{
  "video_id": "P8jPlppa_8I",
  "title": "DS210.17 Time Window Compaction | Operations with Apache Cassandra",
  "description": "#DataStaxAcademy #DS210\nDS210.17 TIME WINDOW COMPACTION\nTime window compaction is purpose built for one kind of data model: time series. In this unit, you will learn how time window compaction works.\n\nLEARN FOR FREE at https://academy.datastax.com -- access all the FREE complete courses, tutorials, and hands-on exercises.\n\nASK QUESTIONS at https://community.datastax.com -- where experts from DataStax & the Apache Cassandra community share their expertise everyday.",
  "published_at": "2020-08-11T12:38:17Z",
  "thumbnail": "https://i.ytimg.com/vi/P8jPlppa_8I/maxresdefault.jpg",
  "channel_title": "DataStax Developers",
  "channel_id": "UCAIQY251avaMv7bBv5PCo-A",
  "tags": [
    "cassandra",
    "datastax",
    "tutorial",
    "apache_cassandra"
  ],
  "url": "https://www.youtube.com/watch?v=P8jPlppa_8I",
  "transcript": {
    "available": true,
    "language": "English (auto-generated)",
    "language_code": "en",
    "is_generated": true,
    "text": "[Music] let's talk about time window compaction one of my favorites why because it's kind of fun but it's really useful it is purpose-built for one type of data model and that's time series and as you see how it works you'll see why it's so good for that it really takes advantage of a lot of things cassandra can do but also takes into account why you're using a time series data model let me explain so here is a great animation of what time window compaction does hold onto your hat there's a lot of data flying around here but hopefully this will make sense for you so time windows we're looking at when data arise on the system we're starting at 3 pm but where do we end that time window that concept what window is it well we get to choose windows of certain sizes in this case in this example we're going to use a one hour window we're saying this window of time is significant so from three o'clock to four o'clock so as we're writing data at three o'clock we hit the four o'clock mark it will then compact all of the ss tables into one ss table that marks 3 pm to 4 pm so that time window now is compacted and done as we move to the next window at 4 pm here's a whole bunch more files now look what it did here it actually did a size tier compaction inside of that window of time that is one of the features of time window compaction inside of that hour if you're writing a lot of data instead of just creating a whole bunch of little tiny files it's still going to run sidesteer compaction inside of that hour now what happens when we hit the hour 5 pm here's another window it compacts all of the data inside of that window see where we're going here more data is written more data is compacted more data is written more data is compacted until you guessed it we hit the next hour mark at 6 p.m what do you think is going to happen i'll let you guess that's right it does a compaction and it just keeps doing this over and over again and what we wind up getting here is over time as we're writing a lot of data in the system it's creating these windows of data and that's really important whenever we're reading that data if i'm looking at this and saying when am i going to find that data well we're just going to look at a certain time window and that data never has to be compacted ever again at this final state where all my data is here for the day because it's a time series data model i'm not expecting there to be any tombstones i'm not expecting there to be any overwrites i'm seeing this data is fairly immutable but i want to have it grouped up in a way that i can move it away from the compaction process and never be compacted again so once i go outside of that hour window it's never touched again this greatly reduces the amount of disk io on a really fast moving time series data model so some of the details here an ss table over those two windows well we just go back to that second window it's just that simple we're not trying to be too fancy or it doesn't split it or do anything like that we want to go for 50 or so ss tables on disk within the window so this is how you compute how big of a window you want the reason being is because when you get to that hour window or whatever that window size is you have to compact that many files so if you create a window say like one day and there's 3 000 files in there at the end of that day it's going to be a very bad moment for that computer it's going to be doing a lot of compaction so let's give it a break think about what you're going to do to it have a little empathy keep it to 50 files some of the tuning parameters are really just the windows unit minutes hours and days and then the window size those are it and that's the simplicity and beauty of time window compaction so i want to do some really granular stuff like i want a 10 minute window or 15 hour window something like that great it's very simple and it should fit in your head this is just the window of time that i want and this is what i want to compact another area of tuning which is probably the bigger problem is looking for tombstones tombstones as you know are deleted data and those can tend to pile up if you have an ss table out there with a lot of tombstones in it this could be a problem in time window so we check that it starts looking for those to clean them out now this is a bit of an anti-pattern if you're going to use a lot of tombstones think twice about using time window compaction you're going to create a lot of data that's just going to sit there until it finally gets compacted and it may not get compacted for a very long time so this is a good overview of time window compaction and i think the animation really makes it here that's something you need to see working but it is really simple here's a window of time compact all my data inside of it leave it alone put it aside don't touch it that's what you really want in a time series data model i'm done with this data i just want to read it later put it aside don't mess with it anymore time window compaction strategy is the don't mess with it compaction strategy and it can be really helpful so when you have a time series data model think about using time window compaction strategy",
    "segments": [
      {
        "start": 1.43,
        "duration": 5.33,
        "text": "[Music]"
      },
      {
        "start": 7.839,
        "duration": 3.521,
        "text": "let's talk about"
      },
      {
        "start": 8.8,
        "duration": 3.52,
        "text": "time window compaction one of my"
      },
      {
        "start": 11.36,
        "duration": 3.76,
        "text": "favorites"
      },
      {
        "start": 12.32,
        "duration": 3.92,
        "text": "why because it's kind of fun but it's"
      },
      {
        "start": 15.12,
        "duration": 3.44,
        "text": "really useful"
      },
      {
        "start": 16.24,
        "duration": 3.36,
        "text": "it is purpose-built for one type of data"
      },
      {
        "start": 18.56,
        "duration": 4.08,
        "text": "model and that's"
      },
      {
        "start": 19.6,
        "duration": 3.679,
        "text": "time series and as you see how it works"
      },
      {
        "start": 22.64,
        "duration": 2.639,
        "text": "you'll see"
      },
      {
        "start": 23.279,
        "duration": 3.121,
        "text": "why it's so good for that it really"
      },
      {
        "start": 25.279,
        "duration": 2.32,
        "text": "takes advantage of a lot of things"
      },
      {
        "start": 26.4,
        "duration": 3.52,
        "text": "cassandra can do"
      },
      {
        "start": 27.599,
        "duration": 4.161,
        "text": "but also takes into account why you're"
      },
      {
        "start": 29.92,
        "duration": 4.56,
        "text": "using a time series data model"
      },
      {
        "start": 31.76,
        "duration": 3.68,
        "text": "let me explain so here is a great"
      },
      {
        "start": 34.48,
        "duration": 3.84,
        "text": "animation of"
      },
      {
        "start": 35.44,
        "duration": 4.32,
        "text": "what time window compaction does hold"
      },
      {
        "start": 38.32,
        "duration": 2.48,
        "text": "onto your hat there's a lot of data"
      },
      {
        "start": 39.76,
        "duration": 2.72,
        "text": "flying around here"
      },
      {
        "start": 40.8,
        "duration": 4.0,
        "text": "but hopefully this will make sense for"
      },
      {
        "start": 42.48,
        "duration": 4.88,
        "text": "you so time windows"
      },
      {
        "start": 44.8,
        "duration": 3.279,
        "text": "we're looking at when data arise on the"
      },
      {
        "start": 47.36,
        "duration": 3.12,
        "text": "system"
      },
      {
        "start": 48.079,
        "duration": 3.12,
        "text": "we're starting at 3 pm but where do we"
      },
      {
        "start": 50.48,
        "duration": 2.88,
        "text": "end"
      },
      {
        "start": 51.199,
        "duration": 3.2,
        "text": "that time window that concept what"
      },
      {
        "start": 53.36,
        "duration": 3.44,
        "text": "window is it"
      },
      {
        "start": 54.399,
        "duration": 3.441,
        "text": "well we get to choose windows of certain"
      },
      {
        "start": 56.8,
        "duration": 3.279,
        "text": "sizes"
      },
      {
        "start": 57.84,
        "duration": 3.28,
        "text": "in this case in this example we're going"
      },
      {
        "start": 60.079,
        "duration": 3.041,
        "text": "to use a one"
      },
      {
        "start": 61.12,
        "duration": 3.999,
        "text": "hour window we're saying this window of"
      },
      {
        "start": 63.12,
        "duration": 4.56,
        "text": "time is significant"
      },
      {
        "start": 65.119,
        "duration": 4.721,
        "text": "so from three o'clock to four o'clock so"
      },
      {
        "start": 67.68,
        "duration": 4.32,
        "text": "as we're writing data at three o'clock"
      },
      {
        "start": 69.84,
        "duration": 3.2,
        "text": "we hit the four o'clock mark it will"
      },
      {
        "start": 72.0,
        "duration": 3.84,
        "text": "then compact"
      },
      {
        "start": 73.04,
        "duration": 3.84,
        "text": "all of the ss tables into one ss table"
      },
      {
        "start": 75.84,
        "duration": 4.24,
        "text": "that marks"
      },
      {
        "start": 76.88,
        "duration": 4.96,
        "text": "3 pm to 4 pm so that time window now is"
      },
      {
        "start": 80.08,
        "duration": 4.8,
        "text": "compacted and done"
      },
      {
        "start": 81.84,
        "duration": 5.76,
        "text": "as we move to the next window at 4 pm"
      },
      {
        "start": 84.88,
        "duration": 3.84,
        "text": "here's a whole bunch more files now look"
      },
      {
        "start": 87.6,
        "duration": 3.28,
        "text": "what it did here"
      },
      {
        "start": 88.72,
        "duration": 4.16,
        "text": "it actually did a size tier compaction"
      },
      {
        "start": 90.88,
        "duration": 3.36,
        "text": "inside of that window of time"
      },
      {
        "start": 92.88,
        "duration": 3.68,
        "text": "that is one of the features of time"
      },
      {
        "start": 94.24,
        "duration": 4.72,
        "text": "window compaction inside of that"
      },
      {
        "start": 96.56,
        "duration": 4.0,
        "text": "hour if you're writing a lot of data"
      },
      {
        "start": 98.96,
        "duration": 2.96,
        "text": "instead of just creating a whole bunch"
      },
      {
        "start": 100.56,
        "duration": 2.72,
        "text": "of little tiny files"
      },
      {
        "start": 101.92,
        "duration": 3.36,
        "text": "it's still going to run sidesteer"
      },
      {
        "start": 103.28,
        "duration": 4.32,
        "text": "compaction inside of that hour"
      },
      {
        "start": 105.28,
        "duration": 3.199,
        "text": "now what happens when we hit the hour 5"
      },
      {
        "start": 107.6,
        "duration": 3.04,
        "text": "pm"
      },
      {
        "start": 108.479,
        "duration": 3.041,
        "text": "here's another window it compacts all of"
      },
      {
        "start": 110.64,
        "duration": 2.72,
        "text": "the data"
      },
      {
        "start": 111.52,
        "duration": 4.08,
        "text": "inside of that window see where we're"
      },
      {
        "start": 113.36,
        "duration": 4.079,
        "text": "going here more data is written"
      },
      {
        "start": 115.6,
        "duration": 3.519,
        "text": "more data is compacted more data is"
      },
      {
        "start": 117.439,
        "duration": 3.36,
        "text": "written more data is compacted"
      },
      {
        "start": 119.119,
        "duration": 3.921,
        "text": "until you guessed it we hit the next"
      },
      {
        "start": 120.799,
        "duration": 3.36,
        "text": "hour mark at 6 p.m"
      },
      {
        "start": 123.04,
        "duration": 3.6,
        "text": "what do you think is going to happen"
      },
      {
        "start": 124.159,
        "duration": 4.72,
        "text": "i'll let you guess that's right"
      },
      {
        "start": 126.64,
        "duration": 4.88,
        "text": "it does a compaction and it just keeps"
      },
      {
        "start": 128.879,
        "duration": 5.44,
        "text": "doing this over and over again"
      },
      {
        "start": 131.52,
        "duration": 4.48,
        "text": "and what we wind up getting here is over"
      },
      {
        "start": 134.319,
        "duration": 2.64,
        "text": "time as we're writing a lot of data in"
      },
      {
        "start": 136.0,
        "duration": 3.68,
        "text": "the system"
      },
      {
        "start": 136.959,
        "duration": 3.441,
        "text": "it's creating these windows of data and"
      },
      {
        "start": 139.68,
        "duration": 2.16,
        "text": "that's really"
      },
      {
        "start": 140.4,
        "duration": 3.36,
        "text": "important whenever we're reading that"
      },
      {
        "start": 141.84,
        "duration": 4.479,
        "text": "data if i'm looking at this and saying"
      },
      {
        "start": 143.76,
        "duration": 3.839,
        "text": "when am i going to find that data well"
      },
      {
        "start": 146.319,
        "duration": 2.081,
        "text": "we're just going to look at a certain"
      },
      {
        "start": 147.599,
        "duration": 3.201,
        "text": "time window"
      },
      {
        "start": 148.4,
        "duration": 3.76,
        "text": "and that data never has to be compacted"
      },
      {
        "start": 150.8,
        "duration": 3.28,
        "text": "ever again"
      },
      {
        "start": 152.16,
        "duration": 3.359,
        "text": "at this final state where all my data is"
      },
      {
        "start": 154.08,
        "duration": 3.6,
        "text": "here for the day"
      },
      {
        "start": 155.519,
        "duration": 3.761,
        "text": "because it's a time series data model"
      },
      {
        "start": 157.68,
        "duration": 3.04,
        "text": "i'm not expecting there to be any"
      },
      {
        "start": 159.28,
        "duration": 2.959,
        "text": "tombstones"
      },
      {
        "start": 160.72,
        "duration": 3.76,
        "text": "i'm not expecting there to be any"
      },
      {
        "start": 162.239,
        "duration": 3.28,
        "text": "overwrites i'm seeing this data is"
      },
      {
        "start": 164.48,
        "duration": 2.56,
        "text": "fairly immutable"
      },
      {
        "start": 165.519,
        "duration": 3.521,
        "text": "but i want to have it grouped up in a"
      },
      {
        "start": 167.04,
        "duration": 2.96,
        "text": "way that i can move it away from the"
      },
      {
        "start": 169.04,
        "duration": 3.76,
        "text": "compaction process"
      },
      {
        "start": 170.0,
        "duration": 5.2,
        "text": "and never be compacted again so once i"
      },
      {
        "start": 172.8,
        "duration": 4.96,
        "text": "go outside of that hour window"
      },
      {
        "start": 175.2,
        "duration": 4.72,
        "text": "it's never touched again this greatly"
      },
      {
        "start": 177.76,
        "duration": 4.0,
        "text": "reduces the amount of disk io on a"
      },
      {
        "start": 179.92,
        "duration": 3.92,
        "text": "really fast moving"
      },
      {
        "start": 181.76,
        "duration": 3.28,
        "text": "time series data model so some of the"
      },
      {
        "start": 183.84,
        "duration": 3.28,
        "text": "details here"
      },
      {
        "start": 185.04,
        "duration": 3.76,
        "text": "an ss table over those two windows well"
      },
      {
        "start": 187.12,
        "duration": 3.36,
        "text": "we just go back to that second window"
      },
      {
        "start": 188.8,
        "duration": 3.2,
        "text": "it's just that simple we're not trying"
      },
      {
        "start": 190.48,
        "duration": 2.72,
        "text": "to be too fancy or it doesn't split it"
      },
      {
        "start": 192.0,
        "duration": 3.44,
        "text": "or do anything like that"
      },
      {
        "start": 193.2,
        "duration": 3.84,
        "text": "we want to go for 50 or so ss tables on"
      },
      {
        "start": 195.44,
        "duration": 3.6,
        "text": "disk within the window"
      },
      {
        "start": 197.04,
        "duration": 3.839,
        "text": "so this is how you compute how big of a"
      },
      {
        "start": 199.04,
        "duration": 2.4,
        "text": "window you want the reason being is"
      },
      {
        "start": 200.879,
        "duration": 2.08,
        "text": "because"
      },
      {
        "start": 201.44,
        "duration": 3.519,
        "text": "when you get to that hour window or"
      },
      {
        "start": 202.959,
        "duration": 4.241,
        "text": "whatever that window size is"
      },
      {
        "start": 204.959,
        "duration": 4.801,
        "text": "you have to compact that many files so"
      },
      {
        "start": 207.2,
        "duration": 5.759,
        "text": "if you create a window say like one day"
      },
      {
        "start": 209.76,
        "duration": 4.72,
        "text": "and there's 3 000 files in there at the"
      },
      {
        "start": 212.959,
        "duration": 3.36,
        "text": "end of that day it's going to be a very"
      },
      {
        "start": 214.48,
        "duration": 2.96,
        "text": "bad moment for that computer"
      },
      {
        "start": 216.319,
        "duration": 3.601,
        "text": "it's going to be doing a lot of"
      },
      {
        "start": 217.44,
        "duration": 3.76,
        "text": "compaction so let's give it a break"
      },
      {
        "start": 219.92,
        "duration": 3.039,
        "text": "think about what you're going to do to"
      },
      {
        "start": 221.2,
        "duration": 4.08,
        "text": "it have a little empathy"
      },
      {
        "start": 222.959,
        "duration": 3.36,
        "text": "keep it to 50 files some of the tuning"
      },
      {
        "start": 225.28,
        "duration": 3.28,
        "text": "parameters"
      },
      {
        "start": 226.319,
        "duration": 3.28,
        "text": "are really just the windows unit minutes"
      },
      {
        "start": 228.56,
        "duration": 3.679,
        "text": "hours and days"
      },
      {
        "start": 229.599,
        "duration": 4.321,
        "text": "and then the window size those are it"
      },
      {
        "start": 232.239,
        "duration": 3.121,
        "text": "and that's the simplicity and beauty of"
      },
      {
        "start": 233.92,
        "duration": 3.679,
        "text": "time window compaction"
      },
      {
        "start": 235.36,
        "duration": 3.84,
        "text": "so i want to do some really granular"
      },
      {
        "start": 237.599,
        "duration": 3.681,
        "text": "stuff like i want a 10 minute window or"
      },
      {
        "start": 239.2,
        "duration": 4.88,
        "text": "15 hour window something like that"
      },
      {
        "start": 241.28,
        "duration": 3.519,
        "text": "great it's very simple and it should fit"
      },
      {
        "start": 244.08,
        "duration": 2.079,
        "text": "in your head"
      },
      {
        "start": 244.799,
        "duration": 3.36,
        "text": "this is just the window of time that i"
      },
      {
        "start": 246.159,
        "duration": 4.241,
        "text": "want and this is what i want to compact"
      },
      {
        "start": 248.159,
        "duration": 3.521,
        "text": "another area of tuning which is probably"
      },
      {
        "start": 250.4,
        "duration": 3.759,
        "text": "the bigger problem is"
      },
      {
        "start": 251.68,
        "duration": 3.119,
        "text": "looking for tombstones tombstones as you"
      },
      {
        "start": 254.159,
        "duration": 2.881,
        "text": "know"
      },
      {
        "start": 254.799,
        "duration": 4.081,
        "text": "are deleted data and those can tend to"
      },
      {
        "start": 257.04,
        "duration": 3.599,
        "text": "pile up if you have an ss table out"
      },
      {
        "start": 258.88,
        "duration": 3.44,
        "text": "there with a lot of tombstones in it"
      },
      {
        "start": 260.639,
        "duration": 3.84,
        "text": "this could be a problem in time window"
      },
      {
        "start": 262.32,
        "duration": 2.64,
        "text": "so we check that it starts looking for"
      },
      {
        "start": 264.479,
        "duration": 2.72,
        "text": "those"
      },
      {
        "start": 264.96,
        "duration": 3.28,
        "text": "to clean them out now this is a bit of"
      },
      {
        "start": 267.199,
        "duration": 2.241,
        "text": "an anti-pattern"
      },
      {
        "start": 268.24,
        "duration": 3.44,
        "text": "if you're going to use a lot of"
      },
      {
        "start": 269.44,
        "duration": 3.199,
        "text": "tombstones think twice about using time"
      },
      {
        "start": 271.68,
        "duration": 2.16,
        "text": "window compaction"
      },
      {
        "start": 272.639,
        "duration": 3.521,
        "text": "you're going to create a lot of data"
      },
      {
        "start": 273.84,
        "duration": 4.079,
        "text": "that's just going to sit there until it"
      },
      {
        "start": 276.16,
        "duration": 3.92,
        "text": "finally gets compacted and it may not"
      },
      {
        "start": 277.919,
        "duration": 3.761,
        "text": "get compacted for a very long time"
      },
      {
        "start": 280.08,
        "duration": 2.96,
        "text": "so this is a good overview of time"
      },
      {
        "start": 281.68,
        "duration": 2.959,
        "text": "window compaction and i think the"
      },
      {
        "start": 283.04,
        "duration": 3.52,
        "text": "animation really makes it here"
      },
      {
        "start": 284.639,
        "duration": 3.041,
        "text": "that's something you need to see working"
      },
      {
        "start": 286.56,
        "duration": 3.44,
        "text": "but it is really"
      },
      {
        "start": 287.68,
        "duration": 3.84,
        "text": "simple here's a window of time compact"
      },
      {
        "start": 290.0,
        "duration": 3.919,
        "text": "all my data inside of it"
      },
      {
        "start": 291.52,
        "duration": 4.16,
        "text": "leave it alone put it aside don't touch"
      },
      {
        "start": 293.919,
        "duration": 2.081,
        "text": "it that's what you really want in a time"
      },
      {
        "start": 295.68,
        "duration": 2.16,
        "text": "series"
      },
      {
        "start": 296.0,
        "duration": 3.28,
        "text": "data model i'm done with this data i"
      },
      {
        "start": 297.84,
        "duration": 4.32,
        "text": "just want to read it later"
      },
      {
        "start": 299.28,
        "duration": 4.639,
        "text": "put it aside don't mess with it anymore"
      },
      {
        "start": 302.16,
        "duration": 3.84,
        "text": "time window compaction strategy is the"
      },
      {
        "start": 303.919,
        "duration": 4.961,
        "text": "don't mess with it compaction strategy"
      },
      {
        "start": 306.0,
        "duration": 4.4,
        "text": "and it can be really helpful so when you"
      },
      {
        "start": 308.88,
        "duration": 5.2,
        "text": "have a time series data model"
      },
      {
        "start": 310.4,
        "duration": 3.68,
        "text": "think about using time window compaction"
      },
      {
        "start": 314.68,
        "duration": 3.0,
        "text": "strategy"
      }
    ],
    "error": null,
    "error_type": null
  },
  "collected_at": "2025-12-16T01:30:26.412329+00:00"
}