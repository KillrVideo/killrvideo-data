{
  "video_id": "2qSVnQzVpK4",
  "title": "CQRS with Event Sourcing, Scala, Akka and Cassandra",
  "description": "Join guest instructor Daniel from RocktheJVM and learn to make a single, scalable system for managing Hotel bookings. Manage 1000+ hotels that have millions of possible events, bookings, changes, cancellations, and extras!  See below for GitHub repo and additional tutorial resources.\n\nChapters: \n- Intro\n- Project Setup (11:54)\n- Live Coding Implementation with Docker - based Cassandra (14:10)\n- Astra DB setup + live run (1:22:38)\n\nSignup for Astra DB: https://astra.dev/rockjvmCQRS\nSource Code: https://github.com/rockthejvm/cqrs-akka-cassandra-demo\n\nApache Cassandra: https://cassandra.apache.org/doc/latest/\nScala: https://www.scala-lang.org/\nAkka: https://akka.io\nCassandra Fundamentals 3rd edition: \nhttps://astra.dev/3J9A7J7\n\nLearn more about Scala and Akka with @rockthejvm \nhttps://www.youtube.com/c/rockthejvm \nhttps://rockthejvm.com/\n\nCONNECT WITH DATASTAX\nSubscribe: http://www.youtube.com/c/datastaxdevs?sub_confirmation=1 \nTwitter: https://twitter.com/datastaxdevs\nTwitch: https://www.twitch.tv/datastaxdevs\n\nAbout DataStax:\nDataStax is the company behind the massively scalable, highly available, cloud-native NoSQL data platform built on Apache Cassandra™. DataStax gives developers and enterprises the freedom to run data in any cloud, Kubernetes, hybrid or bare metal at global scale with zero downtime and zero lock-in. More than 450 of the world’s leading enterprises including Capital One, Cisco, Comcast, Delta Airlines, Macy’s, McDonald’s, Safeway, Sony, and Walmart use DataStax to build transformational data architectures for real-world outcomes. For more, visit DataStax.com and @DataStax.\n\nAbout DataStax Developer:\nOn the DataStax Developers YouTube channel, you can find tutorials, workshops and much more to help you learn and stay updated with the latest information on Apache Cassandra©.  Visit https://datastax.com/dev for more free learning resources.",
  "published_at": "2022-07-27T16:45:24Z",
  "thumbnail": "https://i.ytimg.com/vi/2qSVnQzVpK4/maxresdefault.jpg",
  "channel_title": "DataStax Developers",
  "channel_id": "UCAIQY251avaMv7bBv5PCo-A",
  "tags": [
    "scalable",
    "demo",
    "workshop",
    "cassandra",
    "tutorial",
    "apache_cassandra",
    "nosql",
    "astra",
    "architecture",
    "datastax"
  ],
  "url": "https://www.youtube.com/watch?v=2qSVnQzVpK4",
  "transcript": {
    "available": true,
    "language": "English (auto-generated)",
    "language_code": "en",
    "is_generated": true,
    "text": "[Music] hello and welcome to the data stacks developers youtube channel i'm very pleased to announce we have a special guest today and daniel from rock the jvm up and up-and-coming youtuber who focuses on scala akka and distributed systems he's here to give you a master class today in cqrs or command query responsibility segregation with event sourcing scala akka and of course apache cassandra daniel thanks for being with us today and take it away hi everyone and welcome to cqrs with event sourcing and scala akka and cassandra this video is a live coding tutorial of how to implement the cqrs pattern in your own application and how to run it on datastax's astrodb service my name is daniel and i'm a software engineer and instructor i've been teaching everything in the skull ecosystem in live and online training for more than eight years now and i've had the privilege to train high performing teams at companies like apple adobe and microsoft i also run this website called rock the jvm which has long form training material on the skull language effect systems like cats and zeo data streaming with apache flink big data with apache spark and distributed systems with akka which is what we are going to use in this video i have more than 230 hours of material on the site so there's a lot of feast upon if you're ever interested in the scholar world now the objective of this video is to demonstrate implementation of cqrs and event sourcing with scala akka and cassandra now these are very powerful tools using many high throughput applications and high profile companies around the world and this video is a demo with a realistic scenario dealing with high load scala grade problems now this demo is for you if you're curious to see these technologies and tools in action or if you want to learn what cqrs is and how it's different from other models of storage now i recommend that you use this video in one of two ways either as entertainment and a way to satisfy your curiosity in which case i'd recommend you simply watch what i'm doing and see the effects live or you can follow along and get your hands dirty as i write code on camera i like to demonstrate by doing so i write live code in all my courses at rock the jvm and in demos like this now the structure of the demo is as follows first i'm going to introduce cqrs and event sourcing as design patterns as well as the akka persistence tool that we're going to use in the video after that i'll walk you through the starting project setup and then for most of the video we're going to do live code and testing locally on a docker cassandra instance and finally at the end of the video we're going to take the official datastax osterdb service for a spin with the code that we implement in the video now everything is coded live on camera so you can find links to the github repository and all the resources that we use in the code and you can find them in the description of the video the demo will be quite big so i'm going to speed on some coding parts but i've edited the video so that you can pause it and follow along still i'm going to leave nothing unexplained as we follow through this video now with that said let me introduce the core concepts of the video first cqrs comes from command and query responsibility segregation which is a design pattern on how to organize your code and data while interacting with a persistent store complex applications with high data access concurrency might find themselves in a rut sometimes there are different models or performance requirements for reads and writes for example if the number of stakeholders is disproportionate on one side or there might be the risk of data access contention because of such concurrency or the unifying of the data model will likely make it too complex to manage and there's also data security compliance which is hard to enforce on shared data to that we have the solution to separate the read model from the right model and organize your code in terms of commands which can be applied and these commands will be additive and will have the role of changing your internal state while queries will be separate and will investigate the current state of the system so the picture in a broad sense will look something like this with one side writing to the database using a right specific data model while another stakeholder reads data appropriate for them using another model and these two models for read and write will be synchronized with some tools that we're going to see in the code now the use cases for cqrs include applications with high data access concurrency and task based applications for example a hotel booking which is what we're going to see in the code or an online store and i'm going to show you some examples also cqrs is appropriate for applications with different read and write performance requirements for example if you have a disproportionate number of readers you have different performance requirements for the read side compared to the right side also as we will see in the code cqrs especially appropriate for the situations with a high likelihood of schema evolution that is the situation where you have to change the structure of your data which is particularly painful in regular crud applications obviously cqrs is not to be used with simple crud logic so simple databases where you simply store the latest state in the database directly or for infrequent data access because cqrs is also built for a specific kind of performance now cqrs is often paired with another design pattern called event sourcing now event sourcing is appropriate for the situations when the current state of the system will change all the time but you're also interested in querying a previous state or in tracing how you arrived at the current state examples include tracing orders in an online store or tracing the transaction history in a bank or the chat message history or document versioning in a shared repository and or as we will see in the code we have a hotel booking system now let me give you a relatable situation let's say we are interested in designing an online store and we want to trace an order so we are asking for all the data about an order in a regular crud based database if we want to investigate the state of a particular order we get a single row which is a traditional relational model select star from whatever orders and give me the latest status whereas we can have a much richer description of the status of the order by tracing all the events about the order so a table might look something like this where an order might be created the inventory will be allocated the order will be dispatched delivered or it may be returned cancelled refunded and there are a bunch of stuff that can happen with that order and you can track everything that happens to it so instead of storing the current state which is refunded and we haven't learned too much we can also ask why the order was refunded so we can store all the events that led to the current state and we can always recreate the current state by replaying all the events in order now to implement the event sourcing pattern we're going to use a tool called akka persistence if you've never heard about aka before it's a powerful toolkit that will implement the actor model the actor model will organize your code into so-called actors which are independent encapsulated entities with their own state and behavior they're fully encapsulated so they're not available for regular object oriented method calls but you can only communicate with them via asynchronous message passing now because they're fully independent and asynchronous you can spin up a large very large amount of these independent actors and schedule them on a relatively small thread put for an incredibly high throughput of your application now these are normal actors we will use a special breed of actors called persistent actors which come with extra capabilities every persistent actor will have a unique persistence id and this actor can persist events to a long-term store so this can store events into a database such as cassandra a persistent actor will also be able to recover its own state by replaying events from the store so when an actor receives a message which we will call command from now on it will asynchronously persist an event to the store and after the event is persisted it will be able to change its internal state now when the actor is spun up or restarts because of an application crash or because of an application restart or upgrade the actor will be able to replay all the events associated to its persistent id and recover its state as if nothing had happened so let me show you a quick picture let's assume that this is an actor this blue blob is an actor with a message handler which is the behavior and the mailbox which is used to store all the messages that you send to it when one of the threads in the threadball schedules to run this actor the thread will simply dequeue messages from the mailbox and it will treat every message atomically now let's assume that this actor interacts with a persistent store when the actor is scheduled to run on a thread it will simply dequeue messages and will read that message with the internal behavior of the actor which is its internal code now that behavior can do a lot of stuff and one of the very often used effects is to persist an event to the persistent store once the persistent store acknowledges the persistence of that effect it will notify the actor this will be transparent to us as programmers and when the actor receives this acknowledgement it will change its internal state and as an effect of that it might send messages to other actors in the system as i mentioned we have lots and lots of actors in a aka persistent system and after the actor is done with the message it will simply discard it and dequeue further messages for as long as it holds that particular thread so a new message might be dequeued treated by the handler a new event might be persisted some further messages might be handled and so on and so forth for as long as the actor has hold of that threat obviously the thread pull will juggle between many many of these actors so from our standpoint an actor is effectively a single threaded business now let me show you a picture of what happens to an actor when an application starts or restarts for whatever reason so assume that this is a persistent store and an actor is simply spun up when the application starts an application with an actor with a persistence id will simply ask the persistent store for all the events associated for that persistence id the persistent store will fetch all these events and the actor will simply replay all these events in order and the actor will recreate its internal state so in this demonstration we're going to implement a realistic scenario dealing with events at scale we're going to imagine a hotel reservation system which manages bookings for a thousand plus hotels although you can scale for much more than that so we can treat millions of possible events in a short span of time and we can deal with a variety of event types the fundamental interaction is going to be between a hotel which we are going to imagine as an actor and the persistent store which is going to be cassandra each hotel actor will be a persistent actor and we're going to implement event sourcing on that obviously we're going to manage many many hotels up to 1 000 or even more than that and we are going to manage all these hotel actors by some sort of centralized agent which will in turn receive requests by some sort of front-facing api or application which manages bookings this front-facing api is not really that interesting for our cqrs demo so we will leave that aside but i'm going to leave that to you as an exercise if you want to expose that this is the right side on the read side we will have various hotel staff apps specialized for each hotel which will monitor all the events associated with that particular hotel and they will recreate the entire state the entire state of that hotel in terms of reservations so that they can query that state very easily for availability so we will implement the cqrs pattern in which the right site which is the booking service will issue commands such as make a reservation amend the reservation cancel it and so on and so forth while the read side which is the hotel management app will inspect the current state for that particular hotel and we can have many hotel staff apps independently monitoring their state we will pair cqrs with event sourcing and aqua persistence in which incremental events will be stored to cassandra and the state of the system will be recreated by replaying all these events so without further ado let me show you the project so i'm here in intellij idea i'm using the intellij idea plugin for scholar development and we will have a plain intellij project with a bunch of resources and configurations and a playground application you can check out the git repository which has a start tag which you can check out to bring the state of the code in this state that you are seeing right now now let me quickly walk you through this project we are going to spend all of our time under source main scholar here we have a playground application with a simple actor system that will simply test whether you have the library dependencies already downloaded and installed which brings me to build.sbt which contains all the library definitions that we're going to need for this demonstration once you load this in intellij intellij it will take care to download all the appropriate libraries besides the playground application we have a bunch of configurations which we won't really touch until the end of the demonstration application.com in particular is of most interest to us when we want to change the connection from a local cassandra to the cloud-based data stacks astra db and besides that we have a docker compose yml which will spin up a local version of cassandra for us to interact with at the same time in order to set up the appropriate tables we have this little file called tablesetup.cql this model is the exact same scenario as the definitive guide book which you can find on the datastax website free of charge if you're interested in checking that out i pulled all the table definitions here in this file so that we can access them more easily and set up the appropriate tables once the docker container starts now speaking of the docker container i recommend that you open a terminal window on your computer and navigate to the directory where you downloaded the git repository and run this command docker dash compose up i assume that you already have docker on your computer when you hit docker compose up if you haven't downloaded cassandra before this will take a little while i've done this before and the command spins up the docker container much more easily but leave the docker container to start and we will get back to the code let's test this application so that we can see whether our libraries were downloaded correctly so i'm going to run this application and if we see the string welcome to aka in the logs then we have everything well set all right now i'm going to start by designing the primary interaction between the hotel actor and the cassandra data store so here under the com rock the jvm i'm going to create a new package so i'm going to have com rock the jvm dot bookings and i'm going to design something that says actor so this is going to be the package actor i'm going to create a new scala class i'm going to call this hotel and this will be a class that i won't really want to add to the git repository leave me alone and this will be the primary actor primary persistent actor that will interact with cassandra now this hotel will implement a message protocol so this hotel will only treat a bunch of messages because we're using aca typed so here under the package i'm going to create a new package let's call this model and here under model i'm going to create the commands and the data structures that we're going to use for the rest of the video so here on our model i'm going to create another scala file i'm going to call this protocol and i'm going to remove the protocol class because i'm going to define a bunch of data structures i'm going to speed up the typing a little bit so that we don't waste any time with that now for every reservation we're going to store the guest id the start date and end date for the trip the room number and the actor which we will use to interact with then the change reservation will contain the confirmation number of that reservation which was accepted the start date end date room number and the same actor which we will use to send replies to and the cancellation will simply contain the confirmation number and the actor that we will use to communicate now in order to store a reservation i need to create a reservation case class which is a simple data structure so i'm going to call this reservation and i'm going to store it in a simple file case class reservation will contain a guest id which is a string a hotel id which is also a unique identifier the start date which is going to be a date then the end date which is going to be a date as well the room number which is going to be an int and the confirmation id confirmation number is going to be a string so this is going to be our fundamental data structure which is going to be wrapped inside the events that we are going to store in the cassandra so here back to the models for commands so this is going to be for commands we're also going to store events that we will persist to cassandra and this is going to be a case class let's call this reservation accepted which wraps a reservation one for cancellation so i'm going to call this reservation cancelled and we will have another one for case class let's call this reservation modified or reservation updated with an old reservation and a new reservation so a new reservation as a reservation so these are events the commands are the kind of messages that the actor the hotel actor will receive from the booking service and these are the events that will actually be persisted into cassandra now let's go back to the hotel actor and let's design that now we made this hotel a class but technically this class is never instantiated because an actor of type hotel is actually spun up by akka and it's defined in terms of its behavior so i'm going to turn this class into an object which will only contain some quote-unquote static fields and methods now this object will contain a case class that will store the state of a particular act i'm going to define that with a data type state and this will contain some reservations for a particular hotel so reservations as a set of reservation now i need to import reservation from the model so i will store every state of every actor as a set of all the reservations applied to that actor now i'm going to define an apply method which will allow this hotel object to be invoked much like a function and the apply method will take a hotel id as a string and this will return a behavior so the behavior is the piece of logic that akka uses to handle the command so i'm going to have a behavior from aca actor typed with the type command which we have from the model so i'm going to import everything in the model so now we have the command which is the type that this actor will receive as messages and i'm going to use a special construct called event sourced behavior event source behavior will take three type arguments first of all the command the message that it will receive the event type that it will persist cassandra which we don't have right now and the state that this actor will store internally now let me go back to the model and i'm going to store the reservation accepted update and canceled as events so i'm going to define another sealed trade i'm going to call this event a trait if you don't know scala it's much like a java interface so this is the exact same concept and now the event is known to us the event source behavior also has an apply method which means that this can be invoked like a function and the function will take a bunch of arguments persistence id and the persistence id is a unique identifier from the point of view of the event store which i'm going to use as persistence id dot of unique id of unique id with the hotel id that i get as an argument we got the empty state as an empty set so i'm going to say state with an empty set then we have the command handler and i'm going to define that as a method so i'm going to have a command handler with the hotel id as a string and this is a function from the current state of the actor and the command that is the message that the actor has just received to an effect which will have the event that is persisted into the event store and the new state of the actor i need to import effect from the aka persistence typed and i'm going to leave it unimplemented for now so i'm going to pass this command handler with the hotel id as the third argument of the function and we have an event handler which i'm going to use very similarly i'm going to have another method i'm going to call this event handler so event handler which takes the hotel string and this event handler will also be a function from the state of the actor at that point the event that has just been persisted and the new state of the actor after persisting that event so i'm gonna have my event handler with the hotel id so the fundamental interaction will go as follows this actor will receive a command at some point of course asynchronously when that happens the command handler will be triggered by modifying the internal state of the actor will trigger an effect that will persist that event to the persistent store in this case cassandra so once i receive this command i will persist an event i will create it and i will persist it and after the persistent story has acknowledged the event the second event handler callback will be invoked and the state of the actor will be modified after that awesome now let me go implement the command handler this is a two argument function that contains the state of the actor at this point and the command that i'm just receiving and i need to perform an effect now i need to perform an effect a different effect diff depending on the state of the command so if the command is a make reservation i need to perform some logic change reservation cancel reservation different kinds of logic of course you can add multiple commands if you want so i'm going to run a pattern match so i'm going to say command match and in case we got a make reservation for all the constituent parts i'm going to run the following logic first i'm going to find if there's any conflicting reservation for the hotel plus room interval that i have here in my reservation so if this combination conflicts with any reservation in this set then i'm going to return some sort of failure otherwise i'm going to persist i'm going to say reservation accepted so i'm going to run a quick logic to check whether there is a conflicting reservation that i'm attempting to make now to that end i need to be able to compare reservations for overlapping intervals and also compare these for equality because i'm storing them in a set so let me go back to my reservation data type and let me add a little piece of logic the first piece of logic is an intersect function which returns true if two reservations have the same room in the same hotel and their intervals overlap so we're comparing the hotel id and the room number and the intervals for overlapping the second piece of logic is equals and hash code because we're storing these reservations in a set now for the purpose of this demonstration we're going to consider two reservations equal from the point of view of the set if their reservation numbers their confirmation numbers are identical so reservations are unique by their confirmation numbers now in order to be able to create a reservation we need to be able to somehow generate confirmation numbers as randomly generated strings much like airlines do so i'm going to create a companion object reservation where we will store the quote unquote static fields and methods of this type and i'm going to have a single method called make which will create a reservation based on just guest id hotel id start date and date and room number and leave the confirmation number to that logic to be generated now in order to implement that i'm going to randomly generate a string of 10 characters which will contain only capital alphanumeric characters and i'm going to return a reservation after i've generated that string so this is a simple utility method that will allow me to make reservations very very easily now let's get back to our code in hotel so in the hotel actor we will need to create a tentative reservation and we will get to find some sort of potentially conflicting reservation in this set so i'm going to create a tentative reservation so tentative reservation as reservation.make with guest id and we're going to pass all the arguments here and i'm going to try to find a conflicting reservation so i'm going to have conflicting reservation i'm going to use an option here which is going to be state which i receive as argument so the state here contains the whole set of reservations so state dot reservations find and i'm going to find that reservation for which r dot intersect this tentative reservation is true now the return value is going to be an option reservation so option reservation and i need to pattern match against this one so if the conflicting reservation option dot is empty then i have no problem and i can persist my event so i'm going to have effect dot persist and i'm going to persist this reservation accepted so reservation accepted wrapping this tentative reservation because i can make it and after i've persisted i can then reply or return some sort of confirmation to whoever actor whichever actor sent me this command so i'm going to have reply to the reply to actor and the reply to actor is contained in the make reservation command so i have the reference of the actor to which i can communicate and then i'm going to store the current state and i'm going to say reservation accepted for that tentative reservation so this is the persist and this is the reply to the so-called manager or booking agent actor and otherwise i'm going to return a simple effect that doesn't do anything but rather replies with a command failure so i'm going to have effect dot reply and i'm going to have a reply to and i'm going to return some sort of command failure which i haven't defined yet i need to go back to the protocol and create that so i'm going to create a case class i'm going to call this command failure for a reason as a string let's say and this is the communication with the so-called agent the main actor and the hotel will reply back with a command failure let's say command failure with reservation failed conflict with another reservation for some reason the compiler is unhappy with my s thing and this is probably because the reservation accepted doesn't extend event so i'm going to make sure that all my types extend event and if i do that i can go back to my code and the function is interpreted correctly all right so all the events need to belong to the same trait because all everything is typed so the compiler type checks all so this make reservation is only persisted if we have a non-conflicting scenario here now in case we get a change reservation i'm going to for now i'm going to return an effect dot none because i'm going to try to test whether the make reservation effect was created and i'm going to add another case for cancel reservation and i'm going to again return an effect none and i'm going to add a to do here to change the logic in this case now for make reservation i would like to also handle the event that was persisted which is reservation accepted and we will modify the state of the actor to a new state so i'm going to run a two argument function which is state and event again i'm going to run a pattern match on the event so event match and in case we get a reservation accepted for a reservation i'm going to return a new state so i'm going to have new state save it as a val so new state as state dot copy and i'm going to keep my reservations as state dot reservations plus the reservation that has just been added in scala collections are super easy to add or remove elements to and from and i'm going to define let's call the print line and i'm going to have my state changed and i'm going to return a new state here in this as interpolated string and i'm going to return the new state as the end result of this function again i'm going to add another case and i'm going to add a to do because we don't really need to return anything i'm going to maintain the same state now the to do will act upon the reservation amended or changed in the reservation cancelled events that were persisted right now i want to test whether the make reservation effect was correctly created so here on the comroc the jvm bookings i'm going to create an application so i'm going to have a new package i'm going to call this apps and under apps i'm going to create a let's call this hotel test or hotel playground or something like that so hotel playground and i'm going to make it an object because this will have a main method that will turn this hotel playground into a standalone runnable application so this hotel playground will have a main function now i'm going to spin up an actor system that will hold one of these hotel actors and i'm going to send a message to it let's see what this thing has so first of all i'm going to create a root behavior for the actor system so i'm going to use a construct called behaviors plural so behaviors dot setup and setup takes a data structure called inactive context so ctx and i'm going to create a hotel actor and the so-called agent actor will which will simply log whatever replies the hotel will send back so i'm going to have my logger as ctx.spawn and uh actually i'm going to make the compiler work with me here i'm going to have my behaviors dot empty and i'm going to add a tag a type argument to behaviors.setup let's say that this root actor system will receive messages of type string of course we don't really need to send any messages to the root actor system but i'm going to create a logger behavior so i'm going to have let's call this simple logger as behaviors dot receive and i'm gonna use receive with any kind of message so the simple logger will simply log whatever message it receives to the console so i'm gonna have my context and message as the two argument function and i'm going to use context log info and i'm going to have a simple logger tag and i'm going to inject my message in this interpolated string and i'm going to keep the behavior same so the way that this behavior works is that upon the reception of this message the actor can change its behavior but in this case i'm going to keep the behavior to be the same so i'm going to spin up a logger so i'm going to have my context spawn i'm going to create a small child actor and i'm going to use ctx spawn and i'm going to use simple logger and i'm going to give a name so let's call this logger and i'm going to create my hotel actor so hotel as context spawn and i'm going to use my hotel my hotel actor which i need to import so hotel i'm going to give this id let's call this test hotel and i'm going to use the name test hotel for the actor as well so test hotel is the persistence id of this actor and this is the actor identifier if i want to access that within the actor system now these constructs for those of you who haven't seen aka before they might seem a little strange and that is because an actor is never actually spawned through a constructor of the class but rather it spawned through this construct context.spawn with the behavior described by whatever invocation i might pass as the argument and the actor name obviously all right now i'm going to send a message to this hotel so i'm going to have hotel tell and the way that we send a message to an actor asynchronously is through a method called tell which is denoted in scala with this very interesting name exclamation mark which is an operator so i'm going to use a make reservation that i will import from the model and the make reservation obviously will have a bunch of parameters so the guest id i'm going to have my name and the start date i'm going to use date from java util so not java util java sql date value of and i'm going to use 2022 july 14th which is the day of recording and i'm going to use another date let's say july 21 so we're staying for a week at room 101 and the logger as the reply to actor which this hotel actor will interact with so once the hotel receives the make reservation message it will perform all this logic it will persist this event into cassandra then it will reply to whatever actor i specify which is the simple logger that the reservation was created and the behavior of the root actor system is going to be empty so i'm going to create an actor system so let's call this system as actor system with the rude behavior so rude behavior and the name let's call this demo hotel which will probably be a better name for this application so hotel playground i'm going to use hotel demo and this actor system let's say will terminate after five seconds so system scheduler and i'm going to use schedule once and for five seconds i'm going to run a runnable and i'm going to say system terminate now five dot seconds doesn't exist without an extension method scala offers that i'm going to import a package called scala concurrent duration everything i teach this in my skull advanced course how extension methods work so notice the expression is very interestingly readable and i'm going to import the execution context which is a scholar native thread pool for running this little action so i'm going to import system.executioncontext at this point we should have a runnable application we need to figure out if cassandra is working and by the look of it it seems that cassandra is working we can connect in another terminal window i'm going to use docker ps to find out the name of the cassandra docker container i'm going to copy that and i'm going to run this command docker exec it and i'm going to paste this and then i'm going to use cql shell cql sh to start the cassandra query language shell prompt and if this works then that means the docker container is up and running we should be able to run this application so this is going to be our first run it will take a couple of seconds for the compiler to compile all our code that we wrote in the last half an hour and notice that we have some logs here and we have the demo hotel using the java serializer and notice that the logger got the reservation accepted so the reservation accepted was logged by the logger which means that the event was persisted now due to application.conf aka persistence already knows which persistent store we're going to use so in this case we have here under aka persistence journal we have aqua persistence cassandra journal which is a smart journal that will automatically create the appropriate tables for all the messages and the events that we're going to store in cassandra so here in sql shell i can now run this command select star from a table called akka dot messages so if we see something like this if we see a row in akka.messages this what you see here this binary string is the binary encoding of the reservation accepted event that was persisted in cassandra this table was automatically created by akka persistence and you can check the tag here called test hotel so this is called the persistence id the persistence id is the unique actor that wrote this event into the database so the persistence id is called test hotel which is the exact identifier that we added at the application so the make reservation effect works correctly we can now implement the rest of the effects now looking at the hotel if we go back to the logs of the running of the previous application notice that we also have state changed here so state changed means that our handler our event handler worked correctly in the sense that after the event was persisted in cassandra the internal state of the actor was changed to the set that now contains the reservation with the name daniel the hotel is test hotel the dates are as i typed the room is 101 and the randomly generated string which is the confirmation number now the best thing about this is that if i restart the application and i don't send any more messages to the hotel actor so in hotel demo i cut out the make reservation message or command the hotel because it has the test hotel persistent actor it will ask cassandra for all the events that were associated to that persistence id and therefore the state will still change to the reservation that i added in the previous run so the hotel upon starting the application will restore the entire state as if nothing had happened so i'm going to cut the make reservation thing and i'm going to run the hotel demo again so this time no further events will be persistent to cassandra but notice that we also have state changed from the hotel because the hotel replayed all the events that are already in cassandra associated to that persistence id so if your application crashes or if you need to upgrade it or restart it for any reason all your actors will restore their current state so back to the hotel actor we now need to handle the change reservation and cancel reservation commands now in this case we need to find the old reservation by the confirmation number and if we don't find any reservations we need to reply with a failure if we do then we need to create a tentative reservation and still find a potential conflict with a set of reservations that we currently have if there is such a conflict then we will return a failure otherwise we will persist a reservation changed event much like we did earlier all right now let me find the old reservation so i'm going to have my old reservation and i'm going to use an option here i'm going to say state reservations find and i'm going to find my confirmation number so understand underscore confirmation number must be equal to the confirmation number that i want to change then i will need to create a new reservation so i'm going to have my tentative new reservation so new reservation option as old reservation option that i'm going to map and given the reservation that this option will store inside i'm going to say res copy and i'm going to copy just the start dates end dates and room number because everything else is the same so start date start date equals start date and end date and the room number all right so if there is such an old reservation option the new reservation option will also contain a value now we are going to have a tentative reservation updated event so i'm gonna have let's call this reservation updated event as i'm going to suffix that with an option as well and i'm going to have my old reservation option and i'm going to zip that with a new reservation option and this will be an option containing a tuple and because we have a reservation updated event i need to store the old reservation and the new reservation in this data structure so i'm going to then map that and i'm going to say reservation updated i think and the constructor is called tupold so this is going to be an option of reservation updated this is the event that i want to persist to cassandra if these two options exist now i need to find the conflicting reservation if there is such a thing so i'm going to have let's call this conflicting reservation option as new reservation option which was computed before and i'm going to run a function called flat map and considering the tentative reservation inside so tentative reservation then i'm gonna run the same logic as before so i'm going to have state reservations fined and i'm going to say the reservation contained in the state does not have the same confirmation number because otherwise obviously it will conflict so our confirmation number must not be equal to confirmation number and the intersection so i'm going to have r intersect with this tentative reservation so we have a bunch of options here we need to treat them so i'm going to run a tuple so i'm going to have reservation updated event option and the conflicting reservation option and i'm going to pattern match against these two now in case we get a nun and whatever it means that there is no reservation updated event option because the old reservation could not be found this whole option depends on me finding the old reservation number by confirmation so i'm going to return some sort of confirmation failure so i'm going to have effect dot reply and i'm going to reply to the reply to actor that this change reservation command contains and i'm going to return a command failure i'm going to say cannot update reservation and i'm going to use confirmation number and i'm going to use not found now in case we get something and some value here in conflicting reservation option again this is going to be a command failure because there's already a conflicting reservation for what i will want to do so i'm going to return another command failure i'm going to say cannot update reservation confirmation number conflicting reservations cool and in case we get a sum with the res updated this is the event and none that means the happy path so this is the happy path in which case i found the old reservation option and i did not find the conflicting reservation then it means i'm going to persist my event so i'm going to have effect dot persist and i'm going to persist this res updated thing so res updated because i've computed that beforehand and i'm going to say then reply with the reply to actor and i'm going to return s arrow and i'm going to use this res updated event as before and now i can safely remove the effect none thing because i've already implemented my to-do so i'm going to keep the logic here by the change reservation case all right so we have our effect now let's try this out i'm going to go back to the hotel demo we already have a reservation in the database i will want to try to change a reservation so i'm going to say let's call this change reservation with the confirmation number start date end date room number and reply to i'll need to fetch the confirmation number from the logs which is this thing because it was randomly generated before so i'm going to copy that and the change reservation will have the confirmation number and i will want to change my reservation let's say i want to prolong my stay for another seven days so i'm going to change my reservation to 2022-0728 and i'm going to maintain the same room number okay let's try this out and let's see if it works all right so we have our logger so we have a reservation updated with a old reservation and the new reservation which will be found in cassandra so if we navigate back to cassandra and we select star from aqua messages notice that we now have two events stored in cassandra this is the reservation created and this was the reservation updated this is great now let's go back to the hotel and let me also treat the case for the reservation updated event in my event handler because i didn't add that so i'm going to have a case for reservation updated from the old reservation to the new reservation again i'm going to print line state changed and i'm going to create my new state so i'm going to have new state as state copy and reservations is going to be state reservations minus the old reservation plus the new reservation because i implemented the equals and hash code methods on reservation beforehand adding and removing items from a set is very easy and i'm going to return the new state as well good let me go back to the application let me comment out the message that i sent because these events are already in cassandra and i should now see two state changes in my hotel actor right so we have stay changed so the first one is the reservation between 14th of july and 21st then we have a state changed from the 14th to the 28th and this is great because it maintains the same confirmation number notice that the actor replays all the events to restore its old state now the cancelled logic is very similar so i'm going to speed things up a bit i'm going to simply find the old confirmation by number in my state if i can find it i'm going to persist the event the cancellation event that i'm going to reply with the right response otherwise i'm going to return a failure and in my event handler i'm going to treat the cancellation event and i'm going to update my state now let's test it out so here under the hotel demo application i'm going to also send a cancel reservation for the same reservation confirmation number we don't really need to send the make reservation and change reservation messages again because the hotel actor will recreate the state so i'm going to say hotel i'm going to say instead of change reservation i'm going to say cancel reservation so cancel reservation and i'm only going to pass the reservation confirmation number and the logger actor which the actor will use to reply back so in this case we will have another event persisted to cassandra so these events will be additive but the state of the actor will be reconstructed after them so let me run the application again and we should see three state changes two of them for recovery from cassandra and notice that the third one is a state with a set of empty reservations which means that our reservation was cancelled and if we navigate back to cassandra we should see three events instead of two so notice that we now have three entries in the database one for making reservation one for amending the reservation and one for cancelling it of course if i comment this code as well and if i rerun the application the state of the actor will be restored to an empty state so a state with no reservations after replaying all the reservation events in the database so our hotel actor should work correctly as of this moment now for the real application we're going to spin up many many of these hotel actors and we're going to randomly set the make reservation change reservation and cancel reservation commands to them as simulated by some external api so here under actor i'm going to create a new skull clasp i'm going to call this reservation agent or something like that and this agent will be a object that will generate an influx of these events from some sort of external api so this will simulate a large influx of commands to hotel actors and i'm going to leave it as a to do for now because for now i'm going to focus on a single hotel and then we're going to enhance the scale of this application so back to the hotel now the hotel currently implements the right side of the application the read side has not been implemented yet so from the command query responsibility segregation we've only implemented the command part which is implemented through event sourcing we are also going to implement the read side of this application by creating another application here so here under apps i'm going to create a new scholar class i'm going to call this persistence query demo and i'm going to make it an object because this is going to be a standalone application that will simulate one of those hotel apps that will monitor all the events associated to a particular hotel now that i think about it instead of persistence query demo i'm going to call this hotel event reader or something like that to denote the r part from cqrs so this is going to be a standalone application which will monitor all the events associated to a particular hotel obviously independently from the right side of the application so in order to implement the read part from cqrs we're going to use an aqua persistence feature called akka persistence query this is why i originally named this persistence query demo but it's actually better named by its purpose so i'm going to use aqua persistence query to monitor all the events associated to a particular persistence id which is how a hotel is uniquely identified so i'm going to create an actor system so i'm going to say system as actor system that i'm going to import and i'm going to use behaviors empty i don't really need this actor system to contain any sort of actors so i'm going to leave it at that and i'm going to call this hotel event reader system cool now this system will create what is called a read journal a read journal is one of those little utilities that will monitor all the events in the persistent store in this case cassandra obviously associated to a particular persistence id so i'm going to create a read journal as i'm going to use persistence query and i'm going to import that from the system so the persistence query is indeed based on actors and i'm going to say read journal 4 i'm going to add a type argument and this is called cassandra read journal and i'm going to import that make sure you import from the scala dsl because we're writing skal of course and the argument of that is going to be cassandra read journal dot identifier so every journal will have a unique identifier by which persistence query will identify it because in a real application we can have persistence query with a variety of stores so i'm going to use this cassandra read journal now with this read journal we can fetch all the persistence ids and all the events by that persistence id which is how a hotel is identified or by tags let me show them in turn so all persistence ids if you want to monitor a specific one i'm going to say persistence ids as read journal dot persistence ids now because persistence ideas can come and go because you add new actors in your database this persistence ids updates over time which is why this is called a source of string and not used i'm going to explain what the source is uh come from aqua stream scale dsl this is an aqua streams thing and aqua streams is a powerful library that will allow you to deal with an infinite amount of data from a variety of sources which is why this persistence id is an aqua stream's source now in order to consume the source you need to connect it to some sort of sync so i'm going to say consumption sync as sync from arca stream scala dsl sync for each print line so these are for now static components and if you want to trigger an active stream you will have to connect them so i'm going to say connected let's call this graph because if you connect a source with a sync you'll get a graph i'm going to say persistenceids.2 consumption sync and if you want to trigger the connected graph because right now it's static and materialize all the appropriate resources sockets and so on and so forth you would say connectedgraph.run now this run method requires an implicit so-called materializer which has the appropriate resources to allocate for the stream components which is why i'm going to mark this system this actor system as implicit this also contains an actual materializer this is an actor system of whatever cool now i'm going to type in a main method and i'm going to call this connectedgraph.run in this application's main method now if you call connectgraph.run you'll print all persistence ids as they come in my hotel application so if i spawn another hotel with another persistence id it will pop up in this little application for now we only have a single persistence id which is that of the only hotel that we have which is called test hotel now in this case let me go back to the application we will see a single row being printed to the console so right now this spins up the appropriate resources and notice that we have test hotel being printed notice that the application is currently running so if by any chance there's another actor with a different persistence id to persistent event to cassandra then you will see that persistence id pop up in this little application as well now this read journal is very powerful because not only can it fetch all the persistence ids but it can also fetch all events for a persistence id so for instance if i want all the events associated to my test hotel let's call this events for test hotel as read journal dot and i'm going to have events by persistence id and i'm going to pass my persistence id test hotel now this function takes a bunch of arguments to identify a sequence number for all the events by persistence id because your events might be quite a lot in your real life application i'm going to simply fetch all of them from 0 to long.max value so that we can fetch all the possible events for this test hotel of course this is also a source and the source wraps an event envelope which will have to unwrap to obtain the actual event that was persisted so i'm going to run a map on that so i'm going to say dot map and i'm going to extract the event out of that event envelope so i'm going to parse that out then i'm going to map again and i'm going to use a partial function that will run a pattern match automatically so in case we get a reservation accepted for some sort of reservation let's say i'm going to print something out so i'm going to say print line i'm going to say making reservation and i'm going to inject res inside and i'm going to do the same for all the possible cases so i'm going to duplicate that so in case we get a reservation changed i'm going to import the whole model here i'm going to say reservation updated for the old reservation to new reservation i'm going to say changing changing reservation from and i'm going to use old reservation to new reservation and in case we get a reservation cancelled i'm going to say canceling cancelling or removing reservation and i'm going to inject res inside now because i'm turning every event into the outcome of print line which is unit i don't really care about absolutely printing anything so i'm going to say in main i'm going to have events for test hotel i'm going to say run with and i'm going to plug in a sync dot ignore so i'm going to say sync dot ignore and instead of run with i'm actually going to say 2 sync ignore that run so that we have a similar approach to the previous example so in this case the read journal will fetch all the events associated to the test hotel so it'll interrogate cassandra for all the messages associated to test hotel and it will print the appropriate string depending on that particular event we can simply run this independently of any other application all right so we have making reservation changing reservation and canceling reservation in this order because that's how these events were persisted now this part is where things might get a little confusing the hotel event reader this application that we have right now is the q part from cqrs not the r part the q part from cqrs so it's an independent reader now this standalone application might also quote unquote write data to the database but for its own internal or separate purposes for instance this particular application might be specific to this hotel so we might want to block the calendar days for which a room is booked or store the reservations by guest for easier queries and so on so notice that everything that we might want to write into cassandra is for its own internal purposes we might as well write to a whole new different persistent store but why we use a different precision store when we have cassandra already so whatever this application may end up writing to cassandra it's for its own internal read model all right so instead of simply printing making reservation changing reservation and canceling reservation i'm actually going to store some data to cassandra that is specific to this hotel for easier queries later so now's the time for me to actually add all those tables that i added at the beginning of the video the table setup.cql this contains all the table definitions for the akka and aka snapshot key spaces in cassandra which aqua persistence automatically creates but we're going to have to create these manually when we connect to ostrodb and we are going to also have some hotel and reservation related tables so i'm going to copy all of this from create key space hotel all the way to the end and notice that in this case we also have a materialized view so depending on the cassandra version that you have and if you've enabled materialized views the experimental feature in cassandra this may or may not work in this particular video i'm not going to use materialized views so this command will fail but i'm fine with that materialized views are an excellent way of keeping some tables in sync so i'm going to copy those and in my sql shell i'm going to paste everything so run all the commands and notice that the materialized view doesn't work because we have materialized views disabled enabled in cassandra y ml so you can enable that in docker container if you wish i'm not going to use that for this video all right so we're going to ignore the materialized view you can enable that if you want so right now we have all the tables for reservations hotels and so on and so forth let's go through them in turn real quick so in the key space hotel we have a type called hotel address if you want to fill some data over there we have hotel.hotels and every hotel will have an id a name phone and an address so this is very useful if you want to actually fake your data with some actual addresses and so on and so forth there are some python packages that do that job very very well we're not going to use these tables for this video but rather i'm interested in available rooms by hotel date this is very important this is essentially a table with calendar days that we can block if a reservation is made so for every hotel for every date for every room number we have a flag whether that room number in that hotel is available at that date so we can fill all the calendar days say for a year for a particular hotel and make the rooms free and whenever we have a reservation we're gonna block all these calendar days as for reservations we have this key space specific to reservations we have the reservation.address also a custom data type we have reservation dot reservations by hotel date so for every hotel for every start date and for every room number we have a confirmation number for a guest id and the end date of their trip so we're going to store these reservations with this primary key the tuple hotel id start date and room number the materialized views you're going to ignore and reservation.reservation by guest is another table that is very useful for query so for every guest last name and confirmation number we can find a particular reservation with a hotel id start date and date and so on and so forth in some sort of centralized fashion also if you want to store data about the reservation guests and amenities by room if you want to add special features or other kinds of commands for example if you want to add extras to bookings for example a special room or breakfast in bed or what have you you can add them in these tables i'm not going to use them for this video in the interest of time so the critical tables are reservations by guest reservations by hotel date and the available rooms by hotel date so the calendar days right so in this hotel event reader we can actually write to these tables now when we make a reservation we need to block the calendar days associated to that reservation which means that the room must be free which means that the calendar days need to be in the reservations table which means i'm going to create another application that will populate these tables for a particular calendar duration let's say a year so i'm going to create a new scholar application and i'm going to call this cassandra table cleaner and i'm going to run this application whenever i need a fresh state of cassandra now in the interest of time i'm going to speed things up a bit so for every hotel right now we have one for every room which is in my assumption 100 rooms per hotel and for every day and i'm assuming a year worth of data i'm going to clear up a day in the calendar for that particular hotel for that particular room now i'm going to slow things down a bit because i'm going to show you how we can write an item to cassandra i'm going to create an actor system so system as actor system from actor typed with behaviors dot empty and i'm going to call this cassandra system and i'm going to create a session which is a cassandra session that will allow me to execute queries so i'm going to use cassandra session registry and i'm going to use cassandra session registry from the scholar dsl package because otherwise we're gonna have some type conflicts for that system and i'm gonna say session four and the configuration path you can find in application.conf it's called akka projection cassandra session config so this is the string that we want so i'm gonna go back and write that string so aka projection cassandra session config and with that session i can actually execute a query to cassandra so i can say session dot execute right and i'm going to pass my insert now i have to be really careful about this insert because the names of the columns need to be matched exactly so because i don't remember them by heart i'm using the appropriate file now because this is an archive stream source i'm going to pair it with a sync and return a future that will simply run all these statements after that i'm going to run a feature that will truncate all the existing tables from cassandra now this contains all the akka tables the akka snapshot and also the reservation tables that i want to clear now all these statements will run as futures as well and i'm going to print something in case something goes wrong now once i've created the clear rooms and this future sequence i'm going to add the clear rooms to this list and after the future finishes i'm going to run a non-complete and in case this thing finishes i'm going to print line a little statement so i'm going to have a print line with all tables clear or something like that and then i'm going to say system.terminate to finish the application so this is a quick application that will simply clear all the tables and insert true in all the calendar days for an entire year for this test hotel now we can run this application by adding a main method at the very end of the file so i'm going to type in a main and i'm going to call this clear tables and we can run this application which will probably take a few minutes for our docker container to execute so many queries so we have roughly 40 000 queries that will be executed by cassandra so i'm going to speed things up a bit all right cool so our application finished and we can test the result of this application by inspecting the hotel available rooms by hotel date because this is the only table that actually has some data so i'm going to copy this table name i'm going to navigate back to my cql shell and i'm going to say select star from this little table and let's say limit 10 to not fill the entire screen and we have for the test hotel for the date the first of january 2023 for the room number 1 to 10 and is available true so we have for every number for every date we have true so before every test we're going to run this application to clear our cassandra tables so now that our cassandra tables are clear let's go back to our hotel event reader which is the persistence query based read application and instead of making reservation changing reservation and cancelling reservation just as prints we're going to store some data into cassandra just for this application to read so let me go ahead and create a simple method called make reservation and i'm going to have a reservation as an argument and this will simply execute some statements in cassandra to block all the calendar dates and insert some values in the reservation tables now i'm going to create some variables that will deconstruct the reservation and it will tell me which days i need to block in the calendar now in order to execute the statements in cassandra i will need one of those sessions that i built for the other application so getting to the cassandra table cleaner i'm going to copy the session and i'm going to paste it in my reader application so this is the cassandra session and i'm going to have my val session as cassandra session registry wherever and i'm going to use this session to execute some statements so for every day in this days blocked i'm going to execute a statement i'm going to return a list of futures so this is going to be some let's call this blocked days futures as a four comprehension and for every day in zero until day is blocked because that is an int i'm going to yield a future obtained by session dot execute right and i'm going to write the statement to update and i'm going to update the hotel's available rooms by hotel date so i'm going to copy this name paste it here so i'm going to say update this thing set and i'm going to say is available to false and i'm going to have a where clause and in the where clause i'm going to have my hotel id is the hotel id so hotel id and i'm going to make sure i'm wrapping this in single quotes and date is equal to single quotes and i'm going to expand the variable here which is start local date plus days and i'm going to have days and room number equals room number and i'm going to make sure i have the right amount of single quotes now after i block the days in the calendar i also need to add some rows into the reservation by hotel date and reservations by guest tables into separate futures with two separate statements now just to be able to investigate whether any of these statements failed for any reason i'm also going to add some recover callbacks so that we can inspect what went wrong in that case now in order to be able to run these recover callbacks we will need some kind of execution context which will be provided by the actor system so i'm going to have to import system.executioncontext so that we can run all these callbacks so now we have a sequence of futures which i'm going to run with future.sequence and i'm going to import skullconcurrentfuture and i'm going to have my reservation guest future and reservation guest date future and all the block days features so blocked these futures to list and then i'm going to map this entire future to return some sort of unit so this is going to be a future unit and this will simply finish when all these statements complete now at this point the make reservation call is complete so we are executing these statements in cassandra and it returns a future unit so we can actually invoke this future when we found a reservation event so we can say make reservation with res now in this case we will need to run a map async instead of map because make reservation is not a plain value but it's a future so i'm going to change that to map async with let's say a number of threads like eight threads and we will run the same function that will return some futures and for the cases where i simply return some print lines i'm gonna return future dot successful with unit so that we only return a future wrapping a plane value so this is a placeholder i'm going to add a to do here to insert the appropriate data into cassandra if we are changing reservation and canceling reservation in that case so notice that we only have reservation accepted if we are making a reservation at this point we can start the application and listen for all the events that are associated to this persistence id and after that we can spin up our little hotel actor and try to persist some sort of event so i'm going to run this hotel event reader and we have a running application let's see if nothing goes wrong so all good so far and i'm going to start my little hotel demonstration and in my hotel demonstration for test hotel i'm going to simply create a new reservation remember at this point our cassandra database is free because we executed the cassandra table cleaner so all our tables are fresh so at this point we can run our hotel demo as well which will start persisting those events at cassandra and this hotel demo will have a state change so the reservation was accepted and in hotel event reader notice that we now have a log for making reservation for reservation daniel test hotel and so on and so forth with this confirmation number unfortunately it seems that at this point we have some syntax error in our statements but these are surfaced out by our recover callbacks which is a good reason why we added them so let's go back and let's inspect our syntax so we have room day blocking failed we have a syntax error no viable alternative at where hotel because we don't have a space that is okay then we have a syntax error for reservation for date field which is my second query and we have no viable alternative at input closed paren and we have insert into reservation we have values and then again no space because we have some open and closed parenthesis but the values here doesn't have any space and likewise for the third element now let me close my hotel event reader my hotel demo has already finished so the hotel event reader can simply restart at this point because the event has already been persisted into cassandra so this can simply pick it up again so let me start my application and hopefully my syntax is right for the cassandra so notice that we have fewer errors here so the blocking the room date blocking was successful but the reservation for date failed again the syntax error we have a no viable alternative at the closed paren now in this case i think it's something different because the guest id is daniel and the guest id is supposed to be if i remember correctly a unique identifier so the table setup says that the guest id needs to be a unique identifier so uuid and the uid obviously doesn't conform to the string daniel so here under the hotel demo i'm going to create a make reservation not with daniel but a unique identifier so i'm going to have a uuid dot random uuid dot to string now at this point i should invalidate the cassandra messages so all the events that were persisted cassandra which is just one and let me make the reservation again so here under the cql i'm going to say truncate aka.messages so that we don't run that table cleaner again which takes a little while so i'm going to close the hotel event reader and then spin up the hotel demo again and the hotel event reader in any order so i'm going to spin up the reader again and then the hotel demo again and let's see what happens all right so we now have a single reservation because we only have one event and the hotel event reader notice that we have making reservation and no other syntax error and this is great because right now we have some reservations being stored into the center table specifically for this particular hotel so we should be able to find an entry here under reservations by guest and an entry under reservations by hotel date let me try reservation and reservation by guests so i'm going to say select star from this table where and if i go back to my table setup.cql reservations by guest has the primary key guest last name which is rock the jvm and confirmation number now i'm going to say where guest last name is quote rock the jvm and the confirmation number so confirm underscore number is and i'm going to fetch that from the logs which is this little code at the bottom so i'm going to paste that here in between quotes let's see and we have an entry so the guest last name is rock the jvm obviously you can enhance this data with some real names for your guests confirmation number end date is the 21st of july and the start date is the 14th of july as was requested by that event this is great we can try the same for the other table but i'm pretty sure we're also going to have the data there so at this point we have a first step towards full functionality of the read side of this cqrs application we can also add another method here to remove a reservation and also to change the reservation now the implementation of the removal of a reservation is comparatively simple because we can simply start from the previous implementation and just unblock the days in the calendar by setting their flags to true and instead of inserting into the reservation tables we're simply deleting where the conditions hold true for the hotel id start date and room number so in the case for cancellation we can simply call this remove reservation so instead of this to do i'm going to say remove reservation for this reservation and in my hotel demonstration i'm going to run a cancellation and we're going to see if that reservation is still in my tables so here under the hotel event reader i'm going to run this application again so this will simply look for all the events so making reservation which is okay because the event is in the database and in my hotel demo i'm going to issue the cancel reservation command which will persist the event which will then be listened to in the hotel event application so notice that we have a state change and now we have command failure cannot cancel the reservation this one because it's not found and this is completely normal because the reservation confirmation number is changed this time so i need to change the confirmation number and i need to paste it here and rerun my application let's see so it's good that we have all these fail saves in the code all right so the state was changed to an empty state which is good and notice that we now have cancelling reservation for this particular confirmation number but the reservation removal for guest and for date failed again a syntax error let's go back to the hotel event reader and understand what went wrong so the one for the guest failed which is the second one because we have a mismatched input and expecting empty paren i'm going to remove this parenthesis it's probably a token from the last one and the other one says undefined column name room number because i'm used to this camel case instead of a python case let's try running the application again and we should see a cancellation all right so notice that we have canceling reservation which is great we have the cancellation effect being performed and if i try running the select statement again i should not see any more entries in my table so if i run the same query again notice that nothing shows up and this was great a reservation was simply removed from my hotel my room is free now in the case of a change we only need to remove the existing reservation and add a new one now we need to run two futures which is going to be combined in a4 comprehension so in remove reservation for the old reservation and i'm going to add a new reservation so make reservation for the new one so new reservation i'm going to yield unit and because removal and making worked correctly because we've tested them a couple of minutes ago we don't really need to test the reservation updated because we're pretty sure it will work fine so we've fully implemented the cqrs pattern for the entire application for a single hotel it's time we scaled this up a bit so i'm going to create my little reservation agent and i'm going to define some messages that this agent will receive so here i'm going to create a simple trait then i'm going to call hotel protocol and this hotel protocol will be the protocol that the reservation agent will handle so this actor ref here instead of any will be an actor of hotel protocol and this will extend command of course as before and i'm going to have a case class let's call this manage hotel in case this reservation agent will manage a new hotel so manage hotel which is a hotel with an actor ref of type command and this extends hotel protocol and another one i'm going to call this generate which will generate a number of events or commands rather so n commands as an int for the hotels that this thing manages so this extends hotel protocol as well now considering that the command failure and all the events are going to be sent back to the reservation agent i'm going to mix in the hotel protocol in all of them so i'm gonna mix in hotel protocol in this domain model for all of these messages now in real life this reservation agent would have to report to some sort of user-facing api or an http service or a user interface or something like that that will receive all these commands and this reservation agent will pass all these commands all to the hotels under its jurisdiction but in this case i'm going to have the reservation agent generate all these sorts of events so that we can scale our application and see it perform live now this reservation agent is only auxiliary to our application it's not really relevant to the cqrs pattern that we've already demonstrated so i'm going to speed it up a little bit [Music] so enough music we wrote a lot of code and we haven't tested it this reservation agent would simply generate delete or cancellations with probability five percent changes that is updates with fifteen percent so i've added these two together with a twenty percent total and eighty percent with make reservations so this is the proportion that i'm going to go for in this application obviously you can change the numbers as you see fit now we're going to scale things up a bit by creating this reservation agent and making it manage more than one hotel now in order to be able to test it we are going to modify the cassandra table cleaner to manage not just one hotel with the name test hotel but let's say 100 hotels with the name hotel underscore i or something so instead of a simple list i'm going to say 1 to 100 and i'm going to say map for every i i'm going to return the name hotel underscore dollar i and this will mean that we will have 100 times 100 times 365 queries to cassandra so 3.6 million queries to cassandra so as you can imagine it's probably going to take a while so feel free to run this application while we are modifying the rest of our code all right so with my application collapsed i'm going to create another application to automatically generate a large number of events so i'm going to call this reservation generator and i'm going to make it an object with a main method so in this case all i'm going to do is spin up a reservation agent and a bunch of hotels so i'm going to spin up 100 hotels and i'm going to tell the reservation agent to manage every single one of those hotels after that i'm going to generate messages or commands in bursts so 100 times i'm going to generate 10 messages at a time so 1 000 total messages at 100 different hotels so at this point we can simulate an entire application that manages 100 hotels at the same time with messages coming from whatever front-facing api we might want to imagine now from the persistence query side so from the hotel event reader we can monitor all the events associated to a particular hotel so in events by persistence id we can ask for hotel underscore 37 or something and monitor all the events associated to this particular hotel so at this point we can spin up both of these applications this one and the hotel generation app so let me go ahead and do that i'm going to start hotel event reader for hotel 37 so at this point we shouldn't have any kind of messages but once i start the reservation generator we should start seeing some events associated to this particular hotel not too many but some all right so notice that we have a bunch of messages being generated in spurts and we have some making reservation changing reservation and so on and so forth as they come for hotel number 37. so this application can monitor all the events associated to a single hotel obviously you can spin up multiple instances of this hotel event reader for multiple hotels if you'd like all right so at this point our cqrs application is complete at scale now the final piece the crown jewel of this application is to run it on a cloud managed cassandra service which is osterdb from datastax this is essentially cassandra as a service without you having to do pretty much anything for it so we will take this application and we will deploy the data model on a cloud managed service so we will navigate to astra.didastax.com and just sign in with your username and password or sign up if you don't have an account creating one is very easy it's completely free so in a couple of minutes you should be ready to start so you can pause the video and do that if you haven't done so already and after you log in you'll have this dashboard in front of you which will show you all the cassandra databases that you have under your account i already have one because i created one in preparation for this video but for this particular recording i'm going to create a fresh one so i'm going to click this button to create a serverless database and i'm going to follow this little wizard the database name is going to be let's say rock the jvm cqrs demo and the key space name i'm going to start with rock the jvm but we are going to add all the key spaces including aca reservation and hotel for our database we're going to select a cloud provider i'm in europe so i'm going to click europe and i'm going to select one of these regions and then i'm going to click this blue button to create the database this should only take a couple of seconds and after the spinner finishes you'll get to the client id client secret and token which were already created automatically by the cassandra service but we will create a new admin token from scratch with heightened privileges so you can click this blue button to go to the database after the spinner finishes you'll get to another dashboard which is particular for this cqrs demonstration database that we've just created now for this database i'm going to create a new token as i promised so click on your current organization click on organization settings and go to token management and you will select an administrator user which is the topmost privilege for everything that you may want to use this database for so you'll click this button to generate the token and then you'll copy the strings in this dialog box now here's where you need to put them i'm going to copy the client id and i'm going to navigate back to my application i'm going to go to application.conf and here i have a section that i've commented out which is under the datastax java driver we have a section for basic cloud and advanced auth provider i want you to uncomment that section the secure content bottle is going to be an empty string for now i'm going to show you what that bundle is and here under username i'm going to paste that client id and the password is going to be the client secret in this dialog box now i'm not really afraid of having them in the clear in this video because i'm going to remove the database anyway after this recording so there's no worries about that cool so you'll have your username and password already here in the configuration i've already set this for you so that you don't need to care about that now with these things in place i'm going to create all the schemas and all the tables that we're going to need to interact with this astrodb so i'm going to navigate back to my profile and i'm going to navigate back to my database so let me navigate to the rock the jvm cqrs demo and i'm going to click this cql console here in the middle of the screen so that i have access to a terminal much like my docker container all right so with this sql sh i'm going to go back to my table setup.cql and i'm going to create all the tables now before that i forgot i need to add all the key spaces so back to overview i'm going to add a key space i'm going to have a key space for akka and unfortunately the ui has a little bug because after you create the key space the this little button is blocked so you need to refresh the page and i'm going to have to add all the key spaces including hotels and reservations so you can pause the video until you have four major key spaces we have akop aqua snapshot we have hotel and reservation at this point we can copy all our table definitions so i'm going to be very careful about this we have aca snapshot and then i'm going to copy this one go back to the cql console and i'm going to paste everything in this terminal let's see so this works okay then all the tables in the aqua key space there are the most of them i'm going to copy that paste them in the terminal all right then after the hotel we have everything inside so everything in that section after that we have reservations and everything with including amenities by rome although we aren't really using them for this application and materialized views as with the docker container the materializers aren't really supported here so we will ignore that for the application now after we've created all the tables now it's time to run our first demo application thankfully we have one with a hotel demo so i'm going to make a reservation first and then i'm going to change it and cancel it once i have the confirmation identifier the confirmation number now before i run this application we will need to go to application.conf and fill in this missing piece which is the secure connect bundle this is a zip file which will contain some connection certificates that will let you connect to osterdb in a secure fashion so navigate back to your database and click this connect tab and click on java here using a driver so connect using a driver in this section with java and the java obviously is for scala applications as well being running on the jvm and after that you will have to download this little bundle so click on this download button with secure connect bundle and this will download a zip file which i want you to copy and paste into your source main resources so i'm going to take it and hopefully i can drag it to all the way to my application so i'm going to edit that so under cqrs cassandra live under source main resources okay and then i'm going to click on this refactor button i don't know why it's called refactor so notice that we have secure connect rock the jvm cqrs live demo so this is the zip file which will contain all the required certificates and then i'm going to right click on it and i'm going to copy path and reference from the content root so source main resources this rock the jvm cqrsdemo.zip now at this point all the configuration should be complete and i should be able to run this hotel demo with a simple make reservation event so let me run this application and let's see what happens if this application runs all right so after a certain while notice that we have some events here in the logs and the state was changed which meant that the persistence of this command was successful so we can navigate to the rocket jvm cqrs demo at the cql console and i can investigate if we have a message in aqua.messages so i'm going to select star from aka.messages and if we have an entry there then that means the event was persisted and notice that we do have a single event here which means that our application connected successfully now let me get the confirmation number which is this little fellow over here and then i'm going to try to change it and cancel it so i'm going to change reservation and cancel it with this confirmation number and i'm gonna run the hotel demo again and at this point we should see three items in aqua dot messages let's run this out and after a couple of seconds we should have two state changes so notice that we have state changed and state changed now i think we should have seen a state with an empty set because the reservation was cancelled but i think it's because of the fact that we are shutting down the application after five seconds which is a bit too short i'm gonna shut it down after 30 seconds because now we're connecting to a cloud-based cassandra and the latency might be a little bigger so let me run the application again actually i'm going to keep the change and cancel reservation let's see what we have and after we run this application we should see three items in the akka.messages table let's see all right so at this point we have a state with an empty set so that was probably the cause we didn't give the application enough time to actually persist the events so let's navigate back to cql and let's select star for maca messages again and sure enough we now have three items in the table so we can now safely connect to osterdb with a demo application what about our scalable application with persistence query so right now we have cassandra table cleaner which will also connect to this cloud-based cassandra service because of application.com so you can feel free to run this cassandra table cleaner but it will probably take quite a bit of time to run 3.6 million queries on a cloud-based cassandra but i have the privilege of video editing which gives me some magical powers so i'm going to simply run this application and i'm going to snap my fingers and i'm going to have all tables clear so alright amazing time travel is awesome now at this point we can run both of our applications the hotel event reader and the reservation generator to figure out if we have some events for a particular hotel i'm going to say that the hotel event reader wants to rate from a different hotel let's say 82 or something like that now let me also collapse my little panels over here because my text is big and my screen is small and now we're ready to run this hotel event reader which will be in a waiting state because there are no events for hotel 82 at this point so notice that the application is waiting and at the same time i'm going to start the reservation generator which will create a lot of events so let's try this out and the hotel event reader should start monitoring some events so notice that we have making reservation and maybe cancelling reservation and so on and so forth so we have quite a bunch of events happening here on our cloud-based cassandra and just to test whether these reservations were made in astrodb i'm going to pick a random reservation maybe this one i'm going to take its confirmation number and i'm going to go back to my cql shell and i'm going to select something from that table so i'm going to select star from and the table is reservation dot and we have reservation by guest and uh i'm gonna select star where and i'm gonna have if i remember correctly from the table setup the table for reservation by guest had the primary key guest last name and confirmation number the confirmation number i already have the guest last name is always rock the jvm so the guest last name is rock the jvm in all caps and confirm underscore number is this little fellow in between quotes semicolons let's see what we have all right this is awesome so we have an entry here for the confirmation number whatever for the room number 37 between the 19th of november 2023 and the 22nd of november 2023 which matches the details in this reservation so from 19 11 and 22 11 for room number 37 so our reservations stored correctly in our astrodb cloud-based database all right folks so this was one massive journey start to finish with a real-life cqrs application written in scala with aqua persistence and datastax's official astrodb database i hope you enjoyed it in which case i recommend you take a look at rock the jvm i have literally hundreds of hours of in-depth lessons like this so check me out on youtube twitter and linkedin rock the jvm and until next time i'm daniel signing off and as always don't forget to click that subscribe button and ring that bell to get notifications for all of our future upcoming workshops",
    "segments": [
      {
        "start": 0.13,
        "duration": 5.03,
        "text": "[Music]"
      },
      {
        "start": 5.52,
        "duration": 3.999,
        "text": "hello and welcome to the data stacks"
      },
      {
        "start": 7.359,
        "duration": 3.761,
        "text": "developers youtube channel"
      },
      {
        "start": 9.519,
        "duration": 4.0,
        "text": "i'm very pleased to announce we have a"
      },
      {
        "start": 11.12,
        "duration": 3.92,
        "text": "special guest today and daniel from rock"
      },
      {
        "start": 13.519,
        "duration": 3.201,
        "text": "the jvm"
      },
      {
        "start": 15.04,
        "duration": 3.999,
        "text": "up and up-and-coming youtuber"
      },
      {
        "start": 16.72,
        "duration": 4.8,
        "text": "who focuses on scala akka and"
      },
      {
        "start": 19.039,
        "duration": 3.841,
        "text": "distributed systems"
      },
      {
        "start": 21.52,
        "duration": 3.759,
        "text": "he's here to give you a master class"
      },
      {
        "start": 22.88,
        "duration": 4.559,
        "text": "today in cqrs or command query"
      },
      {
        "start": 25.279,
        "duration": 4.481,
        "text": "responsibility segregation with event"
      },
      {
        "start": 27.439,
        "duration": 3.441,
        "text": "sourcing scala akka and of course apache"
      },
      {
        "start": 29.76,
        "duration": 2.72,
        "text": "cassandra"
      },
      {
        "start": 30.88,
        "duration": 4.56,
        "text": "daniel thanks for being with us today"
      },
      {
        "start": 32.48,
        "duration": 5.759,
        "text": "and take it away"
      },
      {
        "start": 35.44,
        "duration": 5.36,
        "text": "hi everyone and welcome to cqrs with"
      },
      {
        "start": 38.239,
        "duration": 4.961,
        "text": "event sourcing and scala akka and"
      },
      {
        "start": 40.8,
        "duration": 4.64,
        "text": "cassandra this video is a live coding"
      },
      {
        "start": 43.2,
        "duration": 4.4,
        "text": "tutorial of how to implement the cqrs"
      },
      {
        "start": 45.44,
        "duration": 5.599,
        "text": "pattern in your own application and how"
      },
      {
        "start": 47.6,
        "duration": 5.04,
        "text": "to run it on datastax's astrodb service"
      },
      {
        "start": 51.039,
        "duration": 3.2,
        "text": "my name is daniel and i'm a software"
      },
      {
        "start": 52.64,
        "duration": 2.88,
        "text": "engineer and instructor i've been"
      },
      {
        "start": 54.239,
        "duration": 3.201,
        "text": "teaching everything in the skull"
      },
      {
        "start": 55.52,
        "duration": 3.76,
        "text": "ecosystem in live and online training"
      },
      {
        "start": 57.44,
        "duration": 3.36,
        "text": "for more than eight years now and i've"
      },
      {
        "start": 59.28,
        "duration": 3.439,
        "text": "had the privilege to train high"
      },
      {
        "start": 60.8,
        "duration": 4.319,
        "text": "performing teams at companies like apple"
      },
      {
        "start": 62.719,
        "duration": 4.72,
        "text": "adobe and microsoft i also run this"
      },
      {
        "start": 65.119,
        "duration": 4.161,
        "text": "website called rock the jvm which has"
      },
      {
        "start": 67.439,
        "duration": 3.921,
        "text": "long form training material on the skull"
      },
      {
        "start": 69.28,
        "duration": 4.879,
        "text": "language effect systems like cats and"
      },
      {
        "start": 71.36,
        "duration": 4.32,
        "text": "zeo data streaming with apache flink big"
      },
      {
        "start": 74.159,
        "duration": 3.361,
        "text": "data with apache spark and distributed"
      },
      {
        "start": 75.68,
        "duration": 3.6,
        "text": "systems with akka which is what we are"
      },
      {
        "start": 77.52,
        "duration": 4.56,
        "text": "going to use in this video i have more"
      },
      {
        "start": 79.28,
        "duration": 4.56,
        "text": "than 230 hours of material on the site"
      },
      {
        "start": 82.08,
        "duration": 4.24,
        "text": "so there's a lot of feast upon if you're"
      },
      {
        "start": 83.84,
        "duration": 4.08,
        "text": "ever interested in the scholar world now"
      },
      {
        "start": 86.32,
        "duration": 4.24,
        "text": "the objective of this video is to"
      },
      {
        "start": 87.92,
        "duration": 4.96,
        "text": "demonstrate implementation of cqrs and"
      },
      {
        "start": 90.56,
        "duration": 4.559,
        "text": "event sourcing with scala akka and"
      },
      {
        "start": 92.88,
        "duration": 4.08,
        "text": "cassandra now these are very powerful"
      },
      {
        "start": 95.119,
        "duration": 3.921,
        "text": "tools using many high throughput"
      },
      {
        "start": 96.96,
        "duration": 3.68,
        "text": "applications and high profile companies"
      },
      {
        "start": 99.04,
        "duration": 3.52,
        "text": "around the world and this video is a"
      },
      {
        "start": 100.64,
        "duration": 4.88,
        "text": "demo with a realistic scenario dealing"
      },
      {
        "start": 102.56,
        "duration": 5.36,
        "text": "with high load scala grade problems now"
      },
      {
        "start": 105.52,
        "duration": 4.16,
        "text": "this demo is for you if you're curious"
      },
      {
        "start": 107.92,
        "duration": 4.159,
        "text": "to see these technologies and tools in"
      },
      {
        "start": 109.68,
        "duration": 4.0,
        "text": "action or if you want to learn what cqrs"
      },
      {
        "start": 112.079,
        "duration": 4.08,
        "text": "is and how it's different from other"
      },
      {
        "start": 113.68,
        "duration": 4.56,
        "text": "models of storage now i recommend that"
      },
      {
        "start": 116.159,
        "duration": 4.161,
        "text": "you use this video in one of two ways"
      },
      {
        "start": 118.24,
        "duration": 4.159,
        "text": "either as entertainment and a way to"
      },
      {
        "start": 120.32,
        "duration": 3.36,
        "text": "satisfy your curiosity in which case i'd"
      },
      {
        "start": 122.399,
        "duration": 3.521,
        "text": "recommend you simply watch what i'm"
      },
      {
        "start": 123.68,
        "duration": 3.84,
        "text": "doing and see the effects live or you"
      },
      {
        "start": 125.92,
        "duration": 4.64,
        "text": "can follow along and get your hands"
      },
      {
        "start": 127.52,
        "duration": 4.96,
        "text": "dirty as i write code on camera i like"
      },
      {
        "start": 130.56,
        "duration": 3.84,
        "text": "to demonstrate by doing so i write live"
      },
      {
        "start": 132.48,
        "duration": 4.16,
        "text": "code in all my courses at rock the jvm"
      },
      {
        "start": 134.4,
        "duration": 4.32,
        "text": "and in demos like this now the structure"
      },
      {
        "start": 136.64,
        "duration": 4.16,
        "text": "of the demo is as follows first i'm"
      },
      {
        "start": 138.72,
        "duration": 4.32,
        "text": "going to introduce cqrs and event"
      },
      {
        "start": 140.8,
        "duration": 3.68,
        "text": "sourcing as design patterns as well as"
      },
      {
        "start": 143.04,
        "duration": 3.6,
        "text": "the akka persistence tool that we're"
      },
      {
        "start": 144.48,
        "duration": 3.52,
        "text": "going to use in the video after that"
      },
      {
        "start": 146.64,
        "duration": 3.76,
        "text": "i'll walk you through the starting"
      },
      {
        "start": 148.0,
        "duration": 4.879,
        "text": "project setup and then for most of the"
      },
      {
        "start": 150.4,
        "duration": 5.36,
        "text": "video we're going to do live code and"
      },
      {
        "start": 152.879,
        "duration": 4.961,
        "text": "testing locally on a docker"
      },
      {
        "start": 155.76,
        "duration": 4.0,
        "text": "cassandra instance and finally at the"
      },
      {
        "start": 157.84,
        "duration": 4.56,
        "text": "end of the video we're going to take the"
      },
      {
        "start": 159.76,
        "duration": 4.479,
        "text": "official datastax osterdb service for a"
      },
      {
        "start": 162.4,
        "duration": 4.16,
        "text": "spin with the code that we implement in"
      },
      {
        "start": 164.239,
        "duration": 4.481,
        "text": "the video now everything is coded live"
      },
      {
        "start": 166.56,
        "duration": 3.84,
        "text": "on camera so you can find links to the"
      },
      {
        "start": 168.72,
        "duration": 3.36,
        "text": "github repository and all the resources"
      },
      {
        "start": 170.4,
        "duration": 3.839,
        "text": "that we use in the code and you can find"
      },
      {
        "start": 172.08,
        "duration": 4.0,
        "text": "them in the description of the video the"
      },
      {
        "start": 174.239,
        "duration": 4.321,
        "text": "demo will be quite big so i'm going to"
      },
      {
        "start": 176.08,
        "duration": 4.159,
        "text": "speed on some coding parts but i've"
      },
      {
        "start": 178.56,
        "duration": 4.24,
        "text": "edited the video so that you can pause"
      },
      {
        "start": 180.239,
        "duration": 4.72,
        "text": "it and follow along still i'm going to"
      },
      {
        "start": 182.8,
        "duration": 3.76,
        "text": "leave nothing unexplained as we follow"
      },
      {
        "start": 184.959,
        "duration": 3.2,
        "text": "through this video"
      },
      {
        "start": 186.56,
        "duration": 4.399,
        "text": "now with that said let me introduce the"
      },
      {
        "start": 188.159,
        "duration": 4.321,
        "text": "core concepts of the video first cqrs"
      },
      {
        "start": 190.959,
        "duration": 3.36,
        "text": "comes from command and query"
      },
      {
        "start": 192.48,
        "duration": 3.759,
        "text": "responsibility segregation which is a"
      },
      {
        "start": 194.319,
        "duration": 4.161,
        "text": "design pattern on how to organize your"
      },
      {
        "start": 196.239,
        "duration": 3.681,
        "text": "code and data while interacting with a"
      },
      {
        "start": 198.48,
        "duration": 3.44,
        "text": "persistent store"
      },
      {
        "start": 199.92,
        "duration": 4.0,
        "text": "complex applications with high data"
      },
      {
        "start": 201.92,
        "duration": 4.239,
        "text": "access concurrency might find themselves"
      },
      {
        "start": 203.92,
        "duration": 4.0,
        "text": "in a rut sometimes there are different"
      },
      {
        "start": 206.159,
        "duration": 3.201,
        "text": "models or performance requirements for"
      },
      {
        "start": 207.92,
        "duration": 2.879,
        "text": "reads and writes for example if the"
      },
      {
        "start": 209.36,
        "duration": 3.92,
        "text": "number of stakeholders is"
      },
      {
        "start": 210.799,
        "duration": 3.921,
        "text": "disproportionate on one side or there"
      },
      {
        "start": 213.28,
        "duration": 3.679,
        "text": "might be the risk of data access"
      },
      {
        "start": 214.72,
        "duration": 4.4,
        "text": "contention because of such concurrency"
      },
      {
        "start": 216.959,
        "duration": 4.481,
        "text": "or the unifying of the data model will"
      },
      {
        "start": 219.12,
        "duration": 3.92,
        "text": "likely make it too complex to manage and"
      },
      {
        "start": 221.44,
        "duration": 4.64,
        "text": "there's also data security compliance"
      },
      {
        "start": 223.04,
        "duration": 5.759,
        "text": "which is hard to enforce on shared data"
      },
      {
        "start": 226.08,
        "duration": 4.879,
        "text": "to that we have the solution to separate"
      },
      {
        "start": 228.799,
        "duration": 4.0,
        "text": "the read model from the right model and"
      },
      {
        "start": 230.959,
        "duration": 4.161,
        "text": "organize your code in terms of commands"
      },
      {
        "start": 232.799,
        "duration": 4.16,
        "text": "which can be applied and these commands"
      },
      {
        "start": 235.12,
        "duration": 4.72,
        "text": "will be additive and will have the role"
      },
      {
        "start": 236.959,
        "duration": 4.48,
        "text": "of changing your internal state while"
      },
      {
        "start": 239.84,
        "duration": 2.88,
        "text": "queries will be separate and will"
      },
      {
        "start": 241.439,
        "duration": 3.52,
        "text": "investigate the current state of the"
      },
      {
        "start": 242.72,
        "duration": 4.4,
        "text": "system so the picture in a broad sense"
      },
      {
        "start": 244.959,
        "duration": 4.0,
        "text": "will look something like this with one"
      },
      {
        "start": 247.12,
        "duration": 3.92,
        "text": "side writing to the database using a"
      },
      {
        "start": 248.959,
        "duration": 4.241,
        "text": "right specific data model while another"
      },
      {
        "start": 251.04,
        "duration": 4.96,
        "text": "stakeholder reads data appropriate for"
      },
      {
        "start": 253.2,
        "duration": 4.319,
        "text": "them using another model and these two"
      },
      {
        "start": 256.0,
        "duration": 3.199,
        "text": "models for read and write will be"
      },
      {
        "start": 257.519,
        "duration": 3.521,
        "text": "synchronized with some tools that we're"
      },
      {
        "start": 259.199,
        "duration": 4.0,
        "text": "going to see in the code"
      },
      {
        "start": 261.04,
        "duration": 4.48,
        "text": "now the use cases for cqrs include"
      },
      {
        "start": 263.199,
        "duration": 4.56,
        "text": "applications with high data access"
      },
      {
        "start": 265.52,
        "duration": 4.399,
        "text": "concurrency and task based applications"
      },
      {
        "start": 267.759,
        "duration": 4.0,
        "text": "for example a hotel booking which is"
      },
      {
        "start": 269.919,
        "duration": 3.28,
        "text": "what we're going to see in the code or"
      },
      {
        "start": 271.759,
        "duration": 3.681,
        "text": "an online store and i'm going to show"
      },
      {
        "start": 273.199,
        "duration": 3.601,
        "text": "you some examples also cqrs is"
      },
      {
        "start": 275.44,
        "duration": 3.12,
        "text": "appropriate for applications with"
      },
      {
        "start": 276.8,
        "duration": 3.6,
        "text": "different read and write performance"
      },
      {
        "start": 278.56,
        "duration": 3.84,
        "text": "requirements for example if you have a"
      },
      {
        "start": 280.4,
        "duration": 3.92,
        "text": "disproportionate number of readers you"
      },
      {
        "start": 282.4,
        "duration": 3.68,
        "text": "have different performance requirements"
      },
      {
        "start": 284.32,
        "duration": 3.599,
        "text": "for the read side compared to the right"
      },
      {
        "start": 286.08,
        "duration": 3.839,
        "text": "side also as we will see in the code"
      },
      {
        "start": 287.919,
        "duration": 4.161,
        "text": "cqrs especially appropriate for the"
      },
      {
        "start": 289.919,
        "duration": 3.921,
        "text": "situations with a high likelihood of"
      },
      {
        "start": 292.08,
        "duration": 3.2,
        "text": "schema evolution that is the situation"
      },
      {
        "start": 293.84,
        "duration": 3.28,
        "text": "where you have to change the structure"
      },
      {
        "start": 295.28,
        "duration": 4.16,
        "text": "of your data which is particularly"
      },
      {
        "start": 297.12,
        "duration": 4.88,
        "text": "painful in regular crud applications"
      },
      {
        "start": 299.44,
        "duration": 5.12,
        "text": "obviously cqrs is not to be used with"
      },
      {
        "start": 302.0,
        "duration": 5.28,
        "text": "simple crud logic so simple databases"
      },
      {
        "start": 304.56,
        "duration": 4.96,
        "text": "where you simply store the latest state"
      },
      {
        "start": 307.28,
        "duration": 4.4,
        "text": "in the database directly or for"
      },
      {
        "start": 309.52,
        "duration": 3.76,
        "text": "infrequent data access because cqrs is"
      },
      {
        "start": 311.68,
        "duration": 4.56,
        "text": "also built for a specific kind of"
      },
      {
        "start": 313.28,
        "duration": 4.8,
        "text": "performance now cqrs is often paired"
      },
      {
        "start": 316.24,
        "duration": 3.6,
        "text": "with another design pattern called event"
      },
      {
        "start": 318.08,
        "duration": 3.28,
        "text": "sourcing now event sourcing is"
      },
      {
        "start": 319.84,
        "duration": 3.12,
        "text": "appropriate for the situations when the"
      },
      {
        "start": 321.36,
        "duration": 4.32,
        "text": "current state of the system will change"
      },
      {
        "start": 322.96,
        "duration": 5.04,
        "text": "all the time but you're also interested"
      },
      {
        "start": 325.68,
        "duration": 4.64,
        "text": "in querying a previous state or in"
      },
      {
        "start": 328.0,
        "duration": 4.72,
        "text": "tracing how you arrived at the current"
      },
      {
        "start": 330.32,
        "duration": 4.4,
        "text": "state examples include tracing orders in"
      },
      {
        "start": 332.72,
        "duration": 4.319,
        "text": "an online store or tracing the"
      },
      {
        "start": 334.72,
        "duration": 3.759,
        "text": "transaction history in a bank or the"
      },
      {
        "start": 337.039,
        "duration": 4.321,
        "text": "chat message history or document"
      },
      {
        "start": 338.479,
        "duration": 4.56,
        "text": "versioning in a shared repository and or"
      },
      {
        "start": 341.36,
        "duration": 4.08,
        "text": "as we will see in the code we have a"
      },
      {
        "start": 343.039,
        "duration": 4.641,
        "text": "hotel booking system now let me give you"
      },
      {
        "start": 345.44,
        "duration": 4.479,
        "text": "a relatable situation let's say we are"
      },
      {
        "start": 347.68,
        "duration": 4.4,
        "text": "interested in designing an online store"
      },
      {
        "start": 349.919,
        "duration": 4.321,
        "text": "and we want to trace an order so we are"
      },
      {
        "start": 352.08,
        "duration": 4.559,
        "text": "asking for all the data about an order"
      },
      {
        "start": 354.24,
        "duration": 5.36,
        "text": "in a regular crud based database if we"
      },
      {
        "start": 356.639,
        "duration": 5.441,
        "text": "want to investigate the state of a"
      },
      {
        "start": 359.6,
        "duration": 4.64,
        "text": "particular order we get a single row"
      },
      {
        "start": 362.08,
        "duration": 4.88,
        "text": "which is a traditional relational model"
      },
      {
        "start": 364.24,
        "duration": 6.239,
        "text": "select star from whatever orders and"
      },
      {
        "start": 366.96,
        "duration": 5.679,
        "text": "give me the latest status whereas we can"
      },
      {
        "start": 370.479,
        "duration": 4.321,
        "text": "have a much richer description of the"
      },
      {
        "start": 372.639,
        "duration": 3.921,
        "text": "status of the order by tracing all the"
      },
      {
        "start": 374.8,
        "duration": 3.519,
        "text": "events about the order so a table might"
      },
      {
        "start": 376.56,
        "duration": 3.68,
        "text": "look something like this where an order"
      },
      {
        "start": 378.319,
        "duration": 3.761,
        "text": "might be created the inventory will be"
      },
      {
        "start": 380.24,
        "duration": 3.6,
        "text": "allocated the order will be dispatched"
      },
      {
        "start": 382.08,
        "duration": 3.839,
        "text": "delivered or it may be returned"
      },
      {
        "start": 383.84,
        "duration": 4.079,
        "text": "cancelled refunded and there are a bunch"
      },
      {
        "start": 385.919,
        "duration": 3.441,
        "text": "of stuff that can happen with that order"
      },
      {
        "start": 387.919,
        "duration": 3.361,
        "text": "and you can track everything that"
      },
      {
        "start": 389.36,
        "duration": 4.24,
        "text": "happens to it so instead of storing the"
      },
      {
        "start": 391.28,
        "duration": 4.96,
        "text": "current state which is refunded and we"
      },
      {
        "start": 393.6,
        "duration": 4.64,
        "text": "haven't learned too much we can also ask"
      },
      {
        "start": 396.24,
        "duration": 4.16,
        "text": "why the order was refunded so we can"
      },
      {
        "start": 398.24,
        "duration": 4.16,
        "text": "store all the events that led to the"
      },
      {
        "start": 400.4,
        "duration": 3.68,
        "text": "current state and we can always recreate"
      },
      {
        "start": 402.4,
        "duration": 3.68,
        "text": "the current state by replaying all the"
      },
      {
        "start": 404.08,
        "duration": 3.28,
        "text": "events in order now to implement the"
      },
      {
        "start": 406.08,
        "duration": 3.2,
        "text": "event sourcing pattern we're going to"
      },
      {
        "start": 407.36,
        "duration": 3.44,
        "text": "use a tool called akka persistence if"
      },
      {
        "start": 409.28,
        "duration": 4.24,
        "text": "you've never heard about aka before it's"
      },
      {
        "start": 410.8,
        "duration": 4.88,
        "text": "a powerful toolkit that will implement"
      },
      {
        "start": 413.52,
        "duration": 4.16,
        "text": "the actor model the actor model will"
      },
      {
        "start": 415.68,
        "duration": 4.079,
        "text": "organize your code into so-called actors"
      },
      {
        "start": 417.68,
        "duration": 3.84,
        "text": "which are independent encapsulated"
      },
      {
        "start": 419.759,
        "duration": 3.521,
        "text": "entities with their own state and"
      },
      {
        "start": 421.52,
        "duration": 3.84,
        "text": "behavior they're fully encapsulated so"
      },
      {
        "start": 423.28,
        "duration": 3.919,
        "text": "they're not available for regular object"
      },
      {
        "start": 425.36,
        "duration": 4.16,
        "text": "oriented method calls but you can only"
      },
      {
        "start": 427.199,
        "duration": 4.241,
        "text": "communicate with them via asynchronous"
      },
      {
        "start": 429.52,
        "duration": 3.92,
        "text": "message passing now because they're"
      },
      {
        "start": 431.44,
        "duration": 4.72,
        "text": "fully independent and asynchronous you"
      },
      {
        "start": 433.44,
        "duration": 4.319,
        "text": "can spin up a large very large amount of"
      },
      {
        "start": 436.16,
        "duration": 3.599,
        "text": "these independent actors and schedule"
      },
      {
        "start": 437.759,
        "duration": 4.241,
        "text": "them on a relatively small thread put"
      },
      {
        "start": 439.759,
        "duration": 4.401,
        "text": "for an incredibly high throughput of"
      },
      {
        "start": 442.0,
        "duration": 4.24,
        "text": "your application now these are normal"
      },
      {
        "start": 444.16,
        "duration": 3.84,
        "text": "actors we will use a special breed of"
      },
      {
        "start": 446.24,
        "duration": 3.679,
        "text": "actors called persistent actors which"
      },
      {
        "start": 448.0,
        "duration": 3.599,
        "text": "come with extra capabilities every"
      },
      {
        "start": 449.919,
        "duration": 4.4,
        "text": "persistent actor will have a unique"
      },
      {
        "start": 451.599,
        "duration": 5.201,
        "text": "persistence id and this actor can"
      },
      {
        "start": 454.319,
        "duration": 4.561,
        "text": "persist events to a long-term store so"
      },
      {
        "start": 456.8,
        "duration": 4.0,
        "text": "this can store events into a database"
      },
      {
        "start": 458.88,
        "duration": 3.68,
        "text": "such as cassandra a persistent actor"
      },
      {
        "start": 460.8,
        "duration": 4.399,
        "text": "will also be able to recover its own"
      },
      {
        "start": 462.56,
        "duration": 4.8,
        "text": "state by replaying events from the store"
      },
      {
        "start": 465.199,
        "duration": 4.321,
        "text": "so when an actor receives a message"
      },
      {
        "start": 467.36,
        "duration": 4.48,
        "text": "which we will call command from now on"
      },
      {
        "start": 469.52,
        "duration": 4.239,
        "text": "it will asynchronously persist an event"
      },
      {
        "start": 471.84,
        "duration": 4.079,
        "text": "to the store and after the event is"
      },
      {
        "start": 473.759,
        "duration": 4.321,
        "text": "persisted it will be able to change its"
      },
      {
        "start": 475.919,
        "duration": 3.921,
        "text": "internal state now when the actor is"
      },
      {
        "start": 478.08,
        "duration": 3.36,
        "text": "spun up or restarts because of an"
      },
      {
        "start": 479.84,
        "duration": 3.919,
        "text": "application crash or because of an"
      },
      {
        "start": 481.44,
        "duration": 4.24,
        "text": "application restart or upgrade the actor"
      },
      {
        "start": 483.759,
        "duration": 3.761,
        "text": "will be able to replay all the events"
      },
      {
        "start": 485.68,
        "duration": 3.76,
        "text": "associated to its persistent id and"
      },
      {
        "start": 487.52,
        "duration": 3.84,
        "text": "recover its state as if nothing had"
      },
      {
        "start": 489.44,
        "duration": 3.759,
        "text": "happened so let me show you a quick"
      },
      {
        "start": 491.36,
        "duration": 4.16,
        "text": "picture let's assume that this is an"
      },
      {
        "start": 493.199,
        "duration": 4.801,
        "text": "actor this blue blob is an actor with a"
      },
      {
        "start": 495.52,
        "duration": 4.959,
        "text": "message handler which is the behavior"
      },
      {
        "start": 498.0,
        "duration": 4.16,
        "text": "and the mailbox which is used to store"
      },
      {
        "start": 500.479,
        "duration": 2.72,
        "text": "all the messages that you send to it"
      },
      {
        "start": 502.16,
        "duration": 2.879,
        "text": "when one of the threads in the"
      },
      {
        "start": 503.199,
        "duration": 3.68,
        "text": "threadball schedules to run this actor"
      },
      {
        "start": 505.039,
        "duration": 4.0,
        "text": "the thread will simply dequeue messages"
      },
      {
        "start": 506.879,
        "duration": 4.801,
        "text": "from the mailbox and it will treat every"
      },
      {
        "start": 509.039,
        "duration": 4.401,
        "text": "message atomically now let's assume that"
      },
      {
        "start": 511.68,
        "duration": 3.919,
        "text": "this actor interacts with a persistent"
      },
      {
        "start": 513.44,
        "duration": 3.839,
        "text": "store when the actor is scheduled to run"
      },
      {
        "start": 515.599,
        "duration": 3.44,
        "text": "on a thread it will simply dequeue"
      },
      {
        "start": 517.279,
        "duration": 3.76,
        "text": "messages and will read that message with"
      },
      {
        "start": 519.039,
        "duration": 5.041,
        "text": "the internal behavior of the actor which"
      },
      {
        "start": 521.039,
        "duration": 5.041,
        "text": "is its internal code now that behavior"
      },
      {
        "start": 524.08,
        "duration": 4.72,
        "text": "can do a lot of stuff and one of the"
      },
      {
        "start": 526.08,
        "duration": 4.72,
        "text": "very often used effects is to persist an"
      },
      {
        "start": 528.8,
        "duration": 3.52,
        "text": "event to the persistent store once the"
      },
      {
        "start": 530.8,
        "duration": 2.88,
        "text": "persistent store acknowledges the"
      },
      {
        "start": 532.32,
        "duration": 2.88,
        "text": "persistence of that effect it will"
      },
      {
        "start": 533.68,
        "duration": 3.52,
        "text": "notify the actor this will be"
      },
      {
        "start": 535.2,
        "duration": 3.12,
        "text": "transparent to us as programmers and"
      },
      {
        "start": 537.2,
        "duration": 2.639,
        "text": "when the actor receives this"
      },
      {
        "start": 538.32,
        "duration": 3.519,
        "text": "acknowledgement it will change its"
      },
      {
        "start": 539.839,
        "duration": 4.241,
        "text": "internal state and as an effect of that"
      },
      {
        "start": 541.839,
        "duration": 4.321,
        "text": "it might send messages to other actors"
      },
      {
        "start": 544.08,
        "duration": 4.24,
        "text": "in the system as i mentioned we have"
      },
      {
        "start": 546.16,
        "duration": 4.239,
        "text": "lots and lots of actors in a aka"
      },
      {
        "start": 548.32,
        "duration": 3.44,
        "text": "persistent system and after the actor is"
      },
      {
        "start": 550.399,
        "duration": 3.521,
        "text": "done with the message it will simply"
      },
      {
        "start": 551.76,
        "duration": 4.4,
        "text": "discard it and dequeue further messages"
      },
      {
        "start": 553.92,
        "duration": 4.08,
        "text": "for as long as it holds that particular"
      },
      {
        "start": 556.16,
        "duration": 4.32,
        "text": "thread so a new message might be"
      },
      {
        "start": 558.0,
        "duration": 4.16,
        "text": "dequeued treated by the handler a new"
      },
      {
        "start": 560.48,
        "duration": 3.52,
        "text": "event might be persisted some further"
      },
      {
        "start": 562.16,
        "duration": 4.08,
        "text": "messages might be handled and so on and"
      },
      {
        "start": 564.0,
        "duration": 4.32,
        "text": "so forth for as long as the actor has"
      },
      {
        "start": 566.24,
        "duration": 4.0,
        "text": "hold of that threat obviously the thread"
      },
      {
        "start": 568.32,
        "duration": 3.92,
        "text": "pull will juggle between many many of"
      },
      {
        "start": 570.24,
        "duration": 3.68,
        "text": "these actors so from our standpoint an"
      },
      {
        "start": 572.24,
        "duration": 3.2,
        "text": "actor is effectively a single threaded"
      },
      {
        "start": 573.92,
        "duration": 3.12,
        "text": "business now let me show you a picture"
      },
      {
        "start": 575.44,
        "duration": 4.0,
        "text": "of what happens to an actor when an"
      },
      {
        "start": 577.04,
        "duration": 4.239,
        "text": "application starts or restarts for"
      },
      {
        "start": 579.44,
        "duration": 4.079,
        "text": "whatever reason so assume that this is a"
      },
      {
        "start": 581.279,
        "duration": 4.721,
        "text": "persistent store and an actor is simply"
      },
      {
        "start": 583.519,
        "duration": 4.0,
        "text": "spun up when the application starts an"
      },
      {
        "start": 586.0,
        "duration": 3.36,
        "text": "application with an actor with a"
      },
      {
        "start": 587.519,
        "duration": 3.44,
        "text": "persistence id will simply ask the"
      },
      {
        "start": 589.36,
        "duration": 4.8,
        "text": "persistent store for all the events"
      },
      {
        "start": 590.959,
        "duration": 4.801,
        "text": "associated for that persistence id the"
      },
      {
        "start": 594.16,
        "duration": 3.679,
        "text": "persistent store will fetch all these"
      },
      {
        "start": 595.76,
        "duration": 3.759,
        "text": "events and the actor will simply replay"
      },
      {
        "start": 597.839,
        "duration": 4.081,
        "text": "all these events in order and the actor"
      },
      {
        "start": 599.519,
        "duration": 4.0,
        "text": "will recreate its internal state so in"
      },
      {
        "start": 601.92,
        "duration": 3.599,
        "text": "this demonstration we're going to"
      },
      {
        "start": 603.519,
        "duration": 3.76,
        "text": "implement a realistic scenario dealing"
      },
      {
        "start": 605.519,
        "duration": 4.081,
        "text": "with events at scale we're going to"
      },
      {
        "start": 607.279,
        "duration": 4.24,
        "text": "imagine a hotel reservation system which"
      },
      {
        "start": 609.6,
        "duration": 4.0,
        "text": "manages bookings for a thousand plus"
      },
      {
        "start": 611.519,
        "duration": 4.081,
        "text": "hotels although you can scale for much"
      },
      {
        "start": 613.6,
        "duration": 3.919,
        "text": "more than that so we can treat millions"
      },
      {
        "start": 615.6,
        "duration": 4.08,
        "text": "of possible events in a short span of"
      },
      {
        "start": 617.519,
        "duration": 4.161,
        "text": "time and we can deal with a variety of"
      },
      {
        "start": 619.68,
        "duration": 4.0,
        "text": "event types the fundamental interaction"
      },
      {
        "start": 621.68,
        "duration": 4.159,
        "text": "is going to be between a hotel which we"
      },
      {
        "start": 623.68,
        "duration": 4.24,
        "text": "are going to imagine as an actor and the"
      },
      {
        "start": 625.839,
        "duration": 4.481,
        "text": "persistent store which is going to be"
      },
      {
        "start": 627.92,
        "duration": 4.08,
        "text": "cassandra each hotel actor will be a"
      },
      {
        "start": 630.32,
        "duration": 3.759,
        "text": "persistent actor and we're going to"
      },
      {
        "start": 632.0,
        "duration": 4.079,
        "text": "implement event sourcing on that"
      },
      {
        "start": 634.079,
        "duration": 4.641,
        "text": "obviously we're going to manage many"
      },
      {
        "start": 636.079,
        "duration": 5.121,
        "text": "many hotels up to 1 000 or even more"
      },
      {
        "start": 638.72,
        "duration": 4.64,
        "text": "than that and we are going to manage all"
      },
      {
        "start": 641.2,
        "duration": 4.56,
        "text": "these hotel actors by some sort of"
      },
      {
        "start": 643.36,
        "duration": 4.56,
        "text": "centralized agent which will in turn"
      },
      {
        "start": 645.76,
        "duration": 4.8,
        "text": "receive requests by some sort of"
      },
      {
        "start": 647.92,
        "duration": 5.12,
        "text": "front-facing api or application which"
      },
      {
        "start": 650.56,
        "duration": 3.92,
        "text": "manages bookings this front-facing api"
      },
      {
        "start": 653.04,
        "duration": 4.08,
        "text": "is not really that interesting for our"
      },
      {
        "start": 654.48,
        "duration": 4.479,
        "text": "cqrs demo so we will leave that aside"
      },
      {
        "start": 657.12,
        "duration": 4.399,
        "text": "but i'm going to leave that to you as an"
      },
      {
        "start": 658.959,
        "duration": 5.041,
        "text": "exercise if you want to expose that this"
      },
      {
        "start": 661.519,
        "duration": 4.801,
        "text": "is the right side on the read side we"
      },
      {
        "start": 664.0,
        "duration": 4.079,
        "text": "will have various hotel staff apps"
      },
      {
        "start": 666.32,
        "duration": 4.16,
        "text": "specialized for each hotel which will"
      },
      {
        "start": 668.079,
        "duration": 4.241,
        "text": "monitor all the events associated with"
      },
      {
        "start": 670.48,
        "duration": 4.0,
        "text": "that particular hotel and they will"
      },
      {
        "start": 672.32,
        "duration": 3.6,
        "text": "recreate the entire state the entire"
      },
      {
        "start": 674.48,
        "duration": 3.44,
        "text": "state of that hotel in terms of"
      },
      {
        "start": 675.92,
        "duration": 4.88,
        "text": "reservations so that they can query that"
      },
      {
        "start": 677.92,
        "duration": 4.8,
        "text": "state very easily for availability so we"
      },
      {
        "start": 680.8,
        "duration": 3.2,
        "text": "will implement the cqrs pattern in which"
      },
      {
        "start": 682.72,
        "duration": 3.84,
        "text": "the right site which is the booking"
      },
      {
        "start": 684.0,
        "duration": 4.32,
        "text": "service will issue commands such as make"
      },
      {
        "start": 686.56,
        "duration": 3.68,
        "text": "a reservation amend the reservation"
      },
      {
        "start": 688.32,
        "duration": 3.199,
        "text": "cancel it and so on and so forth while"
      },
      {
        "start": 690.24,
        "duration": 3.12,
        "text": "the read side which is the hotel"
      },
      {
        "start": 691.519,
        "duration": 3.681,
        "text": "management app will inspect the current"
      },
      {
        "start": 693.36,
        "duration": 4.32,
        "text": "state for that particular hotel and we"
      },
      {
        "start": 695.2,
        "duration": 4.96,
        "text": "can have many hotel staff apps"
      },
      {
        "start": 697.68,
        "duration": 4.8,
        "text": "independently monitoring their state we"
      },
      {
        "start": 700.16,
        "duration": 4.239,
        "text": "will pair cqrs with event sourcing and"
      },
      {
        "start": 702.48,
        "duration": 3.599,
        "text": "aqua persistence in which incremental"
      },
      {
        "start": 704.399,
        "duration": 2.961,
        "text": "events will be stored to cassandra and"
      },
      {
        "start": 706.079,
        "duration": 4.081,
        "text": "the state of the system will be"
      },
      {
        "start": 707.36,
        "duration": 5.039,
        "text": "recreated by replaying all these events"
      },
      {
        "start": 710.16,
        "duration": 5.919,
        "text": "so without further ado let me show you"
      },
      {
        "start": 712.399,
        "duration": 6.321,
        "text": "the project so i'm here in intellij idea"
      },
      {
        "start": 716.079,
        "duration": 4.32,
        "text": "i'm using the intellij idea plugin for"
      },
      {
        "start": 718.72,
        "duration": 4.0,
        "text": "scholar development and we will have a"
      },
      {
        "start": 720.399,
        "duration": 4.641,
        "text": "plain intellij project with a bunch of"
      },
      {
        "start": 722.72,
        "duration": 4.239,
        "text": "resources and configurations and a"
      },
      {
        "start": 725.04,
        "duration": 4.08,
        "text": "playground application you can check out"
      },
      {
        "start": 726.959,
        "duration": 3.601,
        "text": "the git repository which has a start tag"
      },
      {
        "start": 729.12,
        "duration": 3.519,
        "text": "which you can check out to bring the"
      },
      {
        "start": 730.56,
        "duration": 3.92,
        "text": "state of the code in this state that you"
      },
      {
        "start": 732.639,
        "duration": 3.44,
        "text": "are seeing right now now let me quickly"
      },
      {
        "start": 734.48,
        "duration": 2.88,
        "text": "walk you through this project we are"
      },
      {
        "start": 736.079,
        "duration": 2.88,
        "text": "going to spend all of our time under"
      },
      {
        "start": 737.36,
        "duration": 3.68,
        "text": "source main scholar here we have a"
      },
      {
        "start": 738.959,
        "duration": 4.32,
        "text": "playground application with a simple"
      },
      {
        "start": 741.04,
        "duration": 3.599,
        "text": "actor system that will simply test"
      },
      {
        "start": 743.279,
        "duration": 3.281,
        "text": "whether you have the library"
      },
      {
        "start": 744.639,
        "duration": 4.88,
        "text": "dependencies already downloaded and"
      },
      {
        "start": 746.56,
        "duration": 4.48,
        "text": "installed which brings me to build.sbt"
      },
      {
        "start": 749.519,
        "duration": 3.601,
        "text": "which contains all the library"
      },
      {
        "start": 751.04,
        "duration": 4.0,
        "text": "definitions that we're going to need for"
      },
      {
        "start": 753.12,
        "duration": 3.519,
        "text": "this demonstration once you load this in"
      },
      {
        "start": 755.04,
        "duration": 4.4,
        "text": "intellij intellij it will take care to"
      },
      {
        "start": 756.639,
        "duration": 4.32,
        "text": "download all the appropriate libraries"
      },
      {
        "start": 759.44,
        "duration": 3.12,
        "text": "besides the playground application we"
      },
      {
        "start": 760.959,
        "duration": 3.761,
        "text": "have a bunch of configurations which we"
      },
      {
        "start": 762.56,
        "duration": 3.92,
        "text": "won't really touch until the end of the"
      },
      {
        "start": 764.72,
        "duration": 3.919,
        "text": "demonstration application.com in"
      },
      {
        "start": 766.48,
        "duration": 4.32,
        "text": "particular is of most interest to us"
      },
      {
        "start": 768.639,
        "duration": 4.64,
        "text": "when we want to change the connection"
      },
      {
        "start": 770.8,
        "duration": 5.68,
        "text": "from a local cassandra to the"
      },
      {
        "start": 773.279,
        "duration": 5.36,
        "text": "cloud-based data stacks astra db"
      },
      {
        "start": 776.48,
        "duration": 4.88,
        "text": "and besides that we have a docker"
      },
      {
        "start": 778.639,
        "duration": 5.121,
        "text": "compose yml which will spin up a local"
      },
      {
        "start": 781.36,
        "duration": 3.52,
        "text": "version of cassandra for us to interact"
      },
      {
        "start": 783.76,
        "duration": 3.04,
        "text": "with"
      },
      {
        "start": 784.88,
        "duration": 3.759,
        "text": "at the same time in order to set up the"
      },
      {
        "start": 786.8,
        "duration": 4.08,
        "text": "appropriate tables we have this little"
      },
      {
        "start": 788.639,
        "duration": 4.561,
        "text": "file called tablesetup.cql"
      },
      {
        "start": 790.88,
        "duration": 4.0,
        "text": "this model is the exact same scenario as"
      },
      {
        "start": 793.2,
        "duration": 3.759,
        "text": "the definitive guide book which you can"
      },
      {
        "start": 794.88,
        "duration": 3.759,
        "text": "find on the datastax website free of"
      },
      {
        "start": 796.959,
        "duration": 4.0,
        "text": "charge if you're interested in checking"
      },
      {
        "start": 798.639,
        "duration": 4.561,
        "text": "that out i pulled all the table"
      },
      {
        "start": 800.959,
        "duration": 4.081,
        "text": "definitions here in this file so that we"
      },
      {
        "start": 803.2,
        "duration": 3.439,
        "text": "can access them more easily and set up"
      },
      {
        "start": 805.04,
        "duration": 3.28,
        "text": "the appropriate tables once the docker"
      },
      {
        "start": 806.639,
        "duration": 3.041,
        "text": "container starts now speaking of the"
      },
      {
        "start": 808.32,
        "duration": 2.959,
        "text": "docker container i recommend that you"
      },
      {
        "start": 809.68,
        "duration": 3.68,
        "text": "open a terminal window on your computer"
      },
      {
        "start": 811.279,
        "duration": 4.56,
        "text": "and navigate to the directory where you"
      },
      {
        "start": 813.36,
        "duration": 5.52,
        "text": "downloaded the git repository and run"
      },
      {
        "start": 815.839,
        "duration": 4.641,
        "text": "this command docker dash compose up i"
      },
      {
        "start": 818.88,
        "duration": 3.12,
        "text": "assume that you already have docker on"
      },
      {
        "start": 820.48,
        "duration": 3.2,
        "text": "your computer when you hit docker"
      },
      {
        "start": 822.0,
        "duration": 3.519,
        "text": "compose up if you haven't downloaded"
      },
      {
        "start": 823.68,
        "duration": 3.76,
        "text": "cassandra before this will take a little"
      },
      {
        "start": 825.519,
        "duration": 4.0,
        "text": "while i've done this before and the"
      },
      {
        "start": 827.44,
        "duration": 4.079,
        "text": "command spins up the docker container"
      },
      {
        "start": 829.519,
        "duration": 3.68,
        "text": "much more easily but leave the docker"
      },
      {
        "start": 831.519,
        "duration": 4.161,
        "text": "container to start and we will get back"
      },
      {
        "start": 833.199,
        "duration": 5.121,
        "text": "to the code let's test this application"
      },
      {
        "start": 835.68,
        "duration": 4.159,
        "text": "so that we can see whether our libraries"
      },
      {
        "start": 838.32,
        "duration": 3.68,
        "text": "were downloaded correctly so i'm going"
      },
      {
        "start": 839.839,
        "duration": 4.481,
        "text": "to run this application and if we see"
      },
      {
        "start": 842.0,
        "duration": 5.279,
        "text": "the string welcome to aka in the logs"
      },
      {
        "start": 844.32,
        "duration": 4.72,
        "text": "then we have everything well set all"
      },
      {
        "start": 847.279,
        "duration": 3.68,
        "text": "right now i'm going to start by"
      },
      {
        "start": 849.04,
        "duration": 3.68,
        "text": "designing the primary interaction"
      },
      {
        "start": 850.959,
        "duration": 4.161,
        "text": "between the hotel actor and the"
      },
      {
        "start": 852.72,
        "duration": 4.0,
        "text": "cassandra data store so here under the"
      },
      {
        "start": 855.12,
        "duration": 3.68,
        "text": "com rock the jvm i'm going to create a"
      },
      {
        "start": 856.72,
        "duration": 5.04,
        "text": "new package so i'm going to have"
      },
      {
        "start": 858.8,
        "duration": 5.2,
        "text": "com rock the jvm dot bookings and i'm"
      },
      {
        "start": 861.76,
        "duration": 3.92,
        "text": "going to design something that says"
      },
      {
        "start": 864.0,
        "duration": 3.68,
        "text": "actor so this is going to be the package"
      },
      {
        "start": 865.68,
        "duration": 4.8,
        "text": "actor i'm going to create a new scala"
      },
      {
        "start": 867.68,
        "duration": 5.44,
        "text": "class i'm going to call this hotel and"
      },
      {
        "start": 870.48,
        "duration": 4.159,
        "text": "this will be a class that i won't really"
      },
      {
        "start": 873.12,
        "duration": 3.76,
        "text": "want to add to the git repository leave"
      },
      {
        "start": 874.639,
        "duration": 3.361,
        "text": "me alone and this will be the primary"
      },
      {
        "start": 876.88,
        "duration": 3.36,
        "text": "actor"
      },
      {
        "start": 878.0,
        "duration": 5.6,
        "text": "primary persistent"
      },
      {
        "start": 880.24,
        "duration": 5.92,
        "text": "actor that will interact with cassandra"
      },
      {
        "start": 883.6,
        "duration": 4.4,
        "text": "now this hotel will implement a message"
      },
      {
        "start": 886.16,
        "duration": 3.28,
        "text": "protocol so this hotel will only treat a"
      },
      {
        "start": 888.0,
        "duration": 4.16,
        "text": "bunch of messages because we're using"
      },
      {
        "start": 889.44,
        "duration": 4.48,
        "text": "aca typed so here under the package i'm"
      },
      {
        "start": 892.16,
        "duration": 4.08,
        "text": "going to create a new package let's call"
      },
      {
        "start": 893.92,
        "duration": 3.84,
        "text": "this model and here under model i'm"
      },
      {
        "start": 896.24,
        "duration": 2.8,
        "text": "going to create the commands and the"
      },
      {
        "start": 897.76,
        "duration": 3.439,
        "text": "data structures that we're going to use"
      },
      {
        "start": 899.04,
        "duration": 3.919,
        "text": "for the rest of the video so here on our"
      },
      {
        "start": 901.199,
        "duration": 4.08,
        "text": "model i'm going to create another scala"
      },
      {
        "start": 902.959,
        "duration": 4.401,
        "text": "file i'm going to call this protocol"
      },
      {
        "start": 905.279,
        "duration": 3.521,
        "text": "and i'm going to remove the protocol"
      },
      {
        "start": 907.36,
        "duration": 3.68,
        "text": "class because i'm going to define a"
      },
      {
        "start": 908.8,
        "duration": 4.32,
        "text": "bunch of data structures i'm going to"
      },
      {
        "start": 911.04,
        "duration": 4.4,
        "text": "speed up the typing a little bit so that"
      },
      {
        "start": 913.12,
        "duration": 3.519,
        "text": "we don't waste any time with that now"
      },
      {
        "start": 915.44,
        "duration": 3.12,
        "text": "for every reservation we're going to"
      },
      {
        "start": 916.639,
        "duration": 4.081,
        "text": "store the guest id the start date and"
      },
      {
        "start": 918.56,
        "duration": 4.399,
        "text": "end date for the trip the room number"
      },
      {
        "start": 920.72,
        "duration": 3.679,
        "text": "and the actor which we will use to"
      },
      {
        "start": 922.959,
        "duration": 3.041,
        "text": "interact with then the change"
      },
      {
        "start": 924.399,
        "duration": 3.521,
        "text": "reservation will contain the"
      },
      {
        "start": 926.0,
        "duration": 3.839,
        "text": "confirmation number of that reservation"
      },
      {
        "start": 927.92,
        "duration": 4.32,
        "text": "which was accepted the start date end"
      },
      {
        "start": 929.839,
        "duration": 4.56,
        "text": "date room number and the same actor"
      },
      {
        "start": 932.24,
        "duration": 4.159,
        "text": "which we will use to send replies to and"
      },
      {
        "start": 934.399,
        "duration": 3.601,
        "text": "the cancellation will simply contain the"
      },
      {
        "start": 936.399,
        "duration": 3.601,
        "text": "confirmation number and the actor that"
      },
      {
        "start": 938.0,
        "duration": 4.0,
        "text": "we will use to communicate now in order"
      },
      {
        "start": 940.0,
        "duration": 4.32,
        "text": "to store a reservation i need to create"
      },
      {
        "start": 942.0,
        "duration": 3.519,
        "text": "a reservation case class which is a"
      },
      {
        "start": 944.32,
        "duration": 2.72,
        "text": "simple data structure so i'm going to"
      },
      {
        "start": 945.519,
        "duration": 3.76,
        "text": "call this reservation and i'm going to"
      },
      {
        "start": 947.04,
        "duration": 4.719,
        "text": "store it in a simple file case class"
      },
      {
        "start": 949.279,
        "duration": 5.68,
        "text": "reservation will contain a guest id"
      },
      {
        "start": 951.759,
        "duration": 5.841,
        "text": "which is a string a hotel id which is"
      },
      {
        "start": 954.959,
        "duration": 4.401,
        "text": "also a unique identifier the start date"
      },
      {
        "start": 957.6,
        "duration": 4.799,
        "text": "which is going to be a date"
      },
      {
        "start": 959.36,
        "duration": 5.52,
        "text": "then the end date which is going to be"
      },
      {
        "start": 962.399,
        "duration": 4.56,
        "text": "a date as well the room number"
      },
      {
        "start": 964.88,
        "duration": 3.519,
        "text": "which is going to be an int and the"
      },
      {
        "start": 966.959,
        "duration": 3.361,
        "text": "confirmation id"
      },
      {
        "start": 968.399,
        "duration": 4.641,
        "text": "confirmation"
      },
      {
        "start": 970.32,
        "duration": 3.92,
        "text": "number is going to be a string so this"
      },
      {
        "start": 973.04,
        "duration": 2.799,
        "text": "is going to be our fundamental data"
      },
      {
        "start": 974.24,
        "duration": 3.839,
        "text": "structure which is going to be wrapped"
      },
      {
        "start": 975.839,
        "duration": 4.8,
        "text": "inside the events that we are going to"
      },
      {
        "start": 978.079,
        "duration": 3.44,
        "text": "store in the cassandra so here back to"
      },
      {
        "start": 980.639,
        "duration": 2.961,
        "text": "the"
      },
      {
        "start": 981.519,
        "duration": 3.921,
        "text": "models for commands so this is going to"
      },
      {
        "start": 983.6,
        "duration": 4.159,
        "text": "be for commands we're also going to"
      },
      {
        "start": 985.44,
        "duration": 4.48,
        "text": "store events that we will persist to"
      },
      {
        "start": 987.759,
        "duration": 4.64,
        "text": "cassandra and this is going to be a case"
      },
      {
        "start": 989.92,
        "duration": 3.919,
        "text": "class let's call this reservation"
      },
      {
        "start": 992.399,
        "duration": 3.761,
        "text": "accepted"
      },
      {
        "start": 993.839,
        "duration": 3.92,
        "text": "which wraps a reservation one for"
      },
      {
        "start": 996.16,
        "duration": 4.16,
        "text": "cancellation so i'm going to call this"
      },
      {
        "start": 997.759,
        "duration": 5.361,
        "text": "reservation cancelled"
      },
      {
        "start": 1000.32,
        "duration": 4.8,
        "text": "and we will have another one for case"
      },
      {
        "start": 1003.12,
        "duration": 5.76,
        "text": "class let's call this reservation"
      },
      {
        "start": 1005.12,
        "duration": 6.24,
        "text": "modified or reservation updated"
      },
      {
        "start": 1008.88,
        "duration": 5.519,
        "text": "with an old reservation"
      },
      {
        "start": 1011.36,
        "duration": 6.96,
        "text": "and a new reservation so a new"
      },
      {
        "start": 1014.399,
        "duration": 6.481,
        "text": "reservation as a reservation"
      },
      {
        "start": 1018.32,
        "duration": 4.16,
        "text": "so these are events the commands are the"
      },
      {
        "start": 1020.88,
        "duration": 3.52,
        "text": "kind of messages that the actor the"
      },
      {
        "start": 1022.48,
        "duration": 3.839,
        "text": "hotel actor will receive from the"
      },
      {
        "start": 1024.4,
        "duration": 3.679,
        "text": "booking service and these are the events"
      },
      {
        "start": 1026.319,
        "duration": 4.321,
        "text": "that will actually be persisted into"
      },
      {
        "start": 1028.079,
        "duration": 4.561,
        "text": "cassandra now let's go back to the hotel"
      },
      {
        "start": 1030.64,
        "duration": 3.84,
        "text": "actor and let's design that now we made"
      },
      {
        "start": 1032.64,
        "duration": 4.24,
        "text": "this hotel a class but technically this"
      },
      {
        "start": 1034.48,
        "duration": 4.959,
        "text": "class is never instantiated because an"
      },
      {
        "start": 1036.88,
        "duration": 4.72,
        "text": "actor of type hotel is actually spun up"
      },
      {
        "start": 1039.439,
        "duration": 3.841,
        "text": "by akka and it's defined in terms of its"
      },
      {
        "start": 1041.6,
        "duration": 3.76,
        "text": "behavior so i'm going to turn this class"
      },
      {
        "start": 1043.28,
        "duration": 4.559,
        "text": "into an object which will only contain"
      },
      {
        "start": 1045.36,
        "duration": 6.0,
        "text": "some quote-unquote static fields and"
      },
      {
        "start": 1047.839,
        "duration": 6.08,
        "text": "methods now this object will contain a"
      },
      {
        "start": 1051.36,
        "duration": 4.08,
        "text": "case class that will store the state of"
      },
      {
        "start": 1053.919,
        "duration": 4.081,
        "text": "a particular act i'm going to define"
      },
      {
        "start": 1055.44,
        "duration": 4.88,
        "text": "that with a data type state and this"
      },
      {
        "start": 1058.0,
        "duration": 4.48,
        "text": "will contain some reservations for a"
      },
      {
        "start": 1060.32,
        "duration": 5.28,
        "text": "particular hotel so reservations as a"
      },
      {
        "start": 1062.48,
        "duration": 4.559,
        "text": "set of reservation"
      },
      {
        "start": 1065.6,
        "duration": 4.64,
        "text": "now i need to import reservation from"
      },
      {
        "start": 1067.039,
        "duration": 4.88,
        "text": "the model so i will store every state of"
      },
      {
        "start": 1070.24,
        "duration": 4.16,
        "text": "every actor as a set of all the"
      },
      {
        "start": 1071.919,
        "duration": 4.241,
        "text": "reservations applied to that actor now"
      },
      {
        "start": 1074.4,
        "duration": 3.84,
        "text": "i'm going to define an apply method"
      },
      {
        "start": 1076.16,
        "duration": 4.08,
        "text": "which will allow this hotel object to be"
      },
      {
        "start": 1078.24,
        "duration": 4.16,
        "text": "invoked much like a function and the"
      },
      {
        "start": 1080.24,
        "duration": 5.439,
        "text": "apply method will take a hotel"
      },
      {
        "start": 1082.4,
        "duration": 5.36,
        "text": "id as a string and this will return a"
      },
      {
        "start": 1085.679,
        "duration": 3.921,
        "text": "behavior so the behavior is the piece of"
      },
      {
        "start": 1087.76,
        "duration": 4.4,
        "text": "logic that akka uses to handle the"
      },
      {
        "start": 1089.6,
        "duration": 4.959,
        "text": "command so i'm going to have a behavior"
      },
      {
        "start": 1092.16,
        "duration": 4.48,
        "text": "from aca actor typed with the type"
      },
      {
        "start": 1094.559,
        "duration": 3.681,
        "text": "command"
      },
      {
        "start": 1096.64,
        "duration": 3.279,
        "text": "which we have from the model so i'm"
      },
      {
        "start": 1098.24,
        "duration": 3.92,
        "text": "going to import everything in the model"
      },
      {
        "start": 1099.919,
        "duration": 4.321,
        "text": "so now we have the command which is the"
      },
      {
        "start": 1102.16,
        "duration": 3.92,
        "text": "type that this actor will receive as"
      },
      {
        "start": 1104.24,
        "duration": 5.04,
        "text": "messages and i'm going to use a special"
      },
      {
        "start": 1106.08,
        "duration": 5.28,
        "text": "construct called event sourced behavior"
      },
      {
        "start": 1109.28,
        "duration": 4.0,
        "text": "event source behavior will take three"
      },
      {
        "start": 1111.36,
        "duration": 4.08,
        "text": "type arguments first of all the command"
      },
      {
        "start": 1113.28,
        "duration": 4.48,
        "text": "the message that it will receive the"
      },
      {
        "start": 1115.44,
        "duration": 4.72,
        "text": "event type that it will persist"
      },
      {
        "start": 1117.76,
        "duration": 4.56,
        "text": "cassandra which we don't have right now"
      },
      {
        "start": 1120.16,
        "duration": 3.759,
        "text": "and the state that this actor will store"
      },
      {
        "start": 1122.32,
        "duration": 3.52,
        "text": "internally now let me go back to the"
      },
      {
        "start": 1123.919,
        "duration": 3.921,
        "text": "model and i'm going to store the"
      },
      {
        "start": 1125.84,
        "duration": 3.839,
        "text": "reservation accepted update and canceled"
      },
      {
        "start": 1127.84,
        "duration": 4.079,
        "text": "as events so i'm going to define another"
      },
      {
        "start": 1129.679,
        "duration": 3.281,
        "text": "sealed trade i'm going to call this"
      },
      {
        "start": 1131.919,
        "duration": 2.64,
        "text": "event"
      },
      {
        "start": 1132.96,
        "duration": 3.839,
        "text": "a trait if you don't know scala it's"
      },
      {
        "start": 1134.559,
        "duration": 4.881,
        "text": "much like a java interface so this is"
      },
      {
        "start": 1136.799,
        "duration": 4.961,
        "text": "the exact same concept and now the event"
      },
      {
        "start": 1139.44,
        "duration": 4.08,
        "text": "is known to us the event source behavior"
      },
      {
        "start": 1141.76,
        "duration": 3.76,
        "text": "also has an apply method which means"
      },
      {
        "start": 1143.52,
        "duration": 3.6,
        "text": "that this can be invoked like a function"
      },
      {
        "start": 1145.52,
        "duration": 3.68,
        "text": "and the function will take a bunch of"
      },
      {
        "start": 1147.12,
        "duration": 4.24,
        "text": "arguments persistence id and the"
      },
      {
        "start": 1149.2,
        "duration": 3.76,
        "text": "persistence id is a unique identifier"
      },
      {
        "start": 1151.36,
        "duration": 3.6,
        "text": "from the point of view of the event"
      },
      {
        "start": 1152.96,
        "duration": 3.52,
        "text": "store which i'm going to use as"
      },
      {
        "start": 1154.96,
        "duration": 2.48,
        "text": "persistence"
      },
      {
        "start": 1156.48,
        "duration": 4.4,
        "text": "id"
      },
      {
        "start": 1157.44,
        "duration": 6.16,
        "text": "dot of unique id of unique id with the"
      },
      {
        "start": 1160.88,
        "duration": 4.88,
        "text": "hotel id that i get as an argument we"
      },
      {
        "start": 1163.6,
        "duration": 5.199,
        "text": "got the empty state as an empty set so"
      },
      {
        "start": 1165.76,
        "duration": 5.279,
        "text": "i'm going to say state with an empty set"
      },
      {
        "start": 1168.799,
        "duration": 4.24,
        "text": "then we have the command handler and i'm"
      },
      {
        "start": 1171.039,
        "duration": 4.721,
        "text": "going to define that as a method so i'm"
      },
      {
        "start": 1173.039,
        "duration": 4.321,
        "text": "going to have a command handler with the"
      },
      {
        "start": 1175.76,
        "duration": 4.56,
        "text": "hotel id"
      },
      {
        "start": 1177.36,
        "duration": 4.88,
        "text": "as a string and this is a function from"
      },
      {
        "start": 1180.32,
        "duration": 3.44,
        "text": "the current state of the actor and the"
      },
      {
        "start": 1182.24,
        "duration": 4.88,
        "text": "command that is the message that the"
      },
      {
        "start": 1183.76,
        "duration": 5.84,
        "text": "actor has just received to an effect"
      },
      {
        "start": 1187.12,
        "duration": 4.559,
        "text": "which will have the event that is"
      },
      {
        "start": 1189.6,
        "duration": 4.319,
        "text": "persisted into the event store and the"
      },
      {
        "start": 1191.679,
        "duration": 5.521,
        "text": "new state of the actor i need to import"
      },
      {
        "start": 1193.919,
        "duration": 4.801,
        "text": "effect from the aka persistence typed"
      },
      {
        "start": 1197.2,
        "duration": 2.719,
        "text": "and i'm going to leave it unimplemented"
      },
      {
        "start": 1198.72,
        "duration": 5.199,
        "text": "for now so i'm going to pass this"
      },
      {
        "start": 1199.919,
        "duration": 6.161,
        "text": "command handler with the hotel id as the"
      },
      {
        "start": 1203.919,
        "duration": 4.0,
        "text": "third argument of the function and we"
      },
      {
        "start": 1206.08,
        "duration": 4.32,
        "text": "have an event handler"
      },
      {
        "start": 1207.919,
        "duration": 4.081,
        "text": "which i'm going to use very similarly"
      },
      {
        "start": 1210.4,
        "duration": 4.24,
        "text": "i'm going to have another method i'm"
      },
      {
        "start": 1212.0,
        "duration": 5.28,
        "text": "going to call this event handler"
      },
      {
        "start": 1214.64,
        "duration": 5.12,
        "text": "so event handler which takes the hotel"
      },
      {
        "start": 1217.28,
        "duration": 5.12,
        "text": "string and this event handler will also"
      },
      {
        "start": 1219.76,
        "duration": 4.72,
        "text": "be a function from the state of the"
      },
      {
        "start": 1222.4,
        "duration": 4.639,
        "text": "actor at that point the event that has"
      },
      {
        "start": 1224.48,
        "duration": 3.679,
        "text": "just been persisted and the new state of"
      },
      {
        "start": 1227.039,
        "duration": 3.52,
        "text": "the actor"
      },
      {
        "start": 1228.159,
        "duration": 6.561,
        "text": "after persisting that event so i'm gonna"
      },
      {
        "start": 1230.559,
        "duration": 5.6,
        "text": "have my event handler with the hotel id"
      },
      {
        "start": 1234.72,
        "duration": 3.439,
        "text": "so the fundamental interaction will go"
      },
      {
        "start": 1236.159,
        "duration": 3.601,
        "text": "as follows this actor will receive a"
      },
      {
        "start": 1238.159,
        "duration": 3.52,
        "text": "command at some point of course"
      },
      {
        "start": 1239.76,
        "duration": 3.68,
        "text": "asynchronously when that happens the"
      },
      {
        "start": 1241.679,
        "duration": 3.201,
        "text": "command handler will be triggered by"
      },
      {
        "start": 1243.44,
        "duration": 3.28,
        "text": "modifying the internal state of the"
      },
      {
        "start": 1244.88,
        "duration": 3.52,
        "text": "actor will trigger an effect that will"
      },
      {
        "start": 1246.72,
        "duration": 3.92,
        "text": "persist that event"
      },
      {
        "start": 1248.4,
        "duration": 4.8,
        "text": "to the persistent store in this case"
      },
      {
        "start": 1250.64,
        "duration": 4.96,
        "text": "cassandra so once i receive this command"
      },
      {
        "start": 1253.2,
        "duration": 4.64,
        "text": "i will persist an event i will create it"
      },
      {
        "start": 1255.6,
        "duration": 3.6,
        "text": "and i will persist it and after the"
      },
      {
        "start": 1257.84,
        "duration": 4.0,
        "text": "persistent story has acknowledged the"
      },
      {
        "start": 1259.2,
        "duration": 4.24,
        "text": "event the second event handler callback"
      },
      {
        "start": 1261.84,
        "duration": 3.839,
        "text": "will be invoked and the state of the"
      },
      {
        "start": 1263.44,
        "duration": 3.84,
        "text": "actor will be modified after that"
      },
      {
        "start": 1265.679,
        "duration": 3.281,
        "text": "awesome now let me go implement the"
      },
      {
        "start": 1267.28,
        "duration": 3.279,
        "text": "command handler this is a two argument"
      },
      {
        "start": 1268.96,
        "duration": 3.199,
        "text": "function that contains the state of the"
      },
      {
        "start": 1270.559,
        "duration": 3.921,
        "text": "actor at this point and the command that"
      },
      {
        "start": 1272.159,
        "duration": 4.081,
        "text": "i'm just receiving and i need to perform"
      },
      {
        "start": 1274.48,
        "duration": 4.079,
        "text": "an effect now i need to perform an"
      },
      {
        "start": 1276.24,
        "duration": 4.24,
        "text": "effect a different effect diff depending"
      },
      {
        "start": 1278.559,
        "duration": 3.281,
        "text": "on the state of the command so if the"
      },
      {
        "start": 1280.48,
        "duration": 2.96,
        "text": "command is a make reservation i need to"
      },
      {
        "start": 1281.84,
        "duration": 3.199,
        "text": "perform some logic change reservation"
      },
      {
        "start": 1283.44,
        "duration": 3.44,
        "text": "cancel reservation different kinds of"
      },
      {
        "start": 1285.039,
        "duration": 4.241,
        "text": "logic of course you can add multiple"
      },
      {
        "start": 1286.88,
        "duration": 3.52,
        "text": "commands if you want so i'm going to run"
      },
      {
        "start": 1289.28,
        "duration": 2.639,
        "text": "a pattern match so i'm going to say"
      },
      {
        "start": 1290.4,
        "duration": 3.759,
        "text": "command match"
      },
      {
        "start": 1291.919,
        "duration": 3.841,
        "text": "and in case we got a make reservation"
      },
      {
        "start": 1294.159,
        "duration": 3.361,
        "text": "for all the constituent parts i'm going"
      },
      {
        "start": 1295.76,
        "duration": 3.68,
        "text": "to run the following logic first i'm"
      },
      {
        "start": 1297.52,
        "duration": 4.639,
        "text": "going to find if there's any conflicting"
      },
      {
        "start": 1299.44,
        "duration": 4.239,
        "text": "reservation for the hotel plus room"
      },
      {
        "start": 1302.159,
        "duration": 3.041,
        "text": "interval that i have here in my"
      },
      {
        "start": 1303.679,
        "duration": 3.521,
        "text": "reservation so if this combination"
      },
      {
        "start": 1305.2,
        "duration": 4.16,
        "text": "conflicts with any reservation in this"
      },
      {
        "start": 1307.2,
        "duration": 4.08,
        "text": "set then i'm going to return some sort"
      },
      {
        "start": 1309.36,
        "duration": 3.679,
        "text": "of failure otherwise i'm going to"
      },
      {
        "start": 1311.28,
        "duration": 4.96,
        "text": "persist"
      },
      {
        "start": 1313.039,
        "duration": 5.361,
        "text": "i'm going to say reservation accepted"
      },
      {
        "start": 1316.24,
        "duration": 4.48,
        "text": "so i'm going to run a quick logic to"
      },
      {
        "start": 1318.4,
        "duration": 4.8,
        "text": "check whether there is a conflicting"
      },
      {
        "start": 1320.72,
        "duration": 4.0,
        "text": "reservation that i'm attempting to make"
      },
      {
        "start": 1323.2,
        "duration": 3.68,
        "text": "now to that end i need to be able to"
      },
      {
        "start": 1324.72,
        "duration": 4.24,
        "text": "compare reservations for overlapping"
      },
      {
        "start": 1326.88,
        "duration": 4.159,
        "text": "intervals and also compare these for"
      },
      {
        "start": 1328.96,
        "duration": 4.4,
        "text": "equality because i'm storing them in a"
      },
      {
        "start": 1331.039,
        "duration": 3.921,
        "text": "set so let me go back to my reservation"
      },
      {
        "start": 1333.36,
        "duration": 3.6,
        "text": "data type and let me add a little piece"
      },
      {
        "start": 1334.96,
        "duration": 4.079,
        "text": "of logic the first piece of logic is an"
      },
      {
        "start": 1336.96,
        "duration": 3.76,
        "text": "intersect function which returns true if"
      },
      {
        "start": 1339.039,
        "duration": 3.681,
        "text": "two reservations have the same room in"
      },
      {
        "start": 1340.72,
        "duration": 4.4,
        "text": "the same hotel and their intervals"
      },
      {
        "start": 1342.72,
        "duration": 4.079,
        "text": "overlap so we're comparing the hotel id"
      },
      {
        "start": 1345.12,
        "duration": 3.6,
        "text": "and the room number and the intervals"
      },
      {
        "start": 1346.799,
        "duration": 4.081,
        "text": "for overlapping the second piece of"
      },
      {
        "start": 1348.72,
        "duration": 4.0,
        "text": "logic is equals and hash code because"
      },
      {
        "start": 1350.88,
        "duration": 3.039,
        "text": "we're storing these reservations in a"
      },
      {
        "start": 1352.72,
        "duration": 2.4,
        "text": "set now for the purpose of this"
      },
      {
        "start": 1353.919,
        "duration": 3.041,
        "text": "demonstration we're going to consider"
      },
      {
        "start": 1355.12,
        "duration": 3.76,
        "text": "two reservations equal from the point of"
      },
      {
        "start": 1356.96,
        "duration": 3.76,
        "text": "view of the set if their reservation"
      },
      {
        "start": 1358.88,
        "duration": 4.159,
        "text": "numbers their confirmation numbers are"
      },
      {
        "start": 1360.72,
        "duration": 4.16,
        "text": "identical so reservations are unique by"
      },
      {
        "start": 1363.039,
        "duration": 3.12,
        "text": "their confirmation numbers"
      },
      {
        "start": 1364.88,
        "duration": 2.799,
        "text": "now in order to be able to create a"
      },
      {
        "start": 1366.159,
        "duration": 3.361,
        "text": "reservation we need to be able to"
      },
      {
        "start": 1367.679,
        "duration": 3.441,
        "text": "somehow generate confirmation numbers as"
      },
      {
        "start": 1369.52,
        "duration": 3.519,
        "text": "randomly generated strings much like"
      },
      {
        "start": 1371.12,
        "duration": 3.28,
        "text": "airlines do so i'm going to create a"
      },
      {
        "start": 1373.039,
        "duration": 3.12,
        "text": "companion object"
      },
      {
        "start": 1374.4,
        "duration": 3.6,
        "text": "reservation where we will store the"
      },
      {
        "start": 1376.159,
        "duration": 3.441,
        "text": "quote unquote static fields and methods"
      },
      {
        "start": 1378.0,
        "duration": 4.0,
        "text": "of this type and i'm going to have a"
      },
      {
        "start": 1379.6,
        "duration": 4.72,
        "text": "single method called make which will"
      },
      {
        "start": 1382.0,
        "duration": 4.32,
        "text": "create a reservation based on just guest"
      },
      {
        "start": 1384.32,
        "duration": 3.599,
        "text": "id hotel id start date and date and room"
      },
      {
        "start": 1386.32,
        "duration": 4.4,
        "text": "number and leave the confirmation number"
      },
      {
        "start": 1387.919,
        "duration": 4.24,
        "text": "to that logic to be generated"
      },
      {
        "start": 1390.72,
        "duration": 3.36,
        "text": "now in order to implement that i'm going"
      },
      {
        "start": 1392.159,
        "duration": 4.0,
        "text": "to randomly generate a string of 10"
      },
      {
        "start": 1394.08,
        "duration": 4.64,
        "text": "characters which will contain only"
      },
      {
        "start": 1396.159,
        "duration": 4.561,
        "text": "capital alphanumeric characters and i'm"
      },
      {
        "start": 1398.72,
        "duration": 3.839,
        "text": "going to return a reservation after i've"
      },
      {
        "start": 1400.72,
        "duration": 3.36,
        "text": "generated that string so this is a"
      },
      {
        "start": 1402.559,
        "duration": 3.761,
        "text": "simple utility method that will allow me"
      },
      {
        "start": 1404.08,
        "duration": 4.64,
        "text": "to make reservations very very easily"
      },
      {
        "start": 1406.32,
        "duration": 4.56,
        "text": "now let's get back to our code in hotel"
      },
      {
        "start": 1408.72,
        "duration": 4.48,
        "text": "so in the hotel actor we will need to"
      },
      {
        "start": 1410.88,
        "duration": 4.64,
        "text": "create a tentative reservation and we"
      },
      {
        "start": 1413.2,
        "duration": 4.24,
        "text": "will get to find some sort of"
      },
      {
        "start": 1415.52,
        "duration": 3.2,
        "text": "potentially conflicting reservation in"
      },
      {
        "start": 1417.44,
        "duration": 3.04,
        "text": "this set"
      },
      {
        "start": 1418.72,
        "duration": 4.0,
        "text": "so i'm going to create a tentative"
      },
      {
        "start": 1420.48,
        "duration": 4.319,
        "text": "reservation so tentative"
      },
      {
        "start": 1422.72,
        "duration": 2.92,
        "text": "reservation"
      },
      {
        "start": 1424.799,
        "duration": 4.641,
        "text": "as"
      },
      {
        "start": 1425.64,
        "duration": 5.399,
        "text": "reservation.make with guest id"
      },
      {
        "start": 1429.44,
        "duration": 3.76,
        "text": "and we're going to pass all the"
      },
      {
        "start": 1431.039,
        "duration": 4.0,
        "text": "arguments here and i'm going to try to"
      },
      {
        "start": 1433.2,
        "duration": 4.0,
        "text": "find a conflicting reservation so i'm"
      },
      {
        "start": 1435.039,
        "duration": 4.721,
        "text": "going to have conflicting"
      },
      {
        "start": 1437.2,
        "duration": 5.12,
        "text": "reservation i'm going to use an option"
      },
      {
        "start": 1439.76,
        "duration": 4.64,
        "text": "here which is going to be state which i"
      },
      {
        "start": 1442.32,
        "duration": 4.479,
        "text": "receive as argument so the state here"
      },
      {
        "start": 1444.4,
        "duration": 5.68,
        "text": "contains the whole set of reservations"
      },
      {
        "start": 1446.799,
        "duration": 5.841,
        "text": "so state dot reservations find and i'm"
      },
      {
        "start": 1450.08,
        "duration": 4.479,
        "text": "going to find that reservation for which"
      },
      {
        "start": 1452.64,
        "duration": 4.56,
        "text": "r dot intersect this tentative"
      },
      {
        "start": 1454.559,
        "duration": 4.641,
        "text": "reservation is true now the return value"
      },
      {
        "start": 1457.2,
        "duration": 4.24,
        "text": "is going to be an option reservation so"
      },
      {
        "start": 1459.2,
        "duration": 4.4,
        "text": "option reservation and i need to pattern"
      },
      {
        "start": 1461.44,
        "duration": 4.64,
        "text": "match against this one so if"
      },
      {
        "start": 1463.6,
        "duration": 5.12,
        "text": "the conflicting reservation option dot"
      },
      {
        "start": 1466.08,
        "duration": 4.719,
        "text": "is empty then i have no problem and i"
      },
      {
        "start": 1468.72,
        "duration": 5.52,
        "text": "can persist my event so i'm going to"
      },
      {
        "start": 1470.799,
        "duration": 5.041,
        "text": "have effect dot persist and i'm going to"
      },
      {
        "start": 1474.24,
        "duration": 4.0,
        "text": "persist this reservation accepted so"
      },
      {
        "start": 1475.84,
        "duration": 4.079,
        "text": "reservation accepted wrapping this"
      },
      {
        "start": 1478.24,
        "duration": 2.48,
        "text": "tentative reservation because i can make"
      },
      {
        "start": 1479.919,
        "duration": 3.841,
        "text": "it"
      },
      {
        "start": 1480.72,
        "duration": 5.839,
        "text": "and after i've persisted i can then"
      },
      {
        "start": 1483.76,
        "duration": 5.6,
        "text": "reply or return some sort of"
      },
      {
        "start": 1486.559,
        "duration": 3.681,
        "text": "confirmation to whoever actor whichever"
      },
      {
        "start": 1489.36,
        "duration": 2.24,
        "text": "actor"
      },
      {
        "start": 1490.24,
        "duration": 4.4,
        "text": "sent me this command so i'm going to"
      },
      {
        "start": 1491.6,
        "duration": 5.52,
        "text": "have reply to the reply to actor and the"
      },
      {
        "start": 1494.64,
        "duration": 4.72,
        "text": "reply to actor is contained in the make"
      },
      {
        "start": 1497.12,
        "duration": 4.4,
        "text": "reservation command so i have the"
      },
      {
        "start": 1499.36,
        "duration": 4.4,
        "text": "reference of the actor to which i can"
      },
      {
        "start": 1501.52,
        "duration": 3.92,
        "text": "communicate and then i'm going to store"
      },
      {
        "start": 1503.76,
        "duration": 4.88,
        "text": "the current state and i'm going to say"
      },
      {
        "start": 1505.44,
        "duration": 4.56,
        "text": "reservation accepted for that tentative"
      },
      {
        "start": 1508.64,
        "duration": 2.96,
        "text": "reservation"
      },
      {
        "start": 1510.0,
        "duration": 2.799,
        "text": "so this is the"
      },
      {
        "start": 1511.6,
        "duration": 3.439,
        "text": "persist"
      },
      {
        "start": 1512.799,
        "duration": 6.081,
        "text": "and this is the reply"
      },
      {
        "start": 1515.039,
        "duration": 6.161,
        "text": "to the so-called manager or booking"
      },
      {
        "start": 1518.88,
        "duration": 4.24,
        "text": "agent actor and otherwise i'm going to"
      },
      {
        "start": 1521.2,
        "duration": 3.92,
        "text": "return a simple effect that doesn't do"
      },
      {
        "start": 1523.12,
        "duration": 3.76,
        "text": "anything but rather replies with a"
      },
      {
        "start": 1525.12,
        "duration": 5.6,
        "text": "command failure so i'm going to have"
      },
      {
        "start": 1526.88,
        "duration": 7.2,
        "text": "effect dot reply and i'm going to have a"
      },
      {
        "start": 1530.72,
        "duration": 4.8,
        "text": "reply to and i'm going to return some"
      },
      {
        "start": 1534.08,
        "duration": 2.88,
        "text": "sort of command failure which i haven't"
      },
      {
        "start": 1535.52,
        "duration": 3.279,
        "text": "defined yet i need to go back to the"
      },
      {
        "start": 1536.96,
        "duration": 3.28,
        "text": "protocol and create that so i'm going to"
      },
      {
        "start": 1538.799,
        "duration": 5.12,
        "text": "create a case class i'm going to call"
      },
      {
        "start": 1540.24,
        "duration": 6.24,
        "text": "this command failure for a reason"
      },
      {
        "start": 1543.919,
        "duration": 4.161,
        "text": "as a string let's say and this is the"
      },
      {
        "start": 1546.48,
        "duration": 4.799,
        "text": "communication"
      },
      {
        "start": 1548.08,
        "duration": 6.479,
        "text": "with the so-called agent the"
      },
      {
        "start": 1551.279,
        "duration": 5.121,
        "text": "main actor and the hotel will reply back"
      },
      {
        "start": 1554.559,
        "duration": 5.6,
        "text": "with a command failure let's say command"
      },
      {
        "start": 1556.4,
        "duration": 4.96,
        "text": "failure with reservation"
      },
      {
        "start": 1560.159,
        "duration": 2.481,
        "text": "failed"
      },
      {
        "start": 1561.36,
        "duration": 4.64,
        "text": "conflict"
      },
      {
        "start": 1562.64,
        "duration": 5.6,
        "text": "with another reservation"
      },
      {
        "start": 1566.0,
        "duration": 4.24,
        "text": "for some reason the compiler is unhappy"
      },
      {
        "start": 1568.24,
        "duration": 4.16,
        "text": "with my s thing and this is probably"
      },
      {
        "start": 1570.24,
        "duration": 5.36,
        "text": "because the reservation accepted doesn't"
      },
      {
        "start": 1572.4,
        "duration": 6.639,
        "text": "extend event so i'm going to make sure"
      },
      {
        "start": 1575.6,
        "duration": 6.0,
        "text": "that all my types extend event"
      },
      {
        "start": 1579.039,
        "duration": 5.041,
        "text": "and if i do that i can go back to my"
      },
      {
        "start": 1581.6,
        "duration": 4.72,
        "text": "code and the function is interpreted"
      },
      {
        "start": 1584.08,
        "duration": 4.719,
        "text": "correctly all right so all the events"
      },
      {
        "start": 1586.32,
        "duration": 4.4,
        "text": "need to belong to the same trait because"
      },
      {
        "start": 1588.799,
        "duration": 4.721,
        "text": "all everything is typed so the compiler"
      },
      {
        "start": 1590.72,
        "duration": 5.839,
        "text": "type checks all so this make reservation"
      },
      {
        "start": 1593.52,
        "duration": 5.68,
        "text": "is only persisted if we have a"
      },
      {
        "start": 1596.559,
        "duration": 5.201,
        "text": "non-conflicting scenario here"
      },
      {
        "start": 1599.2,
        "duration": 5.04,
        "text": "now in case we get a change reservation"
      },
      {
        "start": 1601.76,
        "duration": 3.68,
        "text": "i'm going to for now i'm going to return"
      },
      {
        "start": 1604.24,
        "duration": 4.48,
        "text": "an effect"
      },
      {
        "start": 1605.44,
        "duration": 5.839,
        "text": "dot none because i'm going to try to"
      },
      {
        "start": 1608.72,
        "duration": 5.52,
        "text": "test whether the make reservation effect"
      },
      {
        "start": 1611.279,
        "duration": 4.801,
        "text": "was created and i'm going to add another"
      },
      {
        "start": 1614.24,
        "duration": 6.08,
        "text": "case for cancel reservation and i'm"
      },
      {
        "start": 1616.08,
        "duration": 6.8,
        "text": "going to again return an effect none"
      },
      {
        "start": 1620.32,
        "duration": 4.8,
        "text": "and i'm going to add a to do here to"
      },
      {
        "start": 1622.88,
        "duration": 4.399,
        "text": "change the logic in this case now for"
      },
      {
        "start": 1625.12,
        "duration": 4.32,
        "text": "make reservation i would like to also"
      },
      {
        "start": 1627.279,
        "duration": 4.161,
        "text": "handle the event that was persisted"
      },
      {
        "start": 1629.44,
        "duration": 4.16,
        "text": "which is reservation accepted and we"
      },
      {
        "start": 1631.44,
        "duration": 4.0,
        "text": "will modify the state of the actor to a"
      },
      {
        "start": 1633.6,
        "duration": 3.36,
        "text": "new state so i'm going to run a two"
      },
      {
        "start": 1635.44,
        "duration": 2.719,
        "text": "argument function which is state and"
      },
      {
        "start": 1636.96,
        "duration": 2.719,
        "text": "event"
      },
      {
        "start": 1638.159,
        "duration": 4.0,
        "text": "again i'm going to run a pattern match"
      },
      {
        "start": 1639.679,
        "duration": 5.201,
        "text": "on the event so event match and in case"
      },
      {
        "start": 1642.159,
        "duration": 4.961,
        "text": "we get a reservation accepted for a"
      },
      {
        "start": 1644.88,
        "duration": 4.96,
        "text": "reservation i'm going to return a new"
      },
      {
        "start": 1647.12,
        "duration": 5.6,
        "text": "state so i'm going to have new state"
      },
      {
        "start": 1649.84,
        "duration": 5.36,
        "text": "save it as a val so new state as state"
      },
      {
        "start": 1652.72,
        "duration": 5.52,
        "text": "dot copy and i'm going to keep my"
      },
      {
        "start": 1655.2,
        "duration": 5.92,
        "text": "reservations as state"
      },
      {
        "start": 1658.24,
        "duration": 4.64,
        "text": "dot reservations plus the reservation"
      },
      {
        "start": 1661.12,
        "duration": 3.84,
        "text": "that has just been added in scala"
      },
      {
        "start": 1662.88,
        "duration": 4.24,
        "text": "collections are super easy to add or"
      },
      {
        "start": 1664.96,
        "duration": 4.16,
        "text": "remove elements to and from and i'm"
      },
      {
        "start": 1667.12,
        "duration": 4.08,
        "text": "going to define"
      },
      {
        "start": 1669.12,
        "duration": 5.439,
        "text": "let's call the print line"
      },
      {
        "start": 1671.2,
        "duration": 5.599,
        "text": "and i'm going to have my state changed"
      },
      {
        "start": 1674.559,
        "duration": 4.161,
        "text": "and i'm going to return a new state here"
      },
      {
        "start": 1676.799,
        "duration": 5.36,
        "text": "in this as interpolated string and i'm"
      },
      {
        "start": 1678.72,
        "duration": 5.439,
        "text": "going to return the new state as the end"
      },
      {
        "start": 1682.159,
        "duration": 4.081,
        "text": "result of this function again i'm going"
      },
      {
        "start": 1684.159,
        "duration": 4.4,
        "text": "to add another case and i'm going to add"
      },
      {
        "start": 1686.24,
        "duration": 4.4,
        "text": "a to do because we don't really need to"
      },
      {
        "start": 1688.559,
        "duration": 4.641,
        "text": "return anything i'm going to"
      },
      {
        "start": 1690.64,
        "duration": 5.12,
        "text": "maintain the same state"
      },
      {
        "start": 1693.2,
        "duration": 4.719,
        "text": "now the to do will act upon the"
      },
      {
        "start": 1695.76,
        "duration": 4.399,
        "text": "reservation amended or changed in the"
      },
      {
        "start": 1697.919,
        "duration": 3.681,
        "text": "reservation cancelled events that were"
      },
      {
        "start": 1700.159,
        "duration": 3.281,
        "text": "persisted right now i want to test"
      },
      {
        "start": 1701.6,
        "duration": 4.559,
        "text": "whether the make reservation"
      },
      {
        "start": 1703.44,
        "duration": 4.8,
        "text": "effect was correctly created so here on"
      },
      {
        "start": 1706.159,
        "duration": 4.24,
        "text": "the comroc the jvm bookings i'm going to"
      },
      {
        "start": 1708.24,
        "duration": 3.52,
        "text": "create an application so i'm going to"
      },
      {
        "start": 1710.399,
        "duration": 3.601,
        "text": "have a new package i'm going to call"
      },
      {
        "start": 1711.76,
        "duration": 4.72,
        "text": "this apps and under apps i'm going to"
      },
      {
        "start": 1714.0,
        "duration": 3.919,
        "text": "create a let's call this hotel test or"
      },
      {
        "start": 1716.48,
        "duration": 2.64,
        "text": "hotel playground or something like that"
      },
      {
        "start": 1717.919,
        "duration": 3.521,
        "text": "so hotel"
      },
      {
        "start": 1719.12,
        "duration": 4.08,
        "text": "playground and i'm going to make it an"
      },
      {
        "start": 1721.44,
        "duration": 3.599,
        "text": "object because this will have a main"
      },
      {
        "start": 1723.2,
        "duration": 3.76,
        "text": "method that will turn this hotel"
      },
      {
        "start": 1725.039,
        "duration": 4.081,
        "text": "playground into a standalone runnable"
      },
      {
        "start": 1726.96,
        "duration": 3.76,
        "text": "application so this hotel playground"
      },
      {
        "start": 1729.12,
        "duration": 3.279,
        "text": "will have a main function now i'm going"
      },
      {
        "start": 1730.72,
        "duration": 3.52,
        "text": "to spin up an actor system that will"
      },
      {
        "start": 1732.399,
        "duration": 3.76,
        "text": "hold one of these hotel actors and i'm"
      },
      {
        "start": 1734.24,
        "duration": 5.039,
        "text": "going to send a message to it let's see"
      },
      {
        "start": 1736.159,
        "duration": 5.841,
        "text": "what this thing has so first of all i'm"
      },
      {
        "start": 1739.279,
        "duration": 4.081,
        "text": "going to create a root behavior for the"
      },
      {
        "start": 1742.0,
        "duration": 3.679,
        "text": "actor system so i'm going to use a"
      },
      {
        "start": 1743.36,
        "duration": 6.48,
        "text": "construct called behaviors"
      },
      {
        "start": 1745.679,
        "duration": 5.36,
        "text": "plural so behaviors dot setup and setup"
      },
      {
        "start": 1749.84,
        "duration": 3.68,
        "text": "takes"
      },
      {
        "start": 1751.039,
        "duration": 4.801,
        "text": "a data structure called inactive context"
      },
      {
        "start": 1753.52,
        "duration": 5.12,
        "text": "so ctx and i'm going to create a hotel"
      },
      {
        "start": 1755.84,
        "duration": 4.88,
        "text": "actor and the so-called agent actor will"
      },
      {
        "start": 1758.64,
        "duration": 4.32,
        "text": "which will simply log whatever replies"
      },
      {
        "start": 1760.72,
        "duration": 3.36,
        "text": "the hotel will send back so i'm going to"
      },
      {
        "start": 1762.96,
        "duration": 2.319,
        "text": "have my"
      },
      {
        "start": 1764.08,
        "duration": 4.479,
        "text": "logger"
      },
      {
        "start": 1765.279,
        "duration": 5.441,
        "text": "as ctx.spawn"
      },
      {
        "start": 1768.559,
        "duration": 3.6,
        "text": "and uh actually i'm going to make the"
      },
      {
        "start": 1770.72,
        "duration": 4.64,
        "text": "compiler work with me here i'm going to"
      },
      {
        "start": 1772.159,
        "duration": 5.76,
        "text": "have my behaviors dot empty and i'm"
      },
      {
        "start": 1775.36,
        "duration": 4.799,
        "text": "going to add a tag a type argument to"
      },
      {
        "start": 1777.919,
        "duration": 4.161,
        "text": "behaviors.setup let's say that this root"
      },
      {
        "start": 1780.159,
        "duration": 3.601,
        "text": "actor system will"
      },
      {
        "start": 1782.08,
        "duration": 3.92,
        "text": "receive messages of type string of"
      },
      {
        "start": 1783.76,
        "duration": 4.399,
        "text": "course we don't really need to send any"
      },
      {
        "start": 1786.0,
        "duration": 3.76,
        "text": "messages to the root actor system but"
      },
      {
        "start": 1788.159,
        "duration": 3.681,
        "text": "i'm going to create a logger behavior so"
      },
      {
        "start": 1789.76,
        "duration": 5.44,
        "text": "i'm going to have let's call this simple"
      },
      {
        "start": 1791.84,
        "duration": 5.199,
        "text": "logger as behaviors"
      },
      {
        "start": 1795.2,
        "duration": 4.0,
        "text": "dot receive"
      },
      {
        "start": 1797.039,
        "duration": 4.161,
        "text": "and i'm gonna use receive with any kind"
      },
      {
        "start": 1799.2,
        "duration": 4.16,
        "text": "of message so the simple logger will"
      },
      {
        "start": 1801.2,
        "duration": 4.8,
        "text": "simply log whatever message it receives"
      },
      {
        "start": 1803.36,
        "duration": 5.76,
        "text": "to the console so i'm gonna have my"
      },
      {
        "start": 1806.0,
        "duration": 5.12,
        "text": "context and message as the two argument"
      },
      {
        "start": 1809.12,
        "duration": 5.439,
        "text": "function and i'm going to use context"
      },
      {
        "start": 1811.12,
        "duration": 5.76,
        "text": "log info and i'm going to have a simple"
      },
      {
        "start": 1814.559,
        "duration": 4.0,
        "text": "logger tag and i'm going to inject my"
      },
      {
        "start": 1816.88,
        "duration": 4.24,
        "text": "message in this interpolated string and"
      },
      {
        "start": 1818.559,
        "duration": 4.081,
        "text": "i'm going to keep the behavior same"
      },
      {
        "start": 1821.12,
        "duration": 3.439,
        "text": "so the way that this behavior works is"
      },
      {
        "start": 1822.64,
        "duration": 4.0,
        "text": "that upon the reception of this message"
      },
      {
        "start": 1824.559,
        "duration": 3.761,
        "text": "the actor can change its behavior but in"
      },
      {
        "start": 1826.64,
        "duration": 4.159,
        "text": "this case i'm going to keep the behavior"
      },
      {
        "start": 1828.32,
        "duration": 5.12,
        "text": "to be the same so i'm going to spin up a"
      },
      {
        "start": 1830.799,
        "duration": 5.12,
        "text": "logger so i'm going to have my context"
      },
      {
        "start": 1833.44,
        "duration": 4.0,
        "text": "spawn i'm going to create a small child"
      },
      {
        "start": 1835.919,
        "duration": 3.521,
        "text": "actor"
      },
      {
        "start": 1837.44,
        "duration": 3.68,
        "text": "and i'm going to use ctx spawn and i'm"
      },
      {
        "start": 1839.44,
        "duration": 3.52,
        "text": "going to use simple logger"
      },
      {
        "start": 1841.12,
        "duration": 3.2,
        "text": "and i'm going to give a name so let's"
      },
      {
        "start": 1842.96,
        "duration": 2.88,
        "text": "call this logger"
      },
      {
        "start": 1844.32,
        "duration": 4.32,
        "text": "and i'm going to create my hotel actor"
      },
      {
        "start": 1845.84,
        "duration": 4.959,
        "text": "so hotel as context spawn and i'm going"
      },
      {
        "start": 1848.64,
        "duration": 5.12,
        "text": "to use my hotel"
      },
      {
        "start": 1850.799,
        "duration": 5.12,
        "text": "my hotel actor which i need to import"
      },
      {
        "start": 1853.76,
        "duration": 4.399,
        "text": "so hotel i'm going to give this id let's"
      },
      {
        "start": 1855.919,
        "duration": 5.12,
        "text": "call this test hotel"
      },
      {
        "start": 1858.159,
        "duration": 4.481,
        "text": "and i'm going to use the name test hotel"
      },
      {
        "start": 1861.039,
        "duration": 4.561,
        "text": "for the actor as well"
      },
      {
        "start": 1862.64,
        "duration": 5.2,
        "text": "so test hotel is the persistence id of"
      },
      {
        "start": 1865.6,
        "duration": 4.64,
        "text": "this actor and this is the actor"
      },
      {
        "start": 1867.84,
        "duration": 4.079,
        "text": "identifier if i want to access that"
      },
      {
        "start": 1870.24,
        "duration": 3.279,
        "text": "within the actor system now these"
      },
      {
        "start": 1871.919,
        "duration": 3.36,
        "text": "constructs for those of you who haven't"
      },
      {
        "start": 1873.519,
        "duration": 4.0,
        "text": "seen aka before they might seem a little"
      },
      {
        "start": 1875.279,
        "duration": 4.801,
        "text": "strange and that is because an actor is"
      },
      {
        "start": 1877.519,
        "duration": 4.721,
        "text": "never actually spawned through a"
      },
      {
        "start": 1880.08,
        "duration": 3.52,
        "text": "constructor of the class but rather it"
      },
      {
        "start": 1882.24,
        "duration": 3.6,
        "text": "spawned through this construct"
      },
      {
        "start": 1883.6,
        "duration": 5.04,
        "text": "context.spawn with the behavior"
      },
      {
        "start": 1885.84,
        "duration": 5.0,
        "text": "described by whatever invocation i might"
      },
      {
        "start": 1888.64,
        "duration": 5.12,
        "text": "pass as the argument and the actor name"
      },
      {
        "start": 1890.84,
        "duration": 4.839,
        "text": "obviously all right now i'm going to"
      },
      {
        "start": 1893.76,
        "duration": 4.24,
        "text": "send a message to this hotel so i'm"
      },
      {
        "start": 1895.679,
        "duration": 4.321,
        "text": "going to have hotel tell"
      },
      {
        "start": 1898.0,
        "duration": 4.0,
        "text": "and the way that we send a message to an"
      },
      {
        "start": 1900.0,
        "duration": 4.24,
        "text": "actor asynchronously is through a method"
      },
      {
        "start": 1902.0,
        "duration": 3.76,
        "text": "called tell which is denoted in scala"
      },
      {
        "start": 1904.24,
        "duration": 3.919,
        "text": "with this very interesting name"
      },
      {
        "start": 1905.76,
        "duration": 5.6,
        "text": "exclamation mark which is an operator so"
      },
      {
        "start": 1908.159,
        "duration": 5.601,
        "text": "i'm going to use a make reservation that"
      },
      {
        "start": 1911.36,
        "duration": 4.0,
        "text": "i will import from the model and the"
      },
      {
        "start": 1913.76,
        "duration": 4.24,
        "text": "make reservation obviously will have a"
      },
      {
        "start": 1915.36,
        "duration": 4.159,
        "text": "bunch of parameters so the guest id i'm"
      },
      {
        "start": 1918.0,
        "duration": 4.64,
        "text": "going to have my name"
      },
      {
        "start": 1919.519,
        "duration": 4.0,
        "text": "and the start date i'm going to use date"
      },
      {
        "start": 1922.64,
        "duration": 4.48,
        "text": "from"
      },
      {
        "start": 1923.519,
        "duration": 5.681,
        "text": "java util so not java util java sql date"
      },
      {
        "start": 1927.12,
        "duration": 3.919,
        "text": "value of and i'm going to use"
      },
      {
        "start": 1929.2,
        "duration": 5.04,
        "text": "2022"
      },
      {
        "start": 1931.039,
        "duration": 5.76,
        "text": "july 14th which is the day of recording"
      },
      {
        "start": 1934.24,
        "duration": 5.679,
        "text": "and i'm going to use another date let's"
      },
      {
        "start": 1936.799,
        "duration": 3.12,
        "text": "say july"
      },
      {
        "start": 1940.88,
        "duration": 4.639,
        "text": "21"
      },
      {
        "start": 1942.48,
        "duration": 5.6,
        "text": "so we're staying for a week at room 101"
      },
      {
        "start": 1945.519,
        "duration": 4.081,
        "text": "and the logger as the reply to actor"
      },
      {
        "start": 1948.08,
        "duration": 3.68,
        "text": "which this"
      },
      {
        "start": 1949.6,
        "duration": 4.4,
        "text": "hotel actor will interact with so once"
      },
      {
        "start": 1951.76,
        "duration": 4.32,
        "text": "the hotel receives the make reservation"
      },
      {
        "start": 1954.0,
        "duration": 4.08,
        "text": "message it will perform all this logic"
      },
      {
        "start": 1956.08,
        "duration": 4.56,
        "text": "it will persist this event into"
      },
      {
        "start": 1958.08,
        "duration": 5.04,
        "text": "cassandra then it will reply to whatever"
      },
      {
        "start": 1960.64,
        "duration": 5.279,
        "text": "actor i specify which is the simple"
      },
      {
        "start": 1963.12,
        "duration": 4.48,
        "text": "logger that the reservation was created"
      },
      {
        "start": 1965.919,
        "duration": 3.921,
        "text": "and the behavior of the root actor"
      },
      {
        "start": 1967.6,
        "duration": 5.04,
        "text": "system is going to be empty so i'm going"
      },
      {
        "start": 1969.84,
        "duration": 6.079,
        "text": "to create an actor system so let's call"
      },
      {
        "start": 1972.64,
        "duration": 6.0,
        "text": "this system as actor system with the"
      },
      {
        "start": 1975.919,
        "duration": 6.081,
        "text": "rude behavior so rude behavior and the"
      },
      {
        "start": 1978.64,
        "duration": 5.279,
        "text": "name let's call this demo hotel"
      },
      {
        "start": 1982.0,
        "duration": 3.76,
        "text": "which will probably be a better name for"
      },
      {
        "start": 1983.919,
        "duration": 5.281,
        "text": "this application so hotel playground i'm"
      },
      {
        "start": 1985.76,
        "duration": 5.84,
        "text": "going to use hotel demo"
      },
      {
        "start": 1989.2,
        "duration": 4.8,
        "text": "and this actor system let's say will"
      },
      {
        "start": 1991.6,
        "duration": 4.4,
        "text": "terminate after five seconds so system"
      },
      {
        "start": 1994.0,
        "duration": 3.76,
        "text": "scheduler and i'm going to use schedule"
      },
      {
        "start": 1996.0,
        "duration": 3.039,
        "text": "once and for"
      },
      {
        "start": 1997.76,
        "duration": 3.279,
        "text": "five seconds"
      },
      {
        "start": 1999.039,
        "duration": 4.801,
        "text": "i'm going to run a runnable and i'm"
      },
      {
        "start": 2001.039,
        "duration": 4.48,
        "text": "going to say system terminate now five"
      },
      {
        "start": 2003.84,
        "duration": 3.76,
        "text": "dot seconds doesn't exist without an"
      },
      {
        "start": 2005.519,
        "duration": 4.16,
        "text": "extension method scala offers that i'm"
      },
      {
        "start": 2007.6,
        "duration": 3.919,
        "text": "going to import a package called scala"
      },
      {
        "start": 2009.679,
        "duration": 4.561,
        "text": "concurrent duration everything i teach"
      },
      {
        "start": 2011.519,
        "duration": 4.88,
        "text": "this in my skull advanced course how"
      },
      {
        "start": 2014.24,
        "duration": 4.48,
        "text": "extension methods work so notice the"
      },
      {
        "start": 2016.399,
        "duration": 4.241,
        "text": "expression is very interestingly"
      },
      {
        "start": 2018.72,
        "duration": 4.24,
        "text": "readable and i'm going to import the"
      },
      {
        "start": 2020.64,
        "duration": 4.8,
        "text": "execution context which is a scholar"
      },
      {
        "start": 2022.96,
        "duration": 5.24,
        "text": "native thread pool for running this"
      },
      {
        "start": 2025.44,
        "duration": 4.64,
        "text": "little action so i'm going to import"
      },
      {
        "start": 2028.2,
        "duration": 3.479,
        "text": "system.executioncontext at this point we"
      },
      {
        "start": 2030.08,
        "duration": 3.28,
        "text": "should have a runnable application we"
      },
      {
        "start": 2031.679,
        "duration": 4.0,
        "text": "need to figure out if cassandra is"
      },
      {
        "start": 2033.36,
        "duration": 4.88,
        "text": "working and by the look of it it seems"
      },
      {
        "start": 2035.679,
        "duration": 4.401,
        "text": "that cassandra is working we can connect"
      },
      {
        "start": 2038.24,
        "duration": 4.64,
        "text": "in another terminal window i'm going to"
      },
      {
        "start": 2040.08,
        "duration": 4.24,
        "text": "use docker ps to find out the name of"
      },
      {
        "start": 2042.88,
        "duration": 3.2,
        "text": "the cassandra docker container i'm going"
      },
      {
        "start": 2044.32,
        "duration": 3.68,
        "text": "to copy that and i'm going to run this"
      },
      {
        "start": 2046.08,
        "duration": 3.759,
        "text": "command docker exec"
      },
      {
        "start": 2048.0,
        "duration": 6.159,
        "text": "it and i'm going to paste this and then"
      },
      {
        "start": 2049.839,
        "duration": 5.441,
        "text": "i'm going to use cql shell cql sh to"
      },
      {
        "start": 2054.159,
        "duration": 4.081,
        "text": "start the"
      },
      {
        "start": 2055.28,
        "duration": 3.839,
        "text": "cassandra query language shell prompt"
      },
      {
        "start": 2058.24,
        "duration": 2.8,
        "text": "and"
      },
      {
        "start": 2059.119,
        "duration": 3.76,
        "text": "if this works then that means the docker"
      },
      {
        "start": 2061.04,
        "duration": 3.839,
        "text": "container is up and running we should be"
      },
      {
        "start": 2062.879,
        "duration": 3.921,
        "text": "able to run this application so this is"
      },
      {
        "start": 2064.879,
        "duration": 3.28,
        "text": "going to be our first run it will take a"
      },
      {
        "start": 2066.8,
        "duration": 3.279,
        "text": "couple of seconds for the compiler to"
      },
      {
        "start": 2068.159,
        "duration": 4.641,
        "text": "compile all our code that we wrote in"
      },
      {
        "start": 2070.079,
        "duration": 4.401,
        "text": "the last half an hour and notice that we"
      },
      {
        "start": 2072.8,
        "duration": 3.68,
        "text": "have"
      },
      {
        "start": 2074.48,
        "duration": 3.679,
        "text": "some logs here and we have the demo"
      },
      {
        "start": 2076.48,
        "duration": 3.599,
        "text": "hotel using the java serializer and"
      },
      {
        "start": 2078.159,
        "duration": 4.081,
        "text": "notice that the logger"
      },
      {
        "start": 2080.079,
        "duration": 3.84,
        "text": "got the reservation accepted so the"
      },
      {
        "start": 2082.24,
        "duration": 3.679,
        "text": "reservation accepted was logged by the"
      },
      {
        "start": 2083.919,
        "duration": 5.76,
        "text": "logger which means that the event was"
      },
      {
        "start": 2085.919,
        "duration": 6.24,
        "text": "persisted now due to application.conf"
      },
      {
        "start": 2089.679,
        "duration": 4.561,
        "text": "aka persistence already knows which"
      },
      {
        "start": 2092.159,
        "duration": 5.2,
        "text": "persistent store we're going to use so"
      },
      {
        "start": 2094.24,
        "duration": 4.72,
        "text": "in this case we have here under aka"
      },
      {
        "start": 2097.359,
        "duration": 3.681,
        "text": "persistence journal we have aqua"
      },
      {
        "start": 2098.96,
        "duration": 3.68,
        "text": "persistence cassandra journal which is a"
      },
      {
        "start": 2101.04,
        "duration": 3.76,
        "text": "smart journal that will automatically"
      },
      {
        "start": 2102.64,
        "duration": 3.84,
        "text": "create the appropriate tables for all"
      },
      {
        "start": 2104.8,
        "duration": 4.0,
        "text": "the messages and the events that we're"
      },
      {
        "start": 2106.48,
        "duration": 5.119,
        "text": "going to store in cassandra so here in"
      },
      {
        "start": 2108.8,
        "duration": 6.08,
        "text": "sql shell i can now run this command"
      },
      {
        "start": 2111.599,
        "duration": 5.121,
        "text": "select star from a table called akka dot"
      },
      {
        "start": 2114.88,
        "duration": 3.52,
        "text": "messages"
      },
      {
        "start": 2116.72,
        "duration": 4.639,
        "text": "so if we see something like this if we"
      },
      {
        "start": 2118.4,
        "duration": 5.12,
        "text": "see a row in akka.messages this"
      },
      {
        "start": 2121.359,
        "duration": 4.401,
        "text": "what you see here this binary string is"
      },
      {
        "start": 2123.52,
        "duration": 4.319,
        "text": "the binary encoding of the reservation"
      },
      {
        "start": 2125.76,
        "duration": 4.16,
        "text": "accepted event that was persisted in"
      },
      {
        "start": 2127.839,
        "duration": 4.321,
        "text": "cassandra this table was automatically"
      },
      {
        "start": 2129.92,
        "duration": 5.36,
        "text": "created by akka persistence and you can"
      },
      {
        "start": 2132.16,
        "duration": 4.959,
        "text": "check the tag here called test hotel so"
      },
      {
        "start": 2135.28,
        "duration": 4.079,
        "text": "this is called the persistence id the"
      },
      {
        "start": 2137.119,
        "duration": 4.641,
        "text": "persistence id is the unique actor that"
      },
      {
        "start": 2139.359,
        "duration": 4.881,
        "text": "wrote this event into the database so"
      },
      {
        "start": 2141.76,
        "duration": 4.64,
        "text": "the persistence id is called test hotel"
      },
      {
        "start": 2144.24,
        "duration": 4.0,
        "text": "which is the exact identifier that we"
      },
      {
        "start": 2146.4,
        "duration": 4.24,
        "text": "added at the application"
      },
      {
        "start": 2148.24,
        "duration": 4.56,
        "text": "so the make reservation effect works"
      },
      {
        "start": 2150.64,
        "duration": 3.52,
        "text": "correctly we can now implement the rest"
      },
      {
        "start": 2152.8,
        "duration": 4.24,
        "text": "of the effects"
      },
      {
        "start": 2154.16,
        "duration": 4.72,
        "text": "now looking at the hotel if we go back"
      },
      {
        "start": 2157.04,
        "duration": 3.68,
        "text": "to the logs of the running of the"
      },
      {
        "start": 2158.88,
        "duration": 4.479,
        "text": "previous application notice that we also"
      },
      {
        "start": 2160.72,
        "duration": 5.119,
        "text": "have state changed here so state changed"
      },
      {
        "start": 2163.359,
        "duration": 4.48,
        "text": "means that our handler our event handler"
      },
      {
        "start": 2165.839,
        "duration": 4.401,
        "text": "worked correctly in the sense that after"
      },
      {
        "start": 2167.839,
        "duration": 4.24,
        "text": "the event was persisted in cassandra the"
      },
      {
        "start": 2170.24,
        "duration": 3.44,
        "text": "internal state of the actor was changed"
      },
      {
        "start": 2172.079,
        "duration": 3.201,
        "text": "to the set that now contains the"
      },
      {
        "start": 2173.68,
        "duration": 4.0,
        "text": "reservation with the name daniel the"
      },
      {
        "start": 2175.28,
        "duration": 4.799,
        "text": "hotel is test hotel the dates are as i"
      },
      {
        "start": 2177.68,
        "duration": 3.84,
        "text": "typed the room is 101 and the randomly"
      },
      {
        "start": 2180.079,
        "duration": 3.601,
        "text": "generated string which is the"
      },
      {
        "start": 2181.52,
        "duration": 4.24,
        "text": "confirmation number now the best thing"
      },
      {
        "start": 2183.68,
        "duration": 3.76,
        "text": "about this is that if i restart the"
      },
      {
        "start": 2185.76,
        "duration": 4.16,
        "text": "application and i don't send any more"
      },
      {
        "start": 2187.44,
        "duration": 6.399,
        "text": "messages to the hotel actor so in hotel"
      },
      {
        "start": 2189.92,
        "duration": 6.64,
        "text": "demo i cut out the make reservation"
      },
      {
        "start": 2193.839,
        "duration": 4.961,
        "text": "message or command the hotel because it"
      },
      {
        "start": 2196.56,
        "duration": 5.12,
        "text": "has the test hotel persistent actor it"
      },
      {
        "start": 2198.8,
        "duration": 5.039,
        "text": "will ask cassandra for all the events"
      },
      {
        "start": 2201.68,
        "duration": 4.32,
        "text": "that were associated to that persistence"
      },
      {
        "start": 2203.839,
        "duration": 4.881,
        "text": "id and therefore the state will still"
      },
      {
        "start": 2206.0,
        "duration": 5.44,
        "text": "change to the reservation that i added"
      },
      {
        "start": 2208.72,
        "duration": 5.28,
        "text": "in the previous run so the hotel upon"
      },
      {
        "start": 2211.44,
        "duration": 5.12,
        "text": "starting the application will restore"
      },
      {
        "start": 2214.0,
        "duration": 4.24,
        "text": "the entire state as if nothing had"
      },
      {
        "start": 2216.56,
        "duration": 3.279,
        "text": "happened so i'm going to cut the make"
      },
      {
        "start": 2218.24,
        "duration": 4.48,
        "text": "reservation thing and i'm going to run"
      },
      {
        "start": 2219.839,
        "duration": 4.321,
        "text": "the hotel demo again so this time no"
      },
      {
        "start": 2222.72,
        "duration": 4.639,
        "text": "further events will be persistent to"
      },
      {
        "start": 2224.16,
        "duration": 6.08,
        "text": "cassandra but notice that we also have"
      },
      {
        "start": 2227.359,
        "duration": 4.72,
        "text": "state changed from the hotel because the"
      },
      {
        "start": 2230.24,
        "duration": 3.839,
        "text": "hotel replayed all the events that are"
      },
      {
        "start": 2232.079,
        "duration": 4.081,
        "text": "already in cassandra associated to that"
      },
      {
        "start": 2234.079,
        "duration": 4.241,
        "text": "persistence id so if your application"
      },
      {
        "start": 2236.16,
        "duration": 4.4,
        "text": "crashes or if you need to upgrade it or"
      },
      {
        "start": 2238.32,
        "duration": 4.4,
        "text": "restart it for any reason all your"
      },
      {
        "start": 2240.56,
        "duration": 4.32,
        "text": "actors will restore their current state"
      },
      {
        "start": 2242.72,
        "duration": 4.0,
        "text": "so back to the hotel actor we now need"
      },
      {
        "start": 2244.88,
        "duration": 3.6,
        "text": "to handle the change reservation and"
      },
      {
        "start": 2246.72,
        "duration": 3.84,
        "text": "cancel reservation"
      },
      {
        "start": 2248.48,
        "duration": 3.359,
        "text": "commands now in this case we need to"
      },
      {
        "start": 2250.56,
        "duration": 3.44,
        "text": "find the old reservation by the"
      },
      {
        "start": 2251.839,
        "duration": 4.481,
        "text": "confirmation number and if we don't find"
      },
      {
        "start": 2254.0,
        "duration": 4.64,
        "text": "any reservations we need to reply with a"
      },
      {
        "start": 2256.32,
        "duration": 4.96,
        "text": "failure if we do then we need to create"
      },
      {
        "start": 2258.64,
        "duration": 4.08,
        "text": "a tentative reservation and still find a"
      },
      {
        "start": 2261.28,
        "duration": 3.76,
        "text": "potential conflict with a set of"
      },
      {
        "start": 2262.72,
        "duration": 4.0,
        "text": "reservations that we currently have if"
      },
      {
        "start": 2265.04,
        "duration": 3.36,
        "text": "there is such a conflict then we will"
      },
      {
        "start": 2266.72,
        "duration": 4.32,
        "text": "return a failure otherwise we will"
      },
      {
        "start": 2268.4,
        "duration": 4.8,
        "text": "persist a reservation changed event much"
      },
      {
        "start": 2271.04,
        "duration": 3.6,
        "text": "like we did earlier all right now let me"
      },
      {
        "start": 2273.2,
        "duration": 3.68,
        "text": "find the old reservation so i'm going to"
      },
      {
        "start": 2274.64,
        "duration": 3.92,
        "text": "have my old reservation and i'm going to"
      },
      {
        "start": 2276.88,
        "duration": 4.16,
        "text": "use an option here i'm going to say"
      },
      {
        "start": 2278.56,
        "duration": 3.76,
        "text": "state reservations find and i'm going to"
      },
      {
        "start": 2281.04,
        "duration": 2.799,
        "text": "find my confirmation number so"
      },
      {
        "start": 2282.32,
        "duration": 3.039,
        "text": "understand underscore confirmation"
      },
      {
        "start": 2283.839,
        "duration": 3.921,
        "text": "number must be equal to the confirmation"
      },
      {
        "start": 2285.359,
        "duration": 3.841,
        "text": "number that i want to change"
      },
      {
        "start": 2287.76,
        "duration": 3.44,
        "text": "then i will need to create a new"
      },
      {
        "start": 2289.2,
        "duration": 3.68,
        "text": "reservation so i'm going to have my"
      },
      {
        "start": 2291.2,
        "duration": 2.96,
        "text": "tentative new reservation so new"
      },
      {
        "start": 2292.88,
        "duration": 3.36,
        "text": "reservation"
      },
      {
        "start": 2294.16,
        "duration": 5.04,
        "text": "option as old reservation option that"
      },
      {
        "start": 2296.24,
        "duration": 4.879,
        "text": "i'm going to map and given the"
      },
      {
        "start": 2299.2,
        "duration": 4.879,
        "text": "reservation that this option will store"
      },
      {
        "start": 2301.119,
        "duration": 5.441,
        "text": "inside i'm going to say res copy and i'm"
      },
      {
        "start": 2304.079,
        "duration": 4.401,
        "text": "going to copy just the start dates end"
      },
      {
        "start": 2306.56,
        "duration": 5.12,
        "text": "dates and room number because everything"
      },
      {
        "start": 2308.48,
        "duration": 5.84,
        "text": "else is the same so start date start"
      },
      {
        "start": 2311.68,
        "duration": 3.679,
        "text": "date equals start date"
      },
      {
        "start": 2314.32,
        "duration": 2.16,
        "text": "and"
      },
      {
        "start": 2315.359,
        "duration": 2.961,
        "text": "end date"
      },
      {
        "start": 2316.48,
        "duration": 3.599,
        "text": "and the room number"
      },
      {
        "start": 2318.32,
        "duration": 3.519,
        "text": "all right so if there is such an old"
      },
      {
        "start": 2320.079,
        "duration": 5.52,
        "text": "reservation option the new reservation"
      },
      {
        "start": 2321.839,
        "duration": 5.441,
        "text": "option will also contain a value now we"
      },
      {
        "start": 2325.599,
        "duration": 3.281,
        "text": "are going to have a tentative"
      },
      {
        "start": 2327.28,
        "duration": 4.0,
        "text": "reservation updated event so i'm gonna"
      },
      {
        "start": 2328.88,
        "duration": 5.12,
        "text": "have let's call this reservation"
      },
      {
        "start": 2331.28,
        "duration": 4.4,
        "text": "updated event as"
      },
      {
        "start": 2334.0,
        "duration": 3.92,
        "text": "i'm going to suffix that with an option"
      },
      {
        "start": 2335.68,
        "duration": 3.919,
        "text": "as well and i'm going to have my old"
      },
      {
        "start": 2337.92,
        "duration": 4.72,
        "text": "reservation option and i'm going to zip"
      },
      {
        "start": 2339.599,
        "duration": 5.52,
        "text": "that with a new reservation option"
      },
      {
        "start": 2342.64,
        "duration": 4.959,
        "text": "and this will be an option containing a"
      },
      {
        "start": 2345.119,
        "duration": 5.521,
        "text": "tuple and because we have a reservation"
      },
      {
        "start": 2347.599,
        "duration": 4.961,
        "text": "updated event i need to store the old"
      },
      {
        "start": 2350.64,
        "duration": 4.56,
        "text": "reservation and the new reservation in"
      },
      {
        "start": 2352.56,
        "duration": 3.68,
        "text": "this data structure so i'm going to then"
      },
      {
        "start": 2355.2,
        "duration": 2.72,
        "text": "map that"
      },
      {
        "start": 2356.24,
        "duration": 2.96,
        "text": "and i'm going to say"
      },
      {
        "start": 2357.92,
        "duration": 3.6,
        "text": "reservation"
      },
      {
        "start": 2359.2,
        "duration": 4.8,
        "text": "updated i think and the constructor is"
      },
      {
        "start": 2361.52,
        "duration": 4.4,
        "text": "called tupold so this is going to be an"
      },
      {
        "start": 2364.0,
        "duration": 3.76,
        "text": "option of reservation updated this is"
      },
      {
        "start": 2365.92,
        "duration": 5.12,
        "text": "the event that i want to persist to"
      },
      {
        "start": 2367.76,
        "duration": 5.599,
        "text": "cassandra if these two options exist"
      },
      {
        "start": 2371.04,
        "duration": 4.319,
        "text": "now i need to find the conflicting"
      },
      {
        "start": 2373.359,
        "duration": 3.441,
        "text": "reservation if there is such a thing so"
      },
      {
        "start": 2375.359,
        "duration": 3.441,
        "text": "i'm going to have let's call this"
      },
      {
        "start": 2376.8,
        "duration": 3.52,
        "text": "conflicting"
      },
      {
        "start": 2378.8,
        "duration": 2.4,
        "text": "reservation"
      },
      {
        "start": 2380.32,
        "duration": 3.84,
        "text": "option"
      },
      {
        "start": 2381.2,
        "duration": 4.8,
        "text": "as new reservation option"
      },
      {
        "start": 2384.16,
        "duration": 3.919,
        "text": "which was computed before and i'm going"
      },
      {
        "start": 2386.0,
        "duration": 4.0,
        "text": "to run a function called flat map and"
      },
      {
        "start": 2388.079,
        "duration": 4.161,
        "text": "considering the tentative reservation"
      },
      {
        "start": 2390.0,
        "duration": 4.4,
        "text": "inside so tentative"
      },
      {
        "start": 2392.24,
        "duration": 4.16,
        "text": "reservation then i'm gonna run the same"
      },
      {
        "start": 2394.4,
        "duration": 2.88,
        "text": "logic as before so i'm going to have"
      },
      {
        "start": 2396.4,
        "duration": 5.12,
        "text": "state"
      },
      {
        "start": 2397.28,
        "duration": 5.04,
        "text": "reservations fined and i'm going to say"
      },
      {
        "start": 2401.52,
        "duration": 3.04,
        "text": "the"
      },
      {
        "start": 2402.32,
        "duration": 3.68,
        "text": "reservation contained in the state does"
      },
      {
        "start": 2404.56,
        "duration": 2.799,
        "text": "not have the same confirmation number"
      },
      {
        "start": 2406.0,
        "duration": 4.24,
        "text": "because otherwise obviously it will"
      },
      {
        "start": 2407.359,
        "duration": 5.841,
        "text": "conflict so our confirmation number must"
      },
      {
        "start": 2410.24,
        "duration": 4.4,
        "text": "not be equal to confirmation number"
      },
      {
        "start": 2413.2,
        "duration": 4.08,
        "text": "and the intersection so i'm going to"
      },
      {
        "start": 2414.64,
        "duration": 4.4,
        "text": "have r intersect with this tentative"
      },
      {
        "start": 2417.28,
        "duration": 3.36,
        "text": "reservation"
      },
      {
        "start": 2419.04,
        "duration": 3.52,
        "text": "so we have a bunch of options here we"
      },
      {
        "start": 2420.64,
        "duration": 3.679,
        "text": "need to treat them so i'm going to run a"
      },
      {
        "start": 2422.56,
        "duration": 4.16,
        "text": "tuple so i'm going to have reservation"
      },
      {
        "start": 2424.319,
        "duration": 3.76,
        "text": "updated event option and the conflicting"
      },
      {
        "start": 2426.72,
        "duration": 4.48,
        "text": "reservation option and i'm going to"
      },
      {
        "start": 2428.079,
        "duration": 6.081,
        "text": "pattern match against these two"
      },
      {
        "start": 2431.2,
        "duration": 4.639,
        "text": "now in case we get a nun and whatever it"
      },
      {
        "start": 2434.16,
        "duration": 3.36,
        "text": "means that there is no reservation"
      },
      {
        "start": 2435.839,
        "duration": 3.361,
        "text": "updated event option because the old"
      },
      {
        "start": 2437.52,
        "duration": 4.0,
        "text": "reservation could not be found this"
      },
      {
        "start": 2439.2,
        "duration": 4.639,
        "text": "whole option depends on me finding the"
      },
      {
        "start": 2441.52,
        "duration": 5.04,
        "text": "old reservation number by confirmation"
      },
      {
        "start": 2443.839,
        "duration": 4.081,
        "text": "so i'm going to return some sort of"
      },
      {
        "start": 2446.56,
        "duration": 4.08,
        "text": "confirmation failure so i'm going to"
      },
      {
        "start": 2447.92,
        "duration": 5.36,
        "text": "have effect dot reply and i'm going to"
      },
      {
        "start": 2450.64,
        "duration": 5.199,
        "text": "reply to the reply to actor that this"
      },
      {
        "start": 2453.28,
        "duration": 4.559,
        "text": "change reservation command contains and"
      },
      {
        "start": 2455.839,
        "duration": 4.161,
        "text": "i'm going to return a command failure"
      },
      {
        "start": 2457.839,
        "duration": 4.24,
        "text": "i'm going to say cannot update"
      },
      {
        "start": 2460.0,
        "duration": 4.56,
        "text": "reservation"
      },
      {
        "start": 2462.079,
        "duration": 6.321,
        "text": "and i'm going to use confirmation number"
      },
      {
        "start": 2464.56,
        "duration": 6.48,
        "text": "and i'm going to use not found"
      },
      {
        "start": 2468.4,
        "duration": 4.64,
        "text": "now in case we get"
      },
      {
        "start": 2471.04,
        "duration": 3.76,
        "text": "something and some"
      },
      {
        "start": 2473.04,
        "duration": 3.12,
        "text": "value here in conflicting reservation"
      },
      {
        "start": 2474.8,
        "duration": 2.96,
        "text": "option again this is going to be a"
      },
      {
        "start": 2476.16,
        "duration": 3.36,
        "text": "command failure because there's already"
      },
      {
        "start": 2477.76,
        "duration": 4.24,
        "text": "a conflicting reservation for what i"
      },
      {
        "start": 2479.52,
        "duration": 4.48,
        "text": "will want to do so i'm going to return"
      },
      {
        "start": 2482.0,
        "duration": 3.599,
        "text": "another command failure i'm going to say"
      },
      {
        "start": 2484.0,
        "duration": 5.2,
        "text": "cannot update reservation confirmation"
      },
      {
        "start": 2485.599,
        "duration": 3.601,
        "text": "number conflicting reservations"
      },
      {
        "start": 2490.64,
        "duration": 5.28,
        "text": "cool and in case we get a sum with the"
      },
      {
        "start": 2494.16,
        "duration": 4.4,
        "text": "res updated"
      },
      {
        "start": 2495.92,
        "duration": 4.32,
        "text": "this is the event and none that means"
      },
      {
        "start": 2498.56,
        "duration": 3.92,
        "text": "the happy path"
      },
      {
        "start": 2500.24,
        "duration": 4.079,
        "text": "so this is"
      },
      {
        "start": 2502.48,
        "duration": 3.52,
        "text": "the happy path"
      },
      {
        "start": 2504.319,
        "duration": 4.0,
        "text": "in which case i found the old"
      },
      {
        "start": 2506.0,
        "duration": 4.8,
        "text": "reservation option and i did not find"
      },
      {
        "start": 2508.319,
        "duration": 5.441,
        "text": "the conflicting reservation then it"
      },
      {
        "start": 2510.8,
        "duration": 4.72,
        "text": "means i'm going to persist my"
      },
      {
        "start": 2513.76,
        "duration": 3.68,
        "text": "event so i'm going to have effect dot"
      },
      {
        "start": 2515.52,
        "duration": 4.079,
        "text": "persist and i'm going to persist this"
      },
      {
        "start": 2517.44,
        "duration": 4.24,
        "text": "res updated thing so res updated because"
      },
      {
        "start": 2519.599,
        "duration": 4.641,
        "text": "i've computed that beforehand and i'm"
      },
      {
        "start": 2521.68,
        "duration": 5.76,
        "text": "going to say then reply with the reply"
      },
      {
        "start": 2524.24,
        "duration": 4.72,
        "text": "to actor and i'm going to return s arrow"
      },
      {
        "start": 2527.44,
        "duration": 3.919,
        "text": "and i'm going to use this res updated"
      },
      {
        "start": 2528.96,
        "duration": 4.48,
        "text": "event as before and now i can safely"
      },
      {
        "start": 2531.359,
        "duration": 3.841,
        "text": "remove the effect none thing because"
      },
      {
        "start": 2533.44,
        "duration": 4.56,
        "text": "i've already implemented my to-do so i'm"
      },
      {
        "start": 2535.2,
        "duration": 5.36,
        "text": "going to keep the logic here by the"
      },
      {
        "start": 2538.0,
        "duration": 5.359,
        "text": "change reservation"
      },
      {
        "start": 2540.56,
        "duration": 4.4,
        "text": "case all right so we have our effect now"
      },
      {
        "start": 2543.359,
        "duration": 3.201,
        "text": "let's try this out i'm going to go back"
      },
      {
        "start": 2544.96,
        "duration": 3.68,
        "text": "to the hotel demo we already have a"
      },
      {
        "start": 2546.56,
        "duration": 4.0,
        "text": "reservation in the database i will want"
      },
      {
        "start": 2548.64,
        "duration": 4.4,
        "text": "to try to change a reservation so i'm"
      },
      {
        "start": 2550.56,
        "duration": 4.88,
        "text": "going to say let's call this"
      },
      {
        "start": 2553.04,
        "duration": 3.44,
        "text": "change reservation with"
      },
      {
        "start": 2555.44,
        "duration": 3.04,
        "text": "the"
      },
      {
        "start": 2556.48,
        "duration": 4.08,
        "text": "confirmation number start date end date"
      },
      {
        "start": 2558.48,
        "duration": 3.76,
        "text": "room number and reply to i'll need to"
      },
      {
        "start": 2560.56,
        "duration": 3.519,
        "text": "fetch the confirmation number from the"
      },
      {
        "start": 2562.24,
        "duration": 3.839,
        "text": "logs which is this thing because it was"
      },
      {
        "start": 2564.079,
        "duration": 4.24,
        "text": "randomly generated before"
      },
      {
        "start": 2566.079,
        "duration": 3.681,
        "text": "so i'm going to copy that and the change"
      },
      {
        "start": 2568.319,
        "duration": 3.76,
        "text": "reservation will have the confirmation"
      },
      {
        "start": 2569.76,
        "duration": 4.16,
        "text": "number and i will want to change my"
      },
      {
        "start": 2572.079,
        "duration": 3.921,
        "text": "reservation let's say i want to prolong"
      },
      {
        "start": 2573.92,
        "duration": 4.0,
        "text": "my stay for another seven days so i'm"
      },
      {
        "start": 2576.0,
        "duration": 4.16,
        "text": "going to change my reservation to"
      },
      {
        "start": 2577.92,
        "duration": 4.64,
        "text": "2022-0728"
      },
      {
        "start": 2580.16,
        "duration": 4.8,
        "text": "and i'm going to maintain the same room"
      },
      {
        "start": 2582.56,
        "duration": 6.039,
        "text": "number okay let's try this out and let's"
      },
      {
        "start": 2584.96,
        "duration": 3.639,
        "text": "see if it works"
      },
      {
        "start": 2592.0,
        "duration": 5.28,
        "text": "all right so we have our logger so we"
      },
      {
        "start": 2595.04,
        "duration": 4.559,
        "text": "have a reservation updated with a old"
      },
      {
        "start": 2597.28,
        "duration": 4.24,
        "text": "reservation and the new reservation"
      },
      {
        "start": 2599.599,
        "duration": 4.24,
        "text": "which will be found in cassandra so if"
      },
      {
        "start": 2601.52,
        "duration": 4.16,
        "text": "we navigate back to cassandra and we"
      },
      {
        "start": 2603.839,
        "duration": 4.161,
        "text": "select star from aqua messages notice"
      },
      {
        "start": 2605.68,
        "duration": 3.84,
        "text": "that we now have two events stored in"
      },
      {
        "start": 2608.0,
        "duration": 3.2,
        "text": "cassandra this is the reservation"
      },
      {
        "start": 2609.52,
        "duration": 4.0,
        "text": "created and this was the reservation"
      },
      {
        "start": 2611.2,
        "duration": 4.72,
        "text": "updated this is great"
      },
      {
        "start": 2613.52,
        "duration": 4.799,
        "text": "now let's go back to the hotel and let"
      },
      {
        "start": 2615.92,
        "duration": 5.04,
        "text": "me also treat the case for the"
      },
      {
        "start": 2618.319,
        "duration": 4.561,
        "text": "reservation updated event in my event"
      },
      {
        "start": 2620.96,
        "duration": 3.44,
        "text": "handler because i didn't add that so i'm"
      },
      {
        "start": 2622.88,
        "duration": 2.4,
        "text": "going to have a case"
      },
      {
        "start": 2624.4,
        "duration": 2.8,
        "text": "for"
      },
      {
        "start": 2625.28,
        "duration": 3.6,
        "text": "reservation updated"
      },
      {
        "start": 2627.2,
        "duration": 3.2,
        "text": "from the old reservation to the new"
      },
      {
        "start": 2628.88,
        "duration": 3.6,
        "text": "reservation again i'm going to print"
      },
      {
        "start": 2630.4,
        "duration": 3.76,
        "text": "line state changed and i'm going to"
      },
      {
        "start": 2632.48,
        "duration": 5.52,
        "text": "create my new state so i'm going to have"
      },
      {
        "start": 2634.16,
        "duration": 6.0,
        "text": "new state as state copy and reservations"
      },
      {
        "start": 2638.0,
        "duration": 4.4,
        "text": "is going to be state reservations minus"
      },
      {
        "start": 2640.16,
        "duration": 4.8,
        "text": "the old reservation plus the new"
      },
      {
        "start": 2642.4,
        "duration": 4.24,
        "text": "reservation because i implemented the"
      },
      {
        "start": 2644.96,
        "duration": 3.68,
        "text": "equals and hash code methods on"
      },
      {
        "start": 2646.64,
        "duration": 4.56,
        "text": "reservation beforehand adding and"
      },
      {
        "start": 2648.64,
        "duration": 4.479,
        "text": "removing items from a set is very easy"
      },
      {
        "start": 2651.2,
        "duration": 3.28,
        "text": "and i'm going to return the new state as"
      },
      {
        "start": 2653.119,
        "duration": 3.281,
        "text": "well"
      },
      {
        "start": 2654.48,
        "duration": 3.599,
        "text": "good let me go back to the application"
      },
      {
        "start": 2656.4,
        "duration": 3.52,
        "text": "let me comment out the message that i"
      },
      {
        "start": 2658.079,
        "duration": 4.641,
        "text": "sent because these events are already in"
      },
      {
        "start": 2659.92,
        "duration": 6.159,
        "text": "cassandra and i should now see two state"
      },
      {
        "start": 2662.72,
        "duration": 3.359,
        "text": "changes in my hotel actor"
      },
      {
        "start": 2667.28,
        "duration": 3.92,
        "text": "right so we have stay changed so the"
      },
      {
        "start": 2669.28,
        "duration": 4.72,
        "text": "first one is the reservation between"
      },
      {
        "start": 2671.2,
        "duration": 5.76,
        "text": "14th of july and 21st then we have a"
      },
      {
        "start": 2674.0,
        "duration": 4.48,
        "text": "state changed from the 14th to the 28th"
      },
      {
        "start": 2676.96,
        "duration": 3.28,
        "text": "and this is great because it maintains"
      },
      {
        "start": 2678.48,
        "duration": 3.839,
        "text": "the same confirmation number notice that"
      },
      {
        "start": 2680.24,
        "duration": 4.48,
        "text": "the actor replays all the events to"
      },
      {
        "start": 2682.319,
        "duration": 3.681,
        "text": "restore its old state now the cancelled"
      },
      {
        "start": 2684.72,
        "duration": 2.72,
        "text": "logic is very similar so i'm going to"
      },
      {
        "start": 2686.0,
        "duration": 4.24,
        "text": "speed things up a bit i'm going to"
      },
      {
        "start": 2687.44,
        "duration": 4.96,
        "text": "simply find the old confirmation by"
      },
      {
        "start": 2690.24,
        "duration": 3.44,
        "text": "number in my state if i can find it i'm"
      },
      {
        "start": 2692.4,
        "duration": 2.719,
        "text": "going to persist the event the"
      },
      {
        "start": 2693.68,
        "duration": 4.0,
        "text": "cancellation event that i'm going to"
      },
      {
        "start": 2695.119,
        "duration": 4.72,
        "text": "reply with the right response otherwise"
      },
      {
        "start": 2697.68,
        "duration": 3.439,
        "text": "i'm going to return a failure and in my"
      },
      {
        "start": 2699.839,
        "duration": 2.801,
        "text": "event handler i'm going to treat the"
      },
      {
        "start": 2701.119,
        "duration": 4.401,
        "text": "cancellation event and i'm going to"
      },
      {
        "start": 2702.64,
        "duration": 5.52,
        "text": "update my state now let's test it out so"
      },
      {
        "start": 2705.52,
        "duration": 4.64,
        "text": "here under the hotel demo application"
      },
      {
        "start": 2708.16,
        "duration": 4.24,
        "text": "i'm going to also send a cancel"
      },
      {
        "start": 2710.16,
        "duration": 4.32,
        "text": "reservation for the same reservation"
      },
      {
        "start": 2712.4,
        "duration": 3.919,
        "text": "confirmation number we don't really need"
      },
      {
        "start": 2714.48,
        "duration": 4.4,
        "text": "to send the make reservation and change"
      },
      {
        "start": 2716.319,
        "duration": 5.121,
        "text": "reservation messages again because the"
      },
      {
        "start": 2718.88,
        "duration": 4.8,
        "text": "hotel actor will recreate the state so"
      },
      {
        "start": 2721.44,
        "duration": 3.6,
        "text": "i'm going to say hotel i'm going to say"
      },
      {
        "start": 2723.68,
        "duration": 3.28,
        "text": "instead of change reservation i'm going"
      },
      {
        "start": 2725.04,
        "duration": 4.079,
        "text": "to say cancel reservation so cancel"
      },
      {
        "start": 2726.96,
        "duration": 4.48,
        "text": "reservation and i'm only going to pass"
      },
      {
        "start": 2729.119,
        "duration": 4.161,
        "text": "the reservation confirmation number and"
      },
      {
        "start": 2731.44,
        "duration": 3.6,
        "text": "the logger actor which the actor will"
      },
      {
        "start": 2733.28,
        "duration": 3.6,
        "text": "use to reply back"
      },
      {
        "start": 2735.04,
        "duration": 4.0,
        "text": "so in this case we will have another"
      },
      {
        "start": 2736.88,
        "duration": 5.12,
        "text": "event persisted to cassandra so these"
      },
      {
        "start": 2739.04,
        "duration": 4.799,
        "text": "events will be additive but the state of"
      },
      {
        "start": 2742.0,
        "duration": 5.839,
        "text": "the actor will be reconstructed after"
      },
      {
        "start": 2743.839,
        "duration": 4.0,
        "text": "them so let me run the application again"
      },
      {
        "start": 2748.96,
        "duration": 4.08,
        "text": "and we should see"
      },
      {
        "start": 2750.96,
        "duration": 4.399,
        "text": "three state changes two of them for"
      },
      {
        "start": 2753.04,
        "duration": 4.559,
        "text": "recovery from cassandra and notice that"
      },
      {
        "start": 2755.359,
        "duration": 4.24,
        "text": "the third one is a state with a set of"
      },
      {
        "start": 2757.599,
        "duration": 3.441,
        "text": "empty reservations which means that our"
      },
      {
        "start": 2759.599,
        "duration": 3.681,
        "text": "reservation was cancelled and if we"
      },
      {
        "start": 2761.04,
        "duration": 4.24,
        "text": "navigate back to cassandra we should see"
      },
      {
        "start": 2763.28,
        "duration": 4.24,
        "text": "three events instead of two so notice"
      },
      {
        "start": 2765.28,
        "duration": 4.72,
        "text": "that we now have three entries in the"
      },
      {
        "start": 2767.52,
        "duration": 4.559,
        "text": "database one for making reservation one"
      },
      {
        "start": 2770.0,
        "duration": 4.24,
        "text": "for amending the reservation and one for"
      },
      {
        "start": 2772.079,
        "duration": 4.321,
        "text": "cancelling it of course if i comment"
      },
      {
        "start": 2774.24,
        "duration": 4.48,
        "text": "this code as well and if i rerun the"
      },
      {
        "start": 2776.4,
        "duration": 5.439,
        "text": "application the state of the actor will"
      },
      {
        "start": 2778.72,
        "duration": 5.44,
        "text": "be restored to an empty state so a state"
      },
      {
        "start": 2781.839,
        "duration": 4.48,
        "text": "with no reservations after replaying all"
      },
      {
        "start": 2784.16,
        "duration": 4.159,
        "text": "the reservation events in the database"
      },
      {
        "start": 2786.319,
        "duration": 4.161,
        "text": "so our hotel actor should work correctly"
      },
      {
        "start": 2788.319,
        "duration": 4.0,
        "text": "as of this moment"
      },
      {
        "start": 2790.48,
        "duration": 4.24,
        "text": "now for the real application we're going"
      },
      {
        "start": 2792.319,
        "duration": 5.121,
        "text": "to spin up many many of these hotel"
      },
      {
        "start": 2794.72,
        "duration": 4.72,
        "text": "actors and we're going to randomly set"
      },
      {
        "start": 2797.44,
        "duration": 4.32,
        "text": "the make reservation change reservation"
      },
      {
        "start": 2799.44,
        "duration": 4.56,
        "text": "and cancel reservation commands to them"
      },
      {
        "start": 2801.76,
        "duration": 3.839,
        "text": "as simulated by some external api so"
      },
      {
        "start": 2804.0,
        "duration": 3.2,
        "text": "here under actor i'm going to create a"
      },
      {
        "start": 2805.599,
        "duration": 3.281,
        "text": "new skull clasp i'm going to call this"
      },
      {
        "start": 2807.2,
        "duration": 3.6,
        "text": "reservation"
      },
      {
        "start": 2808.88,
        "duration": 5.199,
        "text": "agent or something like that and this"
      },
      {
        "start": 2810.8,
        "duration": 6.48,
        "text": "agent will be a object"
      },
      {
        "start": 2814.079,
        "duration": 6.081,
        "text": "that will generate an influx of these"
      },
      {
        "start": 2817.28,
        "duration": 4.799,
        "text": "events from some sort of external api so"
      },
      {
        "start": 2820.16,
        "duration": 4.08,
        "text": "this will simulate"
      },
      {
        "start": 2822.079,
        "duration": 5.681,
        "text": "a large influx"
      },
      {
        "start": 2824.24,
        "duration": 5.92,
        "text": "of commands to hotel actors"
      },
      {
        "start": 2827.76,
        "duration": 4.64,
        "text": "and i'm going to leave it as a to do for"
      },
      {
        "start": 2830.16,
        "duration": 4.32,
        "text": "now because for now i'm going to"
      },
      {
        "start": 2832.4,
        "duration": 3.76,
        "text": "focus on a single hotel and then we're"
      },
      {
        "start": 2834.48,
        "duration": 4.32,
        "text": "going to enhance the scale of this"
      },
      {
        "start": 2836.16,
        "duration": 4.48,
        "text": "application so back to the hotel now the"
      },
      {
        "start": 2838.8,
        "duration": 3.84,
        "text": "hotel currently implements the right"
      },
      {
        "start": 2840.64,
        "duration": 4.0,
        "text": "side of the application the read side"
      },
      {
        "start": 2842.64,
        "duration": 4.4,
        "text": "has not been implemented yet so from the"
      },
      {
        "start": 2844.64,
        "duration": 4.56,
        "text": "command query responsibility segregation"
      },
      {
        "start": 2847.04,
        "duration": 3.76,
        "text": "we've only implemented the command part"
      },
      {
        "start": 2849.2,
        "duration": 4.24,
        "text": "which is implemented through event"
      },
      {
        "start": 2850.8,
        "duration": 5.279,
        "text": "sourcing we are also going to implement"
      },
      {
        "start": 2853.44,
        "duration": 4.32,
        "text": "the read side of this application by"
      },
      {
        "start": 2856.079,
        "duration": 3.841,
        "text": "creating another"
      },
      {
        "start": 2857.76,
        "duration": 3.92,
        "text": "application here so here under apps i'm"
      },
      {
        "start": 2859.92,
        "duration": 4.56,
        "text": "going to create a new scholar class i'm"
      },
      {
        "start": 2861.68,
        "duration": 4.56,
        "text": "going to call this persistence query"
      },
      {
        "start": 2864.48,
        "duration": 3.599,
        "text": "demo and i'm going to make it an object"
      },
      {
        "start": 2866.24,
        "duration": 3.76,
        "text": "because this is going to be a standalone"
      },
      {
        "start": 2868.079,
        "duration": 4.561,
        "text": "application that will simulate one of"
      },
      {
        "start": 2870.0,
        "duration": 4.8,
        "text": "those hotel apps that will monitor all"
      },
      {
        "start": 2872.64,
        "duration": 3.199,
        "text": "the events associated to a particular"
      },
      {
        "start": 2874.8,
        "duration": 2.64,
        "text": "hotel"
      },
      {
        "start": 2875.839,
        "duration": 3.601,
        "text": "now that i think about it instead of"
      },
      {
        "start": 2877.44,
        "duration": 5.2,
        "text": "persistence query demo i'm going to call"
      },
      {
        "start": 2879.44,
        "duration": 5.84,
        "text": "this hotel event reader"
      },
      {
        "start": 2882.64,
        "duration": 4.76,
        "text": "or something like that to denote the r"
      },
      {
        "start": 2885.28,
        "duration": 5.2,
        "text": "part from"
      },
      {
        "start": 2887.4,
        "duration": 4.679,
        "text": "cqrs so this is going to be a standalone"
      },
      {
        "start": 2890.48,
        "duration": 4.16,
        "text": "application which will monitor all the"
      },
      {
        "start": 2892.079,
        "duration": 4.721,
        "text": "events associated to a particular hotel"
      },
      {
        "start": 2894.64,
        "duration": 5.199,
        "text": "obviously independently from the right"
      },
      {
        "start": 2896.8,
        "duration": 5.12,
        "text": "side of the application so in order to"
      },
      {
        "start": 2899.839,
        "duration": 4.161,
        "text": "implement the read part from cqrs we're"
      },
      {
        "start": 2901.92,
        "duration": 4.72,
        "text": "going to use an aqua persistence feature"
      },
      {
        "start": 2904.0,
        "duration": 4.559,
        "text": "called akka persistence query this is"
      },
      {
        "start": 2906.64,
        "duration": 4.0,
        "text": "why i originally named this persistence"
      },
      {
        "start": 2908.559,
        "duration": 5.76,
        "text": "query demo but it's actually better"
      },
      {
        "start": 2910.64,
        "duration": 5.679,
        "text": "named by its purpose so i'm going to use"
      },
      {
        "start": 2914.319,
        "duration": 3.76,
        "text": "aqua persistence query to monitor all"
      },
      {
        "start": 2916.319,
        "duration": 4.881,
        "text": "the events associated to a particular"
      },
      {
        "start": 2918.079,
        "duration": 5.361,
        "text": "persistence id which is how a hotel is"
      },
      {
        "start": 2921.2,
        "duration": 3.6,
        "text": "uniquely identified so i'm going to"
      },
      {
        "start": 2923.44,
        "duration": 5.28,
        "text": "create an actor system so i'm going to"
      },
      {
        "start": 2924.8,
        "duration": 5.519,
        "text": "say system as actor system"
      },
      {
        "start": 2928.72,
        "duration": 4.56,
        "text": "that i'm going to import and i'm going"
      },
      {
        "start": 2930.319,
        "duration": 5.04,
        "text": "to use behaviors empty"
      },
      {
        "start": 2933.28,
        "duration": 4.48,
        "text": "i don't really need this actor system to"
      },
      {
        "start": 2935.359,
        "duration": 3.841,
        "text": "contain any sort of actors so i'm going"
      },
      {
        "start": 2937.76,
        "duration": 4.64,
        "text": "to leave it at that and i'm going to"
      },
      {
        "start": 2939.2,
        "duration": 4.56,
        "text": "call this hotel event reader"
      },
      {
        "start": 2942.4,
        "duration": 4.32,
        "text": "system"
      },
      {
        "start": 2943.76,
        "duration": 5.68,
        "text": "cool now this system will create what is"
      },
      {
        "start": 2946.72,
        "duration": 5.2,
        "text": "called a read journal a read journal is"
      },
      {
        "start": 2949.44,
        "duration": 4.32,
        "text": "one of those little utilities that will"
      },
      {
        "start": 2951.92,
        "duration": 3.679,
        "text": "monitor all the events in the persistent"
      },
      {
        "start": 2953.76,
        "duration": 3.52,
        "text": "store in this case cassandra obviously"
      },
      {
        "start": 2955.599,
        "duration": 4.321,
        "text": "associated to a particular persistence"
      },
      {
        "start": 2957.28,
        "duration": 6.559,
        "text": "id so i'm going to create a read journal"
      },
      {
        "start": 2959.92,
        "duration": 6.08,
        "text": "as i'm going to use persistence query"
      },
      {
        "start": 2963.839,
        "duration": 4.401,
        "text": "and i'm going to import that"
      },
      {
        "start": 2966.0,
        "duration": 4.88,
        "text": "from the system"
      },
      {
        "start": 2968.24,
        "duration": 4.72,
        "text": "so the persistence query is indeed based"
      },
      {
        "start": 2970.88,
        "duration": 3.36,
        "text": "on actors and i'm going to say read"
      },
      {
        "start": 2972.96,
        "duration": 3.28,
        "text": "journal 4"
      },
      {
        "start": 2974.24,
        "duration": 5.92,
        "text": "i'm going to add a type argument and"
      },
      {
        "start": 2976.24,
        "duration": 6.0,
        "text": "this is called cassandra read journal"
      },
      {
        "start": 2980.16,
        "duration": 4.32,
        "text": "and i'm going to import that make sure"
      },
      {
        "start": 2982.24,
        "duration": 3.92,
        "text": "you import from the scala dsl because"
      },
      {
        "start": 2984.48,
        "duration": 4.0,
        "text": "we're writing skal of course"
      },
      {
        "start": 2986.16,
        "duration": 4.159,
        "text": "and the argument of that is going to be"
      },
      {
        "start": 2988.48,
        "duration": 3.68,
        "text": "cassandra read journal"
      },
      {
        "start": 2990.319,
        "duration": 3.361,
        "text": "dot identifier"
      },
      {
        "start": 2992.16,
        "duration": 3.28,
        "text": "so every journal will have a unique"
      },
      {
        "start": 2993.68,
        "duration": 3.84,
        "text": "identifier by which persistence query"
      },
      {
        "start": 2995.44,
        "duration": 3.6,
        "text": "will identify it because in a real"
      },
      {
        "start": 2997.52,
        "duration": 4.64,
        "text": "application we can have persistence"
      },
      {
        "start": 2999.04,
        "duration": 5.2,
        "text": "query with a variety of stores so i'm"
      },
      {
        "start": 3002.16,
        "duration": 4.959,
        "text": "going to use this cassandra read journal"
      },
      {
        "start": 3004.24,
        "duration": 4.48,
        "text": "now with this read journal we can fetch"
      },
      {
        "start": 3007.119,
        "duration": 4.161,
        "text": "all the persistence ids and all the"
      },
      {
        "start": 3008.72,
        "duration": 5.839,
        "text": "events by that persistence id which is"
      },
      {
        "start": 3011.28,
        "duration": 5.6,
        "text": "how a hotel is identified or by tags let"
      },
      {
        "start": 3014.559,
        "duration": 4.56,
        "text": "me show them in turn so"
      },
      {
        "start": 3016.88,
        "duration": 4.08,
        "text": "all persistence ids"
      },
      {
        "start": 3019.119,
        "duration": 4.641,
        "text": "if you want to monitor a specific one"
      },
      {
        "start": 3020.96,
        "duration": 6.8,
        "text": "i'm going to say persistence ids"
      },
      {
        "start": 3023.76,
        "duration": 5.92,
        "text": "as read journal dot persistence ids"
      },
      {
        "start": 3027.76,
        "duration": 4.0,
        "text": "now because persistence ideas can come"
      },
      {
        "start": 3029.68,
        "duration": 4.0,
        "text": "and go because you add new actors in"
      },
      {
        "start": 3031.76,
        "duration": 4.24,
        "text": "your database this persistence ids"
      },
      {
        "start": 3033.68,
        "duration": 4.72,
        "text": "updates over time which is why this is"
      },
      {
        "start": 3036.0,
        "duration": 4.559,
        "text": "called a source"
      },
      {
        "start": 3038.4,
        "duration": 4.719,
        "text": "of string and not used i'm going to"
      },
      {
        "start": 3040.559,
        "duration": 5.121,
        "text": "explain what the source is uh come from"
      },
      {
        "start": 3043.119,
        "duration": 4.801,
        "text": "aqua stream scale dsl"
      },
      {
        "start": 3045.68,
        "duration": 4.08,
        "text": "this is an aqua streams thing"
      },
      {
        "start": 3047.92,
        "duration": 3.52,
        "text": "and aqua streams is a powerful library"
      },
      {
        "start": 3049.76,
        "duration": 4.319,
        "text": "that will allow you to deal with an"
      },
      {
        "start": 3051.44,
        "duration": 5.2,
        "text": "infinite amount of data from a variety"
      },
      {
        "start": 3054.079,
        "duration": 4.961,
        "text": "of sources which is why this persistence"
      },
      {
        "start": 3056.64,
        "duration": 4.16,
        "text": "id is an aqua stream's source now in"
      },
      {
        "start": 3059.04,
        "duration": 3.68,
        "text": "order to consume the source you need to"
      },
      {
        "start": 3060.8,
        "duration": 4.72,
        "text": "connect it to some sort of sync so i'm"
      },
      {
        "start": 3062.72,
        "duration": 3.839,
        "text": "going to say consumption"
      },
      {
        "start": 3065.52,
        "duration": 2.079,
        "text": "sync"
      },
      {
        "start": 3066.559,
        "duration": 1.841,
        "text": "as"
      },
      {
        "start": 3067.599,
        "duration": 3.76,
        "text": "sync"
      },
      {
        "start": 3068.4,
        "duration": 5.52,
        "text": "from arca stream scala dsl"
      },
      {
        "start": 3071.359,
        "duration": 5.601,
        "text": "sync for each print line"
      },
      {
        "start": 3073.92,
        "duration": 5.199,
        "text": "so these are for now static components"
      },
      {
        "start": 3076.96,
        "duration": 4.72,
        "text": "and if you want to trigger an active"
      },
      {
        "start": 3079.119,
        "duration": 5.121,
        "text": "stream you will have to connect them so"
      },
      {
        "start": 3081.68,
        "duration": 4.32,
        "text": "i'm going to say connected"
      },
      {
        "start": 3084.24,
        "duration": 3.359,
        "text": "let's call this graph because if you"
      },
      {
        "start": 3086.0,
        "duration": 3.64,
        "text": "connect a source with a sync you'll get"
      },
      {
        "start": 3087.599,
        "duration": 4.96,
        "text": "a graph i'm going to say"
      },
      {
        "start": 3089.64,
        "duration": 4.919,
        "text": "persistenceids.2 consumption sync"
      },
      {
        "start": 3092.559,
        "duration": 3.52,
        "text": "and if you want to trigger the connected"
      },
      {
        "start": 3094.559,
        "duration": 3.04,
        "text": "graph because right now it's static and"
      },
      {
        "start": 3096.079,
        "duration": 3.601,
        "text": "materialize all the appropriate"
      },
      {
        "start": 3097.599,
        "duration": 5.361,
        "text": "resources sockets and so on and so forth"
      },
      {
        "start": 3099.68,
        "duration": 5.04,
        "text": "you would say connectedgraph.run"
      },
      {
        "start": 3102.96,
        "duration": 4.159,
        "text": "now this run method requires an implicit"
      },
      {
        "start": 3104.72,
        "duration": 4.879,
        "text": "so-called materializer which has the"
      },
      {
        "start": 3107.119,
        "duration": 3.921,
        "text": "appropriate resources to allocate for"
      },
      {
        "start": 3109.599,
        "duration": 3.681,
        "text": "the stream components which is why i'm"
      },
      {
        "start": 3111.04,
        "duration": 4.559,
        "text": "going to mark this system this actor"
      },
      {
        "start": 3113.28,
        "duration": 3.6,
        "text": "system as implicit"
      },
      {
        "start": 3115.599,
        "duration": 4.48,
        "text": "this also contains an actual"
      },
      {
        "start": 3116.88,
        "duration": 5.04,
        "text": "materializer this is an actor system of"
      },
      {
        "start": 3120.079,
        "duration": 3.921,
        "text": "whatever"
      },
      {
        "start": 3121.92,
        "duration": 3.76,
        "text": "cool now i'm going to type in a main"
      },
      {
        "start": 3124.0,
        "duration": 4.319,
        "text": "method and i'm going to call this"
      },
      {
        "start": 3125.68,
        "duration": 4.399,
        "text": "connectedgraph.run in this application's"
      },
      {
        "start": 3128.319,
        "duration": 3.841,
        "text": "main method now if you call"
      },
      {
        "start": 3130.079,
        "duration": 5.04,
        "text": "connectgraph.run you'll print all"
      },
      {
        "start": 3132.16,
        "duration": 5.04,
        "text": "persistence ids as they come in my hotel"
      },
      {
        "start": 3135.119,
        "duration": 4.0,
        "text": "application so if i spawn another hotel"
      },
      {
        "start": 3137.2,
        "duration": 4.56,
        "text": "with another persistence id it will pop"
      },
      {
        "start": 3139.119,
        "duration": 4.881,
        "text": "up in this little application for now we"
      },
      {
        "start": 3141.76,
        "duration": 4.88,
        "text": "only have a single persistence id which"
      },
      {
        "start": 3144.0,
        "duration": 5.359,
        "text": "is that of the only hotel that we have"
      },
      {
        "start": 3146.64,
        "duration": 4.479,
        "text": "which is called test hotel now in this"
      },
      {
        "start": 3149.359,
        "duration": 3.76,
        "text": "case let me go back to the application"
      },
      {
        "start": 3151.119,
        "duration": 4.72,
        "text": "we will see a single row being printed"
      },
      {
        "start": 3153.119,
        "duration": 2.72,
        "text": "to the console"
      },
      {
        "start": 3156.4,
        "duration": 3.04,
        "text": "so right now this spins up the"
      },
      {
        "start": 3157.599,
        "duration": 3.52,
        "text": "appropriate resources and notice that we"
      },
      {
        "start": 3159.44,
        "duration": 3.2,
        "text": "have test hotel being printed notice"
      },
      {
        "start": 3161.119,
        "duration": 3.361,
        "text": "that the application is currently"
      },
      {
        "start": 3162.64,
        "duration": 2.88,
        "text": "running so if by any chance there's"
      },
      {
        "start": 3164.48,
        "duration": 3.52,
        "text": "another actor with a different"
      },
      {
        "start": 3165.52,
        "duration": 4.559,
        "text": "persistence id to persistent event to"
      },
      {
        "start": 3168.0,
        "duration": 4.079,
        "text": "cassandra then you will see that"
      },
      {
        "start": 3170.079,
        "duration": 4.401,
        "text": "persistence id pop up in this little"
      },
      {
        "start": 3172.079,
        "duration": 4.081,
        "text": "application as well"
      },
      {
        "start": 3174.48,
        "duration": 3.52,
        "text": "now this read journal is very powerful"
      },
      {
        "start": 3176.16,
        "duration": 4.08,
        "text": "because not only can it fetch all the"
      },
      {
        "start": 3178.0,
        "duration": 3.52,
        "text": "persistence ids but it can also fetch"
      },
      {
        "start": 3180.24,
        "duration": 4.64,
        "text": "all events"
      },
      {
        "start": 3181.52,
        "duration": 3.36,
        "text": "for a persistence id"
      },
      {
        "start": 3185.52,
        "duration": 3.68,
        "text": "so for instance if i want all the events"
      },
      {
        "start": 3187.28,
        "duration": 3.92,
        "text": "associated to my test hotel let's call"
      },
      {
        "start": 3189.2,
        "duration": 3.52,
        "text": "this events for"
      },
      {
        "start": 3191.2,
        "duration": 3.44,
        "text": "test hotel"
      },
      {
        "start": 3192.72,
        "duration": 2.8,
        "text": "as read journal"
      },
      {
        "start": 3194.64,
        "duration": 2.64,
        "text": "dot"
      },
      {
        "start": 3195.52,
        "duration": 3.52,
        "text": "and i'm going to have events by"
      },
      {
        "start": 3197.28,
        "duration": 4.48,
        "text": "persistence id and i'm going to pass my"
      },
      {
        "start": 3199.04,
        "duration": 4.72,
        "text": "persistence id test hotel now this"
      },
      {
        "start": 3201.76,
        "duration": 4.319,
        "text": "function takes a bunch of arguments to"
      },
      {
        "start": 3203.76,
        "duration": 4.48,
        "text": "identify a sequence number for all the"
      },
      {
        "start": 3206.079,
        "duration": 3.841,
        "text": "events by persistence id because your"
      },
      {
        "start": 3208.24,
        "duration": 3.04,
        "text": "events might be"
      },
      {
        "start": 3209.92,
        "duration": 3.679,
        "text": "quite a lot in your real life"
      },
      {
        "start": 3211.28,
        "duration": 4.88,
        "text": "application i'm going to simply"
      },
      {
        "start": 3213.599,
        "duration": 4.321,
        "text": "fetch all of them from 0 to long.max"
      },
      {
        "start": 3216.16,
        "duration": 3.6,
        "text": "value"
      },
      {
        "start": 3217.92,
        "duration": 4.08,
        "text": "so that we can fetch all the possible"
      },
      {
        "start": 3219.76,
        "duration": 4.88,
        "text": "events for this test hotel of course"
      },
      {
        "start": 3222.0,
        "duration": 4.8,
        "text": "this is also a source and the source"
      },
      {
        "start": 3224.64,
        "duration": 4.4,
        "text": "wraps an event envelope which will have"
      },
      {
        "start": 3226.8,
        "duration": 3.84,
        "text": "to unwrap to obtain the actual event"
      },
      {
        "start": 3229.04,
        "duration": 3.6,
        "text": "that was persisted"
      },
      {
        "start": 3230.64,
        "duration": 4.0,
        "text": "so i'm going to run a map on that so i'm"
      },
      {
        "start": 3232.64,
        "duration": 4.32,
        "text": "going to say dot map"
      },
      {
        "start": 3234.64,
        "duration": 4.24,
        "text": "and i'm going to extract the event out"
      },
      {
        "start": 3236.96,
        "duration": 3.599,
        "text": "of that event envelope so i'm going to"
      },
      {
        "start": 3238.88,
        "duration": 3.04,
        "text": "parse that out then i'm going to map"
      },
      {
        "start": 3240.559,
        "duration": 3.28,
        "text": "again and i'm going to use a partial"
      },
      {
        "start": 3241.92,
        "duration": 3.76,
        "text": "function that will run a pattern match"
      },
      {
        "start": 3243.839,
        "duration": 3.601,
        "text": "automatically so in case we get a"
      },
      {
        "start": 3245.68,
        "duration": 4.32,
        "text": "reservation"
      },
      {
        "start": 3247.44,
        "duration": 4.08,
        "text": "accepted for some sort of reservation"
      },
      {
        "start": 3250.0,
        "duration": 3.68,
        "text": "let's say i'm going to print something"
      },
      {
        "start": 3251.52,
        "duration": 4.799,
        "text": "out so i'm going to say print line i'm"
      },
      {
        "start": 3253.68,
        "duration": 5.439,
        "text": "going to say making reservation and i'm"
      },
      {
        "start": 3256.319,
        "duration": 5.28,
        "text": "going to inject res inside"
      },
      {
        "start": 3259.119,
        "duration": 4.561,
        "text": "and i'm going to do the same for all the"
      },
      {
        "start": 3261.599,
        "duration": 4.801,
        "text": "possible cases so i'm going to duplicate"
      },
      {
        "start": 3263.68,
        "duration": 6.0,
        "text": "that so in case we get"
      },
      {
        "start": 3266.4,
        "duration": 5.439,
        "text": "a reservation changed i'm going to"
      },
      {
        "start": 3269.68,
        "duration": 4.56,
        "text": "import the whole model here i'm going to"
      },
      {
        "start": 3271.839,
        "duration": 5.921,
        "text": "say reservation"
      },
      {
        "start": 3274.24,
        "duration": 6.48,
        "text": "updated for the old reservation"
      },
      {
        "start": 3277.76,
        "duration": 4.72,
        "text": "to new reservation i'm going to say"
      },
      {
        "start": 3280.72,
        "duration": 4.079,
        "text": "changing"
      },
      {
        "start": 3282.48,
        "duration": 3.839,
        "text": "changing reservation"
      },
      {
        "start": 3284.799,
        "duration": 4.641,
        "text": "from"
      },
      {
        "start": 3286.319,
        "duration": 4.52,
        "text": "and i'm going to use old reservation to"
      },
      {
        "start": 3289.44,
        "duration": 3.679,
        "text": "new"
      },
      {
        "start": 3290.839,
        "duration": 4.041,
        "text": "reservation and in case we get a"
      },
      {
        "start": 3293.119,
        "duration": 3.041,
        "text": "reservation"
      },
      {
        "start": 3294.88,
        "duration": 4.239,
        "text": "cancelled"
      },
      {
        "start": 3296.16,
        "duration": 5.199,
        "text": "i'm going to say canceling cancelling or"
      },
      {
        "start": 3299.119,
        "duration": 4.401,
        "text": "removing reservation and i'm going to"
      },
      {
        "start": 3301.359,
        "duration": 4.801,
        "text": "inject res inside now because i'm"
      },
      {
        "start": 3303.52,
        "duration": 4.319,
        "text": "turning every event into the outcome of"
      },
      {
        "start": 3306.16,
        "duration": 4.24,
        "text": "print line which is unit i don't really"
      },
      {
        "start": 3307.839,
        "duration": 5.201,
        "text": "care about absolutely printing anything"
      },
      {
        "start": 3310.4,
        "duration": 5.76,
        "text": "so i'm going to say in main i'm going to"
      },
      {
        "start": 3313.04,
        "duration": 4.88,
        "text": "have events for test hotel i'm going to"
      },
      {
        "start": 3316.16,
        "duration": 4.56,
        "text": "say run with"
      },
      {
        "start": 3317.92,
        "duration": 4.48,
        "text": "and i'm going to plug in a sync dot"
      },
      {
        "start": 3320.72,
        "duration": 4.24,
        "text": "ignore so i'm going to say"
      },
      {
        "start": 3322.4,
        "duration": 3.919,
        "text": "sync dot ignore"
      },
      {
        "start": 3324.96,
        "duration": 3.359,
        "text": "and instead of run with i'm actually"
      },
      {
        "start": 3326.319,
        "duration": 5.04,
        "text": "going to say 2 sync ignore that run so"
      },
      {
        "start": 3328.319,
        "duration": 4.881,
        "text": "that we have a similar approach to the"
      },
      {
        "start": 3331.359,
        "duration": 3.921,
        "text": "previous example so in this case the"
      },
      {
        "start": 3333.2,
        "duration": 3.84,
        "text": "read journal will fetch all the events"
      },
      {
        "start": 3335.28,
        "duration": 3.839,
        "text": "associated to the test hotel so it'll"
      },
      {
        "start": 3337.04,
        "duration": 4.559,
        "text": "interrogate cassandra for all the"
      },
      {
        "start": 3339.119,
        "duration": 4.48,
        "text": "messages associated to test hotel and it"
      },
      {
        "start": 3341.599,
        "duration": 3.921,
        "text": "will print the appropriate string"
      },
      {
        "start": 3343.599,
        "duration": 4.801,
        "text": "depending on that particular event we"
      },
      {
        "start": 3345.52,
        "duration": 5.68,
        "text": "can simply run this independently of any"
      },
      {
        "start": 3348.4,
        "duration": 2.8,
        "text": "other application"
      },
      {
        "start": 3351.839,
        "duration": 3.52,
        "text": "all right so we have making reservation"
      },
      {
        "start": 3353.68,
        "duration": 3.919,
        "text": "changing reservation and canceling"
      },
      {
        "start": 3355.359,
        "duration": 5.041,
        "text": "reservation in this order because that's"
      },
      {
        "start": 3357.599,
        "duration": 4.96,
        "text": "how these events were persisted now this"
      },
      {
        "start": 3360.4,
        "duration": 4.24,
        "text": "part is where things might get a little"
      },
      {
        "start": 3362.559,
        "duration": 4.161,
        "text": "confusing the hotel event reader this"
      },
      {
        "start": 3364.64,
        "duration": 4.56,
        "text": "application that we have right now is"
      },
      {
        "start": 3366.72,
        "duration": 5.2,
        "text": "the q part from cqrs not the r part the"
      },
      {
        "start": 3369.2,
        "duration": 4.96,
        "text": "q part from cqrs so it's an independent"
      },
      {
        "start": 3371.92,
        "duration": 4.8,
        "text": "reader now this standalone application"
      },
      {
        "start": 3374.16,
        "duration": 4.639,
        "text": "might also quote unquote write data to"
      },
      {
        "start": 3376.72,
        "duration": 4.16,
        "text": "the database but for its own internal or"
      },
      {
        "start": 3378.799,
        "duration": 4.081,
        "text": "separate purposes for instance this"
      },
      {
        "start": 3380.88,
        "duration": 4.16,
        "text": "particular application might be specific"
      },
      {
        "start": 3382.88,
        "duration": 3.6,
        "text": "to this hotel so we might want to block"
      },
      {
        "start": 3385.04,
        "duration": 3.44,
        "text": "the calendar days for which a room is"
      },
      {
        "start": 3386.48,
        "duration": 4.0,
        "text": "booked or store the reservations by"
      },
      {
        "start": 3388.48,
        "duration": 3.76,
        "text": "guest for easier queries and so on so"
      },
      {
        "start": 3390.48,
        "duration": 4.319,
        "text": "notice that everything that we might"
      },
      {
        "start": 3392.24,
        "duration": 4.4,
        "text": "want to write into cassandra is for its"
      },
      {
        "start": 3394.799,
        "duration": 3.28,
        "text": "own internal purposes we might as well"
      },
      {
        "start": 3396.64,
        "duration": 3.76,
        "text": "write to a whole new different"
      },
      {
        "start": 3398.079,
        "duration": 3.681,
        "text": "persistent store but why we use a"
      },
      {
        "start": 3400.4,
        "duration": 3.439,
        "text": "different precision store when we have"
      },
      {
        "start": 3401.76,
        "duration": 4.079,
        "text": "cassandra already so whatever this"
      },
      {
        "start": 3403.839,
        "duration": 4.881,
        "text": "application may end up writing to"
      },
      {
        "start": 3405.839,
        "duration": 5.361,
        "text": "cassandra it's for its own internal read"
      },
      {
        "start": 3408.72,
        "duration": 4.0,
        "text": "model all right so instead of simply"
      },
      {
        "start": 3411.2,
        "duration": 3.44,
        "text": "printing making reservation changing"
      },
      {
        "start": 3412.72,
        "duration": 3.2,
        "text": "reservation and canceling reservation"
      },
      {
        "start": 3414.64,
        "duration": 3.36,
        "text": "i'm actually going to store some data to"
      },
      {
        "start": 3415.92,
        "duration": 4.159,
        "text": "cassandra that is specific to this hotel"
      },
      {
        "start": 3418.0,
        "duration": 3.839,
        "text": "for easier queries later so now's the"
      },
      {
        "start": 3420.079,
        "duration": 3.201,
        "text": "time for me to actually add all those"
      },
      {
        "start": 3421.839,
        "duration": 3.921,
        "text": "tables that i added at the beginning of"
      },
      {
        "start": 3423.28,
        "duration": 4.559,
        "text": "the video the table setup.cql"
      },
      {
        "start": 3425.76,
        "duration": 4.88,
        "text": "this contains all the table definitions"
      },
      {
        "start": 3427.839,
        "duration": 4.96,
        "text": "for the akka and aka snapshot key spaces"
      },
      {
        "start": 3430.64,
        "duration": 4.159,
        "text": "in cassandra which aqua persistence"
      },
      {
        "start": 3432.799,
        "duration": 4.0,
        "text": "automatically creates but we're going to"
      },
      {
        "start": 3434.799,
        "duration": 3.681,
        "text": "have to create these manually when we"
      },
      {
        "start": 3436.799,
        "duration": 5.681,
        "text": "connect to ostrodb"
      },
      {
        "start": 3438.48,
        "duration": 6.24,
        "text": "and we are going to also have some hotel"
      },
      {
        "start": 3442.48,
        "duration": 4.16,
        "text": "and reservation related tables so i'm"
      },
      {
        "start": 3444.72,
        "duration": 5.04,
        "text": "going to copy all of this from create"
      },
      {
        "start": 3446.64,
        "duration": 5.28,
        "text": "key space hotel all the way to the end"
      },
      {
        "start": 3449.76,
        "duration": 3.839,
        "text": "and notice that in this case we also"
      },
      {
        "start": 3451.92,
        "duration": 3.6,
        "text": "have a materialized view so depending on"
      },
      {
        "start": 3453.599,
        "duration": 4.321,
        "text": "the cassandra version that you have and"
      },
      {
        "start": 3455.52,
        "duration": 4.0,
        "text": "if you've enabled materialized views the"
      },
      {
        "start": 3457.92,
        "duration": 3.76,
        "text": "experimental feature in cassandra this"
      },
      {
        "start": 3459.52,
        "duration": 3.92,
        "text": "may or may not work in this particular"
      },
      {
        "start": 3461.68,
        "duration": 4.24,
        "text": "video i'm not going to use materialized"
      },
      {
        "start": 3463.44,
        "duration": 4.32,
        "text": "views so this command will fail but i'm"
      },
      {
        "start": 3465.92,
        "duration": 3.76,
        "text": "fine with that materialized views are an"
      },
      {
        "start": 3467.76,
        "duration": 4.48,
        "text": "excellent way of keeping some tables in"
      },
      {
        "start": 3469.68,
        "duration": 5.52,
        "text": "sync so i'm going to copy those and in"
      },
      {
        "start": 3472.24,
        "duration": 4.64,
        "text": "my sql shell i'm going to"
      },
      {
        "start": 3475.2,
        "duration": 3.76,
        "text": "paste everything"
      },
      {
        "start": 3476.88,
        "duration": 4.0,
        "text": "so run all the commands and notice that"
      },
      {
        "start": 3478.96,
        "duration": 3.599,
        "text": "the materialized view doesn't work"
      },
      {
        "start": 3480.88,
        "duration": 4.88,
        "text": "because we have materialized views"
      },
      {
        "start": 3482.559,
        "duration": 4.881,
        "text": "disabled enabled in cassandra y ml so"
      },
      {
        "start": 3485.76,
        "duration": 3.359,
        "text": "you can enable that in docker container"
      },
      {
        "start": 3487.44,
        "duration": 2.96,
        "text": "if you wish i'm not going to use that"
      },
      {
        "start": 3489.119,
        "duration": 2.561,
        "text": "for this video"
      },
      {
        "start": 3490.4,
        "duration": 3.6,
        "text": "all right so we're going to ignore the"
      },
      {
        "start": 3491.68,
        "duration": 4.159,
        "text": "materialized view you can enable that if"
      },
      {
        "start": 3494.0,
        "duration": 3.92,
        "text": "you want so right now we have all the"
      },
      {
        "start": 3495.839,
        "duration": 3.52,
        "text": "tables for reservations hotels and so on"
      },
      {
        "start": 3497.92,
        "duration": 3.6,
        "text": "and so forth let's go through them in"
      },
      {
        "start": 3499.359,
        "duration": 4.161,
        "text": "turn real quick so in the key space"
      },
      {
        "start": 3501.52,
        "duration": 4.4,
        "text": "hotel we have a type called hotel"
      },
      {
        "start": 3503.52,
        "duration": 5.2,
        "text": "address if you want to fill some data"
      },
      {
        "start": 3505.92,
        "duration": 5.679,
        "text": "over there we have hotel.hotels and"
      },
      {
        "start": 3508.72,
        "duration": 5.68,
        "text": "every hotel will have an id a name phone"
      },
      {
        "start": 3511.599,
        "duration": 4.561,
        "text": "and an address so this is very useful if"
      },
      {
        "start": 3514.4,
        "duration": 3.6,
        "text": "you want to actually fake your data with"
      },
      {
        "start": 3516.16,
        "duration": 3.439,
        "text": "some actual addresses and so on and so"
      },
      {
        "start": 3518.0,
        "duration": 4.319,
        "text": "forth there are some python packages"
      },
      {
        "start": 3519.599,
        "duration": 4.561,
        "text": "that do that job very very well"
      },
      {
        "start": 3522.319,
        "duration": 3.841,
        "text": "we're not going to use these tables for"
      },
      {
        "start": 3524.16,
        "duration": 4.32,
        "text": "this video but rather i'm interested in"
      },
      {
        "start": 3526.16,
        "duration": 4.159,
        "text": "available rooms by hotel date this is"
      },
      {
        "start": 3528.48,
        "duration": 4.079,
        "text": "very important this is essentially a"
      },
      {
        "start": 3530.319,
        "duration": 4.8,
        "text": "table with calendar days that we can"
      },
      {
        "start": 3532.559,
        "duration": 4.881,
        "text": "block if a reservation is made so for"
      },
      {
        "start": 3535.119,
        "duration": 4.24,
        "text": "every hotel for every date for every"
      },
      {
        "start": 3537.44,
        "duration": 4.159,
        "text": "room number we have a flag whether that"
      },
      {
        "start": 3539.359,
        "duration": 4.72,
        "text": "room number in that hotel is available"
      },
      {
        "start": 3541.599,
        "duration": 5.041,
        "text": "at that date so we can fill all the"
      },
      {
        "start": 3544.079,
        "duration": 5.04,
        "text": "calendar days say for a year for a"
      },
      {
        "start": 3546.64,
        "duration": 4.56,
        "text": "particular hotel and make the rooms free"
      },
      {
        "start": 3549.119,
        "duration": 4.321,
        "text": "and whenever we have a reservation we're"
      },
      {
        "start": 3551.2,
        "duration": 4.159,
        "text": "gonna block all these calendar days"
      },
      {
        "start": 3553.44,
        "duration": 3.919,
        "text": "as for reservations we have this key"
      },
      {
        "start": 3555.359,
        "duration": 3.681,
        "text": "space specific to reservations we have"
      },
      {
        "start": 3557.359,
        "duration": 4.0,
        "text": "the reservation.address"
      },
      {
        "start": 3559.04,
        "duration": 4.48,
        "text": "also a custom data type we have"
      },
      {
        "start": 3561.359,
        "duration": 4.72,
        "text": "reservation dot reservations by hotel"
      },
      {
        "start": 3563.52,
        "duration": 4.96,
        "text": "date so for every hotel for every start"
      },
      {
        "start": 3566.079,
        "duration": 5.04,
        "text": "date and for every room number we have a"
      },
      {
        "start": 3568.48,
        "duration": 4.879,
        "text": "confirmation number for a guest id and"
      },
      {
        "start": 3571.119,
        "duration": 3.841,
        "text": "the end date of their trip so we're"
      },
      {
        "start": 3573.359,
        "duration": 3.601,
        "text": "going to store these reservations with"
      },
      {
        "start": 3574.96,
        "duration": 4.159,
        "text": "this primary key the tuple hotel id"
      },
      {
        "start": 3576.96,
        "duration": 3.92,
        "text": "start date and room number the"
      },
      {
        "start": 3579.119,
        "duration": 4.401,
        "text": "materialized views you're going to"
      },
      {
        "start": 3580.88,
        "duration": 4.239,
        "text": "ignore and reservation.reservation by"
      },
      {
        "start": 3583.52,
        "duration": 4.72,
        "text": "guest is another table that is very"
      },
      {
        "start": 3585.119,
        "duration": 7.041,
        "text": "useful for query so for every guest last"
      },
      {
        "start": 3588.24,
        "duration": 5.76,
        "text": "name and confirmation number we can find"
      },
      {
        "start": 3592.16,
        "duration": 3.52,
        "text": "a particular reservation with a hotel id"
      },
      {
        "start": 3594.0,
        "duration": 3.119,
        "text": "start date and date and so on and so"
      },
      {
        "start": 3595.68,
        "duration": 2.639,
        "text": "forth in some sort of centralized"
      },
      {
        "start": 3597.119,
        "duration": 3.041,
        "text": "fashion"
      },
      {
        "start": 3598.319,
        "duration": 4.321,
        "text": "also if you want to store data about the"
      },
      {
        "start": 3600.16,
        "duration": 4.32,
        "text": "reservation guests and amenities by room"
      },
      {
        "start": 3602.64,
        "duration": 3.52,
        "text": "if you want to add special features or"
      },
      {
        "start": 3604.48,
        "duration": 4.16,
        "text": "other kinds of commands for example if"
      },
      {
        "start": 3606.16,
        "duration": 4.48,
        "text": "you want to add extras to bookings for"
      },
      {
        "start": 3608.64,
        "duration": 3.84,
        "text": "example a special room or"
      },
      {
        "start": 3610.64,
        "duration": 3.6,
        "text": "breakfast in bed or what have you you"
      },
      {
        "start": 3612.48,
        "duration": 3.44,
        "text": "can add them in these tables i'm not"
      },
      {
        "start": 3614.24,
        "duration": 3.92,
        "text": "going to use them for this video in the"
      },
      {
        "start": 3615.92,
        "duration": 4.639,
        "text": "interest of time so the critical tables"
      },
      {
        "start": 3618.16,
        "duration": 5.76,
        "text": "are reservations by guest reservations"
      },
      {
        "start": 3620.559,
        "duration": 6.56,
        "text": "by hotel date and the available rooms by"
      },
      {
        "start": 3623.92,
        "duration": 6.08,
        "text": "hotel date so the calendar days"
      },
      {
        "start": 3627.119,
        "duration": 5.761,
        "text": "right so in this hotel event reader we"
      },
      {
        "start": 3630.0,
        "duration": 4.319,
        "text": "can actually write to these tables now"
      },
      {
        "start": 3632.88,
        "duration": 2.88,
        "text": "when we make a reservation we need to"
      },
      {
        "start": 3634.319,
        "duration": 3.201,
        "text": "block the calendar days associated to"
      },
      {
        "start": 3635.76,
        "duration": 3.599,
        "text": "that reservation which means that the"
      },
      {
        "start": 3637.52,
        "duration": 4.4,
        "text": "room must be free which means that the"
      },
      {
        "start": 3639.359,
        "duration": 5.041,
        "text": "calendar days need to be in the"
      },
      {
        "start": 3641.92,
        "duration": 4.48,
        "text": "reservations table which means i'm going"
      },
      {
        "start": 3644.4,
        "duration": 4.88,
        "text": "to create another application that will"
      },
      {
        "start": 3646.4,
        "duration": 5.12,
        "text": "populate these tables for a particular"
      },
      {
        "start": 3649.28,
        "duration": 3.36,
        "text": "calendar duration let's say a year so"
      },
      {
        "start": 3651.52,
        "duration": 3.839,
        "text": "i'm going to create a new scholar"
      },
      {
        "start": 3652.64,
        "duration": 4.479,
        "text": "application and i'm going to call this"
      },
      {
        "start": 3655.359,
        "duration": 3.681,
        "text": "cassandra"
      },
      {
        "start": 3657.119,
        "duration": 3.2,
        "text": "table cleaner"
      },
      {
        "start": 3659.04,
        "duration": 2.96,
        "text": "and i'm going to run this application"
      },
      {
        "start": 3660.319,
        "duration": 3.361,
        "text": "whenever i need a fresh state of"
      },
      {
        "start": 3662.0,
        "duration": 3.2,
        "text": "cassandra now in the interest of time"
      },
      {
        "start": 3663.68,
        "duration": 3.76,
        "text": "i'm going to speed things up a bit so"
      },
      {
        "start": 3665.2,
        "duration": 5.119,
        "text": "for every hotel right now we have one"
      },
      {
        "start": 3667.44,
        "duration": 5.04,
        "text": "for every room which is in my assumption"
      },
      {
        "start": 3670.319,
        "duration": 4.721,
        "text": "100 rooms per hotel and for every day"
      },
      {
        "start": 3672.48,
        "duration": 4.48,
        "text": "and i'm assuming a year worth of data"
      },
      {
        "start": 3675.04,
        "duration": 3.44,
        "text": "i'm going to clear up a day in the"
      },
      {
        "start": 3676.96,
        "duration": 2.879,
        "text": "calendar for that particular hotel for"
      },
      {
        "start": 3678.48,
        "duration": 2.879,
        "text": "that particular room"
      },
      {
        "start": 3679.839,
        "duration": 2.881,
        "text": "now i'm going to slow things down a bit"
      },
      {
        "start": 3681.359,
        "duration": 3.521,
        "text": "because i'm going to show you how we can"
      },
      {
        "start": 3682.72,
        "duration": 4.56,
        "text": "write an item to cassandra i'm going to"
      },
      {
        "start": 3684.88,
        "duration": 4.0,
        "text": "create an actor system so system as"
      },
      {
        "start": 3687.28,
        "duration": 4.96,
        "text": "actor system"
      },
      {
        "start": 3688.88,
        "duration": 5.679,
        "text": "from actor typed with behaviors"
      },
      {
        "start": 3692.24,
        "duration": 3.599,
        "text": "dot empty and i'm going to call this"
      },
      {
        "start": 3694.559,
        "duration": 3.921,
        "text": "cassandra"
      },
      {
        "start": 3695.839,
        "duration": 4.561,
        "text": "system and i'm going to create a session"
      },
      {
        "start": 3698.48,
        "duration": 3.599,
        "text": "which is a cassandra session that will"
      },
      {
        "start": 3700.4,
        "duration": 3.439,
        "text": "allow me to execute queries so i'm going"
      },
      {
        "start": 3702.079,
        "duration": 2.881,
        "text": "to use cassandra"
      },
      {
        "start": 3703.839,
        "duration": 2.96,
        "text": "session"
      },
      {
        "start": 3704.96,
        "duration": 3.68,
        "text": "registry"
      },
      {
        "start": 3706.799,
        "duration": 4.0,
        "text": "and i'm going to use cassandra session"
      },
      {
        "start": 3708.64,
        "duration": 3.36,
        "text": "registry from the scholar dsl package"
      },
      {
        "start": 3710.799,
        "duration": 3.361,
        "text": "because otherwise we're gonna have some"
      },
      {
        "start": 3712.0,
        "duration": 4.72,
        "text": "type conflicts for that system and i'm"
      },
      {
        "start": 3714.16,
        "duration": 4.24,
        "text": "gonna say session four and the"
      },
      {
        "start": 3716.72,
        "duration": 4.48,
        "text": "configuration path you can find in"
      },
      {
        "start": 3718.4,
        "duration": 5.6,
        "text": "application.conf it's called akka"
      },
      {
        "start": 3721.2,
        "duration": 3.68,
        "text": "projection cassandra session config so"
      },
      {
        "start": 3724.0,
        "duration": 3.039,
        "text": "this"
      },
      {
        "start": 3724.88,
        "duration": 4.239,
        "text": "is the string that we want so i'm gonna"
      },
      {
        "start": 3727.039,
        "duration": 4.161,
        "text": "go back and write that string so aka"
      },
      {
        "start": 3729.119,
        "duration": 3.92,
        "text": "projection cassandra session config and"
      },
      {
        "start": 3731.2,
        "duration": 3.44,
        "text": "with that session i can actually execute"
      },
      {
        "start": 3733.039,
        "duration": 4.32,
        "text": "a query to cassandra so i can say"
      },
      {
        "start": 3734.64,
        "duration": 4.959,
        "text": "session dot execute right"
      },
      {
        "start": 3737.359,
        "duration": 3.601,
        "text": "and i'm going to pass my insert now i"
      },
      {
        "start": 3739.599,
        "duration": 3.44,
        "text": "have to be really careful about this"
      },
      {
        "start": 3740.96,
        "duration": 4.24,
        "text": "insert because the names of the columns"
      },
      {
        "start": 3743.039,
        "duration": 4.241,
        "text": "need to be matched exactly so because i"
      },
      {
        "start": 3745.2,
        "duration": 4.0,
        "text": "don't remember them by heart i'm using"
      },
      {
        "start": 3747.28,
        "duration": 3.279,
        "text": "the appropriate file now because this is"
      },
      {
        "start": 3749.2,
        "duration": 3.839,
        "text": "an archive stream source i'm going to"
      },
      {
        "start": 3750.559,
        "duration": 4.081,
        "text": "pair it with a sync and return a future"
      },
      {
        "start": 3753.039,
        "duration": 3.841,
        "text": "that will simply run all these"
      },
      {
        "start": 3754.64,
        "duration": 3.919,
        "text": "statements after that i'm going to run a"
      },
      {
        "start": 3756.88,
        "duration": 4.479,
        "text": "feature that will truncate all the"
      },
      {
        "start": 3758.559,
        "duration": 4.961,
        "text": "existing tables from cassandra now this"
      },
      {
        "start": 3761.359,
        "duration": 4.401,
        "text": "contains all the akka tables the akka"
      },
      {
        "start": 3763.52,
        "duration": 3.839,
        "text": "snapshot and also the reservation tables"
      },
      {
        "start": 3765.76,
        "duration": 3.68,
        "text": "that i want to clear now all these"
      },
      {
        "start": 3767.359,
        "duration": 4.081,
        "text": "statements will run as futures as well"
      },
      {
        "start": 3769.44,
        "duration": 3.28,
        "text": "and i'm going to print something in case"
      },
      {
        "start": 3771.44,
        "duration": 2.96,
        "text": "something goes wrong"
      },
      {
        "start": 3772.72,
        "duration": 3.44,
        "text": "now once i've created the clear rooms"
      },
      {
        "start": 3774.4,
        "duration": 4.0,
        "text": "and this future sequence i'm going to"
      },
      {
        "start": 3776.16,
        "duration": 4.879,
        "text": "add the clear rooms to this list"
      },
      {
        "start": 3778.4,
        "duration": 4.0,
        "text": "and after the future finishes i'm going"
      },
      {
        "start": 3781.039,
        "duration": 2.881,
        "text": "to run a non-complete"
      },
      {
        "start": 3782.4,
        "duration": 3.28,
        "text": "and in case"
      },
      {
        "start": 3783.92,
        "duration": 3.36,
        "text": "this thing finishes i'm going to print"
      },
      {
        "start": 3785.68,
        "duration": 4.879,
        "text": "line a little statement so i'm going to"
      },
      {
        "start": 3787.28,
        "duration": 4.48,
        "text": "have a print line with all tables clear"
      },
      {
        "start": 3790.559,
        "duration": 3.76,
        "text": "or something like that and then i'm"
      },
      {
        "start": 3791.76,
        "duration": 4.559,
        "text": "going to say system.terminate to finish"
      },
      {
        "start": 3794.319,
        "duration": 4.0,
        "text": "the application so this is a quick"
      },
      {
        "start": 3796.319,
        "duration": 4.8,
        "text": "application that will simply clear all"
      },
      {
        "start": 3798.319,
        "duration": 4.961,
        "text": "the tables and insert true in all the"
      },
      {
        "start": 3801.119,
        "duration": 4.161,
        "text": "calendar days for an entire year for"
      },
      {
        "start": 3803.28,
        "duration": 4.24,
        "text": "this test hotel now we can run this"
      },
      {
        "start": 3805.28,
        "duration": 4.24,
        "text": "application by adding a main method at"
      },
      {
        "start": 3807.52,
        "duration": 3.44,
        "text": "the very end of the file so i'm going to"
      },
      {
        "start": 3809.52,
        "duration": 3.44,
        "text": "type in a main and i'm going to call"
      },
      {
        "start": 3810.96,
        "duration": 3.76,
        "text": "this clear tables and we can run this"
      },
      {
        "start": 3812.96,
        "duration": 4.639,
        "text": "application which will probably take a"
      },
      {
        "start": 3814.72,
        "duration": 4.879,
        "text": "few minutes for our docker container to"
      },
      {
        "start": 3817.599,
        "duration": 4.48,
        "text": "execute so many queries so we have"
      },
      {
        "start": 3819.599,
        "duration": 4.0,
        "text": "roughly 40 000 queries that will be"
      },
      {
        "start": 3822.079,
        "duration": 4.0,
        "text": "executed by cassandra so i'm going to"
      },
      {
        "start": 3823.599,
        "duration": 4.48,
        "text": "speed things up a bit all right cool so"
      },
      {
        "start": 3826.079,
        "duration": 4.48,
        "text": "our application finished and we can test"
      },
      {
        "start": 3828.079,
        "duration": 4.561,
        "text": "the result of this application by"
      },
      {
        "start": 3830.559,
        "duration": 3.52,
        "text": "inspecting the hotel available rooms by"
      },
      {
        "start": 3832.64,
        "duration": 4.08,
        "text": "hotel date because this is the only"
      },
      {
        "start": 3834.079,
        "duration": 4.161,
        "text": "table that actually has some data so i'm"
      },
      {
        "start": 3836.72,
        "duration": 5.119,
        "text": "going to copy this table name i'm going"
      },
      {
        "start": 3838.24,
        "duration": 5.599,
        "text": "to navigate back to my cql shell and i'm"
      },
      {
        "start": 3841.839,
        "duration": 4.641,
        "text": "going to say select star from this"
      },
      {
        "start": 3843.839,
        "duration": 4.801,
        "text": "little table and let's say limit 10 to"
      },
      {
        "start": 3846.48,
        "duration": 3.92,
        "text": "not fill the entire screen and we have"
      },
      {
        "start": 3848.64,
        "duration": 3.919,
        "text": "for the test hotel for the date the"
      },
      {
        "start": 3850.4,
        "duration": 5.12,
        "text": "first of january 2023 for the room"
      },
      {
        "start": 3852.559,
        "duration": 5.28,
        "text": "number 1 to 10 and is available true so"
      },
      {
        "start": 3855.52,
        "duration": 5.12,
        "text": "we have for every number for every date"
      },
      {
        "start": 3857.839,
        "duration": 5.2,
        "text": "we have true so before every test we're"
      },
      {
        "start": 3860.64,
        "duration": 4.56,
        "text": "going to run this application to clear"
      },
      {
        "start": 3863.039,
        "duration": 4.721,
        "text": "our cassandra tables so now that our"
      },
      {
        "start": 3865.2,
        "duration": 5.839,
        "text": "cassandra tables are clear let's go back"
      },
      {
        "start": 3867.76,
        "duration": 6.079,
        "text": "to our hotel event reader which is the"
      },
      {
        "start": 3871.039,
        "duration": 4.56,
        "text": "persistence query based read application"
      },
      {
        "start": 3873.839,
        "duration": 3.441,
        "text": "and instead of making reservation"
      },
      {
        "start": 3875.599,
        "duration": 3.841,
        "text": "changing reservation and cancelling"
      },
      {
        "start": 3877.28,
        "duration": 4.559,
        "text": "reservation just as prints we're going"
      },
      {
        "start": 3879.44,
        "duration": 5.04,
        "text": "to store some data into cassandra just"
      },
      {
        "start": 3881.839,
        "duration": 5.121,
        "text": "for this application to read so let me"
      },
      {
        "start": 3884.48,
        "duration": 4.639,
        "text": "go ahead and create a simple method"
      },
      {
        "start": 3886.96,
        "duration": 4.48,
        "text": "called make reservation"
      },
      {
        "start": 3889.119,
        "duration": 5.281,
        "text": "and i'm going to have a reservation as"
      },
      {
        "start": 3891.44,
        "duration": 5.119,
        "text": "an argument and this will simply execute"
      },
      {
        "start": 3894.4,
        "duration": 4.159,
        "text": "some statements in cassandra to block"
      },
      {
        "start": 3896.559,
        "duration": 4.24,
        "text": "all the calendar dates and insert some"
      },
      {
        "start": 3898.559,
        "duration": 3.52,
        "text": "values in the reservation tables now i'm"
      },
      {
        "start": 3900.799,
        "duration": 3.121,
        "text": "going to create some variables that will"
      },
      {
        "start": 3902.079,
        "duration": 3.681,
        "text": "deconstruct the reservation and it will"
      },
      {
        "start": 3903.92,
        "duration": 3.84,
        "text": "tell me which days i need to block in"
      },
      {
        "start": 3905.76,
        "duration": 3.839,
        "text": "the calendar now in order to execute the"
      },
      {
        "start": 3907.76,
        "duration": 3.76,
        "text": "statements in cassandra i will need one"
      },
      {
        "start": 3909.599,
        "duration": 3.921,
        "text": "of those sessions that i built for the"
      },
      {
        "start": 3911.52,
        "duration": 4.4,
        "text": "other application so getting to the"
      },
      {
        "start": 3913.52,
        "duration": 4.0,
        "text": "cassandra table cleaner i'm going to"
      },
      {
        "start": 3915.92,
        "duration": 4.879,
        "text": "copy the session and i'm going to paste"
      },
      {
        "start": 3917.52,
        "duration": 5.76,
        "text": "it in my reader application so this is"
      },
      {
        "start": 3920.799,
        "duration": 4.401,
        "text": "the cassandra session"
      },
      {
        "start": 3923.28,
        "duration": 3.92,
        "text": "and i'm going to have my val session as"
      },
      {
        "start": 3925.2,
        "duration": 3.599,
        "text": "cassandra session registry wherever and"
      },
      {
        "start": 3927.2,
        "duration": 4.639,
        "text": "i'm going to use this session to execute"
      },
      {
        "start": 3928.799,
        "duration": 4.56,
        "text": "some statements so for every day in this"
      },
      {
        "start": 3931.839,
        "duration": 4.0,
        "text": "days blocked i'm going to execute a"
      },
      {
        "start": 3933.359,
        "duration": 4.401,
        "text": "statement i'm going to return a list of"
      },
      {
        "start": 3935.839,
        "duration": 3.681,
        "text": "futures so this is going to be some"
      },
      {
        "start": 3937.76,
        "duration": 5.2,
        "text": "let's call this blocked"
      },
      {
        "start": 3939.52,
        "duration": 4.72,
        "text": "days futures as a four comprehension and"
      },
      {
        "start": 3942.96,
        "duration": 4.399,
        "text": "for every day"
      },
      {
        "start": 3944.24,
        "duration": 5.76,
        "text": "in zero until day is blocked"
      },
      {
        "start": 3947.359,
        "duration": 5.921,
        "text": "because that is an int i'm going to"
      },
      {
        "start": 3950.0,
        "duration": 5.76,
        "text": "yield a future obtained by session"
      },
      {
        "start": 3953.28,
        "duration": 4.48,
        "text": "dot execute right and i'm going to write"
      },
      {
        "start": 3955.76,
        "duration": 4.88,
        "text": "the statement to update"
      },
      {
        "start": 3957.76,
        "duration": 5.599,
        "text": "and i'm going to update the hotel's"
      },
      {
        "start": 3960.64,
        "duration": 4.8,
        "text": "available rooms by hotel date so i'm"
      },
      {
        "start": 3963.359,
        "duration": 5.601,
        "text": "going to copy this name paste it here so"
      },
      {
        "start": 3965.44,
        "duration": 6.159,
        "text": "i'm going to say update this thing set"
      },
      {
        "start": 3968.96,
        "duration": 5.119,
        "text": "and i'm going to say is available"
      },
      {
        "start": 3971.599,
        "duration": 3.76,
        "text": "to false and i'm going to have a where"
      },
      {
        "start": 3974.079,
        "duration": 2.72,
        "text": "clause"
      },
      {
        "start": 3975.359,
        "duration": 5.921,
        "text": "and in the where clause i'm going to"
      },
      {
        "start": 3976.799,
        "duration": 6.0,
        "text": "have my hotel id is the hotel id so"
      },
      {
        "start": 3981.28,
        "duration": 3.759,
        "text": "hotel id"
      },
      {
        "start": 3982.799,
        "duration": 5.681,
        "text": "and i'm going to make sure i'm wrapping"
      },
      {
        "start": 3985.039,
        "duration": 4.401,
        "text": "this in single quotes and date is equal"
      },
      {
        "start": 3988.48,
        "duration": 2.559,
        "text": "to"
      },
      {
        "start": 3989.44,
        "duration": 4.56,
        "text": "single quotes and i'm going to expand"
      },
      {
        "start": 3991.039,
        "duration": 4.961,
        "text": "the variable here which is start"
      },
      {
        "start": 3994.0,
        "duration": 4.0,
        "text": "local date"
      },
      {
        "start": 3996.0,
        "duration": 4.319,
        "text": "plus days"
      },
      {
        "start": 3998.0,
        "duration": 4.64,
        "text": "and i'm going to have days"
      },
      {
        "start": 4000.319,
        "duration": 2.321,
        "text": "and"
      },
      {
        "start": 4002.799,
        "duration": 5.04,
        "text": "room number"
      },
      {
        "start": 4004.4,
        "duration": 3.439,
        "text": "equals room number"
      },
      {
        "start": 4008.079,
        "duration": 4.561,
        "text": "and i'm going to make sure i have the"
      },
      {
        "start": 4009.92,
        "duration": 4.399,
        "text": "right amount of single quotes"
      },
      {
        "start": 4012.64,
        "duration": 4.0,
        "text": "now after i block the days in the"
      },
      {
        "start": 4014.319,
        "duration": 4.161,
        "text": "calendar i also need to add some rows"
      },
      {
        "start": 4016.64,
        "duration": 5.12,
        "text": "into the reservation by hotel date and"
      },
      {
        "start": 4018.48,
        "duration": 4.8,
        "text": "reservations by guest tables into"
      },
      {
        "start": 4021.76,
        "duration": 3.44,
        "text": "separate futures with two separate"
      },
      {
        "start": 4023.28,
        "duration": 3.44,
        "text": "statements now just to be able to"
      },
      {
        "start": 4025.2,
        "duration": 3.359,
        "text": "investigate whether any of these"
      },
      {
        "start": 4026.72,
        "duration": 4.16,
        "text": "statements failed for any reason i'm"
      },
      {
        "start": 4028.559,
        "duration": 4.161,
        "text": "also going to add some recover callbacks"
      },
      {
        "start": 4030.88,
        "duration": 3.919,
        "text": "so that we can inspect what went wrong"
      },
      {
        "start": 4032.72,
        "duration": 4.079,
        "text": "in that case now in order to be able to"
      },
      {
        "start": 4034.799,
        "duration": 3.52,
        "text": "run these recover callbacks we will need"
      },
      {
        "start": 4036.799,
        "duration": 3.601,
        "text": "some kind of execution context which"
      },
      {
        "start": 4038.319,
        "duration": 3.681,
        "text": "will be provided by the actor system so"
      },
      {
        "start": 4040.4,
        "duration": 3.399,
        "text": "i'm going to have to"
      },
      {
        "start": 4042.0,
        "duration": 3.68,
        "text": "import"
      },
      {
        "start": 4043.799,
        "duration": 4.04,
        "text": "system.executioncontext so that we can"
      },
      {
        "start": 4045.68,
        "duration": 3.84,
        "text": "run all these callbacks so now we have a"
      },
      {
        "start": 4047.839,
        "duration": 5.121,
        "text": "sequence of futures which i'm going to"
      },
      {
        "start": 4049.52,
        "duration": 4.519,
        "text": "run with future.sequence"
      },
      {
        "start": 4052.96,
        "duration": 2.639,
        "text": "and i'm going to import"
      },
      {
        "start": 4054.039,
        "duration": 3.961,
        "text": "skullconcurrentfuture and i'm going to"
      },
      {
        "start": 4055.599,
        "duration": 4.96,
        "text": "have my reservation"
      },
      {
        "start": 4058.0,
        "duration": 5.839,
        "text": "guest future and reservation"
      },
      {
        "start": 4060.559,
        "duration": 5.921,
        "text": "guest date future and all the"
      },
      {
        "start": 4063.839,
        "duration": 3.841,
        "text": "block days features so blocked these"
      },
      {
        "start": 4066.48,
        "duration": 3.599,
        "text": "futures"
      },
      {
        "start": 4067.68,
        "duration": 4.48,
        "text": "to list and then i'm going to map this"
      },
      {
        "start": 4070.079,
        "duration": 5.04,
        "text": "entire future to return some sort of"
      },
      {
        "start": 4072.16,
        "duration": 6.32,
        "text": "unit so this is going to be a future"
      },
      {
        "start": 4075.119,
        "duration": 5.361,
        "text": "unit and this will simply finish when"
      },
      {
        "start": 4078.48,
        "duration": 3.68,
        "text": "all these statements complete now at"
      },
      {
        "start": 4080.48,
        "duration": 3.28,
        "text": "this point the make reservation call is"
      },
      {
        "start": 4082.16,
        "duration": 3.6,
        "text": "complete so we are executing these"
      },
      {
        "start": 4083.76,
        "duration": 4.559,
        "text": "statements in cassandra and it returns a"
      },
      {
        "start": 4085.76,
        "duration": 5.92,
        "text": "future unit so we can actually invoke"
      },
      {
        "start": 4088.319,
        "duration": 6.081,
        "text": "this future when we found a reservation"
      },
      {
        "start": 4091.68,
        "duration": 5.2,
        "text": "event so we can say make reservation"
      },
      {
        "start": 4094.4,
        "duration": 4.72,
        "text": "with res now in this case we will need"
      },
      {
        "start": 4096.88,
        "duration": 3.839,
        "text": "to run a map async instead of map"
      },
      {
        "start": 4099.12,
        "duration": 3.36,
        "text": "because make reservation is not a plain"
      },
      {
        "start": 4100.719,
        "duration": 4.48,
        "text": "value but it's a future so i'm going to"
      },
      {
        "start": 4102.48,
        "duration": 4.719,
        "text": "change that to map async with let's say"
      },
      {
        "start": 4105.199,
        "duration": 3.921,
        "text": "a number of threads like eight threads"
      },
      {
        "start": 4107.199,
        "duration": 4.401,
        "text": "and we will run the same function that"
      },
      {
        "start": 4109.12,
        "duration": 4.079,
        "text": "will return some futures and for the"
      },
      {
        "start": 4111.6,
        "duration": 3.199,
        "text": "cases where i simply return some print"
      },
      {
        "start": 4113.199,
        "duration": 4.64,
        "text": "lines i'm gonna return future dot"
      },
      {
        "start": 4114.799,
        "duration": 5.761,
        "text": "successful with unit so that we only"
      },
      {
        "start": 4117.839,
        "duration": 4.241,
        "text": "return a future wrapping a plane value"
      },
      {
        "start": 4120.56,
        "duration": 3.759,
        "text": "so this is a placeholder i'm going to"
      },
      {
        "start": 4122.08,
        "duration": 4.239,
        "text": "add a to do here to insert the"
      },
      {
        "start": 4124.319,
        "duration": 3.601,
        "text": "appropriate data into"
      },
      {
        "start": 4126.319,
        "duration": 3.601,
        "text": "cassandra"
      },
      {
        "start": 4127.92,
        "duration": 5.04,
        "text": "if we are changing reservation and"
      },
      {
        "start": 4129.92,
        "duration": 4.799,
        "text": "canceling reservation in that case so"
      },
      {
        "start": 4132.96,
        "duration": 4.799,
        "text": "notice that we only have reservation"
      },
      {
        "start": 4134.719,
        "duration": 4.401,
        "text": "accepted if we are making a reservation"
      },
      {
        "start": 4137.759,
        "duration": 3.361,
        "text": "at this point we can start the"
      },
      {
        "start": 4139.12,
        "duration": 3.44,
        "text": "application and listen for all the"
      },
      {
        "start": 4141.12,
        "duration": 3.119,
        "text": "events that are associated to this"
      },
      {
        "start": 4142.56,
        "duration": 3.599,
        "text": "persistence id"
      },
      {
        "start": 4144.239,
        "duration": 4.641,
        "text": "and after that we can spin up our little"
      },
      {
        "start": 4146.159,
        "duration": 4.481,
        "text": "hotel actor and try to persist some sort"
      },
      {
        "start": 4148.88,
        "duration": 4.479,
        "text": "of event so i'm going to"
      },
      {
        "start": 4150.64,
        "duration": 5.199,
        "text": "run this hotel event reader and we have"
      },
      {
        "start": 4153.359,
        "duration": 4.081,
        "text": "a running application let's see if"
      },
      {
        "start": 4155.839,
        "duration": 4.161,
        "text": "nothing goes wrong"
      },
      {
        "start": 4157.44,
        "duration": 6.319,
        "text": "so all good so far and i'm going to"
      },
      {
        "start": 4160.0,
        "duration": 5.839,
        "text": "start my little hotel demonstration and"
      },
      {
        "start": 4163.759,
        "duration": 4.08,
        "text": "in my hotel demonstration for test hotel"
      },
      {
        "start": 4165.839,
        "duration": 3.92,
        "text": "i'm going to simply create a new"
      },
      {
        "start": 4167.839,
        "duration": 4.88,
        "text": "reservation remember at this point our"
      },
      {
        "start": 4169.759,
        "duration": 4.881,
        "text": "cassandra database is free because we"
      },
      {
        "start": 4172.719,
        "duration": 4.241,
        "text": "executed the cassandra table cleaner so"
      },
      {
        "start": 4174.64,
        "duration": 4.159,
        "text": "all our tables are fresh"
      },
      {
        "start": 4176.96,
        "duration": 3.92,
        "text": "so at this point we can run our hotel"
      },
      {
        "start": 4178.799,
        "duration": 3.681,
        "text": "demo as well"
      },
      {
        "start": 4180.88,
        "duration": 4.319,
        "text": "which will start persisting those events"
      },
      {
        "start": 4182.48,
        "duration": 3.52,
        "text": "at cassandra and this hotel demo will"
      },
      {
        "start": 4185.199,
        "duration": 3.52,
        "text": "have"
      },
      {
        "start": 4186.0,
        "duration": 5.359,
        "text": "a state change so the reservation was"
      },
      {
        "start": 4188.719,
        "duration": 5.52,
        "text": "accepted and in hotel event reader"
      },
      {
        "start": 4191.359,
        "duration": 4.721,
        "text": "notice that we now have a log for making"
      },
      {
        "start": 4194.239,
        "duration": 4.161,
        "text": "reservation for reservation daniel test"
      },
      {
        "start": 4196.08,
        "duration": 4.4,
        "text": "hotel and so on and so forth with this"
      },
      {
        "start": 4198.4,
        "duration": 3.44,
        "text": "confirmation number unfortunately it"
      },
      {
        "start": 4200.48,
        "duration": 3.36,
        "text": "seems that at this point we have some"
      },
      {
        "start": 4201.84,
        "duration": 3.92,
        "text": "syntax error in our statements but these"
      },
      {
        "start": 4203.84,
        "duration": 4.24,
        "text": "are surfaced out by our recover"
      },
      {
        "start": 4205.76,
        "duration": 4.24,
        "text": "callbacks which is a good reason why we"
      },
      {
        "start": 4208.08,
        "duration": 4.0,
        "text": "added them so let's go back and let's"
      },
      {
        "start": 4210.0,
        "duration": 4.96,
        "text": "inspect our syntax"
      },
      {
        "start": 4212.08,
        "duration": 4.48,
        "text": "so we have room day blocking failed we"
      },
      {
        "start": 4214.96,
        "duration": 4.08,
        "text": "have a syntax error no viable"
      },
      {
        "start": 4216.56,
        "duration": 4.08,
        "text": "alternative at where hotel because we"
      },
      {
        "start": 4219.04,
        "duration": 4.0,
        "text": "don't have a space"
      },
      {
        "start": 4220.64,
        "duration": 4.48,
        "text": "that is okay then we have a syntax error"
      },
      {
        "start": 4223.04,
        "duration": 4.96,
        "text": "for reservation for date field which is"
      },
      {
        "start": 4225.12,
        "duration": 6.0,
        "text": "my second query and we have no viable"
      },
      {
        "start": 4228.0,
        "duration": 5.199,
        "text": "alternative at input closed paren"
      },
      {
        "start": 4231.12,
        "duration": 4.96,
        "text": "and we have insert into reservation we"
      },
      {
        "start": 4233.199,
        "duration": 4.721,
        "text": "have values and then again no space"
      },
      {
        "start": 4236.08,
        "duration": 4.0,
        "text": "because we have some"
      },
      {
        "start": 4237.92,
        "duration": 4.16,
        "text": "open and closed parenthesis but the"
      },
      {
        "start": 4240.08,
        "duration": 5.2,
        "text": "values here doesn't have any space and"
      },
      {
        "start": 4242.08,
        "duration": 5.599,
        "text": "likewise for the third element now let"
      },
      {
        "start": 4245.28,
        "duration": 4.72,
        "text": "me close my hotel event reader my hotel"
      },
      {
        "start": 4247.679,
        "duration": 4.641,
        "text": "demo has already finished so the hotel"
      },
      {
        "start": 4250.0,
        "duration": 3.92,
        "text": "event reader can simply restart at this"
      },
      {
        "start": 4252.32,
        "duration": 3.839,
        "text": "point because the event has already been"
      },
      {
        "start": 4253.92,
        "duration": 4.4,
        "text": "persisted into cassandra so this can"
      },
      {
        "start": 4256.159,
        "duration": 4.0,
        "text": "simply pick it up again so let me start"
      },
      {
        "start": 4258.32,
        "duration": 3.839,
        "text": "my application and hopefully my syntax"
      },
      {
        "start": 4260.159,
        "duration": 4.0,
        "text": "is right for the cassandra so notice"
      },
      {
        "start": 4262.159,
        "duration": 4.241,
        "text": "that we have fewer errors here so the"
      },
      {
        "start": 4264.159,
        "duration": 4.241,
        "text": "blocking the room date blocking was"
      },
      {
        "start": 4266.4,
        "duration": 4.24,
        "text": "successful but the reservation for date"
      },
      {
        "start": 4268.4,
        "duration": 4.56,
        "text": "failed again the syntax error we have"
      },
      {
        "start": 4270.64,
        "duration": 4.24,
        "text": "a no viable alternative at the closed"
      },
      {
        "start": 4272.96,
        "duration": 4.16,
        "text": "paren now in this case i think it's"
      },
      {
        "start": 4274.88,
        "duration": 3.92,
        "text": "something different because the guest id"
      },
      {
        "start": 4277.12,
        "duration": 3.36,
        "text": "is daniel and the guest id is supposed"
      },
      {
        "start": 4278.8,
        "duration": 3.76,
        "text": "to be if i remember correctly a unique"
      },
      {
        "start": 4280.48,
        "duration": 4.0,
        "text": "identifier so the table setup says that"
      },
      {
        "start": 4282.56,
        "duration": 5.44,
        "text": "the guest id needs to be a unique"
      },
      {
        "start": 4284.48,
        "duration": 6.0,
        "text": "identifier so uuid and the uid obviously"
      },
      {
        "start": 4288.0,
        "duration": 5.52,
        "text": "doesn't conform to the string daniel so"
      },
      {
        "start": 4290.48,
        "duration": 5.36,
        "text": "here under the hotel demo i'm going to"
      },
      {
        "start": 4293.52,
        "duration": 4.32,
        "text": "create a make reservation not with"
      },
      {
        "start": 4295.84,
        "duration": 4.64,
        "text": "daniel but a unique identifier so i'm"
      },
      {
        "start": 4297.84,
        "duration": 6.08,
        "text": "going to have a uuid"
      },
      {
        "start": 4300.48,
        "duration": 4.88,
        "text": "dot random uuid dot to string now at"
      },
      {
        "start": 4303.92,
        "duration": 3.52,
        "text": "this point i should invalidate the"
      },
      {
        "start": 4305.36,
        "duration": 3.68,
        "text": "cassandra messages so all the events"
      },
      {
        "start": 4307.44,
        "duration": 4.08,
        "text": "that were persisted cassandra which is"
      },
      {
        "start": 4309.04,
        "duration": 5.679,
        "text": "just one and let me make the reservation"
      },
      {
        "start": 4311.52,
        "duration": 6.32,
        "text": "again so here under the cql i'm going to"
      },
      {
        "start": 4314.719,
        "duration": 5.361,
        "text": "say truncate aka.messages"
      },
      {
        "start": 4317.84,
        "duration": 4.879,
        "text": "so that we don't run that table cleaner"
      },
      {
        "start": 4320.08,
        "duration": 4.639,
        "text": "again which takes a little while so i'm"
      },
      {
        "start": 4322.719,
        "duration": 4.241,
        "text": "going to close the hotel event reader"
      },
      {
        "start": 4324.719,
        "duration": 4.401,
        "text": "and then spin up the hotel demo again"
      },
      {
        "start": 4326.96,
        "duration": 4.719,
        "text": "and the hotel event reader in any order"
      },
      {
        "start": 4329.12,
        "duration": 4.559,
        "text": "so i'm going to spin up the reader again"
      },
      {
        "start": 4331.679,
        "duration": 4.721,
        "text": "and then the hotel demo again and let's"
      },
      {
        "start": 4333.679,
        "duration": 2.721,
        "text": "see what happens"
      },
      {
        "start": 4337.92,
        "duration": 3.759,
        "text": "all right so we now have a single"
      },
      {
        "start": 4339.84,
        "duration": 4.16,
        "text": "reservation because we only have one"
      },
      {
        "start": 4341.679,
        "duration": 4.881,
        "text": "event and the hotel event reader notice"
      },
      {
        "start": 4344.0,
        "duration": 5.199,
        "text": "that we have making reservation and no"
      },
      {
        "start": 4346.56,
        "duration": 4.24,
        "text": "other syntax error and this is great"
      },
      {
        "start": 4349.199,
        "duration": 4.081,
        "text": "because right now we have some"
      },
      {
        "start": 4350.8,
        "duration": 4.8,
        "text": "reservations being stored into the"
      },
      {
        "start": 4353.28,
        "duration": 4.72,
        "text": "center table specifically for this"
      },
      {
        "start": 4355.6,
        "duration": 4.559,
        "text": "particular hotel so we should be able to"
      },
      {
        "start": 4358.0,
        "duration": 4.4,
        "text": "find an entry here under reservations by"
      },
      {
        "start": 4360.159,
        "duration": 5.04,
        "text": "guest and an entry under reservations by"
      },
      {
        "start": 4362.4,
        "duration": 4.96,
        "text": "hotel date let me try reservation and"
      },
      {
        "start": 4365.199,
        "duration": 5.761,
        "text": "reservation by guests so i'm going to"
      },
      {
        "start": 4367.36,
        "duration": 6.319,
        "text": "say select star from this table"
      },
      {
        "start": 4370.96,
        "duration": 6.56,
        "text": "where and if i go back to my"
      },
      {
        "start": 4373.679,
        "duration": 4.881,
        "text": "table setup.cql reservations by guest"
      },
      {
        "start": 4377.52,
        "duration": 2.719,
        "text": "has the"
      },
      {
        "start": 4378.56,
        "duration": 4.24,
        "text": "primary key guest last name which is"
      },
      {
        "start": 4380.239,
        "duration": 4.96,
        "text": "rock the jvm and confirmation number now"
      },
      {
        "start": 4382.8,
        "duration": 4.8,
        "text": "i'm going to say where"
      },
      {
        "start": 4385.199,
        "duration": 2.401,
        "text": "guest"
      },
      {
        "start": 4387.84,
        "duration": 3.28,
        "text": "last name"
      },
      {
        "start": 4389.76,
        "duration": 3.919,
        "text": "is"
      },
      {
        "start": 4391.12,
        "duration": 4.16,
        "text": "quote rock the jvm"
      },
      {
        "start": 4393.679,
        "duration": 3.161,
        "text": "and the"
      },
      {
        "start": 4395.28,
        "duration": 4.48,
        "text": "confirmation number so"
      },
      {
        "start": 4396.84,
        "duration": 4.359,
        "text": "confirm underscore number is and i'm"
      },
      {
        "start": 4399.76,
        "duration": 3.439,
        "text": "going to fetch that from the logs which"
      },
      {
        "start": 4401.199,
        "duration": 4.401,
        "text": "is this little code at the bottom so i'm"
      },
      {
        "start": 4403.199,
        "duration": 3.761,
        "text": "going to paste that here in between"
      },
      {
        "start": 4405.6,
        "duration": 3.119,
        "text": "quotes let's see"
      },
      {
        "start": 4406.96,
        "duration": 3.6,
        "text": "and we have an entry so the guest last"
      },
      {
        "start": 4408.719,
        "duration": 4.241,
        "text": "name is rock the jvm obviously you can"
      },
      {
        "start": 4410.56,
        "duration": 5.2,
        "text": "enhance this data with some real names"
      },
      {
        "start": 4412.96,
        "duration": 6.88,
        "text": "for your guests confirmation number end"
      },
      {
        "start": 4415.76,
        "duration": 6.64,
        "text": "date is the 21st of july and the start"
      },
      {
        "start": 4419.84,
        "duration": 4.879,
        "text": "date is the 14th of july as was"
      },
      {
        "start": 4422.4,
        "duration": 4.4,
        "text": "requested by that event"
      },
      {
        "start": 4424.719,
        "duration": 3.361,
        "text": "this is great we can try the same for"
      },
      {
        "start": 4426.8,
        "duration": 3.6,
        "text": "the other table but i'm pretty sure"
      },
      {
        "start": 4428.08,
        "duration": 4.72,
        "text": "we're also going to have the data there"
      },
      {
        "start": 4430.4,
        "duration": 4.64,
        "text": "so at this point we have a first step"
      },
      {
        "start": 4432.8,
        "duration": 5.359,
        "text": "towards full functionality of the read"
      },
      {
        "start": 4435.04,
        "duration": 4.0,
        "text": "side of this cqrs application we can"
      },
      {
        "start": 4438.159,
        "duration": 2.801,
        "text": "also"
      },
      {
        "start": 4439.04,
        "duration": 3.6,
        "text": "add another method here to remove a"
      },
      {
        "start": 4440.96,
        "duration": 3.6,
        "text": "reservation and also to change the"
      },
      {
        "start": 4442.64,
        "duration": 3.28,
        "text": "reservation now the implementation of"
      },
      {
        "start": 4444.56,
        "duration": 3.599,
        "text": "the removal of a reservation is"
      },
      {
        "start": 4445.92,
        "duration": 3.84,
        "text": "comparatively simple because we can"
      },
      {
        "start": 4448.159,
        "duration": 3.761,
        "text": "simply start from the previous"
      },
      {
        "start": 4449.76,
        "duration": 3.68,
        "text": "implementation and just unblock the days"
      },
      {
        "start": 4451.92,
        "duration": 4.48,
        "text": "in the calendar by setting their flags"
      },
      {
        "start": 4453.44,
        "duration": 4.799,
        "text": "to true and instead of inserting into"
      },
      {
        "start": 4456.4,
        "duration": 4.319,
        "text": "the reservation tables we're simply"
      },
      {
        "start": 4458.239,
        "duration": 4.561,
        "text": "deleting where the conditions hold true"
      },
      {
        "start": 4460.719,
        "duration": 2.96,
        "text": "for the hotel id start date and room"
      },
      {
        "start": 4462.8,
        "duration": 2.64,
        "text": "number"
      },
      {
        "start": 4463.679,
        "duration": 4.161,
        "text": "so in the case for cancellation we can"
      },
      {
        "start": 4465.44,
        "duration": 4.32,
        "text": "simply call this remove reservation so"
      },
      {
        "start": 4467.84,
        "duration": 5.92,
        "text": "instead of this to do i'm going to say"
      },
      {
        "start": 4469.76,
        "duration": 6.479,
        "text": "remove reservation for this reservation"
      },
      {
        "start": 4473.76,
        "duration": 4.64,
        "text": "and in my hotel"
      },
      {
        "start": 4476.239,
        "duration": 3.92,
        "text": "demonstration i'm going to run a"
      },
      {
        "start": 4478.4,
        "duration": 4.16,
        "text": "cancellation and we're going to see if"
      },
      {
        "start": 4480.159,
        "duration": 4.881,
        "text": "that reservation is still in my tables"
      },
      {
        "start": 4482.56,
        "duration": 5.04,
        "text": "so here under the hotel event reader i'm"
      },
      {
        "start": 4485.04,
        "duration": 5.119,
        "text": "going to run this application again so"
      },
      {
        "start": 4487.6,
        "duration": 4.16,
        "text": "this will simply"
      },
      {
        "start": 4490.159,
        "duration": 3.921,
        "text": "look for all the events"
      },
      {
        "start": 4491.76,
        "duration": 5.439,
        "text": "so making reservation which is okay"
      },
      {
        "start": 4494.08,
        "duration": 5.2,
        "text": "because the event is in the database and"
      },
      {
        "start": 4497.199,
        "duration": 4.561,
        "text": "in my hotel demo i'm going to issue the"
      },
      {
        "start": 4499.28,
        "duration": 4.16,
        "text": "cancel reservation command which will"
      },
      {
        "start": 4501.76,
        "duration": 3.28,
        "text": "persist the event which will then be"
      },
      {
        "start": 4503.44,
        "duration": 3.52,
        "text": "listened to in the hotel event"
      },
      {
        "start": 4505.04,
        "duration": 3.119,
        "text": "application so notice that we have a"
      },
      {
        "start": 4506.96,
        "duration": 3.52,
        "text": "state change"
      },
      {
        "start": 4508.159,
        "duration": 4.56,
        "text": "and now we have command failure cannot"
      },
      {
        "start": 4510.48,
        "duration": 4.08,
        "text": "cancel the reservation this one because"
      },
      {
        "start": 4512.719,
        "duration": 4.721,
        "text": "it's not found and"
      },
      {
        "start": 4514.56,
        "duration": 4.88,
        "text": "this is completely normal because the"
      },
      {
        "start": 4517.44,
        "duration": 4.4,
        "text": "reservation confirmation number is"
      },
      {
        "start": 4519.44,
        "duration": 4.08,
        "text": "changed this time so i need to change"
      },
      {
        "start": 4521.84,
        "duration": 4.8,
        "text": "the confirmation number and i need to"
      },
      {
        "start": 4523.52,
        "duration": 5.28,
        "text": "paste it here and rerun my application"
      },
      {
        "start": 4526.64,
        "duration": 3.76,
        "text": "let's see"
      },
      {
        "start": 4528.8,
        "duration": 3.12,
        "text": "so it's good that we have all these fail"
      },
      {
        "start": 4530.4,
        "duration": 3.52,
        "text": "saves in the code"
      },
      {
        "start": 4531.92,
        "duration": 4.319,
        "text": "all right so the state was changed to an"
      },
      {
        "start": 4533.92,
        "duration": 4.88,
        "text": "empty state which is good and notice"
      },
      {
        "start": 4536.239,
        "duration": 4.721,
        "text": "that we now have cancelling reservation"
      },
      {
        "start": 4538.8,
        "duration": 3.919,
        "text": "for this particular"
      },
      {
        "start": 4540.96,
        "duration": 4.08,
        "text": "confirmation number but the reservation"
      },
      {
        "start": 4542.719,
        "duration": 5.121,
        "text": "removal for guest and for date failed"
      },
      {
        "start": 4545.04,
        "duration": 4.96,
        "text": "again a syntax error let's go back to"
      },
      {
        "start": 4547.84,
        "duration": 6.8,
        "text": "the hotel event reader and understand"
      },
      {
        "start": 4550.0,
        "duration": 7.52,
        "text": "what went wrong so the one for the guest"
      },
      {
        "start": 4554.64,
        "duration": 5.599,
        "text": "failed which is the second one because"
      },
      {
        "start": 4557.52,
        "duration": 5.199,
        "text": "we have a mismatched input and expecting"
      },
      {
        "start": 4560.239,
        "duration": 4.321,
        "text": "empty paren i'm going to remove this"
      },
      {
        "start": 4562.719,
        "duration": 3.921,
        "text": "parenthesis it's probably a token from"
      },
      {
        "start": 4564.56,
        "duration": 3.92,
        "text": "the last one and the other one says"
      },
      {
        "start": 4566.64,
        "duration": 3.84,
        "text": "undefined column name room number"
      },
      {
        "start": 4568.48,
        "duration": 4.719,
        "text": "because i'm used to this camel case"
      },
      {
        "start": 4570.48,
        "duration": 4.56,
        "text": "instead of a python case let's try"
      },
      {
        "start": 4573.199,
        "duration": 5.52,
        "text": "running the application again and we"
      },
      {
        "start": 4575.04,
        "duration": 3.679,
        "text": "should see a cancellation"
      },
      {
        "start": 4579.36,
        "duration": 3.92,
        "text": "all right so notice that we have"
      },
      {
        "start": 4580.4,
        "duration": 5.279,
        "text": "canceling reservation which is great we"
      },
      {
        "start": 4583.28,
        "duration": 5.12,
        "text": "have the cancellation effect"
      },
      {
        "start": 4585.679,
        "duration": 4.801,
        "text": "being performed and if i try running the"
      },
      {
        "start": 4588.4,
        "duration": 3.92,
        "text": "select statement again i should not see"
      },
      {
        "start": 4590.48,
        "duration": 3.52,
        "text": "any more entries in my table so if i run"
      },
      {
        "start": 4592.32,
        "duration": 3.28,
        "text": "the same query again notice that nothing"
      },
      {
        "start": 4594.0,
        "duration": 3.76,
        "text": "shows up and this was great a"
      },
      {
        "start": 4595.6,
        "duration": 6.079,
        "text": "reservation was simply removed from my"
      },
      {
        "start": 4597.76,
        "duration": 6.8,
        "text": "hotel my room is free now in the case of"
      },
      {
        "start": 4601.679,
        "duration": 6.081,
        "text": "a change we only need to remove the"
      },
      {
        "start": 4604.56,
        "duration": 5.36,
        "text": "existing reservation and add a new one"
      },
      {
        "start": 4607.76,
        "duration": 4.24,
        "text": "now we need to run two futures which is"
      },
      {
        "start": 4609.92,
        "duration": 5.6,
        "text": "going to be combined in a4 comprehension"
      },
      {
        "start": 4612.0,
        "duration": 7.44,
        "text": "so in remove reservation for the old"
      },
      {
        "start": 4615.52,
        "duration": 6.08,
        "text": "reservation and i'm going to add a new"
      },
      {
        "start": 4619.44,
        "duration": 4.88,
        "text": "reservation so make reservation for the"
      },
      {
        "start": 4621.6,
        "duration": 5.36,
        "text": "new one so new reservation i'm going to"
      },
      {
        "start": 4624.32,
        "duration": 4.24,
        "text": "yield unit and because removal and"
      },
      {
        "start": 4626.96,
        "duration": 3.36,
        "text": "making worked correctly because we've"
      },
      {
        "start": 4628.56,
        "duration": 2.88,
        "text": "tested them a couple of minutes ago we"
      },
      {
        "start": 4630.32,
        "duration": 2.879,
        "text": "don't really need to test the"
      },
      {
        "start": 4631.44,
        "duration": 4.0,
        "text": "reservation updated because we're pretty"
      },
      {
        "start": 4633.199,
        "duration": 4.401,
        "text": "sure it will work fine so we've fully"
      },
      {
        "start": 4635.44,
        "duration": 4.32,
        "text": "implemented the cqrs pattern for the"
      },
      {
        "start": 4637.6,
        "duration": 4.0,
        "text": "entire application for a single hotel"
      },
      {
        "start": 4639.76,
        "duration": 3.6,
        "text": "it's time we scaled this up a bit so i'm"
      },
      {
        "start": 4641.6,
        "duration": 3.599,
        "text": "going to create my little reservation"
      },
      {
        "start": 4643.36,
        "duration": 4.4,
        "text": "agent and i'm going to define some"
      },
      {
        "start": 4645.199,
        "duration": 4.881,
        "text": "messages that this agent will receive so"
      },
      {
        "start": 4647.76,
        "duration": 4.88,
        "text": "here i'm going to create a simple trait"
      },
      {
        "start": 4650.08,
        "duration": 5.119,
        "text": "then i'm going to call hotel protocol"
      },
      {
        "start": 4652.64,
        "duration": 5.36,
        "text": "and this hotel protocol will be the"
      },
      {
        "start": 4655.199,
        "duration": 4.801,
        "text": "protocol that the reservation agent will"
      },
      {
        "start": 4658.0,
        "duration": 4.88,
        "text": "handle so this actor ref here instead of"
      },
      {
        "start": 4660.0,
        "duration": 5.28,
        "text": "any will be an actor of hotel protocol"
      },
      {
        "start": 4662.88,
        "duration": 5.2,
        "text": "and this will extend command of course"
      },
      {
        "start": 4665.28,
        "duration": 5.68,
        "text": "as before and i'm going to have a case"
      },
      {
        "start": 4668.08,
        "duration": 4.639,
        "text": "class let's call this manage hotel"
      },
      {
        "start": 4670.96,
        "duration": 3.44,
        "text": "in case this"
      },
      {
        "start": 4672.719,
        "duration": 4.721,
        "text": "reservation agent will manage a new"
      },
      {
        "start": 4674.4,
        "duration": 5.92,
        "text": "hotel so manage hotel which is a hotel"
      },
      {
        "start": 4677.44,
        "duration": 6.0,
        "text": "with an actor ref of type command"
      },
      {
        "start": 4680.32,
        "duration": 4.24,
        "text": "and this extends hotel protocol and"
      },
      {
        "start": 4683.44,
        "duration": 3.36,
        "text": "another one i'm going to call this"
      },
      {
        "start": 4684.56,
        "duration": 5.92,
        "text": "generate which will generate a number of"
      },
      {
        "start": 4686.8,
        "duration": 6.56,
        "text": "events or commands rather so n commands"
      },
      {
        "start": 4690.48,
        "duration": 4.88,
        "text": "as an int for the hotels that this thing"
      },
      {
        "start": 4693.36,
        "duration": 3.839,
        "text": "manages so this extends hotel protocol"
      },
      {
        "start": 4695.36,
        "duration": 4.72,
        "text": "as well now considering that the command"
      },
      {
        "start": 4697.199,
        "duration": 4.081,
        "text": "failure and all the events"
      },
      {
        "start": 4700.08,
        "duration": 3.2,
        "text": "are going to be sent back to the"
      },
      {
        "start": 4701.28,
        "duration": 4.24,
        "text": "reservation agent i'm going to mix in"
      },
      {
        "start": 4703.28,
        "duration": 4.56,
        "text": "the hotel protocol in all of them so i'm"
      },
      {
        "start": 4705.52,
        "duration": 5.44,
        "text": "gonna mix in hotel protocol in this"
      },
      {
        "start": 4707.84,
        "duration": 5.04,
        "text": "domain model for all of these messages"
      },
      {
        "start": 4710.96,
        "duration": 3.36,
        "text": "now in real life this reservation agent"
      },
      {
        "start": 4712.88,
        "duration": 3.76,
        "text": "would have to report to some sort of"
      },
      {
        "start": 4714.32,
        "duration": 4.32,
        "text": "user-facing api or an http service or a"
      },
      {
        "start": 4716.64,
        "duration": 3.599,
        "text": "user interface or something like that"
      },
      {
        "start": 4718.64,
        "duration": 3.2,
        "text": "that will receive all these commands and"
      },
      {
        "start": 4720.239,
        "duration": 4.401,
        "text": "this reservation agent will pass all"
      },
      {
        "start": 4721.84,
        "duration": 4.64,
        "text": "these commands all to the hotels under"
      },
      {
        "start": 4724.64,
        "duration": 3.599,
        "text": "its jurisdiction but in this case i'm"
      },
      {
        "start": 4726.48,
        "duration": 4.0,
        "text": "going to have the reservation agent"
      },
      {
        "start": 4728.239,
        "duration": 4.241,
        "text": "generate all these sorts of events so"
      },
      {
        "start": 4730.48,
        "duration": 3.92,
        "text": "that we can scale our application and"
      },
      {
        "start": 4732.48,
        "duration": 3.52,
        "text": "see it perform live now this reservation"
      },
      {
        "start": 4734.4,
        "duration": 3.12,
        "text": "agent is only auxiliary to our"
      },
      {
        "start": 4736.0,
        "duration": 3.12,
        "text": "application it's not really relevant to"
      },
      {
        "start": 4737.52,
        "duration": 4.0,
        "text": "the cqrs pattern that we've already"
      },
      {
        "start": 4739.12,
        "duration": 5.8,
        "text": "demonstrated so i'm going to speed it up"
      },
      {
        "start": 4741.52,
        "duration": 3.4,
        "text": "a little bit"
      },
      {
        "start": 4747.58,
        "duration": 13.899,
        "text": "[Music]"
      },
      {
        "start": 4769.36,
        "duration": 3.28,
        "text": "so enough music we wrote a lot of code"
      },
      {
        "start": 4771.6,
        "duration": 3.2,
        "text": "and we haven't tested it this"
      },
      {
        "start": 4772.64,
        "duration": 4.32,
        "text": "reservation agent would simply generate"
      },
      {
        "start": 4774.8,
        "duration": 4.64,
        "text": "delete or cancellations with probability"
      },
      {
        "start": 4776.96,
        "duration": 4.88,
        "text": "five percent changes that is updates"
      },
      {
        "start": 4779.44,
        "duration": 4.719,
        "text": "with fifteen percent so i've added these"
      },
      {
        "start": 4781.84,
        "duration": 3.839,
        "text": "two together with a twenty percent total"
      },
      {
        "start": 4784.159,
        "duration": 3.441,
        "text": "and eighty percent with make"
      },
      {
        "start": 4785.679,
        "duration": 3.921,
        "text": "reservations so this is the proportion"
      },
      {
        "start": 4787.6,
        "duration": 3.599,
        "text": "that i'm going to go for in this"
      },
      {
        "start": 4789.6,
        "duration": 3.52,
        "text": "application obviously you can change the"
      },
      {
        "start": 4791.199,
        "duration": 4.401,
        "text": "numbers as you see fit"
      },
      {
        "start": 4793.12,
        "duration": 4.88,
        "text": "now we're going to scale things up a bit"
      },
      {
        "start": 4795.6,
        "duration": 5.2,
        "text": "by creating this reservation agent and"
      },
      {
        "start": 4798.0,
        "duration": 4.56,
        "text": "making it manage more than one hotel now"
      },
      {
        "start": 4800.8,
        "duration": 3.2,
        "text": "in order to be able to test it we are"
      },
      {
        "start": 4802.56,
        "duration": 4.0,
        "text": "going to modify the cassandra table"
      },
      {
        "start": 4804.0,
        "duration": 4.639,
        "text": "cleaner to manage not just one hotel"
      },
      {
        "start": 4806.56,
        "duration": 4.56,
        "text": "with the name test hotel but let's say"
      },
      {
        "start": 4808.639,
        "duration": 4.481,
        "text": "100 hotels with the name hotel"
      },
      {
        "start": 4811.12,
        "duration": 4.559,
        "text": "underscore i or something so instead of"
      },
      {
        "start": 4813.12,
        "duration": 5.119,
        "text": "a simple list i'm going to say 1 to 100"
      },
      {
        "start": 4815.679,
        "duration": 4.721,
        "text": "and i'm going to say map for every i i'm"
      },
      {
        "start": 4818.239,
        "duration": 5.92,
        "text": "going to return the name"
      },
      {
        "start": 4820.4,
        "duration": 7.68,
        "text": "hotel underscore dollar i"
      },
      {
        "start": 4824.159,
        "duration": 7.841,
        "text": "and this will mean that we will have 100"
      },
      {
        "start": 4828.08,
        "duration": 6.96,
        "text": "times 100 times 365 queries to cassandra"
      },
      {
        "start": 4832.0,
        "duration": 4.239,
        "text": "so 3.6 million queries to cassandra so"
      },
      {
        "start": 4835.04,
        "duration": 3.28,
        "text": "as you can imagine it's probably going"
      },
      {
        "start": 4836.239,
        "duration": 4.561,
        "text": "to take a while so feel free to run this"
      },
      {
        "start": 4838.32,
        "duration": 4.16,
        "text": "application while we are modifying the"
      },
      {
        "start": 4840.8,
        "duration": 3.04,
        "text": "rest of our code"
      },
      {
        "start": 4842.48,
        "duration": 2.96,
        "text": "all right so with my application"
      },
      {
        "start": 4843.84,
        "duration": 4.08,
        "text": "collapsed i'm going to create another"
      },
      {
        "start": 4845.44,
        "duration": 4.16,
        "text": "application to automatically generate a"
      },
      {
        "start": 4847.92,
        "duration": 4.4,
        "text": "large number of events so i'm going to"
      },
      {
        "start": 4849.6,
        "duration": 4.4,
        "text": "call this reservation"
      },
      {
        "start": 4852.32,
        "duration": 3.359,
        "text": "generator"
      },
      {
        "start": 4854.0,
        "duration": 4.0,
        "text": "and i'm going to make it an object with"
      },
      {
        "start": 4855.679,
        "duration": 4.401,
        "text": "a main method so in this case all i'm"
      },
      {
        "start": 4858.0,
        "duration": 4.159,
        "text": "going to do is spin up a reservation"
      },
      {
        "start": 4860.08,
        "duration": 4.4,
        "text": "agent and a bunch of hotels so i'm going"
      },
      {
        "start": 4862.159,
        "duration": 4.161,
        "text": "to spin up 100 hotels and i'm going to"
      },
      {
        "start": 4864.48,
        "duration": 4.0,
        "text": "tell the reservation agent to manage"
      },
      {
        "start": 4866.32,
        "duration": 4.08,
        "text": "every single one of those hotels"
      },
      {
        "start": 4868.48,
        "duration": 5.52,
        "text": "after that i'm going to generate"
      },
      {
        "start": 4870.4,
        "duration": 5.52,
        "text": "messages or commands in bursts so 100"
      },
      {
        "start": 4874.0,
        "duration": 5.52,
        "text": "times i'm going to generate 10 messages"
      },
      {
        "start": 4875.92,
        "duration": 5.52,
        "text": "at a time so 1 000 total messages at 100"
      },
      {
        "start": 4879.52,
        "duration": 3.76,
        "text": "different hotels so at this point we can"
      },
      {
        "start": 4881.44,
        "duration": 4.64,
        "text": "simulate an entire application that"
      },
      {
        "start": 4883.28,
        "duration": 4.48,
        "text": "manages 100 hotels at the same time with"
      },
      {
        "start": 4886.08,
        "duration": 3.52,
        "text": "messages coming from whatever"
      },
      {
        "start": 4887.76,
        "duration": 4.0,
        "text": "front-facing api we might want to"
      },
      {
        "start": 4889.6,
        "duration": 4.559,
        "text": "imagine now from the persistence query"
      },
      {
        "start": 4891.76,
        "duration": 4.399,
        "text": "side so from the hotel event reader we"
      },
      {
        "start": 4894.159,
        "duration": 4.56,
        "text": "can monitor all the events associated to"
      },
      {
        "start": 4896.159,
        "duration": 5.681,
        "text": "a particular hotel so in events by"
      },
      {
        "start": 4898.719,
        "duration": 6.321,
        "text": "persistence id we can ask for hotel"
      },
      {
        "start": 4901.84,
        "duration": 4.72,
        "text": "underscore 37 or something and monitor"
      },
      {
        "start": 4905.04,
        "duration": 3.28,
        "text": "all the events associated to this"
      },
      {
        "start": 4906.56,
        "duration": 3.92,
        "text": "particular hotel so at this point we can"
      },
      {
        "start": 4908.32,
        "duration": 5.12,
        "text": "spin up both of these applications this"
      },
      {
        "start": 4910.48,
        "duration": 4.48,
        "text": "one and the hotel generation app"
      },
      {
        "start": 4913.44,
        "duration": 4.64,
        "text": "so let me go ahead and do that i'm going"
      },
      {
        "start": 4914.96,
        "duration": 4.88,
        "text": "to start hotel event reader for hotel 37"
      },
      {
        "start": 4918.08,
        "duration": 3.28,
        "text": "so at this point we shouldn't have any"
      },
      {
        "start": 4919.84,
        "duration": 3.6,
        "text": "kind of messages"
      },
      {
        "start": 4921.36,
        "duration": 3.92,
        "text": "but once i start the reservation"
      },
      {
        "start": 4923.44,
        "duration": 3.84,
        "text": "generator we should start seeing some"
      },
      {
        "start": 4925.28,
        "duration": 5.28,
        "text": "events associated to this particular"
      },
      {
        "start": 4927.28,
        "duration": 4.959,
        "text": "hotel not too many but some"
      },
      {
        "start": 4930.56,
        "duration": 3.679,
        "text": "all right so notice that we have a bunch"
      },
      {
        "start": 4932.239,
        "duration": 3.841,
        "text": "of messages being generated in spurts"
      },
      {
        "start": 4934.239,
        "duration": 3.521,
        "text": "and we have some making reservation"
      },
      {
        "start": 4936.08,
        "duration": 5.52,
        "text": "changing reservation and so on and so"
      },
      {
        "start": 4937.76,
        "duration": 6.479,
        "text": "forth as they come for hotel number 37."
      },
      {
        "start": 4941.6,
        "duration": 4.48,
        "text": "so this application can monitor all the"
      },
      {
        "start": 4944.239,
        "duration": 3.521,
        "text": "events associated to a single hotel"
      },
      {
        "start": 4946.08,
        "duration": 3.68,
        "text": "obviously you can spin up multiple"
      },
      {
        "start": 4947.76,
        "duration": 4.32,
        "text": "instances of this hotel event reader for"
      },
      {
        "start": 4949.76,
        "duration": 4.56,
        "text": "multiple hotels if you'd like"
      },
      {
        "start": 4952.08,
        "duration": 5.28,
        "text": "all right so at this point our cqrs"
      },
      {
        "start": 4954.32,
        "duration": 5.2,
        "text": "application is complete at scale"
      },
      {
        "start": 4957.36,
        "duration": 4.319,
        "text": "now the final piece the crown jewel of"
      },
      {
        "start": 4959.52,
        "duration": 3.92,
        "text": "this application is to run it on a cloud"
      },
      {
        "start": 4961.679,
        "duration": 3.921,
        "text": "managed cassandra service which is"
      },
      {
        "start": 4963.44,
        "duration": 4.0,
        "text": "osterdb from datastax this is"
      },
      {
        "start": 4965.6,
        "duration": 3.52,
        "text": "essentially cassandra as a service"
      },
      {
        "start": 4967.44,
        "duration": 3.92,
        "text": "without you having to do pretty much"
      },
      {
        "start": 4969.12,
        "duration": 4.8,
        "text": "anything for it so we will take this"
      },
      {
        "start": 4971.36,
        "duration": 5.68,
        "text": "application and we will deploy the data"
      },
      {
        "start": 4973.92,
        "duration": 6.08,
        "text": "model on a cloud managed service so we"
      },
      {
        "start": 4977.04,
        "duration": 4.639,
        "text": "will navigate to astra.didastax.com"
      },
      {
        "start": 4980.0,
        "duration": 3.52,
        "text": "and just sign in with your username and"
      },
      {
        "start": 4981.679,
        "duration": 4.48,
        "text": "password or sign up if you don't have an"
      },
      {
        "start": 4983.52,
        "duration": 4.08,
        "text": "account creating one is very easy it's"
      },
      {
        "start": 4986.159,
        "duration": 3.361,
        "text": "completely free so in a couple of"
      },
      {
        "start": 4987.6,
        "duration": 3.599,
        "text": "minutes you should be ready to start so"
      },
      {
        "start": 4989.52,
        "duration": 3.36,
        "text": "you can pause the video and do that if"
      },
      {
        "start": 4991.199,
        "duration": 3.681,
        "text": "you haven't done so already"
      },
      {
        "start": 4992.88,
        "duration": 3.52,
        "text": "and after you log in you'll have this"
      },
      {
        "start": 4994.88,
        "duration": 3.44,
        "text": "dashboard in front of you which will"
      },
      {
        "start": 4996.4,
        "duration": 3.52,
        "text": "show you all the cassandra databases"
      },
      {
        "start": 4998.32,
        "duration": 4.08,
        "text": "that you have under your account i"
      },
      {
        "start": 4999.92,
        "duration": 4.719,
        "text": "already have one because i created one"
      },
      {
        "start": 5002.4,
        "duration": 3.759,
        "text": "in preparation for this video but for"
      },
      {
        "start": 5004.639,
        "duration": 3.6,
        "text": "this particular recording i'm going to"
      },
      {
        "start": 5006.159,
        "duration": 3.601,
        "text": "create a fresh one so i'm going to click"
      },
      {
        "start": 5008.239,
        "duration": 3.041,
        "text": "this button to create a serverless"
      },
      {
        "start": 5009.76,
        "duration": 3.12,
        "text": "database and i'm going to follow this"
      },
      {
        "start": 5011.28,
        "duration": 4.56,
        "text": "little wizard the database name is going"
      },
      {
        "start": 5012.88,
        "duration": 6.319,
        "text": "to be let's say rock the"
      },
      {
        "start": 5015.84,
        "duration": 5.04,
        "text": "jvm cqrs demo"
      },
      {
        "start": 5019.199,
        "duration": 3.601,
        "text": "and the key space name i'm going to"
      },
      {
        "start": 5020.88,
        "duration": 4.48,
        "text": "start with rock the jvm but we are going"
      },
      {
        "start": 5022.8,
        "duration": 5.6,
        "text": "to add all the key spaces including aca"
      },
      {
        "start": 5025.36,
        "duration": 5.12,
        "text": "reservation and hotel for our database"
      },
      {
        "start": 5028.4,
        "duration": 3.44,
        "text": "we're going to select a cloud provider"
      },
      {
        "start": 5030.48,
        "duration": 2.8,
        "text": "i'm in europe so i'm going to click"
      },
      {
        "start": 5031.84,
        "duration": 2.64,
        "text": "europe and i'm going to select one of"
      },
      {
        "start": 5033.28,
        "duration": 3.04,
        "text": "these regions and then i'm going to"
      },
      {
        "start": 5034.48,
        "duration": 4.0,
        "text": "click this blue button to create the"
      },
      {
        "start": 5036.32,
        "duration": 4.24,
        "text": "database this should only take a couple"
      },
      {
        "start": 5038.48,
        "duration": 4.08,
        "text": "of seconds and after the spinner"
      },
      {
        "start": 5040.56,
        "duration": 3.599,
        "text": "finishes you'll get to the client id"
      },
      {
        "start": 5042.56,
        "duration": 3.84,
        "text": "client secret and token which were"
      },
      {
        "start": 5044.159,
        "duration": 4.641,
        "text": "already created automatically by the"
      },
      {
        "start": 5046.4,
        "duration": 4.799,
        "text": "cassandra service but we will create a"
      },
      {
        "start": 5048.8,
        "duration": 4.399,
        "text": "new admin token from scratch with"
      },
      {
        "start": 5051.199,
        "duration": 5.44,
        "text": "heightened privileges so you can click"
      },
      {
        "start": 5053.199,
        "duration": 5.921,
        "text": "this blue button to go to the database"
      },
      {
        "start": 5056.639,
        "duration": 4.401,
        "text": "after the spinner finishes you'll get to"
      },
      {
        "start": 5059.12,
        "duration": 4.4,
        "text": "another dashboard which is particular"
      },
      {
        "start": 5061.04,
        "duration": 4.08,
        "text": "for this cqrs demonstration database"
      },
      {
        "start": 5063.52,
        "duration": 3.199,
        "text": "that we've just created"
      },
      {
        "start": 5065.12,
        "duration": 3.68,
        "text": "now for this database i'm going to"
      },
      {
        "start": 5066.719,
        "duration": 4.161,
        "text": "create a new token as i promised so"
      },
      {
        "start": 5068.8,
        "duration": 5.28,
        "text": "click on your current organization click"
      },
      {
        "start": 5070.88,
        "duration": 6.0,
        "text": "on organization settings and go to token"
      },
      {
        "start": 5074.08,
        "duration": 5.68,
        "text": "management and you will select an"
      },
      {
        "start": 5076.88,
        "duration": 5.44,
        "text": "administrator user which is the topmost"
      },
      {
        "start": 5079.76,
        "duration": 5.2,
        "text": "privilege for everything that you may"
      },
      {
        "start": 5082.32,
        "duration": 4.8,
        "text": "want to use this database for so you'll"
      },
      {
        "start": 5084.96,
        "duration": 4.64,
        "text": "click this button to generate the token"
      },
      {
        "start": 5087.12,
        "duration": 5.039,
        "text": "and then you'll copy the strings in this"
      },
      {
        "start": 5089.6,
        "duration": 4.8,
        "text": "dialog box now here's where you need to"
      },
      {
        "start": 5092.159,
        "duration": 3.921,
        "text": "put them i'm going to copy the client id"
      },
      {
        "start": 5094.4,
        "duration": 3.279,
        "text": "and i'm going to navigate back to my"
      },
      {
        "start": 5096.08,
        "duration": 3.119,
        "text": "application i'm going to go to"
      },
      {
        "start": 5097.679,
        "duration": 3.281,
        "text": "application.conf"
      },
      {
        "start": 5099.199,
        "duration": 3.921,
        "text": "and here i have a section that i've"
      },
      {
        "start": 5100.96,
        "duration": 5.12,
        "text": "commented out which is under the"
      },
      {
        "start": 5103.12,
        "duration": 5.2,
        "text": "datastax java driver we have a section"
      },
      {
        "start": 5106.08,
        "duration": 4.4,
        "text": "for basic cloud and advanced auth"
      },
      {
        "start": 5108.32,
        "duration": 4.64,
        "text": "provider i want you to uncomment that"
      },
      {
        "start": 5110.48,
        "duration": 4.56,
        "text": "section the secure content bottle is"
      },
      {
        "start": 5112.96,
        "duration": 3.92,
        "text": "going to be an empty string for now i'm"
      },
      {
        "start": 5115.04,
        "duration": 3.36,
        "text": "going to show you what that bundle is"
      },
      {
        "start": 5116.88,
        "duration": 4.319,
        "text": "and here under username i'm going to"
      },
      {
        "start": 5118.4,
        "duration": 4.64,
        "text": "paste that client id and the password is"
      },
      {
        "start": 5121.199,
        "duration": 4.321,
        "text": "going to be the client secret in this"
      },
      {
        "start": 5123.04,
        "duration": 4.56,
        "text": "dialog box now i'm not really afraid of"
      },
      {
        "start": 5125.52,
        "duration": 3.52,
        "text": "having them in the clear in this video"
      },
      {
        "start": 5127.6,
        "duration": 3.76,
        "text": "because i'm going to remove the database"
      },
      {
        "start": 5129.04,
        "duration": 4.24,
        "text": "anyway after this recording so there's"
      },
      {
        "start": 5131.36,
        "duration": 4.24,
        "text": "no worries about that"
      },
      {
        "start": 5133.28,
        "duration": 4.32,
        "text": "cool so you'll have your username and"
      },
      {
        "start": 5135.6,
        "duration": 3.68,
        "text": "password already here in the"
      },
      {
        "start": 5137.6,
        "duration": 3.76,
        "text": "configuration i've already set this for"
      },
      {
        "start": 5139.28,
        "duration": 4.0,
        "text": "you so that you don't need to care about"
      },
      {
        "start": 5141.36,
        "duration": 4.16,
        "text": "that now with these things in place i'm"
      },
      {
        "start": 5143.28,
        "duration": 4.08,
        "text": "going to create all the schemas and all"
      },
      {
        "start": 5145.52,
        "duration": 3.84,
        "text": "the tables that we're going to need to"
      },
      {
        "start": 5147.36,
        "duration": 4.96,
        "text": "interact with this astrodb so i'm going"
      },
      {
        "start": 5149.36,
        "duration": 5.839,
        "text": "to navigate back to my profile and i'm"
      },
      {
        "start": 5152.32,
        "duration": 5.12,
        "text": "going to navigate back to my database"
      },
      {
        "start": 5155.199,
        "duration": 5.201,
        "text": "so let me navigate to the rock the jvm"
      },
      {
        "start": 5157.44,
        "duration": 4.96,
        "text": "cqrs demo and i'm going to click this"
      },
      {
        "start": 5160.4,
        "duration": 3.92,
        "text": "cql console here in the middle of the"
      },
      {
        "start": 5162.4,
        "duration": 4.799,
        "text": "screen so that i have access to a"
      },
      {
        "start": 5164.32,
        "duration": 5.12,
        "text": "terminal much like my docker container"
      },
      {
        "start": 5167.199,
        "duration": 6.321,
        "text": "all right so with this sql sh i'm going"
      },
      {
        "start": 5169.44,
        "duration": 5.759,
        "text": "to go back to my table setup.cql and i'm"
      },
      {
        "start": 5173.52,
        "duration": 4.48,
        "text": "going to create all the tables now"
      },
      {
        "start": 5175.199,
        "duration": 4.801,
        "text": "before that i forgot i need to add all"
      },
      {
        "start": 5178.0,
        "duration": 3.76,
        "text": "the key spaces so back to overview i'm"
      },
      {
        "start": 5180.0,
        "duration": 5.28,
        "text": "going to add a key space i'm going to"
      },
      {
        "start": 5181.76,
        "duration": 3.52,
        "text": "have a key space for akka"
      },
      {
        "start": 5185.36,
        "duration": 4.08,
        "text": "and unfortunately the ui has a little"
      },
      {
        "start": 5187.76,
        "duration": 3.6,
        "text": "bug because after you create the key"
      },
      {
        "start": 5189.44,
        "duration": 4.32,
        "text": "space the this little button is blocked"
      },
      {
        "start": 5191.36,
        "duration": 4.08,
        "text": "so you need to refresh the page"
      },
      {
        "start": 5193.76,
        "duration": 5.919,
        "text": "and i'm going to have to add all the key"
      },
      {
        "start": 5195.44,
        "duration": 4.239,
        "text": "spaces including hotels and reservations"
      },
      {
        "start": 5201.04,
        "duration": 4.48,
        "text": "so you can pause the video until you"
      },
      {
        "start": 5202.56,
        "duration": 5.28,
        "text": "have four major key spaces we have akop"
      },
      {
        "start": 5205.52,
        "duration": 4.48,
        "text": "aqua snapshot we have hotel and"
      },
      {
        "start": 5207.84,
        "duration": 4.16,
        "text": "reservation at this point we can copy"
      },
      {
        "start": 5210.0,
        "duration": 4.0,
        "text": "all our table definitions so i'm going"
      },
      {
        "start": 5212.0,
        "duration": 4.56,
        "text": "to be very careful about this we have"
      },
      {
        "start": 5214.0,
        "duration": 6.32,
        "text": "aca snapshot and then i'm going to copy"
      },
      {
        "start": 5216.56,
        "duration": 5.119,
        "text": "this one go back to the cql console"
      },
      {
        "start": 5220.32,
        "duration": 2.879,
        "text": "and i'm going to paste everything in"
      },
      {
        "start": 5221.679,
        "duration": 3.841,
        "text": "this terminal"
      },
      {
        "start": 5223.199,
        "duration": 3.44,
        "text": "let's see so"
      },
      {
        "start": 5225.52,
        "duration": 3.84,
        "text": "this works"
      },
      {
        "start": 5226.639,
        "duration": 3.761,
        "text": "okay then all the tables in the aqua key"
      },
      {
        "start": 5229.36,
        "duration": 2.64,
        "text": "space"
      },
      {
        "start": 5230.4,
        "duration": 3.12,
        "text": "there are the most of them"
      },
      {
        "start": 5232.0,
        "duration": 5.239,
        "text": "i'm going to copy that"
      },
      {
        "start": 5233.52,
        "duration": 3.719,
        "text": "paste them in the terminal"
      },
      {
        "start": 5238.4,
        "duration": 3.36,
        "text": "all right"
      },
      {
        "start": 5239.36,
        "duration": 3.839,
        "text": "then after the hotel we have everything"
      },
      {
        "start": 5241.76,
        "duration": 4.8,
        "text": "inside"
      },
      {
        "start": 5243.199,
        "duration": 3.361,
        "text": "so everything in"
      },
      {
        "start": 5247.76,
        "duration": 2.959,
        "text": "that section after that we have"
      },
      {
        "start": 5249.44,
        "duration": 3.92,
        "text": "reservations"
      },
      {
        "start": 5250.719,
        "duration": 4.48,
        "text": "and everything with including amenities"
      },
      {
        "start": 5253.36,
        "duration": 2.96,
        "text": "by rome although we aren't really using"
      },
      {
        "start": 5255.199,
        "duration": 3.681,
        "text": "them for this application and"
      },
      {
        "start": 5256.32,
        "duration": 4.48,
        "text": "materialized views as with the docker"
      },
      {
        "start": 5258.88,
        "duration": 4.08,
        "text": "container the materializers aren't"
      },
      {
        "start": 5260.8,
        "duration": 4.56,
        "text": "really supported here so we will ignore"
      },
      {
        "start": 5262.96,
        "duration": 5.52,
        "text": "that for the application now after we've"
      },
      {
        "start": 5265.36,
        "duration": 4.879,
        "text": "created all the tables now it's time to"
      },
      {
        "start": 5268.48,
        "duration": 4.48,
        "text": "run our first demo application"
      },
      {
        "start": 5270.239,
        "duration": 5.281,
        "text": "thankfully we have one with a hotel demo"
      },
      {
        "start": 5272.96,
        "duration": 4.239,
        "text": "so i'm going to make a reservation first"
      },
      {
        "start": 5275.52,
        "duration": 3.679,
        "text": "and then i'm going to change it and"
      },
      {
        "start": 5277.199,
        "duration": 4.241,
        "text": "cancel it once i have the confirmation"
      },
      {
        "start": 5279.199,
        "duration": 4.161,
        "text": "identifier the confirmation number now"
      },
      {
        "start": 5281.44,
        "duration": 3.92,
        "text": "before i run this application we will"
      },
      {
        "start": 5283.36,
        "duration": 3.279,
        "text": "need to go to application.conf and fill"
      },
      {
        "start": 5285.36,
        "duration": 3.76,
        "text": "in this missing piece which is the"
      },
      {
        "start": 5286.639,
        "duration": 4.401,
        "text": "secure connect bundle this is a zip file"
      },
      {
        "start": 5289.12,
        "duration": 4.4,
        "text": "which will contain some connection"
      },
      {
        "start": 5291.04,
        "duration": 5.36,
        "text": "certificates that will let you connect"
      },
      {
        "start": 5293.52,
        "duration": 6.0,
        "text": "to osterdb in a secure fashion so"
      },
      {
        "start": 5296.4,
        "duration": 5.279,
        "text": "navigate back to your database and click"
      },
      {
        "start": 5299.52,
        "duration": 5.52,
        "text": "this connect tab"
      },
      {
        "start": 5301.679,
        "duration": 5.441,
        "text": "and click on java here using a driver so"
      },
      {
        "start": 5305.04,
        "duration": 3.52,
        "text": "connect using a driver in this section"
      },
      {
        "start": 5307.12,
        "duration": 4.64,
        "text": "with java"
      },
      {
        "start": 5308.56,
        "duration": 4.88,
        "text": "and the java obviously is for scala"
      },
      {
        "start": 5311.76,
        "duration": 4.879,
        "text": "applications as well being running on"
      },
      {
        "start": 5313.44,
        "duration": 5.6,
        "text": "the jvm and after that you will have to"
      },
      {
        "start": 5316.639,
        "duration": 4.641,
        "text": "download this little bundle so click on"
      },
      {
        "start": 5319.04,
        "duration": 4.72,
        "text": "this download button with secure connect"
      },
      {
        "start": 5321.28,
        "duration": 5.52,
        "text": "bundle and this will download a zip file"
      },
      {
        "start": 5323.76,
        "duration": 5.68,
        "text": "which i want you to copy and paste into"
      },
      {
        "start": 5326.8,
        "duration": 5.12,
        "text": "your source main resources so i'm going"
      },
      {
        "start": 5329.44,
        "duration": 7.56,
        "text": "to take it and hopefully i can"
      },
      {
        "start": 5331.92,
        "duration": 5.08,
        "text": "drag it to all the way to my application"
      },
      {
        "start": 5337.28,
        "duration": 5.2,
        "text": "so i'm going to edit that so under cqrs"
      },
      {
        "start": 5339.76,
        "duration": 5.36,
        "text": "cassandra live under source main"
      },
      {
        "start": 5342.48,
        "duration": 5.52,
        "text": "resources"
      },
      {
        "start": 5345.12,
        "duration": 4.72,
        "text": "okay and then i'm going to click on"
      },
      {
        "start": 5348.0,
        "duration": 3.6,
        "text": "this refactor button i don't know why"
      },
      {
        "start": 5349.84,
        "duration": 3.839,
        "text": "it's called refactor so notice that we"
      },
      {
        "start": 5351.6,
        "duration": 3.92,
        "text": "have secure connect rock the jvm cqrs"
      },
      {
        "start": 5353.679,
        "duration": 2.96,
        "text": "live demo so this is the zip file which"
      },
      {
        "start": 5355.52,
        "duration": 3.44,
        "text": "will contain"
      },
      {
        "start": 5356.639,
        "duration": 3.921,
        "text": "all the required certificates and then"
      },
      {
        "start": 5358.96,
        "duration": 4.56,
        "text": "i'm going to right click on it and i'm"
      },
      {
        "start": 5360.56,
        "duration": 3.92,
        "text": "going to copy path and reference"
      },
      {
        "start": 5363.52,
        "duration": 2.639,
        "text": "from"
      },
      {
        "start": 5364.48,
        "duration": 6.32,
        "text": "the content root so source main"
      },
      {
        "start": 5366.159,
        "duration": 6.48,
        "text": "resources this rock the jvm cqrsdemo.zip"
      },
      {
        "start": 5370.8,
        "duration": 3.439,
        "text": "now at this point all the configuration"
      },
      {
        "start": 5372.639,
        "duration": 4.161,
        "text": "should be complete and i should be able"
      },
      {
        "start": 5374.239,
        "duration": 4.801,
        "text": "to run this hotel demo with a simple"
      },
      {
        "start": 5376.8,
        "duration": 4.16,
        "text": "make reservation event"
      },
      {
        "start": 5379.04,
        "duration": 4.32,
        "text": "so let me run this application and let's"
      },
      {
        "start": 5380.96,
        "duration": 4.8,
        "text": "see what happens if this application"
      },
      {
        "start": 5383.36,
        "duration": 2.4,
        "text": "runs"
      },
      {
        "start": 5386.239,
        "duration": 4.48,
        "text": "all right so after a certain while"
      },
      {
        "start": 5388.88,
        "duration": 2.88,
        "text": "notice that we have"
      },
      {
        "start": 5390.719,
        "duration": 3.121,
        "text": "some"
      },
      {
        "start": 5391.76,
        "duration": 4.0,
        "text": "events here in the logs and the state"
      },
      {
        "start": 5393.84,
        "duration": 4.399,
        "text": "was changed which meant that the"
      },
      {
        "start": 5395.76,
        "duration": 4.8,
        "text": "persistence of this command was"
      },
      {
        "start": 5398.239,
        "duration": 6.0,
        "text": "successful so we can navigate to the"
      },
      {
        "start": 5400.56,
        "duration": 6.96,
        "text": "rocket jvm cqrs demo at the cql console"
      },
      {
        "start": 5404.239,
        "duration": 5.121,
        "text": "and i can investigate if we have a"
      },
      {
        "start": 5407.52,
        "duration": 5.84,
        "text": "message in aqua.messages so i'm going to"
      },
      {
        "start": 5409.36,
        "duration": 5.68,
        "text": "select star from aka.messages"
      },
      {
        "start": 5413.36,
        "duration": 4.08,
        "text": "and if we have an entry there then that"
      },
      {
        "start": 5415.04,
        "duration": 5.119,
        "text": "means the event was persisted and notice"
      },
      {
        "start": 5417.44,
        "duration": 4.16,
        "text": "that we do have a single event here"
      },
      {
        "start": 5420.159,
        "duration": 4.401,
        "text": "which means that our application"
      },
      {
        "start": 5421.6,
        "duration": 4.96,
        "text": "connected successfully now let me get"
      },
      {
        "start": 5424.56,
        "duration": 4.24,
        "text": "the confirmation number which is this"
      },
      {
        "start": 5426.56,
        "duration": 4.8,
        "text": "little fellow over here and then i'm"
      },
      {
        "start": 5428.8,
        "duration": 4.56,
        "text": "going to try to change it and cancel it"
      },
      {
        "start": 5431.36,
        "duration": 4.48,
        "text": "so i'm going to change reservation and"
      },
      {
        "start": 5433.36,
        "duration": 5.04,
        "text": "cancel it with this confirmation number"
      },
      {
        "start": 5435.84,
        "duration": 4.56,
        "text": "and i'm gonna run the hotel demo again"
      },
      {
        "start": 5438.4,
        "duration": 4.08,
        "text": "and at this point we should see three"
      },
      {
        "start": 5440.4,
        "duration": 3.92,
        "text": "items in aqua dot messages let's run"
      },
      {
        "start": 5442.48,
        "duration": 4.159,
        "text": "this out and"
      },
      {
        "start": 5444.32,
        "duration": 4.56,
        "text": "after a couple of seconds we should have"
      },
      {
        "start": 5446.639,
        "duration": 4.961,
        "text": "two state changes so notice that we have"
      },
      {
        "start": 5448.88,
        "duration": 4.16,
        "text": "state changed and state changed now i"
      },
      {
        "start": 5451.6,
        "duration": 3.28,
        "text": "think we should have seen a state with"
      },
      {
        "start": 5453.04,
        "duration": 3.84,
        "text": "an empty set because the reservation was"
      },
      {
        "start": 5454.88,
        "duration": 4.319,
        "text": "cancelled but i think it's because of"
      },
      {
        "start": 5456.88,
        "duration": 4.08,
        "text": "the fact that we are shutting down the"
      },
      {
        "start": 5459.199,
        "duration": 4.161,
        "text": "application after five seconds which is"
      },
      {
        "start": 5460.96,
        "duration": 4.16,
        "text": "a bit too short i'm gonna shut it down"
      },
      {
        "start": 5463.36,
        "duration": 3.839,
        "text": "after 30 seconds because now we're"
      },
      {
        "start": 5465.12,
        "duration": 4.559,
        "text": "connecting to a cloud-based cassandra"
      },
      {
        "start": 5467.199,
        "duration": 5.281,
        "text": "and the latency might be a little bigger"
      },
      {
        "start": 5469.679,
        "duration": 5.201,
        "text": "so let me run the application again"
      },
      {
        "start": 5472.48,
        "duration": 4.0,
        "text": "actually i'm going to keep the change"
      },
      {
        "start": 5474.88,
        "duration": 3.12,
        "text": "and cancel reservation let's see what we"
      },
      {
        "start": 5476.48,
        "duration": 2.96,
        "text": "have and"
      },
      {
        "start": 5478.0,
        "duration": 3.719,
        "text": "after we run this application we should"
      },
      {
        "start": 5479.44,
        "duration": 6.16,
        "text": "see three items in the"
      },
      {
        "start": 5481.719,
        "duration": 3.881,
        "text": "akka.messages table let's see"
      },
      {
        "start": 5485.76,
        "duration": 3.919,
        "text": "all right so at this point we have a"
      },
      {
        "start": 5487.6,
        "duration": 3.92,
        "text": "state with an empty set so that was"
      },
      {
        "start": 5489.679,
        "duration": 3.281,
        "text": "probably the cause we didn't give the"
      },
      {
        "start": 5491.52,
        "duration": 3.84,
        "text": "application enough time to actually"
      },
      {
        "start": 5492.96,
        "duration": 3.36,
        "text": "persist the events so let's navigate"
      },
      {
        "start": 5495.36,
        "duration": 3.2,
        "text": "back to"
      },
      {
        "start": 5496.32,
        "duration": 4.08,
        "text": "cql and let's select star for maca"
      },
      {
        "start": 5498.56,
        "duration": 4.4,
        "text": "messages again and sure enough we now"
      },
      {
        "start": 5500.4,
        "duration": 4.48,
        "text": "have three items in the table so we can"
      },
      {
        "start": 5502.96,
        "duration": 5.36,
        "text": "now safely connect to osterdb with a"
      },
      {
        "start": 5504.88,
        "duration": 6.4,
        "text": "demo application what about our scalable"
      },
      {
        "start": 5508.32,
        "duration": 4.64,
        "text": "application with persistence query so"
      },
      {
        "start": 5511.28,
        "duration": 4.64,
        "text": "right now we have cassandra table"
      },
      {
        "start": 5512.96,
        "duration": 4.719,
        "text": "cleaner which will also connect to this"
      },
      {
        "start": 5515.92,
        "duration": 4.08,
        "text": "cloud-based cassandra service because of"
      },
      {
        "start": 5517.679,
        "duration": 4.0,
        "text": "application.com so you can feel free to"
      },
      {
        "start": 5520.0,
        "duration": 3.52,
        "text": "run this cassandra table cleaner but it"
      },
      {
        "start": 5521.679,
        "duration": 4.401,
        "text": "will probably take quite a bit of time"
      },
      {
        "start": 5523.52,
        "duration": 4.56,
        "text": "to run 3.6 million queries on a"
      },
      {
        "start": 5526.08,
        "duration": 3.76,
        "text": "cloud-based cassandra but i have the"
      },
      {
        "start": 5528.08,
        "duration": 3.52,
        "text": "privilege of video editing which gives"
      },
      {
        "start": 5529.84,
        "duration": 3.68,
        "text": "me some magical powers so i'm going to"
      },
      {
        "start": 5531.6,
        "duration": 3.599,
        "text": "simply run this application and i'm"
      },
      {
        "start": 5533.52,
        "duration": 4.24,
        "text": "going to snap my fingers and i'm going"
      },
      {
        "start": 5535.199,
        "duration": 4.801,
        "text": "to have all tables clear so"
      },
      {
        "start": 5537.76,
        "duration": 4.16,
        "text": "alright amazing time travel is awesome"
      },
      {
        "start": 5540.0,
        "duration": 4.0,
        "text": "now at this point we can run both of our"
      },
      {
        "start": 5541.92,
        "duration": 4.4,
        "text": "applications the hotel event reader and"
      },
      {
        "start": 5544.0,
        "duration": 4.0,
        "text": "the reservation generator to figure out"
      },
      {
        "start": 5546.32,
        "duration": 4.08,
        "text": "if we have some events for a particular"
      },
      {
        "start": 5548.0,
        "duration": 4.08,
        "text": "hotel i'm going to say that the hotel"
      },
      {
        "start": 5550.4,
        "duration": 4.08,
        "text": "event reader wants to rate from a"
      },
      {
        "start": 5552.08,
        "duration": 3.84,
        "text": "different hotel let's say 82 or"
      },
      {
        "start": 5554.48,
        "duration": 2.96,
        "text": "something like that now let me also"
      },
      {
        "start": 5555.92,
        "duration": 4.08,
        "text": "collapse my little panels over here"
      },
      {
        "start": 5557.44,
        "duration": 4.64,
        "text": "because my text is big and my screen is"
      },
      {
        "start": 5560.0,
        "duration": 4.4,
        "text": "small and now we're ready to run this"
      },
      {
        "start": 5562.08,
        "duration": 3.92,
        "text": "hotel event reader which will be in a"
      },
      {
        "start": 5564.4,
        "duration": 4.4,
        "text": "waiting state because there are no"
      },
      {
        "start": 5566.0,
        "duration": 5.76,
        "text": "events for hotel 82 at this point so"
      },
      {
        "start": 5568.8,
        "duration": 5.439,
        "text": "notice that the application is waiting"
      },
      {
        "start": 5571.76,
        "duration": 4.64,
        "text": "and at the same time i'm going to start"
      },
      {
        "start": 5574.239,
        "duration": 4.721,
        "text": "the reservation generator which will"
      },
      {
        "start": 5576.4,
        "duration": 5.279,
        "text": "create a lot of events so let's try this"
      },
      {
        "start": 5578.96,
        "duration": 3.679,
        "text": "out and the hotel event reader should"
      },
      {
        "start": 5581.679,
        "duration": 3.281,
        "text": "start"
      },
      {
        "start": 5582.639,
        "duration": 4.08,
        "text": "monitoring some events so notice that we"
      },
      {
        "start": 5584.96,
        "duration": 4.48,
        "text": "have making reservation"
      },
      {
        "start": 5586.719,
        "duration": 5.121,
        "text": "and maybe cancelling reservation and so"
      },
      {
        "start": 5589.44,
        "duration": 4.799,
        "text": "on and so forth so we have quite a bunch"
      },
      {
        "start": 5591.84,
        "duration": 5.28,
        "text": "of events happening here on our"
      },
      {
        "start": 5594.239,
        "duration": 4.881,
        "text": "cloud-based cassandra and just to test"
      },
      {
        "start": 5597.12,
        "duration": 3.84,
        "text": "whether these reservations were made in"
      },
      {
        "start": 5599.12,
        "duration": 4.079,
        "text": "astrodb i'm going to pick a random"
      },
      {
        "start": 5600.96,
        "duration": 4.239,
        "text": "reservation maybe this one i'm going to"
      },
      {
        "start": 5603.199,
        "duration": 5.121,
        "text": "take its confirmation number and i'm"
      },
      {
        "start": 5605.199,
        "duration": 4.881,
        "text": "going to go back to my cql shell and i'm"
      },
      {
        "start": 5608.32,
        "duration": 4.56,
        "text": "going to select something from that"
      },
      {
        "start": 5610.08,
        "duration": 3.84,
        "text": "table so i'm going to select"
      },
      {
        "start": 5612.88,
        "duration": 2.0,
        "text": "star"
      },
      {
        "start": 5613.92,
        "duration": 4.08,
        "text": "from"
      },
      {
        "start": 5614.88,
        "duration": 5.6,
        "text": "and the table is reservation dot and we"
      },
      {
        "start": 5618.0,
        "duration": 5.6,
        "text": "have reservation by guest"
      },
      {
        "start": 5620.48,
        "duration": 4.64,
        "text": "and uh i'm gonna select star where and"
      },
      {
        "start": 5623.6,
        "duration": 4.0,
        "text": "i'm gonna have"
      },
      {
        "start": 5625.12,
        "duration": 4.24,
        "text": "if i remember correctly from the table"
      },
      {
        "start": 5627.6,
        "duration": 4.639,
        "text": "setup the"
      },
      {
        "start": 5629.36,
        "duration": 4.56,
        "text": "table for reservation by guest had the"
      },
      {
        "start": 5632.239,
        "duration": 3.281,
        "text": "primary key guest last name and"
      },
      {
        "start": 5633.92,
        "duration": 3.12,
        "text": "confirmation number the confirmation"
      },
      {
        "start": 5635.52,
        "duration": 4.719,
        "text": "number i already have the guest last"
      },
      {
        "start": 5637.04,
        "duration": 4.159,
        "text": "name is always rock the jvm so the guest"
      },
      {
        "start": 5640.239,
        "duration": 2.321,
        "text": "last"
      },
      {
        "start": 5641.199,
        "duration": 5.761,
        "text": "name is"
      },
      {
        "start": 5642.56,
        "duration": 6.56,
        "text": "rock the jvm in all caps and confirm"
      },
      {
        "start": 5646.96,
        "duration": 4.719,
        "text": "underscore number is"
      },
      {
        "start": 5649.12,
        "duration": 5.039,
        "text": "this little fellow in between quotes"
      },
      {
        "start": 5651.679,
        "duration": 5.201,
        "text": "semicolons let's see what we have"
      },
      {
        "start": 5654.159,
        "duration": 5.04,
        "text": "all right this is awesome so we have an"
      },
      {
        "start": 5656.88,
        "duration": 5.68,
        "text": "entry here for the confirmation number"
      },
      {
        "start": 5659.199,
        "duration": 7.52,
        "text": "whatever for the room number 37 between"
      },
      {
        "start": 5662.56,
        "duration": 7.28,
        "text": "the 19th of november 2023 and the 22nd"
      },
      {
        "start": 5666.719,
        "duration": 6.161,
        "text": "of november 2023 which matches the"
      },
      {
        "start": 5669.84,
        "duration": 7.12,
        "text": "details in this reservation so from 19"
      },
      {
        "start": 5672.88,
        "duration": 7.12,
        "text": "11 and 22 11 for room number 37 so our"
      },
      {
        "start": 5676.96,
        "duration": 6.32,
        "text": "reservations stored correctly in our"
      },
      {
        "start": 5680.0,
        "duration": 6.4,
        "text": "astrodb cloud-based database"
      },
      {
        "start": 5683.28,
        "duration": 5.52,
        "text": "all right folks so this was one massive"
      },
      {
        "start": 5686.4,
        "duration": 5.04,
        "text": "journey start to finish with a real-life"
      },
      {
        "start": 5688.8,
        "duration": 5.52,
        "text": "cqrs application written in scala with"
      },
      {
        "start": 5691.44,
        "duration": 5.04,
        "text": "aqua persistence and datastax's official"
      },
      {
        "start": 5694.32,
        "duration": 3.68,
        "text": "astrodb database i hope you enjoyed it"
      },
      {
        "start": 5696.48,
        "duration": 3.679,
        "text": "in which case i recommend you take a"
      },
      {
        "start": 5698.0,
        "duration": 4.48,
        "text": "look at rock the jvm i have literally"
      },
      {
        "start": 5700.159,
        "duration": 4.241,
        "text": "hundreds of hours of in-depth lessons"
      },
      {
        "start": 5702.48,
        "duration": 4.32,
        "text": "like this so check me out on youtube"
      },
      {
        "start": 5704.4,
        "duration": 6.64,
        "text": "twitter and linkedin rock the jvm and"
      },
      {
        "start": 5706.8,
        "duration": 6.319,
        "text": "until next time i'm daniel signing off"
      },
      {
        "start": 5711.04,
        "duration": 4.24,
        "text": "and as always don't forget to click that"
      },
      {
        "start": 5713.119,
        "duration": 4.321,
        "text": "subscribe button and ring that bell to"
      },
      {
        "start": 5715.28,
        "duration": 5.64,
        "text": "get notifications for all of our future"
      },
      {
        "start": 5717.44,
        "duration": 3.48,
        "text": "upcoming workshops"
      }
    ],
    "error": null,
    "error_type": null
  },
  "collected_at": "2025-12-15T18:49:14.028852+00:00"
}