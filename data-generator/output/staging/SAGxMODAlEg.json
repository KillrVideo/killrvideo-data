{
  "video_id": "SAGxMODAlEg",
  "title": "DS201.09 Vnodes | Foundations of Apache Cassandra",
  "description": "#DataStaxAcademy #DS201\nDS201.09 VNODES\nVnodes help keep a cluster balanced as new Apache Cassandra nodes are introduced to the cluster and old nodes are decommissoned, and also automate token range assignment. With vnodes, each node is responsible for several smaller slices of the ring, instead of just one large slice. In this unit, we discuss the advantages of using vnodes.\n\nLEARN FOR FREE at https://academy.datastax.com -- access all the FREE complete courses, tutorials, and hands-on exercises.\n\nASK QUESTIONS at https://community.datastax.com -- where experts from DataStax & the Apache Cassandra community share their expertise everyday.",
  "published_at": "2020-08-06T04:01:46Z",
  "thumbnail": "https://i.ytimg.com/vi/SAGxMODAlEg/maxresdefault.jpg",
  "channel_title": "DataStax Developers",
  "channel_id": "UCAIQY251avaMv7bBv5PCo-A",
  "tags": [
    "cassandra",
    "datastax",
    "tutorial",
    "apache_cassandra"
  ],
  "url": "https://www.youtube.com/watch?v=SAGxMODAlEg",
  "transcript": {
    "available": true,
    "language": "English (auto-generated)",
    "language_code": "en",
    "is_generated": true,
    "text": "[Music] hi i'm jeff carpenter and we're going to talk about virtual nodes or v-nodes in a perfect world we would not have to decommission or recommission nodes but we're not in a perfect world and adding or removing nodes from a cluster is something that happens that said with normal token range assignments you must ensure that your token assignments are evenly spread adding or removing nodes to your cluster can also make the system unbalanced for a time and it requires nodes with existing data to stream the data to the new nodes for example here's an unbalanced cluster notice the yellow node owns half of the token range here we see smaller circles that represent the partitions a good partitioner will spread the partition token assignments evenly across the cluster but we see in this case the yellow node has double the number of partitions as the other two nodes let's say we decide to add a new node to this cluster ideally our new node will split the yellow node's token range assignment in half as you see in this animation this new node does just that half the partitions in the yellow node now fall into this light blue token range and thus apache cassandra must now move them to the new node the yellow node streams the pertinent replicas to the new node unfortunately this puts strain on the yellow node apache cassandra's v-node feature helps mitigate this problem by having each physical node act more like several smaller virtual nodes let's examine how this works when we add a node to an existing cluster with v nodes each node is now responsible for several smaller slices of the ring instead of just one large slice with a consistent hash all three nodes have roughly the same amount of data that's because each node's smaller portions of the ring add up to 1 3 of the ring instead of the half plus 2 1 4 sections that we saw on the previous slide the token assignments again change however instead of the new node simply taking over one node's entire token range the new node takes over several smaller ranges from each of the other nodes our partition colors for the blue node change to blue themselves now every node has some data that it must stream to the new node each node streams its data in parallel with the other nodes this makes bootstrapping a new node into the cluster take much less time and it takes the burden of doing this streaming off of any single node v nodes help keep the cluster balanced as new nodes are introduced to it and old nodes are decommissioned the default value for the number of v nodes is 128. v nodes are also great as they automate token assignment instead of the administrator having to manually distribute the ranges you can configure the number of v nodes by changing the num tokens value in the cassandra.yaml file and as long as this value is greater than one you're using v-nodes now let's test out your knowledge of v-nodes with an exercise",
    "segments": [
      {
        "start": 1.43,
        "duration": 5.449,
        "text": "[Music]"
      },
      {
        "start": 6.56,
        "duration": 1.92,
        "text": "hi"
      },
      {
        "start": 6.879,
        "duration": 3.361,
        "text": "i'm jeff carpenter and we're going to"
      },
      {
        "start": 8.48,
        "duration": 5.039,
        "text": "talk about virtual nodes"
      },
      {
        "start": 10.24,
        "duration": 4.08,
        "text": "or v-nodes in a perfect world we would"
      },
      {
        "start": 13.519,
        "duration": 4.001,
        "text": "not have to"
      },
      {
        "start": 14.32,
        "duration": 5.68,
        "text": "decommission or recommission nodes but"
      },
      {
        "start": 17.52,
        "duration": 4.24,
        "text": "we're not in a perfect world and adding"
      },
      {
        "start": 20.0,
        "duration": 4.24,
        "text": "or removing nodes from a cluster"
      },
      {
        "start": 21.76,
        "duration": 4.4,
        "text": "is something that happens that said with"
      },
      {
        "start": 24.24,
        "duration": 3.84,
        "text": "normal token range assignments"
      },
      {
        "start": 26.16,
        "duration": 3.84,
        "text": "you must ensure that your token"
      },
      {
        "start": 28.08,
        "duration": 4.08,
        "text": "assignments are evenly spread"
      },
      {
        "start": 30.0,
        "duration": 3.04,
        "text": "adding or removing nodes to your cluster"
      },
      {
        "start": 32.16,
        "duration": 3.36,
        "text": "can also"
      },
      {
        "start": 33.04,
        "duration": 4.88,
        "text": "make the system unbalanced for a time"
      },
      {
        "start": 35.52,
        "duration": 5.68,
        "text": "and it requires nodes with existing data"
      },
      {
        "start": 37.92,
        "duration": 7.119,
        "text": "to stream the data to the new nodes"
      },
      {
        "start": 41.2,
        "duration": 5.92,
        "text": "for example here's an unbalanced cluster"
      },
      {
        "start": 45.039,
        "duration": 3.121,
        "text": "notice the yellow node owns half of the"
      },
      {
        "start": 47.12,
        "duration": 3.119,
        "text": "token range"
      },
      {
        "start": 48.16,
        "duration": 3.68,
        "text": "here we see smaller circles that"
      },
      {
        "start": 50.239,
        "duration": 3.761,
        "text": "represent the partitions"
      },
      {
        "start": 51.84,
        "duration": 3.84,
        "text": "a good partitioner will spread the"
      },
      {
        "start": 54.0,
        "duration": 4.239,
        "text": "partition token assignments"
      },
      {
        "start": 55.68,
        "duration": 3.359,
        "text": "evenly across the cluster but we see in"
      },
      {
        "start": 58.239,
        "duration": 3.441,
        "text": "this case"
      },
      {
        "start": 59.039,
        "duration": 5.361,
        "text": "the yellow node has double the number of"
      },
      {
        "start": 61.68,
        "duration": 4.88,
        "text": "partitions as the other two nodes"
      },
      {
        "start": 64.4,
        "duration": 3.28,
        "text": "let's say we decide to add a new node to"
      },
      {
        "start": 66.56,
        "duration": 3.68,
        "text": "this cluster"
      },
      {
        "start": 67.68,
        "duration": 4.72,
        "text": "ideally our new node will split the"
      },
      {
        "start": 70.24,
        "duration": 5.04,
        "text": "yellow node's token range assignment"
      },
      {
        "start": 72.4,
        "duration": 4.079,
        "text": "in half as you see in this animation"
      },
      {
        "start": 75.28,
        "duration": 3.839,
        "text": "this new node"
      },
      {
        "start": 76.479,
        "duration": 3.761,
        "text": "does just that half the partitions in"
      },
      {
        "start": 79.119,
        "duration": 3.601,
        "text": "the yellow node"
      },
      {
        "start": 80.24,
        "duration": 3.199,
        "text": "now fall into this light blue token"
      },
      {
        "start": 82.72,
        "duration": 3.84,
        "text": "range"
      },
      {
        "start": 83.439,
        "duration": 4.481,
        "text": "and thus apache cassandra must now move"
      },
      {
        "start": 86.56,
        "duration": 3.28,
        "text": "them to the new node"
      },
      {
        "start": 87.92,
        "duration": 4.32,
        "text": "the yellow node streams the pertinent"
      },
      {
        "start": 89.84,
        "duration": 4.959,
        "text": "replicas to the new node"
      },
      {
        "start": 92.24,
        "duration": 3.6,
        "text": "unfortunately this puts strain on the"
      },
      {
        "start": 94.799,
        "duration": 3.761,
        "text": "yellow node"
      },
      {
        "start": 95.84,
        "duration": 4.4,
        "text": "apache cassandra's v-node feature helps"
      },
      {
        "start": 98.56,
        "duration": 4.96,
        "text": "mitigate this problem by having"
      },
      {
        "start": 100.24,
        "duration": 5.519,
        "text": "each physical node act more like several"
      },
      {
        "start": 103.52,
        "duration": 4.239,
        "text": "smaller virtual nodes"
      },
      {
        "start": 105.759,
        "duration": 4.961,
        "text": "let's examine how this works when we add"
      },
      {
        "start": 107.759,
        "duration": 5.121,
        "text": "a node to an existing cluster"
      },
      {
        "start": 110.72,
        "duration": 3.439,
        "text": "with v nodes each node is now"
      },
      {
        "start": 112.88,
        "duration": 3.919,
        "text": "responsible for"
      },
      {
        "start": 114.159,
        "duration": 3.441,
        "text": "several smaller slices of the ring"
      },
      {
        "start": 116.799,
        "duration": 4.081,
        "text": "instead of just"
      },
      {
        "start": 117.6,
        "duration": 5.199,
        "text": "one large slice with a consistent hash"
      },
      {
        "start": 120.88,
        "duration": 3.199,
        "text": "all three nodes have roughly the same"
      },
      {
        "start": 122.799,
        "duration": 3.761,
        "text": "amount of data"
      },
      {
        "start": 124.079,
        "duration": 4.721,
        "text": "that's because each node's smaller"
      },
      {
        "start": 126.56,
        "duration": 5.679,
        "text": "portions of the ring add up to"
      },
      {
        "start": 128.8,
        "duration": 6.079,
        "text": "1 3 of the ring instead of the half plus"
      },
      {
        "start": 132.239,
        "duration": 4.241,
        "text": "2 1 4 sections that we saw on the"
      },
      {
        "start": 134.879,
        "duration": 3.841,
        "text": "previous slide"
      },
      {
        "start": 136.48,
        "duration": 3.28,
        "text": "the token assignments again change"
      },
      {
        "start": 138.72,
        "duration": 3.44,
        "text": "however"
      },
      {
        "start": 139.76,
        "duration": 5.119,
        "text": "instead of the new node simply taking"
      },
      {
        "start": 142.16,
        "duration": 5.52,
        "text": "over one node's entire token range"
      },
      {
        "start": 144.879,
        "duration": 5.121,
        "text": "the new node takes over several smaller"
      },
      {
        "start": 147.68,
        "duration": 4.8,
        "text": "ranges from each of the other nodes"
      },
      {
        "start": 150.0,
        "duration": 3.36,
        "text": "our partition colors for the blue node"
      },
      {
        "start": 152.48,
        "duration": 4.08,
        "text": "change to blue"
      },
      {
        "start": 153.36,
        "duration": 5.28,
        "text": "themselves now every node has some data"
      },
      {
        "start": 156.56,
        "duration": 4.64,
        "text": "that it must stream to the new node"
      },
      {
        "start": 158.64,
        "duration": 3.92,
        "text": "each node streams its data in parallel"
      },
      {
        "start": 161.2,
        "duration": 3.92,
        "text": "with the other nodes"
      },
      {
        "start": 162.56,
        "duration": 3.6,
        "text": "this makes bootstrapping a new node into"
      },
      {
        "start": 165.12,
        "duration": 3.839,
        "text": "the cluster"
      },
      {
        "start": 166.16,
        "duration": 3.84,
        "text": "take much less time and it takes the"
      },
      {
        "start": 168.959,
        "duration": 4.401,
        "text": "burden of doing this"
      },
      {
        "start": 170.0,
        "duration": 5.519,
        "text": "streaming off of any single node v nodes"
      },
      {
        "start": 173.36,
        "duration": 3.599,
        "text": "help keep the cluster balanced as new"
      },
      {
        "start": 175.519,
        "duration": 4.0,
        "text": "nodes are introduced to it"
      },
      {
        "start": 176.959,
        "duration": 3.601,
        "text": "and old nodes are decommissioned the"
      },
      {
        "start": 179.519,
        "duration": 4.161,
        "text": "default value"
      },
      {
        "start": 180.56,
        "duration": 6.08,
        "text": "for the number of v nodes is 128."
      },
      {
        "start": 183.68,
        "duration": 4.4,
        "text": "v nodes are also great as they automate"
      },
      {
        "start": 186.64,
        "duration": 3.599,
        "text": "token assignment"
      },
      {
        "start": 188.08,
        "duration": 4.4,
        "text": "instead of the administrator having to"
      },
      {
        "start": 190.239,
        "duration": 4.64,
        "text": "manually distribute the ranges"
      },
      {
        "start": 192.48,
        "duration": 3.44,
        "text": "you can configure the number of v nodes"
      },
      {
        "start": 194.879,
        "duration": 4.08,
        "text": "by changing the"
      },
      {
        "start": 195.92,
        "duration": 3.679,
        "text": "num tokens value in the cassandra.yaml"
      },
      {
        "start": 198.959,
        "duration": 2.481,
        "text": "file"
      },
      {
        "start": 199.599,
        "duration": 3.041,
        "text": "and as long as this value is greater"
      },
      {
        "start": 201.44,
        "duration": 4.32,
        "text": "than one"
      },
      {
        "start": 202.64,
        "duration": 4.959,
        "text": "you're using v-nodes now"
      },
      {
        "start": 205.76,
        "duration": 8.08,
        "text": "let's test out your knowledge of v-nodes"
      },
      {
        "start": 207.599,
        "duration": 6.241,
        "text": "with an exercise"
      }
    ],
    "error": null,
    "error_type": null
  },
  "collected_at": "2025-12-16T02:03:43.999850+00:00"
}