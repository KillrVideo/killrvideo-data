{
  "video_id": "ezyJ6FSAiDg",
  "title": "Upgrading Apache Cassandra with Kubernetes",
  "description": "Deploying configuration changes and managing upgrades on a database can be tricky. Check out how easy it is with Apache Cassandra on Kubernetes. Applications stay online with zero downtime while updates are deployed and versions are rotated.\n\nStay in the loop on all things K8ssandra at:\nK8ssandra - https://k8ssandra.io/\nTwitter - https://twitter.com/k8ssandra\nGitHub - https://github.com/k8ssandra\n\nCONNECT WITH DATASTAX\nSubscribe: http://www.youtube.com/c/datastaxdevs?sub_confirmation=1 \nTwitter: https://twitter.com/datastaxdevs\nTwitch: https://www.twitch.tv/datastaxdevs\n\nAbout DataStax:\nDataStax is the company behind the massively scalable, highly available, cloud-native NoSQL data platform built on Apache Cassandra™. DataStax gives developers and enterprises the freedom to run data in any cloud, Kubernetes, hybrid or bare metal at global scale with zero downtime and zero lock-in. More than 450 of the world’s leading enterprises including Capital One, Cisco, Comcast, Delta Airlines, Macy’s, McDonald’s, Safeway, Sony, and Walmart use DataStax to build transformational data architectures for real-world outcomes. For more, visit DataStax.com and @DataStax.\n\nAbout DataStax Developer:\nOn the DataStax Developers YouTube channel, you can find tutorials, workshops and much more to help you learn and stay updated with the latest information on Apache Cassandra©.  Visit https://datastax.com/dev for more free learning resources.",
  "published_at": "2021-10-25T21:38:10Z",
  "thumbnail": "https://i.ytimg.com/vi/ezyJ6FSAiDg/maxresdefault.jpg",
  "channel_title": "DataStax Developers",
  "channel_id": "UCAIQY251avaMv7bBv5PCo-A",
  "tags": [
    "scalable",
    "workshop",
    "cassandra",
    "database",
    "apache_cassandra",
    "tutorial",
    "nosql",
    "architecture",
    "datastax"
  ],
  "url": "https://www.youtube.com/watch?v=ezyJ6FSAiDg",
  "transcript": {
    "available": true,
    "language": "English (auto-generated)",
    "language_code": "en",
    "is_generated": true,
    "text": "hello and welcome to the kate sandra upgrade demo in this demo we're going to cover how a kate sander cluster manages upgrading the underlying cassandra version in a safe and automated manner to get started let's review our environment here we already have a kate sander cluster running it's composed of three apache cassandra nodes each running version 3.11.10 these nodes are also running on separate cloud managed kubernetes workers one node per az and a regional deployment our target state for this cluster is to be running apache cassandra 4.0 with the same topology one node per rack and to kick off this process we're going to take a look at the helm values used to initially deploy this cluster so over here we see our version is 3.11.10 and we want it to be 4.0.0 so we'll just update this field 1.0.0 save it and we will run the command to push this into our cluster when we do the helm upgrade command it's going to handle the templating of the kubernetes resources and submitting those to the kubernetes api we could edit this uh these resources by hand either through this ide here or on our disk but ultimately there's a cas dc or cassandra data center resource that's going to be updated to reflect the new version number the cads operator monitors the cavs dc objects and it's going to set that new version to 4.0.0 with the the change in version it updates the stable sets and specifically the template for the staple set and then forces the recreation of the pods based off of that template it's going to do that in a rolling manner make sure that the nodes come back up before moving on to the next node in the cluster so you aren't left in a state where your data is unavailable so it looks like we had a pod restart it's that might not be related to the upgrade let's see so we scroll down here it is related to the upgrade so here we see version 4.0.0 our init container has already run and now we've started the management api and we're kicking off the bootstrap process so if we go here to server system logger we can monitor and watch when that happens there we go now what's going to happen here is it's going to reach out to the seed service which is a kubernetes service and that's going to help it discover the other nodes within this cluster it's then going to reach out to those nodes and inquire about their uh their status as well as what their view of the cluster looks like and discover all the other nodes um here we're going to see some messages about connections reset by here that's nothing to worry about there but we just have to wait for the node to finish its upgrade and then the next node will take its place one of the nice things about cassandra is the fact that your data is replicated across multiple nodes in this case we're also replicated across azs so should a node go down whether that be for maintenance purposes or otherwise your data still stays available as multiple replicas are still online now when this node finishes its upgrade process it's going to receive hints from the other nodes for queries that were received and processed while it was down and unavailable we can see it's still bootstrapping it's figuring out where the token values were that it previously owned on disk repopulating in-memory structures and we'll see it finish bootstrapping here just in a moment it's also interesting to check the stateful sets because we can see rack1 and we look at the template spec we can check the version there's 4.0 but if we look at rack 2 check its version it's still 3.11.10. so it's going to make these changes in a rolling fashion while you let that run if you are curious to check out our other demos i just want to say thank you for attending this demo be sure to check out all of our other demos and join us at katesander.io",
    "segments": [
      {
        "start": 0.08,
        "duration": 4.32,
        "text": "hello and welcome to the kate sandra"
      },
      {
        "start": 2.08,
        "duration": 4.239,
        "text": "upgrade demo in this demo we're going to"
      },
      {
        "start": 4.4,
        "duration": 3.359,
        "text": "cover how a kate sander cluster manages"
      },
      {
        "start": 6.319,
        "duration": 3.521,
        "text": "upgrading the underlying cassandra"
      },
      {
        "start": 7.759,
        "duration": 3.521,
        "text": "version in a safe and automated manner"
      },
      {
        "start": 9.84,
        "duration": 2.959,
        "text": "to get started let's review our"
      },
      {
        "start": 11.28,
        "duration": 3.68,
        "text": "environment here we already have a kate"
      },
      {
        "start": 12.799,
        "duration": 4.001,
        "text": "sander cluster running it's composed of"
      },
      {
        "start": 14.96,
        "duration": 4.56,
        "text": "three apache cassandra nodes each"
      },
      {
        "start": 16.8,
        "duration": 4.88,
        "text": "running version 3.11.10"
      },
      {
        "start": 19.52,
        "duration": 4.16,
        "text": "these nodes are also running on separate"
      },
      {
        "start": 21.68,
        "duration": 4.16,
        "text": "cloud managed kubernetes workers one"
      },
      {
        "start": 23.68,
        "duration": 3.599,
        "text": "node per az and a regional deployment"
      },
      {
        "start": 25.84,
        "duration": 4.08,
        "text": "our target state for this cluster is to"
      },
      {
        "start": 27.279,
        "duration": 4.96,
        "text": "be running apache cassandra 4.0 with the"
      },
      {
        "start": 29.92,
        "duration": 3.84,
        "text": "same topology one node per rack and to"
      },
      {
        "start": 32.239,
        "duration": 3.521,
        "text": "kick off this process we're going to"
      },
      {
        "start": 33.76,
        "duration": 4.08,
        "text": "take a look at the helm values used to"
      },
      {
        "start": 35.76,
        "duration": 5.28,
        "text": "initially deploy this cluster so over"
      },
      {
        "start": 37.84,
        "duration": 5.76,
        "text": "here we see our version is 3.11.10 and"
      },
      {
        "start": 41.04,
        "duration": 6.08,
        "text": "we want it to be 4.0.0 so we'll just"
      },
      {
        "start": 43.6,
        "duration": 5.2,
        "text": "update this field 1.0.0 save it and we"
      },
      {
        "start": 47.12,
        "duration": 3.68,
        "text": "will run the command to push this into"
      },
      {
        "start": 48.8,
        "duration": 3.2,
        "text": "our cluster when we do the helm upgrade"
      },
      {
        "start": 50.8,
        "duration": 3.439,
        "text": "command it's going to handle the"
      },
      {
        "start": 52.0,
        "duration": 3.6,
        "text": "templating of the kubernetes resources"
      },
      {
        "start": 54.239,
        "duration": 4.241,
        "text": "and submitting those to the kubernetes"
      },
      {
        "start": 55.6,
        "duration": 4.56,
        "text": "api we could edit this uh these"
      },
      {
        "start": 58.48,
        "duration": 3.759,
        "text": "resources by hand either through this"
      },
      {
        "start": 60.16,
        "duration": 3.44,
        "text": "ide here or on our disk"
      },
      {
        "start": 62.239,
        "duration": 3.041,
        "text": "but ultimately"
      },
      {
        "start": 63.6,
        "duration": 2.96,
        "text": "there's a cas dc or cassandra data"
      },
      {
        "start": 65.28,
        "duration": 3.28,
        "text": "center resource that's going to be"
      },
      {
        "start": 66.56,
        "duration": 3.36,
        "text": "updated to reflect the new version"
      },
      {
        "start": 68.56,
        "duration": 4.0,
        "text": "number"
      },
      {
        "start": 69.92,
        "duration": 4.559,
        "text": "the cads operator monitors the cavs dc"
      },
      {
        "start": 72.56,
        "duration": 2.879,
        "text": "objects and it's going to set that new"
      },
      {
        "start": 74.479,
        "duration": 3.841,
        "text": "version"
      },
      {
        "start": 75.439,
        "duration": 4.961,
        "text": "to 4.0.0 with the the change in version"
      },
      {
        "start": 78.32,
        "duration": 3.439,
        "text": "it updates the stable sets and"
      },
      {
        "start": 80.4,
        "duration": 4.399,
        "text": "specifically the template for the staple"
      },
      {
        "start": 81.759,
        "duration": 6.0,
        "text": "set and then forces the recreation of"
      },
      {
        "start": 84.799,
        "duration": 4.081,
        "text": "the pods based off of that template"
      },
      {
        "start": 87.759,
        "duration": 2.4,
        "text": "it's going to do that in a rolling"
      },
      {
        "start": 88.88,
        "duration": 2.64,
        "text": "manner make sure that the nodes come"
      },
      {
        "start": 90.159,
        "duration": 2.64,
        "text": "back up before moving on to the next"
      },
      {
        "start": 91.52,
        "duration": 2.4,
        "text": "node in the cluster so you aren't left"
      },
      {
        "start": 92.799,
        "duration": 3.121,
        "text": "in a state where your data is"
      },
      {
        "start": 93.92,
        "duration": 4.559,
        "text": "unavailable so it looks like we had a"
      },
      {
        "start": 95.92,
        "duration": 4.8,
        "text": "pod restart it's that might not be"
      },
      {
        "start": 98.479,
        "duration": 4.401,
        "text": "related to the upgrade let's see"
      },
      {
        "start": 100.72,
        "duration": 5.12,
        "text": "so we scroll down here it is related to"
      },
      {
        "start": 102.88,
        "duration": 5.04,
        "text": "the upgrade so here we see version 4.0.0"
      },
      {
        "start": 105.84,
        "duration": 3.76,
        "text": "our init container has already run and"
      },
      {
        "start": 107.92,
        "duration": 3.28,
        "text": "now we've started the management api and"
      },
      {
        "start": 109.6,
        "duration": 3.76,
        "text": "we're kicking off the bootstrap process"
      },
      {
        "start": 111.2,
        "duration": 3.76,
        "text": "so if we go here to server system logger"
      },
      {
        "start": 113.36,
        "duration": 2.48,
        "text": "we can monitor and watch when that"
      },
      {
        "start": 114.96,
        "duration": 3.36,
        "text": "happens"
      },
      {
        "start": 115.84,
        "duration": 2.48,
        "text": "there we go"
      },
      {
        "start": 118.56,
        "duration": 2.8,
        "text": "now what's going to happen here is it's"
      },
      {
        "start": 120.0,
        "duration": 3.2,
        "text": "going to reach out to the seed service"
      },
      {
        "start": 121.36,
        "duration": 3.52,
        "text": "which is a kubernetes service"
      },
      {
        "start": 123.2,
        "duration": 4.08,
        "text": "and that's going to help it discover the"
      },
      {
        "start": 124.88,
        "duration": 5.519,
        "text": "other nodes within this cluster it's"
      },
      {
        "start": 127.28,
        "duration": 4.88,
        "text": "then going to reach out to those nodes"
      },
      {
        "start": 130.399,
        "duration": 3.84,
        "text": "and inquire about their"
      },
      {
        "start": 132.16,
        "duration": 3.28,
        "text": "uh their status as well as what their"
      },
      {
        "start": 134.239,
        "duration": 3.36,
        "text": "view of the cluster looks like and"
      },
      {
        "start": 135.44,
        "duration": 3.68,
        "text": "discover all the other nodes"
      },
      {
        "start": 137.599,
        "duration": 4.241,
        "text": "um here we're going to see some messages"
      },
      {
        "start": 139.12,
        "duration": 4.479,
        "text": "about connections reset by here that's"
      },
      {
        "start": 141.84,
        "duration": 4.16,
        "text": "nothing to worry about there"
      },
      {
        "start": 143.599,
        "duration": 4.401,
        "text": "but we just have to wait for the node to"
      },
      {
        "start": 146.0,
        "duration": 3.36,
        "text": "finish its upgrade"
      },
      {
        "start": 148.0,
        "duration": 2.4,
        "text": "and then the next node will take its"
      },
      {
        "start": 149.36,
        "duration": 2.48,
        "text": "place"
      },
      {
        "start": 150.4,
        "duration": 2.88,
        "text": "one of the nice things about cassandra"
      },
      {
        "start": 151.84,
        "duration": 3.28,
        "text": "is the fact that your data is replicated"
      },
      {
        "start": 153.28,
        "duration": 4.08,
        "text": "across multiple nodes in this case we're"
      },
      {
        "start": 155.12,
        "duration": 3.839,
        "text": "also replicated across azs"
      },
      {
        "start": 157.36,
        "duration": 3.76,
        "text": "so should a node go down whether that be"
      },
      {
        "start": 158.959,
        "duration": 3.841,
        "text": "for maintenance purposes or otherwise"
      },
      {
        "start": 161.12,
        "duration": 3.44,
        "text": "your data still stays available as"
      },
      {
        "start": 162.8,
        "duration": 3.04,
        "text": "multiple replicas are still"
      },
      {
        "start": 164.56,
        "duration": 3.759,
        "text": "online"
      },
      {
        "start": 165.84,
        "duration": 4.479,
        "text": "now when this node finishes its upgrade"
      },
      {
        "start": 168.319,
        "duration": 3.761,
        "text": "process it's going to receive hints from"
      },
      {
        "start": 170.319,
        "duration": 3.521,
        "text": "the other nodes"
      },
      {
        "start": 172.08,
        "duration": 3.12,
        "text": "for queries that were received and"
      },
      {
        "start": 173.84,
        "duration": 3.2,
        "text": "processed while it was down and"
      },
      {
        "start": 175.2,
        "duration": 4.56,
        "text": "unavailable we can see it's still"
      },
      {
        "start": 177.04,
        "duration": 4.32,
        "text": "bootstrapping it's figuring out where"
      },
      {
        "start": 179.76,
        "duration": 3.839,
        "text": "the token values were that it previously"
      },
      {
        "start": 181.36,
        "duration": 3.519,
        "text": "owned on disk repopulating in-memory"
      },
      {
        "start": 183.599,
        "duration": 2.72,
        "text": "structures"
      },
      {
        "start": 184.879,
        "duration": 3.28,
        "text": "and we'll see it finish bootstrapping"
      },
      {
        "start": 186.319,
        "duration": 3.2,
        "text": "here just in a moment"
      },
      {
        "start": 188.159,
        "duration": 3.761,
        "text": "it's also interesting to check the"
      },
      {
        "start": 189.519,
        "duration": 4.401,
        "text": "stateful sets because we can see rack1"
      },
      {
        "start": 191.92,
        "duration": 4.64,
        "text": "and we look at the"
      },
      {
        "start": 193.92,
        "duration": 5.2,
        "text": "template spec we can check the version"
      },
      {
        "start": 196.56,
        "duration": 5.44,
        "text": "there's 4.0 but if we look at rack 2"
      },
      {
        "start": 199.12,
        "duration": 3.92,
        "text": "check its version it's still 3.11.10. so"
      },
      {
        "start": 202.0,
        "duration": 3.44,
        "text": "it's going to make these changes in a"
      },
      {
        "start": 203.04,
        "duration": 4.24,
        "text": "rolling fashion while you let that run"
      },
      {
        "start": 205.44,
        "duration": 3.2,
        "text": "if you are curious to check out our"
      },
      {
        "start": 207.28,
        "duration": 3.12,
        "text": "other demos i just want to say thank you"
      },
      {
        "start": 208.64,
        "duration": 3.12,
        "text": "for attending this demo be sure to check"
      },
      {
        "start": 210.4,
        "duration": 4.44,
        "text": "out all of our other demos and join us"
      },
      {
        "start": 211.76,
        "duration": 3.08,
        "text": "at katesander.io"
      }
    ],
    "error": null,
    "error_type": null
  },
  "collected_at": "2025-12-15T19:43:38.629491+00:00"
}