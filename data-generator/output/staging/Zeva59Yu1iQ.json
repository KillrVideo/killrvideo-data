{
  "video_id": "Zeva59Yu1iQ",
  "title": "DS210.12 Bootstrapping | Operations with Apache Cassandra",
  "description": "#DataStaxAcademy #DS210\nDS210.12 BOOTSTRAPPING\nIn this unit, you will learn about bootstrapping. Bootstrapping is an operation that is really critical to understand if you are going to be adding another node to your Apache Cassandra cluster.\n\nLEARN FOR FREE at https://academy.datastax.com -- access all the FREE complete courses, tutorials, and hands-on exercises.\n\nASK QUESTIONS at https://community.datastax.com -- where experts from DataStax & the Apache Cassandra community share their expertise everyday.",
  "published_at": "2020-08-11T12:21:20Z",
  "thumbnail": "https://i.ytimg.com/vi/Zeva59Yu1iQ/maxresdefault.jpg",
  "channel_title": "DataStax Developers",
  "channel_id": "UCAIQY251avaMv7bBv5PCo-A",
  "tags": [
    "cassandra",
    "datastax",
    "tutorial",
    "apache_cassandra"
  ],
  "url": "https://www.youtube.com/watch?v=Zeva59Yu1iQ",
  "transcript": {
    "available": true,
    "language": "English (auto-generated)",
    "language_code": "en",
    "is_generated": true,
    "text": "[Music] let's talk about bootstrapping a node this is the operation that is really critical for you to understand if you're adding capacity to your system so bootstrapping is what we call adding capacity adding a node to the system how does it work this is one of my favorite features of cassandra because back in the day when i ran relational systems if i needed to do any upgrades it meant downtime bootstrapping doesn't mean any downtime and that is magical bootstrapping is a new node joining the cluster how does it work kind of cool actually because it's a very orderly process and it's one that you can watch in the logs if you wanted to so a joining node contacts that seed node this is the first part of this so when it connects it says hey world i want to know what's going on in your configuration file when you put in seed nodes what you're doing is you're telling that node where to find running information about the cluster so when it starts up it connects to the cluster says hey this is me how are you doing cluster the cluster recognizes okay you have the right configuration that's when the real fun starts the cluster starts rearranging itself to make room for this new node the token ranges are now rearranged to fit the new token range for that node and or many nodes if you're using v nodes and then at that point you're just moving data into or out of other nodes this is a operation that happens runtime you do not need to bring down anything to make it happen and it is pretty cool to watch because what you get at the end is a running system that incrementally grows without any downtime so how do we do this bootstrapping a node is pretty simple so what you're doing is you're changing the yaml file the cassandra.yaml file on the node you're going to add to the system in there you're going to point out the seed nodes running nodes inside of the running cluster and give it the cluster name those are the most basic things of course the other configuration values need to be there but the cluster name and the c nodes need to match up with what's running already in the cluster so the yaml file stores things like cluster name native transport address lists and address seeds those are all mandatory for getting the node going but that like i said that seed node is really important because that is where it's at important thing about seed nodes and this is a confusion that happens a lot seed nodes are not masternodes or specially designated or anything like that seed nodes are just running nodes that you happen to designate you could designate any node in the system as a seed node it just has to be running when you start up seed nodes don't even have to have all the same nodes they can all be different so the seed node is not that super special just keep in mind it has to be running something running in the cluster that it can contact when it starts up so what happens when something fails bad things happen it didn't start up not to worry you can recover from this so if it couldn't connect to the cluster that's an easy one because that just means that it didn't start this not starting you can recover from pretty quickly you look at the reason why most likely it has something to do with communication maybe you didn't get the cluster information right something very basic so that's an easy one to troubleshoot look at the logs it'll probably give you a clear indication the harder one to do is whenever it started and it got killed halfway through not good now that means we have this node in sort of a halfway state meaning that it has joined the cluster it is not currently running it is an adjoining state and half of the data is there how do we get past that the first thing to try is just restarting the node and that should usually get it going if it doesn't delete all the data try to restart the node again if that fails you need to start diagnosing what happened in that bootstrap process after you bootstrap a node there's a process called node tool cleanup no tool cleanup is run on every other node in the system so nodetool cleanup's job is to look at all the ss tables on that running node and find out if that data actually pertains to that node now when you bootstrap a new node into the cluster the token ranges are going to change and those token ranges are really important for that node for replication etc well if you start moving token ranges so you add a new node there's going to be some data stored on that local node that is no longer valid for that node nodetool cleanup reads all the ss tables and discards any data that is no longer valid this is a good way to keep your disk space in check and just keep the system healthy and clean so how does this work well it's pretty much a compaction process without the actual compaction it will read the ss table and then write out another ss table in the process but what it's doing is just doing a simple comparison it looks at the partition keys it says is this the partition key that belongs to this node if not throws it out if it is it puts it in the assets table very simple to run nodetool cleanup that is a node tool command very simple you can see some of the commands here you're running cleanup on a key space or a table even most times you're going to run no tool cleanup if you're bootstrapping a new node into the cluster because you now have a lot of information in the system it's all over the place every node is going to need it run it on the entire system hopefully this is good information for you to know when you go to bootstrap a node give it a try it's really not that hard",
    "segments": [
      {
        "start": 1.43,
        "duration": 5.33,
        "text": "[Music]"
      },
      {
        "start": 7.359,
        "duration": 2.961,
        "text": "let's talk about"
      },
      {
        "start": 8.24,
        "duration": 3.12,
        "text": "bootstrapping a node this is the"
      },
      {
        "start": 10.32,
        "duration": 2.8,
        "text": "operation"
      },
      {
        "start": 11.36,
        "duration": 4.08,
        "text": "that is really critical for you to"
      },
      {
        "start": 13.12,
        "duration": 4.56,
        "text": "understand if you're adding capacity"
      },
      {
        "start": 15.44,
        "duration": 3.12,
        "text": "to your system so bootstrapping is what"
      },
      {
        "start": 17.68,
        "duration": 3.04,
        "text": "we call"
      },
      {
        "start": 18.56,
        "duration": 4.08,
        "text": "adding capacity adding a node to the"
      },
      {
        "start": 20.72,
        "duration": 4.559,
        "text": "system how does it work"
      },
      {
        "start": 22.64,
        "duration": 3.52,
        "text": "this is one of my favorite features of"
      },
      {
        "start": 25.279,
        "duration": 2.401,
        "text": "cassandra"
      },
      {
        "start": 26.16,
        "duration": 3.84,
        "text": "because back in the day when i ran"
      },
      {
        "start": 27.68,
        "duration": 5.28,
        "text": "relational systems if i needed to do any"
      },
      {
        "start": 30.0,
        "duration": 4.64,
        "text": "upgrades it meant downtime bootstrapping"
      },
      {
        "start": 32.96,
        "duration": 4.48,
        "text": "doesn't mean any downtime and that"
      },
      {
        "start": 34.64,
        "duration": 3.919,
        "text": "is magical bootstrapping is a new node"
      },
      {
        "start": 37.44,
        "duration": 3.279,
        "text": "joining the cluster"
      },
      {
        "start": 38.559,
        "duration": 4.081,
        "text": "how does it work kind of cool actually"
      },
      {
        "start": 40.719,
        "duration": 3.601,
        "text": "because it's a very orderly process"
      },
      {
        "start": 42.64,
        "duration": 3.12,
        "text": "and it's one that you can watch in the"
      },
      {
        "start": 44.32,
        "duration": 3.919,
        "text": "logs if you wanted to"
      },
      {
        "start": 45.76,
        "duration": 4.16,
        "text": "so a joining node contacts that seed"
      },
      {
        "start": 48.239,
        "duration": 4.32,
        "text": "node this is the first part of this"
      },
      {
        "start": 49.92,
        "duration": 4.56,
        "text": "so when it connects it says hey world i"
      },
      {
        "start": 52.559,
        "duration": 4.081,
        "text": "want to know what's going on"
      },
      {
        "start": 54.48,
        "duration": 3.04,
        "text": "in your configuration file when you put"
      },
      {
        "start": 56.64,
        "duration": 2.239,
        "text": "in seed nodes"
      },
      {
        "start": 57.52,
        "duration": 3.6,
        "text": "what you're doing is you're telling that"
      },
      {
        "start": 58.879,
        "duration": 5.28,
        "text": "node where to find running information"
      },
      {
        "start": 61.12,
        "duration": 5.6,
        "text": "about the cluster so when it starts up"
      },
      {
        "start": 64.159,
        "duration": 3.441,
        "text": "it connects to the cluster says hey this"
      },
      {
        "start": 66.72,
        "duration": 2.719,
        "text": "is me"
      },
      {
        "start": 67.6,
        "duration": 3.24,
        "text": "how are you doing cluster the cluster"
      },
      {
        "start": 69.439,
        "duration": 2.641,
        "text": "recognizes okay you have the right"
      },
      {
        "start": 70.84,
        "duration": 3.24,
        "text": "configuration"
      },
      {
        "start": 72.08,
        "duration": 4.56,
        "text": "that's when the real fun starts the"
      },
      {
        "start": 74.08,
        "duration": 4.8,
        "text": "cluster starts rearranging itself"
      },
      {
        "start": 76.64,
        "duration": 4.4,
        "text": "to make room for this new node the token"
      },
      {
        "start": 78.88,
        "duration": 3.84,
        "text": "ranges are now rearranged to fit the new"
      },
      {
        "start": 81.04,
        "duration": 3.6,
        "text": "token range for that node"
      },
      {
        "start": 82.72,
        "duration": 4.079,
        "text": "and or many nodes if you're using v"
      },
      {
        "start": 84.64,
        "duration": 2.96,
        "text": "nodes and then at that point you're just"
      },
      {
        "start": 86.799,
        "duration": 4.161,
        "text": "moving data"
      },
      {
        "start": 87.6,
        "duration": 5.519,
        "text": "into or out of other nodes this is a"
      },
      {
        "start": 90.96,
        "duration": 3.839,
        "text": "operation that happens runtime you do"
      },
      {
        "start": 93.119,
        "duration": 2.481,
        "text": "not need to bring down anything to make"
      },
      {
        "start": 94.799,
        "duration": 2.881,
        "text": "it happen"
      },
      {
        "start": 95.6,
        "duration": 3.44,
        "text": "and it is pretty cool to watch because"
      },
      {
        "start": 97.68,
        "duration": 3.2,
        "text": "what you get at the end"
      },
      {
        "start": 99.04,
        "duration": 3.84,
        "text": "is a running system that incrementally"
      },
      {
        "start": 100.88,
        "duration": 4.239,
        "text": "grows without any downtime"
      },
      {
        "start": 102.88,
        "duration": 3.68,
        "text": "so how do we do this bootstrapping a"
      },
      {
        "start": 105.119,
        "duration": 3.201,
        "text": "node is pretty simple"
      },
      {
        "start": 106.56,
        "duration": 3.919,
        "text": "so what you're doing is you're changing"
      },
      {
        "start": 108.32,
        "duration": 3.439,
        "text": "the yaml file the cassandra.yaml file"
      },
      {
        "start": 110.479,
        "duration": 3.041,
        "text": "on the node you're going to add to the"
      },
      {
        "start": 111.759,
        "duration": 2.64,
        "text": "system in there you're going to point"
      },
      {
        "start": 113.52,
        "duration": 2.559,
        "text": "out the seed nodes"
      },
      {
        "start": 114.399,
        "duration": 3.04,
        "text": "running nodes inside of the running"
      },
      {
        "start": 116.079,
        "duration": 2.881,
        "text": "cluster and"
      },
      {
        "start": 117.439,
        "duration": 3.121,
        "text": "give it the cluster name those are the"
      },
      {
        "start": 118.96,
        "duration": 3.439,
        "text": "most basic things of course the other"
      },
      {
        "start": 120.56,
        "duration": 4.08,
        "text": "configuration values need to be there"
      },
      {
        "start": 122.399,
        "duration": 3.921,
        "text": "but the cluster name and the c nodes"
      },
      {
        "start": 124.64,
        "duration": 2.96,
        "text": "need to match up with what's running"
      },
      {
        "start": 126.32,
        "duration": 3.04,
        "text": "already in the cluster"
      },
      {
        "start": 127.6,
        "duration": 3.52,
        "text": "so the yaml file stores things like"
      },
      {
        "start": 129.36,
        "duration": 3.12,
        "text": "cluster name native transport address"
      },
      {
        "start": 131.12,
        "duration": 3.04,
        "text": "lists and address seeds"
      },
      {
        "start": 132.48,
        "duration": 3.92,
        "text": "those are all mandatory for getting the"
      },
      {
        "start": 134.16,
        "duration": 3.2,
        "text": "node going but that like i said that"
      },
      {
        "start": 136.4,
        "duration": 2.88,
        "text": "seed node is"
      },
      {
        "start": 137.36,
        "duration": 4.32,
        "text": "really important because that is where"
      },
      {
        "start": 139.28,
        "duration": 4.08,
        "text": "it's at important thing about seed nodes"
      },
      {
        "start": 141.68,
        "duration": 3.36,
        "text": "and this is a confusion that happens a"
      },
      {
        "start": 143.36,
        "duration": 4.08,
        "text": "lot seed nodes are not"
      },
      {
        "start": 145.04,
        "duration": 4.0,
        "text": "masternodes or specially designated or"
      },
      {
        "start": 147.44,
        "duration": 3.92,
        "text": "anything like that"
      },
      {
        "start": 149.04,
        "duration": 3.68,
        "text": "seed nodes are just running nodes that"
      },
      {
        "start": 151.36,
        "duration": 3.44,
        "text": "you happen to designate"
      },
      {
        "start": 152.72,
        "duration": 3.28,
        "text": "you could designate any node in the"
      },
      {
        "start": 154.8,
        "duration": 3.92,
        "text": "system as a"
      },
      {
        "start": 156.0,
        "duration": 3.68,
        "text": "seed node it just has to be running when"
      },
      {
        "start": 158.72,
        "duration": 3.12,
        "text": "you start up"
      },
      {
        "start": 159.68,
        "duration": 4.32,
        "text": "seed nodes don't even have to have all"
      },
      {
        "start": 161.84,
        "duration": 4.32,
        "text": "the same nodes they can all be different"
      },
      {
        "start": 164.0,
        "duration": 3.76,
        "text": "so the seed node is not that super"
      },
      {
        "start": 166.16,
        "duration": 3.6,
        "text": "special just keep in mind"
      },
      {
        "start": 167.76,
        "duration": 4.08,
        "text": "it has to be running something running"
      },
      {
        "start": 169.76,
        "duration": 3.6,
        "text": "in the cluster that it can contact when"
      },
      {
        "start": 171.84,
        "duration": 3.92,
        "text": "it starts up"
      },
      {
        "start": 173.36,
        "duration": 4.48,
        "text": "so what happens when something fails bad"
      },
      {
        "start": 175.76,
        "duration": 4.559,
        "text": "things happen it didn't start up"
      },
      {
        "start": 177.84,
        "duration": 3.2,
        "text": "not to worry you can recover from this"
      },
      {
        "start": 180.319,
        "duration": 2.56,
        "text": "so"
      },
      {
        "start": 181.04,
        "duration": 3.279,
        "text": "if it couldn't connect to the cluster"
      },
      {
        "start": 182.879,
        "duration": 3.201,
        "text": "that's an easy one because"
      },
      {
        "start": 184.319,
        "duration": 3.041,
        "text": "that just means that it didn't start"
      },
      {
        "start": 186.08,
        "duration": 3.36,
        "text": "this not starting"
      },
      {
        "start": 187.36,
        "duration": 3.28,
        "text": "you can recover from pretty quickly you"
      },
      {
        "start": 189.44,
        "duration": 2.719,
        "text": "look at the reason why"
      },
      {
        "start": 190.64,
        "duration": 3.28,
        "text": "most likely it has something to do with"
      },
      {
        "start": 192.159,
        "duration": 3.281,
        "text": "communication maybe you didn't get the"
      },
      {
        "start": 193.92,
        "duration": 3.52,
        "text": "cluster information right"
      },
      {
        "start": 195.44,
        "duration": 3.04,
        "text": "something very basic so that's an easy"
      },
      {
        "start": 197.44,
        "duration": 2.879,
        "text": "one to troubleshoot"
      },
      {
        "start": 198.48,
        "duration": 3.92,
        "text": "look at the logs it'll probably give you"
      },
      {
        "start": 200.319,
        "duration": 3.84,
        "text": "a clear indication the harder one to do"
      },
      {
        "start": 202.4,
        "duration": 4.399,
        "text": "is whenever it started"
      },
      {
        "start": 204.159,
        "duration": 3.121,
        "text": "and it got killed halfway through not"
      },
      {
        "start": 206.799,
        "duration": 2.321,
        "text": "good"
      },
      {
        "start": 207.28,
        "duration": 3.44,
        "text": "now that means we have this node in sort"
      },
      {
        "start": 209.12,
        "duration": 4.08,
        "text": "of a halfway state"
      },
      {
        "start": 210.72,
        "duration": 4.239,
        "text": "meaning that it has joined the cluster"
      },
      {
        "start": 213.2,
        "duration": 3.2,
        "text": "it is not currently running it is an"
      },
      {
        "start": 214.959,
        "duration": 4.0,
        "text": "adjoining state"
      },
      {
        "start": 216.4,
        "duration": 3.52,
        "text": "and half of the data is there how do we"
      },
      {
        "start": 218.959,
        "duration": 2.56,
        "text": "get past that"
      },
      {
        "start": 219.92,
        "duration": 3.28,
        "text": "the first thing to try is just"
      },
      {
        "start": 221.519,
        "duration": 2.8,
        "text": "restarting the node and that should"
      },
      {
        "start": 223.2,
        "duration": 4.08,
        "text": "usually get it going"
      },
      {
        "start": 224.319,
        "duration": 4.401,
        "text": "if it doesn't delete all the data try to"
      },
      {
        "start": 227.28,
        "duration": 3.36,
        "text": "restart the node again"
      },
      {
        "start": 228.72,
        "duration": 3.68,
        "text": "if that fails you need to start"
      },
      {
        "start": 230.64,
        "duration": 4.56,
        "text": "diagnosing what happened"
      },
      {
        "start": 232.4,
        "duration": 4.64,
        "text": "in that bootstrap process after you"
      },
      {
        "start": 235.2,
        "duration": 3.44,
        "text": "bootstrap a node there's a process"
      },
      {
        "start": 237.04,
        "duration": 3.839,
        "text": "called node tool cleanup"
      },
      {
        "start": 238.64,
        "duration": 3.76,
        "text": "no tool cleanup is run on every other"
      },
      {
        "start": 240.879,
        "duration": 3.761,
        "text": "node in the system"
      },
      {
        "start": 242.4,
        "duration": 3.759,
        "text": "so nodetool cleanup's job is to look at"
      },
      {
        "start": 244.64,
        "duration": 3.679,
        "text": "all the ss tables"
      },
      {
        "start": 246.159,
        "duration": 4.8,
        "text": "on that running node and find out if"
      },
      {
        "start": 248.319,
        "duration": 4.801,
        "text": "that data actually pertains to that node"
      },
      {
        "start": 250.959,
        "duration": 3.041,
        "text": "now when you bootstrap a new node into"
      },
      {
        "start": 253.12,
        "duration": 2.88,
        "text": "the cluster"
      },
      {
        "start": 254.0,
        "duration": 3.919,
        "text": "the token ranges are going to change and"
      },
      {
        "start": 256.0,
        "duration": 3.519,
        "text": "those token ranges are really important"
      },
      {
        "start": 257.919,
        "duration": 4.641,
        "text": "for that node for replication"
      },
      {
        "start": 259.519,
        "duration": 4.801,
        "text": "etc well if you start moving token"
      },
      {
        "start": 262.56,
        "duration": 3.52,
        "text": "ranges so you add a new node"
      },
      {
        "start": 264.32,
        "duration": 3.68,
        "text": "there's going to be some data stored on"
      },
      {
        "start": 266.08,
        "duration": 4.72,
        "text": "that local node that is no longer valid"
      },
      {
        "start": 268.0,
        "duration": 4.72,
        "text": "for that node nodetool cleanup reads all"
      },
      {
        "start": 270.8,
        "duration": 4.399,
        "text": "the ss tables and discards"
      },
      {
        "start": 272.72,
        "duration": 4.08,
        "text": "any data that is no longer valid this is"
      },
      {
        "start": 275.199,
        "duration": 2.161,
        "text": "a good way to keep your disk space in"
      },
      {
        "start": 276.8,
        "duration": 2.399,
        "text": "check"
      },
      {
        "start": 277.36,
        "duration": 3.119,
        "text": "and just keep the system healthy and"
      },
      {
        "start": 279.199,
        "duration": 4.161,
        "text": "clean"
      },
      {
        "start": 280.479,
        "duration": 4.72,
        "text": "so how does this work well it's pretty"
      },
      {
        "start": 283.36,
        "duration": 3.279,
        "text": "much a compaction process without the"
      },
      {
        "start": 285.199,
        "duration": 4.0,
        "text": "actual compaction"
      },
      {
        "start": 286.639,
        "duration": 4.881,
        "text": "it will read the ss table and then write"
      },
      {
        "start": 289.199,
        "duration": 3.841,
        "text": "out another ss table in the process"
      },
      {
        "start": 291.52,
        "duration": 3.36,
        "text": "but what it's doing is just doing a"
      },
      {
        "start": 293.04,
        "duration": 3.68,
        "text": "simple comparison it looks at the"
      },
      {
        "start": 294.88,
        "duration": 4.0,
        "text": "partition keys it says is this the"
      },
      {
        "start": 296.72,
        "duration": 4.479,
        "text": "partition key that belongs to this node"
      },
      {
        "start": 298.88,
        "duration": 3.36,
        "text": "if not throws it out if it is it puts it"
      },
      {
        "start": 301.199,
        "duration": 3.761,
        "text": "in the assets table"
      },
      {
        "start": 302.24,
        "duration": 4.16,
        "text": "very simple to run nodetool cleanup that"
      },
      {
        "start": 304.96,
        "duration": 3.28,
        "text": "is a node tool command"
      },
      {
        "start": 306.4,
        "duration": 3.76,
        "text": "very simple you can see some of the"
      },
      {
        "start": 308.24,
        "duration": 3.679,
        "text": "commands here you're running cleanup on"
      },
      {
        "start": 310.16,
        "duration": 3.28,
        "text": "a key space or a table even"
      },
      {
        "start": 311.919,
        "duration": 3.601,
        "text": "most times you're going to run no tool"
      },
      {
        "start": 313.44,
        "duration": 3.52,
        "text": "cleanup if you're bootstrapping a new"
      },
      {
        "start": 315.52,
        "duration": 2.8,
        "text": "node into the cluster"
      },
      {
        "start": 316.96,
        "duration": 3.04,
        "text": "because you now have a lot of"
      },
      {
        "start": 318.32,
        "duration": 3.2,
        "text": "information in the system"
      },
      {
        "start": 320.0,
        "duration": 3.36,
        "text": "it's all over the place every node is"
      },
      {
        "start": 321.52,
        "duration": 2.56,
        "text": "going to need it run it on the entire"
      },
      {
        "start": 323.36,
        "duration": 2.24,
        "text": "system"
      },
      {
        "start": 324.08,
        "duration": 3.04,
        "text": "hopefully this is good information for"
      },
      {
        "start": 325.6,
        "duration": 2.08,
        "text": "you to know when you go to bootstrap a"
      },
      {
        "start": 327.12,
        "duration": 7.68,
        "text": "node"
      },
      {
        "start": 327.68,
        "duration": 7.12,
        "text": "give it a try it's really not that hard"
      }
    ],
    "error": null,
    "error_type": null
  },
  "collected_at": "2025-12-16T01:35:28.801620+00:00"
}